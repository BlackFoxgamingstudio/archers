!function(){function printStackTrace(a){a=a||{guess:!0};var b=a.e||null,c=!!a.guess,d=new printStackTrace.implementation,e=d.run(b);return c?d.guessAnonymousFunctions(e):e}window.pc||(window.pc={},pc.VERSION="0.5.6");var requirejs,require,define;!function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=p.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function d(b,c){return function(){return k.apply(a,s.call(arguments,0).concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[];if(i=i||c,"function"==typeof h){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h.apply(n[c],u),c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){return"string"==typeof b?m[b]?m[b](c):g(l(b,c).f):(b.splice||(p=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k)},k.config=function(a){return p=a,p.deps&&k(p.deps,p.callback),k},define=function(a,c,d){c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),define("../components/almond/almond",function(){}),window.gamecore={hasOwn:Object.prototype.hasOwnProperty,isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},isWindow:function(a){return!(!a||!a.setInterval)},isArray:Array.isArray||function(a){return a.constructor===Array},isString:function(a){return"string"==typeof a},isObject:function(a){return a===Object(a)},isPlainObject:function(a){if(!a||this.isObject(a)||a.nodeType||this.isWindow(a))return!1;try{if(a.constructor&&!this.hasOwn.call(a,"constructor")&&!this.hasOwn.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}var c;for(c in a);return void 0===c||this.hasOwn.call(a,c)},extend:function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||gamecore.isFunction(g)||(g={}),i===h&&(g=this,--h);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(this.isPlainObject(d)||(e=this.isArray(d)))?(e?(e=!1,f=c&&this.isArray(c)?c:[]):f=c&&this.isPlainObject(c)?c:{},g[b]=this.extend(j,f,d)):void 0!==d&&(g[b]=d));return g}},gamecore.push=Array.prototype.push,gamecore.merge=function(a,b){var c=a.length,d=0;if("number"==typeof b.length)for(var e=b.length;e>d;d++)a[c++]=b[d];else for(;void 0!==b[d];)a[c++]=b[d++];return a.length=c,a},gamecore.makeArray=function(a,b){var c=b||[];return null!=a&&(null==a.length||gamecore.isString(a)||gamecore.isFunction(a)||gamecore.isWindow(a)?gamecore.push.call(c,a):gamecore.merge(c,a)),c},gamecore.each=function(a,b,c){var d,e=0,f=a.length,g=void 0===f||gamecore.isFunction(a);if(c)if(g){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;f>e&&b.apply(a[e++],c)!==!1;);else if(g){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;f>e&&b.call(a[e],e,a[e++])!==!1;);return a},gamecore._flagsCache={},gamecore.createFlags=function(a){var b,c,d=gamecore._flagsCache[a]={};for(a=a.split(/\s+/),b=0,c=a.length;c>b;b++)d[a[b]]=!0;return d},gamecore.Callbacks=function(a){a=a?gamecore._flagsCache[a]||gamecore.createFlags(a):{};var b,c,d,e,f,g=[],h=[],i=function(b){var c,d,e;for(c=0,d=b.length;d>c;c++)e=b[c],gamecore.isArray(e)?i(e):gamecore.isFunction(e)&&(a.unique&&k.has(e)||g.push(e))},j=function(i,j){for(j=j||[],b=!a.memory||[i,j],c=!0,f=d||0,d=0,e=g.length;g&&e>f;f++)if(g[f].apply(i,j)===!1&&a.stopOnFalse){b=!0;break}c=!1,g&&(a.once?b===!0?k.disable():g=[]:h&&h.length&&(b=h.shift(),k.fireWith(b[0],b[1])))},k={add:function(){if(g){var a=g.length;i(arguments),c?e=g.length:b&&b!==!0&&(d=a,j(b[0],b[1]))}return this},remove:function(){if(g)for(var b=arguments,d=0,h=b.length;h>d;d++)for(var i=0;i<g.length&&(b[d]!==g[i]||(c&&e>=i&&(e--,f>=i&&f--),g.splice(i--,1),!a.unique));i++);return this},has:function(a){if(g)for(var b=0,c=g.length;c>b;b++)if(a===g[b])return!0;return!1},empty:function(){return g=[],this},disable:function(){return g=h=b=void 0,this},disabled:function(){return!g},lock:function(){return h=void 0,b&&b!==!0||k.disable(),this},locked:function(){return!h},fireWith:function(d,e){return h&&(c?a.once||h.push([d,e]):a.once&&b||j(d,e)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!b}};return k},gamecore.extend({Deferred:function(a){var b,c=gamecore.Callbacks("once memory"),d=gamecore.Callbacks("once memory"),e=gamecore.Callbacks("memory"),f="pending",g={resolve:c,reject:d,notify:e},h={done:c.add,fail:d.add,progress:e.add,state:function(){return f},isResolved:c.fired,isRejected:d.fired,then:function(a,b,c){return i.done(a).fail(b).progress(c),this},always:function(){return i.done.apply(i,arguments).fail.apply(i,arguments),this},pipe:function(a,b,c){return gamecore.Deferred(function(d){gamecore.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c,e=b[0],f=b[1];gamecore.isFunction(e)?i[a](function(){c=e.apply(this,arguments),c&&gamecore.isFunction(c.promise)?c.promise().then(d.resolve,d.reject,d.notify):d[f+"With"](this===i?d:this,[c])}):i[a](d[f])})}).promise()},promise:function(a){if(null==a)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({});for(b in g)i[b]=g[b].fire,i[b+"With"]=g[b].fireWith;return i.done(function(){f="resolved"},d.disable,e.lock).fail(function(){f="rejected"},c.disable,e.lock),a&&a.call(i,i),i},when:function(a){function b(a){return function(b){e[a]=arguments.length>1?d.call(arguments,0):b,--i||j.resolveWith(j,e)}}function c(a){return function(b){h[a]=arguments.length>1?d.call(arguments,0):b,j.notifyWith(k,h)}}var d=[].slice,e=d.call(arguments,0),f=0,g=e.length,h=new Array(g),i=g,j=1>=g&&a&&gamecore.isFunction(a.promise)?a:gamecore.Deferred(),k=j.promise();if(g>1){for(;g>f;f++)e[f]&&e[f].promise&&gamecore.isFunction(e[f].promise)?e[f].promise().then(b(f),j.reject,c(f)):--i;i||j.resolveWith(j,e)}else j!==a&&j.resolveWith(j,g?[a]:[]);return k}}),define("playcraft/ext/gamecore.js/src/gamecore",function(){}),function(a){var b={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},c=function(a,b,c){return a[b]||c&&(a[b]={})},d=function(a){var b=typeof a;return b&&("function"==b||"object"==b)},e=function(e,f,g){var h,i,j,k=e?e.split(b.dot):[],l=k.length,m=a.isArray(f)?f:[f||window],n=0;if(0==l)return m[0];for(;h=m[n++];){for(j=0;l-1>j&&d(h);j++)h=c(h,k[j],g);if(d(h)&&(i=c(h,k[j],g),void 0!==i))return g===!1&&delete h[k[j]],i}},f=a.String={getObject:e,capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},camelize:function(a){return a=f.classize(a),a.charAt(0).toLowerCase()+a.substr(1)},classize:function(a,c){for(var d=a.split(b.undHash),e=0;e<d.length;e++)d[e]=f.capitalize(d[e]);return d.join(c||"")},niceName:function(a){return f.classize(a," ")},underscore:function(a){return a.replace(b.colons,"/").replace(b.words,"$1_$2").replace(b.lowUp,"$1_$2").replace(b.dash,"_").toLowerCase()},sub:function(a,c,d){var f=[];return f.push(a.replace(b.replacer,function(a,b){var g=e(b,c,"boolean"==typeof d?!d:d),h=typeof g;return"object"!==h&&"function"!==h||null===h?""+g:(f.push(g),"")})),f.length<=1?f[0]:f}}}(gamecore),function(a){var b=!1,c=a.makeArray,d=a.isFunction,e=a.isArray,f=a.extend,g=function(a){if(!a||"object"!=typeof a)return a;if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b[c]=g(a[c]);return b}var d={};for(var e in a)d[e]=g(a[e]);return d},h=function(a,b){return a.concat(c(b))},i=/xyz/.test(function(){})?/\b_super\b/:/.*/,j=function(a,b,c){c=c||a;for(var e in a)c[e]=d(a[e])&&d(b[e])&&i.test(a[e])?function(a,c){return function(){var d,e=this._super;return this._super=b[a],d=c.apply(this,arguments),this._super=e,d}}(e,a[e]):a[e]},k=a.Class=function(){return arguments.length?k.extend.apply(k,arguments):void 0};f(k,{callback:function(a){var b,d=c(arguments);return a=d.shift(),e(a)||(a=[a]),b=this,function(){for(var c,f,g=h(d,arguments),i=a.length,j=0;i>j;j++)f=a[j],f&&(c="string"==typeof f,c&&b._set_called&&(b.called=f),g=(c?b[f]:f).apply(b,g||[]),i-1>j&&(g=!e(g)||g._use_call?[g]:g));return g}},getObject:a.String.getObject,newInstance:function(){var a,b=this.rawInstance();b.setup&&(a=b.setup.apply(b,arguments));for(var c in b.__proto__)b[c]=g(b[c]);return b.init&&b.init.apply(b,e(a)?a:arguments),b},setup:function(a){return this.defaults=f(!0,{},a.defaults,this.defaults),void 0==this._types&&(this._types=[]),this._types.push(this.fullName),void 0==this._fullTypeName&&(this._fullTypeName="|"),this._fullTypeName+=this.fullName+"|",arguments},rawInstance:function(){b=!0;var a=new this;return b=!1,a},extend:function(a,c,d){function e(){return b?void 0:this.constructor!==e&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}"string"!=typeof a&&(d=c,c=a,a=null),d||(d=c,c=null),d=d||{};var i,l,m,n,o=this,p=this.prototype;this.isA=function(a){return-1!=this._fullTypeName.indexOf("|"+a+"|")},b=!0,n=new this,b=!1,j(d,p,n);for(i in this)this.hasOwnProperty(i)&&(e[i]=g(this[i]));if(j(c,this,e),a){var q=a.split(/\./),l=q.pop();q.length>0&&(current=k.getObject(q.join("."),window,!0),m=current),current[l]=e}f(e,{prototype:n,namespace:m,shortName:l,constructor:e,fullName:a}),e.prototype.Class=e.prototype.constructor=e;var r=e.setup.apply(e,h([o],arguments));return e.init&&e.init.apply(e,r||[]),e}}),k.prototype.callback=k.callback}(gamecore),define("playcraft/ext/gamecore.js/src/class",function(){}),gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(a){var b="";a&&(b=":"+a)},warn:function(a){this.log(null,this.WARN,a)},debug:function(a){this.log(null,this.DEBUG,a)},error:function(a){this.log(null,this.ERROR,a)},info:function(a){this.log(null,this.INFO,a)},assert:function(a,b){if(!b)throw a}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++,this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(a){this.Class.log(this.objectId,this.Class.WARN,a)},debug:function(a){this.Class.log(this.objectId,this.Class.DEBUG,a)},error:function(a){this.Class.log(this.objectId,this.Class.ERROR,a)},info:function(a){this.Class.log(this.objectId,this.Class.INFO,a)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}}),define("playcraft/ext/gamecore.js/src/base",function(){}),gamecore.Hashtable=function(){function a(b){var c;if("string"==typeof b)return b;if(typeof b.hashCode==k)return c=b.hashCode(),"string"==typeof c?c:a(c);if(typeof b.toString==k)return b.toString();try{return String(b)}catch(d){return Object.prototype.toString.call(b)}}function b(a,b){return a.equals(b)}function c(a,b){return typeof b.equals==k?b.equals(a):a===b}function d(a){return function(b){if(null===b)throw new Error("null is not a valid "+a);if("undefined"==typeof b)throw new Error(a+" must not be undefined")}}function e(a,b,c,d){this[0]=a,this.entries=[],this.addEntry(b,c),null!==d&&(this.getEqualityFunction=function(){return d})}function f(a){return function(b){for(var c,d=this.entries.length,e=this.getEqualityFunction(b);d--;)if(c=this.entries[d],e(b,c[0]))switch(a){case o:return!0;case p:return c;case q:return[d,c[1]]}return!1}}function g(a){return function(b){for(var c=b.length,d=0,e=this.entries.length;e>d;++d)b[c+d]=this.entries[d][a]}}function h(a,b){for(var c,d=a.length;d--;)if(c=a[d],b===c[0])return d;return null}function i(a,b){var c=a[b];return c&&c instanceof e?c:null}function j(b,c){var d=this,f=[],g={},o=typeof b==k?b:a,p=typeof c==k?c:null;this.put=function(a,b){m(a),n(b);var c,d,h=o(a),j=null;return c=i(g,h),c?(d=c.getEntryForKey(a),d?(j=d[1],d[1]=b):c.addEntry(a,b)):(c=new e(h,a,b,p),f[f.length]=c,g[h]=c),j},this.get=function(a){m(a);var b=o(a),c=i(g,b);if(c){var d=c.getEntryForKey(a);if(d)return d[1]}return null},this.containsKey=function(a){m(a);var b=o(a),c=i(g,b);return c?c.containsKey(a):!1},this.containsValue=function(a){n(a);for(var b=f.length;b--;)if(f[b].containsValue(a))return!0;return!1},this.clear=function(){f.length=0,g={}},this.isEmpty=function(){return!f.length};var q=function(a){return function(){for(var b=[],c=f.length;c--;)f[c][a](b);return b}};this.keys=q("keys"),this.values=q("values"),this.entries=q("getEntries"),this.remove=function(a){m(a);var b,c=o(a),d=null,e=i(g,c);return e&&(d=e.removeEntryForKey(a),null!==d&&(e.entries.length||(b=h(f,c),l(f,b),delete g[c]))),d},this.size=function(){for(var a=0,b=f.length;b--;)a+=f[b].entries.length;return a},this.each=function(a){for(var b,c=d.entries(),e=c.length;e--;)b=c[e],a(b[0],b[1])},this.putAll=function(a,b){for(var c,e,f,g,h=a.entries(),i=h.length,j=typeof b==k;i--;)c=h[i],e=c[0],f=c[1],j&&(g=d.get(e))&&(f=b(e,g,f)),d.put(e,f)},this.clone=function(){var a=new j(b,c);return a.putAll(d),a},this.toString=function(){for(var a="",b=this.keys(),c=0;c<b.length;c++){var d=this.get(b[c]);a+=b[c].toString()+" = "+d.toString()+"\n"}return a}}var k="function",l=typeof Array.prototype.splice==k?function(a,b){a.splice(b,1)}:function(a,b){var c,d,e;if(b===a.length-1)a.length=b;else for(c=a.slice(b+1),a.length=b,d=0,e=c.length;e>d;++d)a[b+d]=c[d]},m=d("key"),n=d("value"),o=0,p=1,q=2;return e.prototype={getEqualityFunction:function(a){return typeof a.equals==k?b:c},getEntryForKey:f(p),getEntryAndIndexForKey:f(q),removeEntryForKey:function(a){var b=this.getEntryAndIndexForKey(a);return b?(l(this.entries,b[0]),b[1]):null},addEntry:function(a,b){this.entries[this.entries.length]=[a,b]},keys:g(0),values:g(1),getEntries:function(a){for(var b=a.length,c=0,d=this.entries.length;d>c;++c)a[b+c]=this.entries[c].slice(0)},containsKey:f(o),containsValue:function(a){for(var b=this.entries.length;b--;)if(a===this.entries[b][1])return!0;return!1}},j}(),define("playcraft/ext/gamecore.js/src/jhashtable",function(){}),gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1,this.isiPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.isiPod=-1!=navigator.userAgent.toLowerCase().indexOf("ipod"),this.isiPhone4=2==this.pixelRatio&&this.isiPhone,this.isiPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),this.isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android"),this.isFirefox=-1!=navigator.userAgent.toLowerCase().indexOf("firefox"),this.isChrome=-1!=navigator.userAgent.toLowerCase().indexOf("chrome"),this.isOpera=-1!=navigator.userAgent.toLowerCase().indexOf("opera"),this.isTouch="ontouchstart"in document.documentElement,this.isiOS=this.isiPhone||this.iPad||this.isiPod,void 0!=window.performance&&(this.hasMemoryProfiling=window.performance.memory),/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var a=new Audio;a.canPlayType("audio/ogg")&&(this.canPlayOgg=!0),a.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0),a.canPlayType("audio/x-wav")&&(this.canPlayWav=!0),this.requestAnimFrame=function(){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,16,Date.now())};return function(b,c){a.apply(window,[b,c])}}()},canPlay:function(a){return"mp3"===a.toLowerCase()&&this.canPlayMP3?!0:"ogg"===a.toLowerCase()&&this.canPlayOgg?!0:"wav"===a.toLowerCase()&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{}),define("playcraft/ext/gamecore.js/src/device",function(){}),gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(a){this.description=a,this.start(),this.Class.history.push(this)},start:function(){this.timeStart=Date.now(),this.memStart=gamecore.Device.getUsedHeap()},end:function(){return this.timeEnd=Date.now(),this.timeDelta=this.timeEnd-this.timeStart,this.memEnd=gamecore.Device.getUsedHeap(),this.memDelta=this.memEnd<this.memStart?0:this.memEnd-this.memStart,this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(0==this.memDelta?"unknown":this.memDelta)+" byte(s)"}}),define("playcraft/ext/gamecore.js/src/perf",function(){}),gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}}),gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super(),this.objToNodeMap=new gamecore.Hashtable},getNode:function(a){return this.objToNodeMap.get(a.getUniqueId())},addNode:function(a){var b=new gamecore.LinkedNode;return b.obj=a,b.prevLinked=null,b.nextLinked=null,b.free=!1,this.objToNodeMap.put(a.getUniqueId(),b),b},add:function(a){var b=this.getNode(a);if(null==b)b=this.addNode(a);else{if(0==b.free)throw"Attempting to add object: "+a.getUniqueId()+" twice to list "+this.getUniqueId();b.obj=a,b.free=!1,b.nextLinked=null,b.prevLinked=null}if(null==this.first)this.first=b,this.last=b,b.nextLinked=null,b.prevLinked=null;else{if(null==this.last)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=b,b.prevLinked=this.last,this.last=b,b.nextLinked=null}this.count++,this.showDebug&&this.dump("after add")},has:function(a){var b=this.getNode(a);return!(null==b||1==b.free)},moveUp:function(a){this.dump("before move up");var b=this.getNode(a);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.prevLinked){var c=b.prevLinked,d=c.prevLinked;b==this.last&&(this.last=c);var e=b.nextLinked;d&&(d.nextLinked=b),b.nextLinked=c,b.prevLinked=c.prevLinked,c.nextLinked=e,c.prevLinked=b,this.first==c&&(this.first=b)}},moveDown:function(a){var b=this.getNode(a);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.nextLinked){var c=b.nextLinked;this.moveUp(c.obj),this.last==c&&(this.last=b)}},sort:function(a){for(var b=[],c=this.first;c;)b.push(c.object()),c=c.next();this.clear(),b.sort(a);for(var d=0;d<b.length;d++)this.add(b[d])},remove:function(a){this.showDebug&&this.dump("before remove of "+a);var b=this.getNode(a);return null==b||1==b.free?!1:(null!=b.prevLinked&&(b.prevLinked.nextLinked=b.nextLinked),null!=b.nextLinked&&(b.nextLinked.prevLinked=b.prevLinked),null==b.prevLinked&&(this.first=b.nextLinked),null==b.nextLinked&&(this.last=b.prevLinked),b.free=!0,b.prevLinked=null,b.nextLinked=null,this.count--,this.showDebug&&this.dump("after remove"),!0)},clear:function(){for(var a=this.first;null!=a;)a.free=!0,a=a.nextLinked;this.first=null,this.count=0},length:function(){return this.count},dump:function(a){this.debug("===================="+a+"=====================");for(var b=this.first;null!=b;)this.debug("{"+b.obj.toString()+"} previous="+(b.prevLinked?b.prevLinked.obj:"NULL")),b=b.next();this.debug("==================================="),this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} "+"First: {"+(this.first?this.first.obj:"NULL")+"}")}}),define("playcraft/ext/gamecore.js/src/linkedlist",function(){}),gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(a,b){var c=this.hashtable.get(a);null==c&&(c=new pc.LinkedList,this.hashtable.put(a,c)),c.add(b)},remove:function(a,b){var c=this.hashtable.get(a);if(null==c)throw"No list for a key in hashlist when removing";c.remove(b)},get:function(a){return this.hashtable.get(a)}}),define("playcraft/ext/gamecore.js/src/hashlist",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(a,b){return a=a||this.createException(),b=b||this.mode(a),"other"===b?this.other(arguments.callee):this[b](a)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":"string"==typeof a.message&&"undefined"!=typeof window&&window.opera?a.stacktrace?a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":a.stack?a.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":a.stack?"firefox":"other"},instrumentFunction:function(a,b,c){a=a||window;var d=a[b];a[b]=function(){return c.call(this,printStackTrace().slice(4)),a[b]._instrumented.apply(this,arguments)},a[b]._instrumented=d},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a[b]._instrumented.constructor===Function&&(a[b]=a[b]._instrumented)},chrome:function(a){var b=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return b.pop(),b},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(a){for(var b="{anonymous}",c=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,d=a.stacktrace.split("\n"),e=[],f=0,g=d.length;g>f;f+=2){var h=c.exec(d[f]);if(h){var i=h[4]+":"+h[1]+":"+h[2],j=h[3]||"global code";j=j.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,b),e.push(j+"@"+i+" -- "+d[f+1].replace(/^\s+/,""))}}return e},opera10b:function(a){for(var b=/^(.*)@(.+):(\d+)$/,c=a.stacktrace.split("\n"),d=[],e=0,f=c.length;f>e;e++){var g=b.exec(c[e]);if(g){var h=g[1]?g[1]+"()":"global code";d.push(h+"@"+g[2]+":"+g[3])}}return d},opera10a:function(a){for(var b="{anonymous}",c=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,d=a.stacktrace.split("\n"),e=[],f=0,g=d.length;g>f;f+=2){var h=c.exec(d[f]);if(h){var i=h[3]||b;e.push(i+"()@"+h[2]+":"+h[1]+" -- "+d[f+1].replace(/^\s+/,""))}}return e},opera9:function(a){for(var b="{anonymous}",c=/Line (\d+).*script (?:in )?(\S+)/i,d=a.message.split("\n"),e=[],f=2,g=d.length;g>f;f+=2){var h=c.exec(d[f]);h&&e.push(b+"()@"+h[2]+":"+h[1]+" -- "+d[f+1].replace(/^\s+/,""))}return e},other:function(a){for(var b,c,d="{anonymous}",e=/function\s*([\w\-$]+)?\s*\(/i,f=[],g=10;a&&a.arguments&&f.length<g;)b=e.test(a.toString())?RegExp.$1||d:d,c=Array.prototype.slice.call(a.arguments||[]),f[f.length]=b+"("+this.stringifyArguments(c)+")",a=a.caller;return f},stringifyArguments:function(a){for(var b=[],c=Array.prototype.slice,d=0;d<a.length;++d){var e=a[d];void 0===e?b[d]="undefined":null===e?b[d]="null":e.constructor&&(e.constructor===Array?b[d]=e.length<3?"["+this.stringifyArguments(e)+"]":"["+this.stringifyArguments(c.call(e,0,1))+"..."+this.stringifyArguments(c.call(e,-1))+"]":e.constructor===Object?b[d]="#object":e.constructor===Function?b[d]="#function":e.constructor===String?b[d]='"'+e+'"':e.constructor===Number&&(b[d]=e))}return b.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(b)try{return b.open("GET",a,!1),b.send(null),b.responseText}catch(c){}return""},createXMLHTTPObject:function(){for(var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{return a=b[c](),this.createXMLHTTPObject=b[c],a}catch(d){}},isSameDomain:function(a){return"undefined"!=typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){return a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n")),this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var b=0;b<a.length;++b){var c=/\{anonymous\}\(.*\)@(.*)/,d=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,e=a[b],f=c.exec(e);if(f){var g=d.exec(f[1]);if(g){var h=g[1],i=g[2],j=g[3]||0;if(h&&this.isSameDomain(h)&&i){var k=this.guessAnonymousFunction(h,i,j);a[b]=e.replace("{anonymous}",k)}}}}return a},guessAnonymousFunction:function(a,b){var c;try{c=this.findFunctionName(this.getSource(a),b)}catch(d){c="getSource failed with url: "+a+", exception: "+d.toString()}return c},findFunctionName:function(a,b){for(var c,d,e,f=/function\s+([^(]*?)\s*\(([^)]*)\)/,g=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,h=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,i="",j=Math.min(b,20),k=0;j>k;++k)if(c=a[b-k-1],e=c.indexOf("//"),e>=0&&(c=c.substr(0,e)),c){if(i=c+i,d=g.exec(i),d&&d[1])return d[1];if(d=f.exec(i),d&&d[1])return d[1];if(d=h.exec(i),d&&d[1])return d[1]}return"(?)"}},define("playcraft/ext/gamecore.js/src/stacktrace",function(){}),gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(a){var b=this.getPool(a);return(void 0==b||null==b)&&(b=new gamecore.Pool(a,this.INITIAL_POOL_SIZE),this.pools.put(a.fullName,b)),b.acquire()},release:function(a){var b=this.pools.get(a.Class.fullName);if(void 0==b)throw"Oops, trying to release an object of type "+a.Class.fullName+" but no pool exists. Did you new an object instead of using create.";b.release(a)},getPool:function(a){return this.pools.get(a.fullName)},getStats:function(){for(var a="",b=this.pools.keys(),c=0;c<b.length;c++){var d=b[c],e=this.pools.get(d);a+=d+": "+e.getStats()+"\n"}return a}},{freeList:null,expansion:1,traces:null,init:function(a,b){this._super(),this.classType=a,this.freeList=[],this.expand(b)},startTracing:function(){this.tracing||(this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable)},stopTracing:function(){this.tracing=!1},expand:function(a){gamecore.Pool.totalPooled+=a,this.debug("expanding "+this.classType.fullName+" by "+a+" total="+gamecore.Pool.totalPooled);for(var b=0;a>b;b++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){if(this.freeList.length<=0&&(this.expansion=Math.round(1.2*this.expansion)+1,this.expand(this.expansion)),this.tracing){for(var a=printStackTrace(),b=a.length-1;0==a[b].indexOf("Class.addTo")&&b>0;)b--;var c=this.traces.get(a[b]);null==c?this.traces.put(a[b],{value:1}):c.value++}return this.freeList.pop()},release:function(a){this.freeList.push(a)},getStats:function(){var a=this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){a+="TRACING\n";var b=this.traces.keys();for(var c in b)a+=b[c]+" ("+this.traces.get(b[c]).value+")\n"}return a},dump:function(a){this.info("================== "+a+" ==================="),this.info("FREE"),this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}}),gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(a){var b=this.getPool(a);return(void 0==b||null==b)&&(b=new gamecore.DualPool(a,this.INITIAL_POOL_SIZE),this.pools.put(a.fullName,b)),b.acquire()},getStats:function(){for(var a="",b=this.pools.keys(),c=0;c<b.length;c++){var d=b[c],e=this.pools.get(d);a+=d+" (free: "+e.freeList.length()+" used: "+e.usedList.length()+")\n"}return a}},{freeList:null,usedList:null,init:function(a,b){this.classType=a,this.usedList=new gamecore.LinkedList,this.freeList=new gamecore.LinkedList,this.expand(b)},expand:function(a){gamecore.Pool.totalPooled+=a;for(var b=0;a>b;b++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){if(null==this.freeList.first&&this.expand(Math.round(this.size()/5)+1),this.returnObj=this.freeList.first.obj,this.freeList.remove(this.returnObj),this.returnObj.destroyed=!1,this.usedList.add(this.returnObj),this.tracing){for(var a=printStackTrace(),b=a.length-1;0==a[b].indexOf("Class.addTo")&&b>0;)b--;var c=this.traces.get(a[b]);null==c?this.traces.put(a[b],{value:1}):c.value++}return this.returnObj},release:function(a){this.freeList.add(a),this.usedList.remove(a)},dump:function(a){this.info("================== "+a+" ==================="),this.info("FREE"),this.freeList.dump(),this.info("USED"),this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}}),gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.Pool.release(this)},onRelease:function(){}}),gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.DualPool.release(this)},onRelease:function(){}}),define("playcraft/ext/gamecore.js/src/pooled",function(){}),goog={inherits:function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a}},goog.debug={},goog.debug.Error=function(a){this.stack=Error().stack||"",a&&(this.message=""+a)},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.string={},goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)},goog.string.endsWith=function(a,b){var c=a.length-b.length;return c>=0&&a.indexOf(b,c)==c},goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))},goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))},goog.string.subs=function(a){for(var b=1;b<arguments.length;b++)var c=(""+arguments[b]).replace(/\$/g,"$$$$"),a=a.replace(/\%s/,c);return a},goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(a){return/^[\s\xa0]*$/.test(a)
},goog.string.isEmptySafe=function(a){return goog.string.isEmpty(goog.string.makeSafe(a))},goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)},goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)},goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)},goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)},goog.string.isSpace=function(a){return" "==a},goog.string.isUnicodeChar=function(a){return 1==a.length&&a>=" "&&"~">=a||a>=""&&"�">=a},goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(a,b){var c=(""+a).toLowerCase(),d=(""+b).toLowerCase();return d>c?-1:c==d?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;e>f;f++){var g=c[f],h=d[f];if(g!=h)return c=parseInt(g,10),!isNaN(c)&&(d=parseInt(h,10),!isNaN(d)&&c-d)?c-d:h>g?-1:1}return c.length!=d.length?c.length-d.length:b>a?-1:1},goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/,goog.string.urlEncode=function(a){return a=""+a,goog.string.encodeUriRegExp_.test(a)?a:encodeURIComponent(a)},goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))},goog.string.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")},goog.string.htmlEscape=function(a,b){return b?a.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;"):goog.string.allRe_.test(a)?(-1!=a.indexOf("&")&&(a=a.replace(goog.string.amperRe_,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(goog.string.ltRe_,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(goog.string.gtRe_,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(goog.string.quotRe_,"&quot;")),a):a},goog.string.amperRe_=/&/g,goog.string.ltRe_=/</g,goog.string.gtRe_=/>/g,goog.string.quotRe_=/\"/g,goog.string.allRe_=/[&<>\"]/,goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a},goog.string.unescapeEntitiesUsingDom_=function(a){var b={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},c=document.createElement("div");return a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,d){var e=b[a];if(e)return e;if("#"==d.charAt(0)){var f=Number("0"+d.substr(1));isNaN(f)||(e=String.fromCharCode(f))}return e||(c.innerHTML=a+" ",e=c.firstChild.nodeValue.slice(0,-1)),b[a]=e})},goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,b){switch(b){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==b.charAt(0)){var c=Number("0"+b.substr(1));if(!isNaN(c))return String.fromCharCode(c)}return a}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)},goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;c>d;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a},goog.string.truncate=function(a,b,c){return c&&(a=goog.string.unescapeEntities(a)),a.length>b&&(a=a.substring(0,b-3)+"..."),c&&(a=goog.string.htmlEscape(a)),a},goog.string.truncateMiddle=function(a,b,c,d){if(c&&(a=goog.string.unescapeEntities(a)),d&&a.length>b){d>b&&(d=b);var e=a.length-d,a=a.substring(0,b-d)+"..."+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+"..."+a.substring(e));return c&&(a=goog.string.htmlEscape(a)),a},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(a){if(a=""+a,a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(e>31&&127>e?d:goog.string.escapeChar(d))}return b.push('"'),b.join("")},goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")},goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);return c>31&&127>c?b=a:(256>c?(b="\\x",(16>c||c>256)&&(b+="0")):(b="\\u",4096>c&&(b+="0")),b+=c.toString(16).toUpperCase()),goog.string.jsEscapeCache_[a]=b},goog.string.toMap=function(a){for(var b={},c=0;c<a.length;c++)b[a.charAt(c)]=!0;return b},goog.string.contains=function(a,b){return-1!=a.indexOf(b)},goog.string.removeAt=function(a,b,c){var d=a;return b>=0&&b<a.length&&c>0&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c)),d},goog.string.remove=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"");return a.replace(c,"")},goog.string.removeAll=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"g");return a.replace(c,"")},goog.string.regExpEscape=function(a){return(""+a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(a,b){return Array(b+1).join(a)},goog.string.padNumber=function(a,b,c){return a=goog.isDef(c)?a.toFixed(c):""+a,c=a.indexOf("."),-1==c&&(c=a.length),goog.string.repeat("0",Math.max(0,b-c))+a},goog.string.makeSafe=function(a){return null==a?"":""+a},goog.string.buildString=function(){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(""+a).split("."),e=goog.string.trim(""+b).split("."),f=Math.max(d.length,e.length),g=0;0==c&&f>g;g++){var h=d[g]||"",i=e[g]||"",j=RegExp("(\\d*)(\\D*)","g"),k=RegExp("(\\d*)(\\D*)","g");do{var l=j.exec(h)||["","",""],m=k.exec(i)||["","",""];if(0==l[0].length&&0==m[0].length)break;var c=0==l[1].length?0:parseInt(l[1],10),n=0==m[1].length?0:parseInt(m[1],10),c=goog.string.compareElements_(c,n)||goog.string.compareElements_(0==l[2].length,0==m[2].length)||goog.string.compareElements_(l[2],m[2])}while(0==c)}return c},goog.string.compareElements_=function(a,b){return b>a?-1:a>b?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b},goog.string.uniqueStringCounter_=0|2147483648*Math.random(),goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmpty(a)?0/0:b},goog.string.toCamelCaseCache_={},goog.string.toCamelCase=function(a){return goog.string.toCamelCaseCache_[a]||(goog.string.toCamelCaseCache_[a]=(""+a).replace(/\-([a-z])/g,function(a,b){return b.toUpperCase()}))},goog.string.toSelectorCaseCache_={},goog.string.toSelectorCase=function(a){return goog.string.toSelectorCaseCache_[a]||(goog.string.toSelectorCaseCache_[a]=(""+a).replace(/([A-Z])/g,"-$1").toLowerCase())},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=!0,goog.array.peek=function(a){return a[a.length-1]},goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){if(c=null==c?0:0>c?Math.max(0,a.length+c):c,goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){if(c=null==c?a.length-1:c,0>c&&(c=Math.max(0,a.length+c)),goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;c>=0;c--)if(c in a&&a[c]===b)return c;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(a,b,c){goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)f in e&&b.call(c,e[f],f,a)},goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;d>=0;--d)d in e&&b.call(c,e[d],d,a)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;d>h;h++)if(h in g){var i=g[h];b.call(c,i,h,a)&&(e[f++]=i)}return e},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;d>g;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},goog.array.reduce=function(a,b,c,d){if(a.reduce)return d?a.reduce(goog.bind(b,d),c):a.reduce(b,c);var e=c;return goog.array.forEach(a,function(c,f){e=b.call(d,e,c,f,a)}),e},goog.array.reduceRight=function(a,b,c,d){if(a.reduceRight)return d?a.reduceRight(goog.bind(b,d),c):a.reduceRight(b,c);var e=c;return goog.array.forEachRight(a,function(c,f){e=b.call(d,e,c,f,a)}),e},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(a,b,c){return goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0},goog.array.find=function(a,b,c){return b=goog.array.findIndex(a,b,c),0>b?null:goog.isString(a)?a.charAt(b):a[b]},goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;d>f;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1},goog.array.findRight=function(a,b,c){return b=goog.array.findIndexRight(a,b,c),0>b?null:goog.isString(a)?a.charAt(b):a[b]},goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;d>=0;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1},goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)},goog.array.isEmpty=function(a){return 0==a.length},goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;b>=0;b--)delete a[b];a.length=0},goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)},goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)},goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)},goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)},goog.array.remove=function(a,b){var c,d=goog.array.indexOf(a,b);return(c=d>=0)&&goog.array.removeAt(a,d),c},goog.array.removeAt=function(a,b){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length},goog.array.removeIf=function(a,b,c){return b=goog.array.findIndex(a,b,c),b>=0?(goog.array.removeAt(a,b),!0):!1},goog.array.concat=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.clone=function(a){if(goog.isArray(a))return goog.array.concat(a);for(var b=[],c=0,d=a.length;d>c;c++)b[c]=a[c];return b},goog.array.toArray=function(a){return goog.isArray(a)?goog.array.concat(a):goog.array.clone(a)},goog.array.extend=function(a){for(var b=1;b<arguments.length;b++){var c,d=arguments[b];if(goog.isArray(d)||(c=goog.isArrayLike(d))&&d.hasOwnProperty("callee"))a.push.apply(a,d);else if(c)for(var e=a.length,f=d.length,g=0;f>g;g++)a[e+g]=d[g];else a.push(d)}},goog.array.splice=function(a){return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))},goog.array.slice=function(a,b,c){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)},goog.array.removeDuplicates=function(a,b){for(var c=b||a,d={},e=0,f=0;f<a.length;){var g=a[f++],h=goog.isObject(g)?"o"+goog.getUid(g):(typeof g).charAt(0)+g;Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,c[e++]=g)}c.length=e},goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)},goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)},goog.array.binarySearch_=function(a,b,c,d,e){for(var f,g=0,h=a.length;h>g;){var i,j=g+h>>1;i=c?b.call(e,a[j],j,a):b(d,a[j]),i>0?g=j+1:(h=j,f=!i)}return f?g:~g},goog.array.sort=function(a,b){goog.array.ARRAY_PROTOTYPE_.sort.call(a,b||goog.array.defaultCompare)},goog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;for(goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index}),c=0;c<a.length;c++)a[c]=a[c].value},goog.array.sortObjectsByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(a[b],c[b])})},goog.array.isSorted=function(a,b,c){for(var b=b||goog.array.defaultCompare,d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(e>0||0==e&&c)return!1}return!0},goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;for(var d=a.length,c=c||goog.array.defaultCompareEquality,e=0;d>e;e++)if(!c(a[e],b[e]))return!1;return!0},goog.array.compare=function(a,b,c){return goog.array.equals(a,b,c)},goog.array.compare3=function(a,b,c){for(var c=c||goog.array.defaultCompare,d=Math.min(a.length,b.length),e=0;d>e;e++){var f=c(a[e],b[e]);if(0!=f)return f}return goog.array.defaultCompare(a.length,b.length)},goog.array.defaultCompare=function(a,b){return a>b?1:b>a?-1:0},goog.array.defaultCompareEquality=function(a,b){return a===b},goog.array.binaryInsert=function(a,b,c){return c=goog.array.binarySearch(a,b,c),0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1},goog.array.binaryRemove=function(a,b,c){return b=goog.array.binarySearch(a,b,c),b>=0?goog.array.removeAt(a,b):!1},goog.array.bucket=function(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d],f=b(e,d,a);goog.isDef(f)&&(c[f]||(c[f]=[])).push(e)}return c},goog.array.repeat=function(a,b){for(var c=[],d=0;b>d;d++)c[d]=a;return c},goog.array.flatten=function(){for(var a=[],b=0;b<arguments.length;b++){var c=arguments[b];goog.isArray(c)?a.push.apply(a,goog.array.flatten.apply(null,c)):a.push(c)}return a},goog.array.rotate=function(a,b){return a.length&&(b%=a.length,b>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b))),a},goog.array.zip=function(){if(!arguments.length)return[];for(var a=[],b=0;;b++){for(var c=[],d=0;d<arguments.length;d++){var e=arguments[d];if(b>=e.length)return a;c.push(e[b])}a.push(c)}},goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;d>0;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e],a[e]=f}},goog.structs={},goog.structs.Queue=function(){this.elements_=[]},goog.structs.Queue.prototype.head_=0,goog.structs.Queue.prototype.tail_=0,goog.structs.Queue.prototype.enqueue=function(a){this.elements_[this.tail_++]=a},goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var a=this.elements_[this.head_];return delete this.elements_[this.head_],this.head_++,a}},goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]},goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_},goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_},goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0},goog.structs.Queue.prototype.contains=function(a){return goog.array.contains(this.elements_,a)},goog.structs.Queue.prototype.remove=function(a){return a=goog.array.indexOf(this.elements_,a),0>a?!1:(a==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,a),this.tail_--),!0)},goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};var Box2D={Common:{}};Box2D.Common.Math={},Box2D.Common.Math.b2Vec2=function(a,b){this.x=a,this.y=b},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(a,b){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var c=Box2D.Common.Math.b2Vec2._freeCache.pop();return c.Set(a,b),c}return new Box2D.Common.Math.b2Vec2(a,b)},Box2D.Common.Math.b2Vec2.Free=function(a){null!=a&&Box2D.Common.Math.b2Vec2._freeCache.push(a)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.y=this.x=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(a,b){this.x=a,this.y=b},Box2D.Common.Math.b2Vec2.prototype.SetV=function(a){this.x=a.x,this.y=a.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(a){this.x*=a,this.y*=a},Box2D.Common.Math.b2Vec2.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(a){var b=this.x*a.col1.x+this.y*a.col1.y;this.y=this.x*a.col2.x+this.y*a.col2.y,this.x=b},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(a){var b=this.x;this.x=a*this.y,this.y=-a*b},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(a){var b=this.x;this.x=-a*this.y,this.y=a*b},Box2D.Common.Math.b2Vec2.prototype.MinV=function(a){this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(a){this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var a=this.Length();if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.b2Settings={},Box2D.Common.b2Settings.b2MixFriction=function(a,b){return Math.sqrt(a*b)},Box2D.Common.b2Settings.b2MixRestitution=function(a,b){return a>b?a:b},Box2D.Common.b2Settings.b2Assert=function(a){if(!a)throw"Assertion Failed"},Box2D.Common.b2Settings.VERSION="2.1a-playcraft",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22._freeCache=[],Box2D.Common.Math.b2Mat22.Get=function(){if(0<Box2D.Common.Math.b2Mat22._freeCache.length){var a=Box2D.Common.Math.b2Mat22._freeCache.pop();return a.SetZero(),a}return new Box2D.Common.Math.b2Mat22},Box2D.Common.Math.b2Mat22.Free=function(a){null!=a&&Box2D.Common.Math.b2Mat22._freeCache.push(a)},Box2D.Common.Math.b2Mat22.FromAngle=function(a){var b=Box2D.Common.Math.b2Mat22.Get();return b.Set(a),b},Box2D.Common.Math.b2Mat22.FromVV=function(a,b){var c=Box2D.Common.Math.b2Mat22.Get();return c.SetVV(a,b),c},Box2D.Common.Math.b2Mat22.prototype.Set=function(a){var b=Math.cos(a),a=Math.sin(a);this.col1.Set(b,a),this.col2.Set(-a,b)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var a=Box2D.Common.Math.b2Mat22.Get();return a.SetM(this),a},Box2D.Common.Math.b2Mat22.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(a){this.col1.Add(a.col1),this.col2.Add(a.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(a){var b=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==b&&(b=1/b),a.col1.x=b*this.col2.y,a.col2.x=-b*this.col2.x,a.col1.y=-b*this.col1.y,a.col2.y=b*this.col1.x,a},Box2D.Common.Math.b2Mat22.prototype.Solve=function(a,b,c){var d=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==d&&(d=1/d),a.x=d*(this.col2.y*b-this.col2.x*c),a.y=d*(this.col1.x*c-this.col1.y*b),a},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Math={},Box2D.Common.Math.b2Math.Dot=function(a,b){return a.x*b.x+a.y*b.y},Box2D.Common.Math.b2Math.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},Box2D.Common.Math.b2Math.CrossVF=function(a,b){return Box2D.Common.Math.b2Vec2.Get(b*a.y,-b*a.x)},Box2D.Common.Math.b2Math.CrossFV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(-a*b.y,a*b.x)},Box2D.Common.Math.b2Math.MulMV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)},Box2D.Common.Math.b2Math.MulTMV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(b,a.col1),Box2D.Common.Math.b2Math.Dot(b,a.col2))},Box2D.Common.Math.b2Math.MulX=function(a,b){var c=Box2D.Common.Math.b2Math.MulMV(a.R,b);return c.x+=a.position.x,c.y+=a.position.y,c},Box2D.Common.Math.b2Math.MulXT=function(a,b){var c=Box2D.Common.Math.b2Math.SubtractVV(b,a.position),d=c.x*a.R.col1.x+c.y*a.R.col1.y;return c.y=c.x*a.R.col2.x+c.y*a.R.col2.y,c.x=d,c},Box2D.Common.Math.b2Math.AddVV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(a.x+b.x,a.y+b.y)},Box2D.Common.Math.b2Math.SubtractVV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(a.x-b.x,a.y-b.y)},Box2D.Common.Math.b2Math.Distance=function(a,b){return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(a,b))},Box2D.Common.Math.b2Math.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},Box2D.Common.Math.b2Math.MulFV=function(a,b){return Box2D.Common.Math.b2Vec2.Get(a*b.x,a*b.y)},Box2D.Common.Math.b2Math.AddMM=function(a,b){var c=Box2D.Common.Math.b2Math.AddVV(a.col1,b.col1),d=Box2D.Common.Math.b2Math.AddVV(a.col2,b.col2),e=Box2D.Common.Math.b2Mat22.FromVV(c,d);return Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(d),e},Box2D.Common.Math.b2Math.MulMM=function(a,b){var c=Box2D.Common.Math.b2Math.MulMV(a,b.col1),d=Box2D.Common.Math.b2Math.MulMV(a,b.col2),e=Box2D.Common.Math.b2Mat22.FromVV(c,d);return Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(d),e},Box2D.Common.Math.b2Math.MulTMM=function(a,b){var c=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(a.col1,b.col1),Box2D.Common.Math.b2Math.Dot(a.col2,b.col1)),d=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(a.col1,b.col2),Box2D.Common.Math.b2Math.Dot(a.col2,b.col2)),e=Box2D.Common.Math.b2Mat22.FromVV(c,d);return Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(d),e},Box2D.Common.Math.b2Math.AbsV=function(a){return Box2D.Common.Math.b2Vec2.Get(Math.abs(a.x),Math.abs(a.y))},Box2D.Common.Math.b2Math.AbsM=function(a){var b=Box2D.Common.Math.b2Math.AbsV(a.col1),a=Box2D.Common.Math.b2Math.AbsV(a.col2),c=Box2D.Common.Math.b2Mat22.FromVV(b,a);return Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(a),c},Box2D.Common.Math.b2Math.Clamp=function(a,b,c){return b>a?b:a>c?c:a},Box2D.Common.Math.b2Math.ClampV=function(a,b,c){var d=Box2D.Common.Math.b2Math.Clamp(a.x,b.x,c.x),a=Box2D.Common.Math.b2Math.Clamp(a.y,b.y,c.y);return Box2D.Common.Math.b2Vec2.Get(d,a)},Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2Joint=function(a){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Common.b2Settings.b2Assert(a.bodyA!=a.bodyB),this.m_type=a.type,this.m_next=this.m_prev=null,this.m_bodyA=a.bodyA,this.m_bodyB=a.bodyB,this.m_collideConnected=a.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(a){return a.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(){return!1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2LineJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f;a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;a=c.m_sweep.c.x+g-(b.m_sweep.c.x+d);var f=c.m_sweep.c.y+h-(b.m_sweep.c.y+e),i=b.GetWorldVector(this.m_localXAxis1),j=b.m_linearVelocity,k=c.m_linearVelocity,b=b.m_angularVelocity,c=c.m_angularVelocity;return a*-b*i.y+f*b*i.x+(i.x*(k.x+-c*h-j.x- -b*e)+i.y*(k.y+c*g-j.y-b*d))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation
},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;this.m_localCenterA.SetV(c.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var f=c.GetTransform();d.GetTransform(),b=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y,e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e;b=d.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y,e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;b=d.m_sweep.c.x+i-c.m_sweep.c.x-g,e=d.m_sweep.c.y+j-c.m_sweep.c.y-h,this.m_invMassA=c.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=c.m_invI,this.m_invIB=d.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(f.R,this.m_localXAxis1)),this.m_a1=(b+g)*this.m_axis.y-(e+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(f.R,this.m_localYAxis1)),this.m_s1=(b+g)*this.m_perp.y-(e+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x,f=this.m_invMassA,g=this.m_invMassB,h=this.m_invIA,i=this.m_invIB,this.m_K.col1.x=f+g+h*this.m_s1*this.m_s1+i*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1*this.m_a1+i*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+g+h*this.m_a1*this.m_a1+i*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*e,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):b>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,e=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,f=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*b,c.m_angularVelocity-=this.m_invIA*e,d.m_linearVelocity.x+=this.m_invMassB*a,d.m_linearVelocity.y+=this.m_invMassB*b,d.m_angularVelocity+=this.m_invIB*f):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,f=c.m_linearVelocity,g=c.m_angularVelocity,h=0,i=0,j=0,k=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(k=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e)),h=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+k,-a,a),k=this.m_motorImpulse-h,h=k*this.m_axis.x,i=k*this.m_axis.y,j=k*this.m_a1,k*=this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k),i=this.m_perp.x*(f.x-d.x)+this.m_perp.y*(f.y-d.y)+this.m_s2*g-this.m_s1*e,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(a=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,h=this.m_impulse.Copy(),j=Box2D.Common.Math.b2Vec2.Get(0,0),a=this.m_K.Solve(j,-i,-a),Box2D.Common.Math.b2Vec2.Free(j),this.m_impulse.Add(a),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),i=-i-(this.m_impulse.y-h.y)*this.m_K.col2.x,j=0,j=0!=this.m_K.col1.x?i/this.m_K.col1.x+h.x:h.x,this.m_impulse.x=j,a.x=this.m_impulse.x-h.x,a.y=this.m_impulse.y-h.y,Box2D.Common.Math.b2Vec2.Free(h),h=a.x*this.m_perp.x+a.y*this.m_axis.x,i=a.x*this.m_perp.y+a.y*this.m_axis.y,j=a.x*this.m_s1+a.y*this.m_a1,k=a.x*this.m_s2+a.y*this.m_a2):(a=0,a=0!=this.m_K.col1.x?-i/this.m_K.col1.x:0,this.m_impulse.x+=a,h=a*this.m_perp.x,i=a*this.m_perp.y,j=a*this.m_s1,k=a*this.m_s2),d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k,b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(f),c.m_angularVelocity=g},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB,d=b.m_sweep.c,e=b.m_sweep.a,f=c.m_sweep.c,g=c.m_sweep.a,h=0,i=0,j=0,k=0,l=a=0,m=0,i=!1,n=0,o=Box2D.Common.Math.b2Mat22.FromAngle(e),j=Box2D.Common.Math.b2Mat22.FromAngle(g);a=o;var m=this.m_localAnchor1.x-this.m_localCenterA.x,p=this.m_localAnchor1.y-this.m_localCenterA.y,h=a.col1.x*m+a.col2.x*p,p=a.col1.y*m+a.col2.y*p,m=h;if(a=j,j=this.m_localAnchor2.x-this.m_localCenterB.x,k=this.m_localAnchor2.y-this.m_localCenterB.y,h=a.col1.x*j+a.col2.x*k,k=a.col1.y*j+a.col2.y*k,j=h,a=f.x+j-d.x-m,h=f.y+k-d.y-p,this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(o,this.m_localXAxis1),this.m_a1=(a+m)*this.m_axis.y-(h+p)*this.m_axis.x,this.m_a2=j*this.m_axis.y-k*this.m_axis.x;var q=this.m_axis.x*a+this.m_axis.y*h;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(n=Box2D.Common.Math.b2Math.Clamp(q,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),l=Math.abs(q),i=!0):q<=this.m_lowerTranslation?(n=Box2D.Common.Math.b2Math.Clamp(q-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),l=this.m_lowerTranslation-q,i=!0):q>=this.m_upperTranslation&&(n=Box2D.Common.Math.b2Math.Clamp(q-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),l=q-this.m_upperTranslation,i=!0)}return this.m_perp=Box2D.Common.Math.b2Math.MulMV(o,this.m_localYAxis1),this.m_s1=(a+m)*this.m_perp.y-(h+p)*this.m_perp.x,this.m_s2=j*this.m_perp.y-k*this.m_perp.x,o=Box2D.Common.Math.b2Vec2.Get(0,0),p=this.m_perp.x*a+this.m_perp.y*h,l=Math.max(l,Math.abs(p)),m=0,i?(i=this.m_invMassA,j=this.m_invMassB,k=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=i+j+k*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=k*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=i+j+k*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_K.Solve(o,-p,-n)):(i=this.m_invMassA,j=this.m_invMassB,k=this.m_invIA,a=this.m_invIB,n=i+j+k*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,o.x=0!=n?-p/n:0,o.y=0),n=o.x*this.m_perp.x+o.y*this.m_axis.x,i=o.x*this.m_perp.y+o.y*this.m_axis.y,p=o.x*this.m_s1+o.y*this.m_a1,o=o.x*this.m_s2+o.y*this.m_a2,d.x-=this.m_invMassA*n,d.y-=this.m_invMassA*i,e-=this.m_invIA*p,f.x+=this.m_invMassB*n,f.y+=this.m_invMassB*i,g+=this.m_invIB*o,b.m_sweep.a=e,c.m_sweep.a=g,b.SynchronizeTransform(),c.SynchronizeTransform(),l<=Box2D.Common.b2Settings.b2_linearSlop&&m<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyB=this.bodyA=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Collision={},Box2D.Collision.b2DistanceProxy=function(){this.m_radius=this.m_count=0,this.m_vertices=[]},Box2D.Collision.b2DistanceProxy.prototype.SetValues=function(a,b,c){this.m_count=a,this.m_radius=b,this.m_vertices=c},Box2D.Collision.b2DistanceProxy.prototype.Set=function(a){a.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;d++){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(a){return this.m_vertices[this.GetSupport(a)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(a){return void 0===a&&(a=0),Box2D.Common.b2Settings.b2Assert(a>=0&&a<this.m_count),this.m_vertices[a]},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0),this.t0=this.a=this.a0=null},Box2D.Common.Math.b2Sweep.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var a=new Box2D.Common.Math.b2Sweep;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(a,b){void 0===b&&(b=0),a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y,a.R.Set((1-b)*this.a0+b*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y,a.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(a){if(void 0===a&&(a=0),this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Common.Math.b2Vec3=function(a,b,c){this.x=a,this.y=b,this.z=c},Box2D.Common.Math.b2Vec3._freeCache=[],Box2D.Common.Math.b2Vec3.Get=function(a,b,c){if(0<Box2D.Common.Math.b2Vec3._freeCache.length){var d=Box2D.Common.Math.b2Vec3._freeCache.pop();return d.Set(a,b,c),d}return new Box2D.Common.Math.b2Vec3(a,b,c)},Box2D.Common.Math.b2Vec3.Free=function(a){null!=a&&Box2D.Common.Math.b2Vec3._freeCache.push(a)},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.z=this.y=this.x=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(a,b,c){this.x=a,this.y=b,this.z=c},Box2D.Common.Math.b2Vec3.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec3.Get(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return Box2D.Common.Math.b2Vec3.Get(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(a){this.x*=a,this.y*=a,this.z*=a},Box2D.Common.Math.b2Mat33=function(a,b,c){this.col1=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col2=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col3=Box2D.Common.Math.b2Vec3.Get(0,0,0),a&&this.col1.SetV(a),b&&this.col2.SetV(b),c&&this.col3.SetV(c)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(a,b,c){var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(a,b,c,d){var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},Box2D.Dynamics.Joints.b2PrismaticJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,e=d.y-c.y;return Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(d),a=a.GetWorldVector(this.m_localXAxis1),c=a.x*b+a.y*e,Box2D.Common.Math.b2Vec2.Free(a),c},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f;a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=c.m_sweep.c.x+g-(b.m_sweep.c.x+d),i=c.m_sweep.c.y+h-(b.m_sweep.c.y+e);a=b.GetWorldVector(this.m_localXAxis1);var j=b.m_linearVelocity,k=c.m_linearVelocity,b=b.m_angularVelocity,c=c.m_angularVelocity,d=f*-b*a.y+i*b*a.x+(a.x*(k.x+-c*h-j.x- -b*e)+a.y*(k.y+c*g-j.y-b*d));return Box2D.Common.Math.b2Vec2.Free(a),d},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;this.m_localCenterA.SetV(c.GetLocalCenter()),this.m_localCenterB.SetV(d.GetLocalCenter());var f=c.GetTransform();b=c.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,h=this.m_localAnchor1.y-this.m_localCenterA.y,e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e;b=d.m_xf.R;var i=this.m_localAnchor2.x-this.m_localCenterB.x,j=this.m_localAnchor2.y-this.m_localCenterB.y,e=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=e;b=d.m_sweep.c.x+i-c.m_sweep.c.x-g,e=d.m_sweep.c.y+j-c.m_sweep.c.y-h,this.m_invMassA=c.m_invMass,this.m_invMassB=d.m_invMass,this.m_invIA=c.m_invI,this.m_invIB=d.m_invI;var k=Box2D.Common.Math.b2Math.MulMV(f.R,this.m_localXAxis1);this.m_axis.SetV(k),Box2D.Common.Math.b2Vec2.Free(k),this.m_a1=(b+g)*this.m_axis.y-(e+h)*this.m_axis.x,this.m_a2=i*this.m_axis.y-j*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),f=Box2D.Common.Math.b2Math.MulMV(f.R,this.m_localYAxis1),this.m_perp.SetV(f),Box2D.Common.Math.b2Vec2.Free(f),this.m_s1=(b+g)*this.m_perp.y-(e+h)*this.m_perp.x,this.m_s2=i*this.m_perp.y-j*this.m_perp.x,g=this.m_invMassA,h=this.m_invMassB,i=this.m_invIA,j=this.m_invIB,this.m_K.col1.x=g+h+i*this.m_s1*this.m_s1+j*this.m_s2*this.m_s2,this.m_K.col1.y=i*this.m_s1+j*this.m_s2,this.m_K.col1.z=i*this.m_s1*this.m_a1+j*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=i+j,this.m_K.col2.z=i*this.m_a1+j*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=g+h+i*this.m_a1*this.m_a1+j*this.m_a2*this.m_a2,this.m_enableLimit?(b=this.m_axis.x*b+this.m_axis.y*e,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,b=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,e=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,g=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,c.m_linearVelocity.x-=this.m_invMassA*a,c.m_linearVelocity.y-=this.m_invMassA*b,c.m_angularVelocity-=this.m_invIA*e,d.m_linearVelocity.x+=this.m_invMassB*a,d.m_linearVelocity.y+=this.m_invMassB*b,d.m_angularVelocity+=this.m_invIB*g):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,f=c.m_linearVelocity,g=c.m_angularVelocity,h=0,i=0,j=0,k=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(k=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e)),h=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+k,-a,a),k=this.m_motorImpulse-h,h=k*this.m_axis.x,i=k*this.m_axis.y,j=k*this.m_a1,k*=this.m_a2,d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k),j=this.m_perp.x*(f.x-d.x)+this.m_perp.y*(f.y-d.y)+this.m_s2*g-this.m_s1*e,i=g-e,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(k=this.m_axis.x*(f.x-d.x)+this.m_axis.y*(f.y-d.y)+this.m_a2*g-this.m_a1*e,h=this.m_impulse.Copy(),a=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_K.Solve33(a,-j,-i,-k),this.m_impulse.Add(a),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),j=-j-(this.m_impulse.z-h.z)*this.m_K.col3.x,i=-i-(this.m_impulse.z-h.z)*this.m_K.col3.y,k=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(k,j,i),k.x+=h.x,k.y+=h.y,this.m_impulse.x=k.x,this.m_impulse.y=k.y,Box2D.Common.Math.b2Vec2.Free(k),a.x=this.m_impulse.x-h.x,a.y=this.m_impulse.y-h.y,a.z=this.m_impulse.z-h.z,h=a.x*this.m_perp.x+a.z*this.m_axis.x,i=a.x*this.m_perp.y+a.z*this.m_axis.y,j=a.x*this.m_s1+a.y+a.z*this.m_a1,k=a.x*this.m_s2+a.y+a.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(a)):(a=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(a,-j,-i),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,h=a.x*this.m_perp.x,i=a.x*this.m_perp.y,j=a.x*this.m_s1+a.y,k=a.x*this.m_s2+a.y,Box2D.Common.Math.b2Vec2.Free(a)),d.x-=this.m_invMassA*h,d.y-=this.m_invMassA*i,e-=this.m_invIA*j,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*i,g+=this.m_invIB*k,b.m_linearVelocity.SetV(d),b.m_angularVelocity=e,c.m_linearVelocity.SetV(f),c.m_angularVelocity=g},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.m_sweep.c,d=a.m_sweep.a,e=b.m_sweep.c,f=b.m_sweep.a,g=0,h=0,i=0,j=g=0,k=0,l=0,h=!1,m=0,n=Box2D.Common.Math.b2Mat22.FromAngle(d),l=this.m_localAnchor1.x-this.m_localCenterA.x,o=this.m_localAnchor1.y-this.m_localCenterA.y,g=n.col1.x*l+n.col2.x*o,o=n.col1.y*l+n.col2.y*o;Box2D.Common.Math.b2Mat22.Free(n);var l=g,j=Box2D.Common.Math.b2Mat22.FromAngle(f),p=this.m_localAnchor2.x-this.m_localCenterB.x,i=this.m_localAnchor2.y-this.m_localCenterB.y,g=j.col1.x*p+j.col2.x*i,i=j.col1.y*p+j.col2.y*i;if(Box2D.Common.Math.b2Mat22.Free(j),p=g,g=e.x+p-c.x-l,j=e.y+i-c.y-o,this.m_enableLimit){Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.MulMV(n,this.m_localXAxis1),this.m_a1=(g+l)*this.m_axis.y-(j+o)*this.m_axis.x,this.m_a2=p*this.m_axis.y-i*this.m_axis.x;var q=this.m_axis.x*g+this.m_axis.y*j;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(m=Box2D.Common.Math.b2Math.Clamp(q,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),k=Math.abs(q),h=!0):q<=this.m_lowerTranslation?(m=Box2D.Common.Math.b2Math.Clamp(q-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),k=this.m_lowerTranslation-q,h=!0):q>=this.m_upperTranslation&&(m=Box2D.Common.Math.b2Math.Clamp(q-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),k=q-this.m_upperTranslation,h=!0)}return Box2D.Common.Math.b2Vec2.Free(this.m_perp),this.m_perp=Box2D.Common.Math.b2Math.MulMV(n,this.m_localYAxis1),this.m_s1=(g+l)*this.m_perp.y-(j+o)*this.m_perp.x,this.m_s2=p*this.m_perp.y-i*this.m_perp.x,n=Box2D.Common.Math.b2Vec3.Get(0,0,0),o=this.m_perp.x*g+this.m_perp.y*j,p=f-d-this.m_refAngle,k=Math.max(k,Math.abs(o)),l=Math.abs(p),h?(h=this.m_invMassA,i=this.m_invMassB,g=this.m_invIA,j=this.m_invIB,this.m_K.col1.x=h+i+g*this.m_s1*this.m_s1+j*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1+j*this.m_s2,this.m_K.col1.z=g*this.m_s1*this.m_a1+j*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=g+j,this.m_K.col2.z=g*this.m_a1+j*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=h+i+g*this.m_a1*this.m_a1+j*this.m_a2*this.m_a2,this.m_K.Solve33(n,-o,-p,-m)):(h=this.m_invMassA,i=this.m_invMassB,g=this.m_invIA,j=this.m_invIB,m=g*this.m_s1+j*this.m_s2,q=g+j,this.m_K.col1.Set(h+i+g*this.m_s1*this.m_s1+j*this.m_s2*this.m_s2,m,0),this.m_K.col2.Set(m,q,0),m=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(m,-o,-p),n.x=m.x,n.y=m.y,Box2D.Common.Math.b2Vec2.Free(m),n.z=0),m=n.x*this.m_perp.x+n.z*this.m_axis.x,h=n.x*this.m_perp.y+n.z*this.m_axis.y,o=n.x*this.m_s1+n.y+n.z*this.m_a1,p=n.x*this.m_s2+n.y+n.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(n),c.x-=this.m_invMassA*m,c.y-=this.m_invMassA*h,d-=this.m_invIA*o,e.x+=this.m_invMassB*m,e.y+=this.m_invMassB*h,f+=this.m_invIB*p,a.m_sweep.a=d,b.m_sweep.a=f,a.SynchronizeTransform(),b.SynchronizeTransform(),k<=Box2D.Common.b2Settings.b2_linearSlop&&l<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle},goog.inherits(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(a){return Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(a){return a*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;b=d.m_invMass;var c=e.m_invMass,j=d.m_invI,k=e.m_invI;this.m_mass.col1.x=b+c+g*g*j+i*i*k,this.m_mass.col2.x=-g*f*j-i*h*k,this.m_mass.col3.x=-g*j-i*k,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=b+c+f*f*j+h*h*k,this.m_mass.col3.y=f*j+h*k,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=j+k,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=b*this.m_impulse.x,d.m_linearVelocity.y-=b*this.m_impulse.y,d.m_angularVelocity-=j*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=c*this.m_impulse.x,e.m_linearVelocity.y+=c*this.m_impulse.y,e.m_angularVelocity+=k*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB,e=c.m_linearVelocity,f=c.m_angularVelocity,g=d.m_linearVelocity,h=d.m_angularVelocity,i=c.m_invMass,j=d.m_invMass,k=c.m_invI,l=d.m_invI;a=c.m_xf.R;var m=this.m_localAnchorA.x-c.m_sweep.localCenter.x,n=this.m_localAnchorA.y-c.m_sweep.localCenter.y,b=a.col1.x*m+a.col2.x*n,n=a.col1.y*m+a.col2.y*n,m=b;a=d.m_xf.R;var o=this.m_localAnchorB.x-d.m_sweep.localCenter.x,p=this.m_localAnchorB.y-d.m_sweep.localCenter.y,b=a.col1.x*o+a.col2.x*p,p=a.col1.y*o+a.col2.y*p,o=b;
a=g.x-h*p-e.x+f*n;var b=g.y+h*o-e.y-f*m,q=h-f,r=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(r,-a,-b,-q),this.m_impulse.Add(r),e.x-=i*r.x,e.y-=i*r.y,f-=k*(m*r.y-n*r.x+r.z),g.x+=j*r.x,g.y+=j*r.y,h+=l*(o*r.y-p*r.x+r.z),Box2D.Common.Math.b2Vec3.Free(r),c.m_angularVelocity=f,d.m_angularVelocity=h},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB;a=c.m_xf.R;var e=this.m_localAnchorA.x-c.m_sweep.localCenter.x,f=this.m_localAnchorA.y-c.m_sweep.localCenter.y,b=a.col1.x*e+a.col2.x*f,f=a.col1.y*e+a.col2.y*f,e=b;a=d.m_xf.R;var g=this.m_localAnchorB.x-d.m_sweep.localCenter.x,h=this.m_localAnchorB.y-d.m_sweep.localCenter.y,b=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=b;a=c.m_invMass;var b=d.m_invMass,i=c.m_invI,j=d.m_invI,k=d.m_sweep.c.x+g-c.m_sweep.c.x-e,l=d.m_sweep.c.y+h-c.m_sweep.c.y-f,m=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,n=10*Box2D.Common.b2Settings.b2_linearSlop,o=Math.sqrt(k*k+l*l),p=Math.abs(m);return o>n&&(i*=1,j*=1),this.m_mass.col1.x=a+b+f*f*i+h*h*j,this.m_mass.col2.x=-f*e*i-h*g*j,this.m_mass.col3.x=-f*i-h*j,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=a+b+e*e*i+g*g*j,this.m_mass.col3.y=e*i+g*j,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=i+j,n=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass.Solve33(n,-k,-l,-m),c.m_sweep.c.x-=a*n.x,c.m_sweep.c.y-=a*n.y,c.m_sweep.a-=i*(e*n.y-f*n.x+n.z),d.m_sweep.c.x+=b*n.x,d.m_sweep.c.y+=b*n.y,d.m_sweep.a+=j*(g*n.y-h*n.x+n.z),Box2D.Common.Math.b2Vec3.Free(n),c.SynchronizeTransform(),d.SynchronizeTransform(),o<=Box2D.Common.b2Settings.b2_linearSlop&&p<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},goog.inherits(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2SimplexVertex=function(){this.wA=Box2D.Common.Math.b2Vec2.Get(0,0),this.wB=Box2D.Common.Math.b2Vec2.Get(0,0),this.w=Box2D.Common.Math.b2Vec2.Get(0,0),this.indexB=this.indexA=this.a=0},Box2D.Collision.b2SimplexVertex.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex._freeCache=[],Box2D.Collision.b2Simplex.Get=function(){if(0<Box2D.Collision.b2Simplex._freeCache.length){for(var a=Box2D.Collision.b2Simplex._freeCache.pop(),b=0;b<a.m_vertices.length;b++){var c=a.m_vertices[b];null!=c.wA&&c.wA.Set(0,0),null!=c.wB&&c.wB.Set(0,0),null!=c.w&&c.w.Set(0,0),c.indexA=0,c.indexB=0,c.a=0}return a}return new Box2D.Collision.b2Simplex},Box2D.Collision.b2Simplex.Free=function(a){null!=a&&Box2D.Collision.b2Simplex._freeCache.push(a)},Box2D.Collision.b2Simplex.prototype.ReadCache=function(a,b,c,d,e){Box2D.Common.b2Settings.b2Assert(0<=a.count&&3>=a.count);var f,g;this.m_count=a.count;for(var h=this.m_vertices,i=0;i<this.m_count;i++){var j=h[i];j.indexA=a.indexA[i],j.indexB=a.indexB[i],f=b.GetVertex(j.indexA),g=d.GetVertex(j.indexB),Box2D.Common.Math.b2Vec2.Free(j.wA),Box2D.Common.Math.b2Vec2.Free(j.wB),Box2D.Common.Math.b2Vec2.Free(j.w),j.wA=Box2D.Common.Math.b2Math.MulX(c,f),j.wB=Box2D.Common.Math.b2Math.MulX(e,g),j.w=Box2D.Common.Math.b2Math.SubtractVV(j.wB,j.wA),j.a=0}1<this.m_count&&(a=a.metric,f=this.GetMetric(),.5*a>f||f>2*a||f<Number.MIN_VALUE)&&(this.m_count=0),0==this.m_count&&(j=h[0],j.indexA=0,j.indexB=0,f=b.GetVertex(0),g=d.GetVertex(0),Box2D.Common.Math.b2Vec2.Free(j.wA),Box2D.Common.Math.b2Vec2.Free(j.wB),Box2D.Common.Math.b2Vec2.Free(j.w),j.wA=Box2D.Common.Math.b2Math.MulX(c,f),j.wB=Box2D.Common.Math.b2Math.MulX(e,g),j.w=Box2D.Common.Math.b2Math.SubtractVV(j.wB,j.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=this.m_count;for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=b[c].indexA,a.indexB[c]=b[c].indexB},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count)return this.m_v1.w.GetNegative();if(2==this.m_count){var a=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b=this.m_v1.w.GetNegative(),c=Box2D.Common.Math.b2Math.CrossVV(a,b);return Box2D.Common.Math.b2Vec2.Free(b),b=null,b=c>0?Box2D.Common.Math.b2Math.CrossFV(1,a):Box2D.Common.Math.b2Math.CrossVF(a,1),Box2D.Common.Math.b2Vec2.Free(a),b}return Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):(Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0))},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(a,b){1==this.m_count?(a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB)):2==this.m_count?(a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count?(b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y):Box2D.Common.b2Settings.b2Assert(!1)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){if(1==this.m_count)return 0;if(2==this.m_count){var a=Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w),b=a.Length();return Box2D.Common.Math.b2Vec2.Free(a),b}if(3==this.m_count){var a=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),c=Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w),b=Box2D.Common.Math.b2Math.CrossVV(a,c);return Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(c),b}return Box2D.Common.b2Settings.b2Assert(!1),0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=Box2D.Common.Math.b2Math.SubtractVV(b,a),a=-(a.x*c.x+a.y*c.y);0>=a?(Box2D.Common.Math.b2Vec2.Free(c),this.m_count=this.m_v1.a=1):(b=b.x*c.x+b.y*c.y,Box2D.Common.Math.b2Vec2.Free(c),0>=b?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(c=1/(b+a),this.m_v1.a=b*c,this.m_v2.a=a*c,this.m_count=2))},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=Box2D.Common.Math.b2Math.SubtractVV(b,a),e=Box2D.Common.Math.b2Math.Dot(a,d),f=Box2D.Common.Math.b2Math.Dot(b,d),e=-e,g=Box2D.Common.Math.b2Math.SubtractVV(c,a),h=Box2D.Common.Math.b2Math.Dot(a,g),i=Box2D.Common.Math.b2Math.Dot(c,g),j=Box2D.Common.Math.b2Math.CrossVV(d,g);Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(g);var d=-h,h=Box2D.Common.Math.b2Math.SubtractVV(c,b),k=Box2D.Common.Math.b2Math.Dot(b,h),g=Box2D.Common.Math.b2Math.Dot(c,h);Box2D.Common.Math.b2Vec2.Free(h),h=-k,k=j*Box2D.Common.Math.b2Math.CrossVV(b,c),c=j*Box2D.Common.Math.b2Math.CrossVV(c,a),a=j*Box2D.Common.Math.b2Math.CrossVV(a,b),0>=e&&0>=d?this.m_count=this.m_v1.a=1:f>0&&e>0&&0>=a?(i=1/(f+e),this.m_v1.a=f*i,this.m_v2.a=e*i,this.m_count=2):i>0&&d>0&&0>=c?(f=1/(i+d),this.m_v1.a=i*f,this.m_v3.a=d*f,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=f&&0>=h?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=i&&0>=g?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):g>0&&h>0&&0>=k?(f=1/(g+h),this.m_v2.a=g*f,this.m_v3.a=h*f,this.m_count=2,this.m_v1.Set(this.m_v3)):(f=1/(k+c+a),this.m_v1.a=k*f,this.m_v2.a=c*f,this.m_v3.a=a*f,this.m_count=3)},Box2D.Collision.b2Distance={},Box2D.Collision.b2Distance.Distance=function(a,b,c){var d=Box2D.Collision.b2Simplex.Get();d.ReadCache(b,c.proxyA,c.transformA,c.proxyB,c.transformB),(1>d.m_count||3<d.m_count)&&Box2D.Common.b2Settings.b2Assert(!1);for(var e=0;20>e;){for(var f=[],g=0;g<d.m_count;g++)f[g]={},f[g].indexA=d.m_vertices[g].indexA,f[g].indexB=d.m_vertices[g].indexB;if(2==d.m_count?d.Solve2():3==d.m_count&&d.Solve3(),3==d.m_count)break;if(g=d.GetSearchDirection(),g.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED){Box2D.Common.Math.b2Vec2.Free(g);break}Box2D.Common.Math.b2Vec2.Free(d.m_vertices[d.m_count].wA),Box2D.Common.Math.b2Vec2.Free(d.m_vertices[d.m_count].wB),Box2D.Common.Math.b2Vec2.Free(d.m_vertices[d.m_count].w);var h=g.GetNegative(),i=Box2D.Common.Math.b2Math.MulTMV(c.transformA.R,h);for(Box2D.Common.Math.b2Vec2.Free(h),d.m_vertices[d.m_count].indexA=c.proxyA.GetSupport(i),Box2D.Common.Math.b2Vec2.Free(i),d.m_vertices[d.m_count].wA=Box2D.Common.Math.b2Math.MulX(c.transformA,c.proxyA.GetVertex(d.m_vertices[d.m_count].indexA)),h=Box2D.Common.Math.b2Math.MulTMV(c.transformB.R,g),Box2D.Common.Math.b2Vec2.Free(g),d.m_vertices[d.m_count].indexB=c.proxyB.GetSupport(h),Box2D.Common.Math.b2Vec2.Free(h),d.m_vertices[d.m_count].wB=Box2D.Common.Math.b2Math.MulX(c.transformB,c.proxyB.GetVertex(d.m_vertices[d.m_count].indexB)),d.m_vertices[d.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(d.m_vertices[d.m_count].wB,d.m_vertices[d.m_count].wA),e++,h=!1,g=0;g<f.length;g++)if(d.m_vertices[d.m_count].indexA==f[g].indexA&&d.m_vertices[d.m_count].indexB==f[g].indexB){h=!0;break}if(h)break;d.m_count++}d.GetWitnessPoints(a.pointA,a.pointB),e=Box2D.Common.Math.b2Math.SubtractVV(a.pointA,a.pointB),a.distance=e.Length(),Box2D.Common.Math.b2Vec2.Free(e),d.WriteCache(b),Box2D.Collision.b2Simplex.Free(d),c.useRadii&&(b=c.proxyA.m_radius,c=c.proxyB.m_radius,a.distance>b+c&&a.distance>Number.MIN_VALUE?(a.distance-=b+c,d=Box2D.Common.Math.b2Math.SubtractVV(a.pointB,a.pointA),d.Normalize(),a.pointA.x+=b*d.x,a.pointA.y+=b*d.y,a.pointB.x-=c*d.x,a.pointB.y-=c*d.y,Box2D.Common.Math.b2Vec2.Free(d)):(c=Box2D.Common.Math.b2Vec2.Get(0,0),c.x=.5*(a.pointA.x+a.pointB.x),c.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=c.x,a.pointA.y=a.pointB.y=c.y,a.distance=0,Box2D.Common.Math.b2Vec2.Free(c)))},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2DistanceInput=function(){this.useRadii=!1,this.transformB=this.transformA=this.proxyB=this.proxyA=null},Box2D.Collision.Shapes={},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(a){this.m_radius=a.m_radius},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(a,b,c,d){var e=new Box2D.Collision.b2DistanceInput;return e.proxyA=new Box2D.Collision.b2DistanceProxy,e.proxyA.Set(a),e.proxyB=new Box2D.Collision.b2DistanceProxy,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0,a=new Box2D.Collision.b2SimplexCache,a.count=0,b=new Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2Distance.Distance(b,a,e),Box2D.Common.Math.b2Vec2.Free(b.pointA),Box2D.Common.Math.b2Vec2.Free(b.pointB),b.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(a){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=a,this.m_radiusSquared=a*a,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[this.m_p]},goog.inherits(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var a=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return a.Set(this),a},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(a){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,a),a instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(a.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(a,b){var c=b.x-(a.position.x+(a.R.col1.x*this.m_p.x+a.R.col2.x*this.m_p.y)),d=b.y-(a.position.y+(a.R.col1.y*this.m_p.x+a.R.col2.y*this.m_p.y));return c*c+d*d<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(a,b,c){var d=c.R,e=b.p1.x-(c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y)),c=b.p1.y-(c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y)),d=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y,g=e*d+c*f,h=d*d+f*f,i=g*g-h*(e*e+c*c-this.m_radiusSquared);return 0>i||h<Number.MIN_VALUE?!1:(g=-(g+Math.sqrt(i)),g>=0&&g<=b.maxFraction*h?(g/=h,a.fraction=g,a.normal.x=e+g*d,a.normal.y=c+g*f,a.normal.Normalize(),!0):!1)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),c=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,c-this.m_radius),a.upperBound.Set(d+this.m_radius,c+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(a,b){var c=b*Math.PI*this.m_radiusSquared;a.SetV(c,this.m_p,c*(.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y)))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(a,b,c,d){var c=Box2D.Common.Math.b2Math.MulX(c,this.m_p),e=-(Box2D.Common.Math.b2Math.Dot(a,c)-b);return e<-this.m_radius+Number.MIN_VALUE?(Box2D.Common.Math.b2Vec2.Free(c),0):e>this.m_radius?(Box2D.Common.Math.b2Vec2.Free(c),d.SetV(c),Math.PI*this.m_radiusSquared):(b=e*e,e=this.m_radiusSquared*(Math.asin(e/this.m_radius)+Math.PI/2)+e*Math.sqrt(this.m_radiusSquared-b),b=-2/3*Math.pow(this.m_radiusSquared-b,1.5)/e,d.x=c.x+a.x*b,d.y=c.y+a.y*b,Box2D.Common.Math.b2Vec2.Free(c),e)},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(a){a.SetValues(1,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(a){this.m_radius=a,this.m_radiusSquared=a*a},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Consts={},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Collision.b2AABB=function(){this.lowerBound=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var a=Box2D.Collision.b2AABB._freeCache.pop();return a.SetZero(),a}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(a){null!=a&&Box2D.Collision.b2AABB._freeCache.push(a)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound.Set(0,0),this.upperBound.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return 0>this.upperBound.x-this.lowerBound.x||0>this.upperBound.y-this.lowerBound.y?!1:this.lowerBound.IsValid()&&this.upperBound.IsValid()},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(a){var b=this.GetCenter();this.lowerBound.Subtract(b),this.upperBound.Subtract(b),this.lowerBound.Add(a),this.upperBound.Add(a),Box2D.Common.Math.b2Vec2.Free(b)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(a){var b;return b=(b=(b=(b=this.lowerBound.x<=a.lowerBound.x)&&this.lowerBound.y<=a.lowerBound.y)&&a.upperBound.x<=this.upperBound.x)&&a.upperBound.y<=this.upperBound.y},Box2D.Collision.b2AABB.prototype.RayCast=function(a,b){var c=-Number.MAX_VALUE,d=Number.MAX_VALUE,e=b.p2.x-b.p1.x;if(Math.abs(e)<Number.MIN_VALUE){if(b.p1.x<this.lowerBound.x||this.upperBound.x<b.p1.x)return!1}else{var f=1/e,e=(this.lowerBound.x-b.p1.x)*f,f=(this.upperBound.x-b.p1.x)*f,g=-1;if(e>f&&(g=e,e=f,f=g,g=1),e>c&&(a.normal.x=g,a.normal.y=0,c=e),d=Math.min(d,f),c>d)return!1}if(e=b.p2.y-b.p1.y,Math.abs(e)<Number.MIN_VALUE){if(b.p1.y<this.lowerBound.y||this.upperBound.y<b.p1.y)return!1}else if(f=1/e,e=(this.lowerBound.y-b.p1.y)*f,f*=this.upperBound.y-b.p1.y,g=-1,e>f&&(g=e,e=f,f=g,g=1),e>c&&(a.normal.y=g,a.normal.x=0,c=e),d=Math.min(d,f),c>d)return!1;return a.fraction=c,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(a){return 0<a.lowerBound.x-this.upperBound.x||0<a.lowerBound.y-this.upperBound.y||0<this.lowerBound.x-a.upperBound.x||0<this.lowerBound.y-a.upperBound.y?!1:!0},Box2D.Collision.b2AABB.Combine=function(a,b){var c=Box2D.Collision.b2AABB.Get();return c.Combine(a,b),c},Box2D.Collision.b2AABB.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},Box2D.Dynamics.b2FixtureListNode=function(a){this.fixture=a,this.previous=this.next=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Collision.b2ContactID=function(){this._incidentVertex=this._incidentEdge=this._referenceEdge=this._key=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(a){this._key=a,this._referenceEdge=255&this._key,this._incidentEdge=255&(65280&this._key)>>8,this._incidentVertex=255&(16711680&this._key)>>16,this._flip=255&(4278190080&this._key)>>24},Box2D.Collision.b2ContactID.prototype.Set=function(a){this.SetKey(a._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(a){this._referenceEdge=a,this._key=4294967040&this._key|255&this._referenceEdge},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(a){this._incidentEdge=a,this._key=4294902015&this._key|65280&this._incidentEdge<<8},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(a){this._incidentVertex=a,this._key=4278255615&this._key|16711680&this._incidentVertex<<16},Box2D.Collision.b2ContactID.prototype.SetFlip=function(a){this._flip=a,this._key=16777215&this._key|4278190080&this._flip<<24},Box2D.Collision.b2ContactID.prototype.Copy=function(){var a=new Box2D.Collision.b2ContactID;return a.Set(this),a},Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.m_tangentImpulse=this.m_normalImpulse=0},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},Box2D.Collision.b2DynamicTreeNode=function(a){this.aabb=Box2D.Collision.b2AABB.Get(),this.parent=this.child2=this.child1=null,this.fixture=a},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(a){if("undefined"==typeof a&&(a=null),0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var b=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return b.fixture=a,b.aabb.SetZero(),b}return new Box2D.Collision.b2DynamicTreeNode(a)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.fixture=this.parent=this.child2=this.child1=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2RayCastInput=function(a,b,c){this.p1=Box2D.Common.Math.b2Vec2.Get(a.x,a.y),this.p2=Box2D.Common.Math.b2Vec2.Get(b.x,b.y),this.maxFraction=c},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_insertionCount=this.m_path=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(a,b){var c=Box2D.Collision.b2DynamicTreeNode.Get(b),d=Box2D.Common.b2Settings.b2_aabbExtension,e=Box2D.Common.b2Settings.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-d,c.aabb.lowerBound.y=a.lowerBound.y-e,c.aabb.upperBound.x=a.upperBound.x+d,c.aabb.upperBound.y=a.upperBound.y+e,this.InsertLeaf(c),c},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),a.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(a,b,c){if(Box2D.Common.b2Settings.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var d=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(c.x),c=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(c.y);return a.aabb.lowerBound.x=b.lowerBound.x-d,a.aabb.lowerBound.y=b.lowerBound.y-c,a.aabb.upperBound.x=b.upperBound.x+d,a.aabb.upperBound.y=b.upperBound.y+c,this.InsertLeaf(a),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(a){if(null!==this.m_root)for(var b=0;a>b;b++){for(var c=this.m_root,d=0;!c.IsLeaf();)c=1&this.m_path>>d?c.child2:c.child1,d=31&d+1;this.m_path++,this.RemoveLeaf(c),this.InsertLeaf(c)}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(a){return a.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(a,b,c){if(null!==this.m_root){var d=[];for(d.push(this.m_root);0<d.length;){var e=d.pop();if(e.aabb.TestOverlap(b))if(e.IsLeaf()){if(!a.call(c,e.fixture))break}else d.push(e.child1),d.push(e.child2)}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(a,b){if(null!==this.m_root){var c=Box2D.Common.Math.b2Math.SubtractVV(b.p1,b.p2);c.Normalize();var d=Box2D.Common.Math.b2Math.CrossFV(1,c);Box2D.Common.Math.b2Vec2.Free(c);var c=Box2D.Common.Math.b2Math.AbsV(d),e=b.maxFraction,f=b.p1.x+e*(b.p2.x-b.p1.x),e=b.p1.y+e*(b.p2.y-b.p1.y),g=Box2D.Collision.b2AABB.Get();g.lowerBound.x=Math.min(b.p1.x,f),g.lowerBound.y=Math.min(b.p1.y,e),g.upperBound.x=Math.max(b.p1.x,f),g.upperBound.y=Math.max(b.p1.y,e);var h=[];for(h.push(this.m_root);0<h.length;)if(f=h.pop(),f.aabb.TestOverlap(g)){var e=f.aabb.GetCenter(),i=f.aabb.GetExtents(),j=Math.abs(d.x*(b.p1.x-e.x)+d.y*(b.p1.y-e.y))-c.x*i.x-c.y*i.y;if(Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(i),!(j>0))if(f.IsLeaf()){if(new Box2D.Collision.b2RayCastInput(b.p1,b.p2,b.maxFraction),e=a(b,f.fixture),0==e)break;e>0&&(f=b.p1.x+e*(b.p2.x-b.p1.x),e=b.p1.y+e*(b.p2.y-b.p1.y),g.lowerBound.x=Math.min(b.p1.x,f),g.lowerBound.y=Math.min(b.p1.y,e),g.upperBound.x=Math.max(b.p1.x,f),g.upperBound.y=Math.max(b.p1.y,e))}else h.push(f.child1),h.push(f.child2)}Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(c),Box2D.Collision.b2AABB.Free(g)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(a){if(this.m_insertionCount++,null===this.m_root)this.m_root=a,this.m_root.parent=null;else{var b=this.GetBestSibling(a),c=b.parent,d=Box2D.Collision.b2DynamicTreeNode.Get();if(d.parent=c,d.aabb.Combine(a.aabb,b.aabb),c)for(b.parent.child1==b?c.child1=d:c.child2=d,d.child1=b,d.child2=a,b.parent=d,a.parent=d;c&&!c.aabb.Contains(d.aabb);)c.aabb.Combine(c.child1.aabb,c.child2.aabb),d=c,c=c.parent;else d.child1=b,d.child2=a,b.parent=d,this.m_root=a.parent=d}},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(a){for(var a=a.aabb.GetCenter(),b=this.m_root;!b.IsLeaf();)var c=b.child1,b=b.child2,d=Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-a.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-a.y),e=Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-a.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/2-a.y),b=e>d?c:b;return Box2D.Common.Math.b2Vec2.Free(a),b},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(a){if(a==this.m_root)this.m_root=null;else{var b=a.parent,c=b.parent,a=b.child1==a?b.child2:b.child1;if(c)for(c.child1==b?c.child1=a:c.child2=a,a.parent=c;c&&(a=c.aabb,c.aabb.Combine(c.child1.aabb,c.child2.aabb),!a.Contains(c.aabb));)c=c.parent;else this.m_root=a,a.parent=null;b.Destroy()}},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},Box2D.Collision.b2Manifold=function(){this.m_type=this.m_pointCount=0,this.m_points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=new Box2D.Collision.b2ManifoldPoint;this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++)this.m_points[a].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},Box2D.Collision.b2Manifold.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<Box2D.Common.b2Settings.b2_maxManifoldPoints;b++)this.m_points[b].Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var a=new Box2D.Collision.b2Manifold;return a.Set(this),a},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2Collision={},Box2D.Collision.b2Collision.ClipSegmentToLine=function(a,b,c,d){var e=0,f=b[0].v,g=b[1].v,h=c.x*f.x+c.y*f.y-d,c=c.x*g.x+c.y*g.y-d;return 0>=h&&a[e++].Set(b[0]),0>=c&&a[e++].Set(b[1]),0>h*c&&(c=h/(h-c),d=a[e].v,d.x=f.x+c*(g.x-f.x),d.y=f.y+c*(g.y-f.y),a[e].id=h>0?b[0].id:b[1].id,e++),e},Box2D.Collision.b2Collision.EdgeSeparation=function(a,b,c,d,e){for(var f=b.R.col1.x*a.m_normals[c].x+b.R.col2.x*a.m_normals[c].y,g=b.R.col1.y*a.m_normals[c].x+b.R.col2.y*a.m_normals[c].y,h=e.R.col1.x*f+e.R.col1.y*g,i=e.R.col2.x*f+e.R.col2.y*g,j=0,k=Number.MAX_VALUE,l=0;l<d.m_vertexCount;l++){var m=d.m_vertices[l].x*h+d.m_vertices[l].y*i;k>m&&(k=m,j=l)}return(e.position.x+(e.R.col1.x*d.m_vertices[j].x+e.R.col2.x*d.m_vertices[j].y)-(b.position.x+(b.R.col1.x*a.m_vertices[c].x+b.R.col2.x*a.m_vertices[c].y)))*f+(e.position.y+(e.R.col1.y*d.m_vertices[j].x+e.R.col2.y*d.m_vertices[j].y)-(b.position.y+(b.R.col1.y*a.m_vertices[c].x+b.R.col2.y*a.m_vertices[c].y)))*g},Box2D.Collision.b2Collision.FindMaxSeparation=function(a,b,c,d){for(var e=d.position.x+(d.R.col1.x*c.m_centroid.x+d.R.col2.x*c.m_centroid.y),f=d.position.y+(d.R.col1.y*c.m_centroid.x+d.R.col2.y*c.m_centroid.y),e=e-(b.position.x+(b.R.col1.x*a.m_centroid.x+b.R.col2.x*a.m_centroid.y)),f=f-(b.position.y+(b.R.col1.y*a.m_centroid.x+b.R.col2.y*a.m_centroid.y)),g=e*b.R.col1.x+f*b.R.col1.y,f=e*b.R.col2.x+f*b.R.col2.y,e=0,h=-Number.MAX_VALUE,i=0;i<a.m_vertexCount;++i){var j=a.m_normals[i].x*g+a.m_normals[i].y*f;j>h&&(h=j,e=i)}g=Box2D.Collision.b2Collision.EdgeSeparation(a,b,e,c,d),f=e-1,0>f&&(f=a.m_vertexCount-1),h=Box2D.Collision.b2Collision.EdgeSeparation(a,b,f,c,d),i=e+1,i>=a.m_vertexCount&&(i=0);var j=Box2D.Collision.b2Collision.EdgeSeparation(a,b,i,c,d),k=0,l=0;if(h>g&&h>j)for(k=f,l=h;e=k-1,0>e&&(e=a.m_vertexCount-1),g=Box2D.Collision.b2Collision.EdgeSeparation(a,b,e,c,d),g>l;)k=e,l=g;else if(j>g)for(k=i,l=j;e=k+1,e>=a.m_vertexCount&&(e=0),g=Box2D.Collision.b2Collision.EdgeSeparation(a,b,e,c,d),g>l;)k=e,l=g;else k=e,l=g;return{bestEdge:k,separation:l}},Box2D.Collision.b2Collision.FindIncidentEdge=function(a,b,c,d,e,f){for(var g=c.R.col1.x*b.m_normals[d].x+c.R.col2.x*b.m_normals[d].y,b=c.R.col1.y*b.m_normals[d].x+c.R.col2.y*b.m_normals[d].y,c=f.R.col1.x*g+f.R.col1.y*b,b=f.R.col2.x*g+f.R.col2.y*b,g=c,c=0,h=Number.MAX_VALUE,i=0;i<e.m_vertexCount;i++){var j=g*e.m_normals[i].x+b*e.m_normals[i].y;h>j&&(h=j,c=i)}g=c+1,g>=e.m_vertexCount&&(g=0),a[0].v.x=f.position.x+(f.R.col1.x*e.m_vertices[c].x+f.R.col2.x*e.m_vertices[c].y),a[0].v.y=f.position.y+(f.R.col1.y*e.m_vertices[c].x+f.R.col2.y*e.m_vertices[c].y),a[0].id.SetReferenceEdge(d),a[0].id.SetIncidentEdge(c),a[0].id.SetIncidentVertex(0),a[1].v.x=f.position.x+(f.R.col1.x*e.m_vertices[g].x+f.R.col2.x*e.m_vertices[g].y),a[1].v.y=f.position.y+(f.R.col1.y*e.m_vertices[g].x+f.R.col2.y*e.m_vertices[g].y),a[1].id.SetReferenceEdge(d),a[1].id.SetIncidentEdge(g),a[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(a,b,c,d,e){a.m_pointCount=0;var f=b.m_radius+d.m_radius,g=Box2D.Collision.b2Collision.FindMaxSeparation(b,c,d,e);if(!(g.separation>f)){var h=Box2D.Collision.b2Collision.FindMaxSeparation(d,e,b,c);if(!(h.separation>f)){var i=b,j=d,k=c,l=e,m=0,n=g.bestEdge;if(a.m_type=Box2D.Collision.b2Manifold.e_faceA,h.separation>.98*g.separation+.001&&(i=d,j=b,k=e,l=c,n=h.bestEdge,a.m_type=Box2D.Collision.b2Manifold.e_faceB,m=1),b=Box2D.Collision.b2Collision.s_incidentEdge,Box2D.Collision.b2Collision.FindIncidentEdge(b,i,k,n,j,l),j=i.m_vertices[n],i=n+1<i.m_vertexCount?i.m_vertices[n+1]:i.m_vertices[0],Box2D.Collision.b2Collision.s_localTangent.Set(i.x-j.x,i.y-j.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(.5*(j.x+i.x),.5*(j.y+i.y)),Box2D.Collision.b2Collision.s_tangent.x=k.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+k.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=k.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+k.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=k.position.x+(k.R.col1.x*j.x+k.R.col2.x*j.y),Box2D.Collision.b2Collision.s_v11.y=k.position.y+(k.R.col1.y*j.x+k.R.col2.y*j.y),Box2D.Collision.b2Collision.s_v12.x=k.position.x+(k.R.col1.x*i.x+k.R.col2.x*i.y),Box2D.Collision.b2Collision.s_v12.y=k.position.y+(k.R.col1.y*i.x+k.R.col2.y*i.y),!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,b,Box2D.Collision.b2Collision.s_tangent2,-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+f)||2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+f))){for(a.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),a.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint),k=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y,n=i=0;n<Box2D.Common.b2Settings.b2_maxManifoldPoints;++n)Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[n].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[n].v.y-k<=f&&(j=Box2D.Collision.b2Collision.s_clipPoints2[n].v.x-l.position.x,b=Box2D.Collision.b2Collision.s_clipPoints2[n].v.y-l.position.y,a.m_points[i].m_localPoint.x=j*l.R.col1.x+b*l.R.col1.y,a.m_points[i].m_localPoint.y=j*l.R.col2.x+b*l.R.col2.y,a.m_points[i].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[n].id),a.m_points[i].m_id.SetFlip(m),i++);
a.m_pointCount=i}}}},Box2D.Collision.b2Collision.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f=e.position.x+(e.R.col1.x*d.m_p.x+e.R.col2.x*d.m_p.y)-(c.position.x+(c.R.col1.x*b.m_p.x+c.R.col2.x*b.m_p.y)),c=e.position.y+(e.R.col1.y*d.m_p.x+e.R.col2.y*d.m_p.y)-(c.position.y+(c.R.col1.y*b.m_p.x+c.R.col2.y*b.m_p.y)),e=b.m_radius+d.m_radius;f*f+c*c>e*e||(a.m_type=Box2D.Collision.b2Manifold.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;for(var f=e.position.x+(e.R.col1.x*d.m_p.x+e.R.col2.x*d.m_p.y)-c.position.x,g=e.position.y+(e.R.col1.y*d.m_p.x+e.R.col2.y*d.m_p.y)-c.position.y,e=f*c.R.col1.x+g*c.R.col1.y,c=f*c.R.col2.x+g*c.R.col2.y,f=0,g=-Number.MAX_VALUE,h=b.m_radius+d.m_radius,i=0;i<b.m_vertexCount;++i){var j=b.m_normals[i].x*(e-b.m_vertices[i].x)+b.m_normals[i].y*(c-b.m_vertices[i].y);if(j>h)return;j>g&&(g=j,f=i)}j=f+1,j>=b.m_vertexCount&&(j=0);var i=b.m_vertices[f],k=b.m_vertices[j];g<Number.MIN_VALUE?(a.m_pointCount=1,a.m_type=Box2D.Collision.b2Manifold.e_faceA,a.m_localPlaneNormal.SetV(b.m_normals[f]),a.m_localPoint.x=.5*(i.x+k.x),a.m_localPoint.y=.5*(i.y+k.y),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.SetKey(0)):0>=(e-i.x)*(k.x-i.x)+(c-i.y)*(k.y-i.y)?(e-i.x)*(e-i.x)+(c-i.y)*(c-i.y)>h*h||(a.m_pointCount=1,a.m_type=Box2D.Collision.b2Manifold.e_faceA,a.m_localPlaneNormal.x=e-i.x,a.m_localPlaneNormal.y=c-i.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(i),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.SetKey(0)):0>=(e-k.x)*(i.x-k.x)+(c-k.y)*(i.y-k.y)?(e-k.x)*(e-k.x)+(c-k.y)*(c-k.y)>h*h||(a.m_pointCount=1,a.m_type=Box2D.Collision.b2Manifold.e_faceA,a.m_localPlaneNormal.x=e-k.x,a.m_localPlaneNormal.y=c-k.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(k),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.SetKey(0)):(j=.5*(i.x+k.x),i=.5*(i.y+k.y),g=(e-j)*b.m_normals[f].x+(c-i)*b.m_normals[f].y,g>h||(a.m_pointCount=1,a.m_type=Box2D.Collision.b2Manifold.e_faceA,a.m_localPlaneNormal.x=b.m_normals[f].x,a.m_localPlaneNormal.y=b.m_normals[f].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(j,i),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.SetKey(0)))},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_proxyB=this.m_proxyA=null},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(a,b,c,d,e){this.m_proxyA=b,this.m_proxyB=d;var f=a.count;Box2D.Common.b2Settings.b2Assert(f>0&&3>f);var g,h,i,j,k=h=g=0,l=0,d=b=0,k=0;1==f?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,f=this.m_proxyA.GetVertex(a.indexA[0]),a=this.m_proxyB.GetVertex(a.indexB[0]),j=f,i=c.R,g=c.position.x+(i.col1.x*j.x+i.col2.x*j.y),h=c.position.y+(i.col1.y*j.x+i.col2.y*j.y),j=a,i=e.R,k=e.position.x+(i.col1.x*j.x+i.col2.x*j.y),l=e.position.y+(i.col1.y*j.x+i.col2.y*j.y),this.m_axis.x=k-g,this.m_axis.y=l-h,this.m_axis.Normalize()):a.indexB[0]==a.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),d=this.m_proxyA.GetVertex(a.indexA[1]),a=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(b.x+d.x),this.m_localPoint.y=.5*(b.y+d.y),l=Box2D.Common.Math.b2Math.SubtractVV(d,b),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(l,1),Box2D.Common.Math.b2Vec2.Free(l),this.m_axis.Normalize(),j=this.m_axis,i=c.R,b=i.col1.x*j.x+i.col2.x*j.y,d=i.col1.y*j.x+i.col2.y*j.y,j=this.m_localPoint,i=c.R,g=c.position.x+(i.col1.x*j.x+i.col2.x*j.y),h=c.position.y+(i.col1.y*j.x+i.col2.y*j.y),j=a,i=e.R,k=e.position.x+(i.col1.x*j.x+i.col2.x*j.y),l=e.position.y+(i.col1.y*j.x+i.col2.y*j.y),0>(k-g)*b+(l-h)*d&&this.m_axis.NegativeSelf()):a.indexA[0]==a.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,g=this.m_proxyB.GetVertex(a.indexB[0]),h=this.m_proxyB.GetVertex(a.indexB[1]),f=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(g.x+h.x),this.m_localPoint.y=.5*(g.y+h.y),l=Box2D.Common.Math.b2Math.SubtractVV(h,g),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(l,1),Box2D.Common.Math.b2Vec2.Free(l),this.m_axis.Normalize(),j=this.m_axis,i=e.R,b=i.col1.x*j.x+i.col2.x*j.y,d=i.col1.y*j.x+i.col2.y*j.y,j=this.m_localPoint,i=e.R,k=e.position.x+(i.col1.x*j.x+i.col2.x*j.y),l=e.position.y+(i.col1.y*j.x+i.col2.y*j.y),j=f,i=c.R,g=c.position.x+(i.col1.x*j.x+i.col2.x*j.y),h=c.position.y+(i.col1.y*j.x+i.col2.y*j.y),0>(g-k)*b+(h-l)*d&&this.m_axis.NegativeSelf()):(b=this.m_proxyA.GetVertex(a.indexA[0]),d=this.m_proxyA.GetVertex(a.indexA[1]),g=this.m_proxyB.GetVertex(a.indexB[0]),h=this.m_proxyB.GetVertex(a.indexB[1]),l=Box2D.Common.Math.b2Math.SubtractVV(d,b),k=Box2D.Common.Math.b2Math.MulMV(c.R,l),Box2D.Common.Math.b2Vec2.Free(l),l=Box2D.Common.Math.b2Math.SubtractVV(h,g),i=Box2D.Common.Math.b2Math.MulMV(e.R,l),Box2D.Common.Math.b2Vec2.Free(l),e=k.x*k.x+k.y*k.y,c=i.x*i.x+i.y*i.y,l=Box2D.Common.Math.b2Math.SubtractVV(i,k),a=k.x*l.x+k.y*l.y,f=i.x*l.x+i.y*l.y,Box2D.Common.Math.b2Vec2.Free(l),l=k.x*i.x+k.y*i.y,i=e*c-l*l,k=0,0!=i&&(k=Box2D.Common.Math.b2Math.Clamp((l*f-a*c)/i,0,1)),0>(l*k+f)/c&&(k=Box2D.Common.Math.b2Math.Clamp((l-a)/e,0,1)),f=Box2D.Common.Math.b2Vec2.Get(0,0),f.x=b.x+k*(d.x-b.x),f.y=b.y+k*(d.y-b.y),a=Box2D.Common.Math.b2Vec2.Get(0,0),a.x=g.x+k*(h.x-g.x),a.y=g.y+k*(h.y-g.y),0==k||1==k?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,l=Box2D.Common.Math.b2Math.SubtractVV(h,g),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(l,1),Box2D.Common.Math.b2Vec2.Free(l),this.m_axis.Normalize(),this.m_localPoint=a):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,l=Box2D.Common.Math.b2Math.SubtractVV(d,b),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(l,1),Box2D.Common.Math.b2Vec2.Free(l),this.m_localPoint=f),0>k&&this.m_axis.NegativeSelf(),Box2D.Common.Math.b2Vec2.Free(f),Box2D.Common.Math.b2Vec2.Free(a))},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(a,b){var c=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:var c=Box2D.Common.Math.b2Math.MulTMV(a.R,this.m_axis),d=this.m_axis.GetNegative(),e=Box2D.Common.Math.b2Math.MulTMV(b.R,d);Box2D.Common.Math.b2Vec2.Free(d);var f=this.m_proxyA.GetSupportVertex(c);Box2D.Common.Math.b2Vec2.Free(c),c=this.m_proxyB.GetSupportVertex(e),Box2D.Common.Math.b2Vec2.Free(e),e=Box2D.Common.Math.b2Math.MulX(a,f),f=Box2D.Common.Math.b2Math.MulX(b,c),c=(f.x-e.x)*this.m_axis.x+(f.y-e.y)*this.m_axis.y,Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(f);break;case Box2D.Collision.b2SeparationFunction.e_faceA:d=Box2D.Common.Math.b2Math.MulMV(a.R,this.m_axis),f=d.GetNegative(),e=Box2D.Common.Math.b2Math.MulTMV(b.R,f),Box2D.Common.Math.b2Vec2.Free(f),c=this.m_proxyB.GetSupportVertex(e),Box2D.Common.Math.b2Vec2.Free(e),e=Box2D.Common.Math.b2Math.MulX(a,this.m_localPoint),f=Box2D.Common.Math.b2Math.MulX(b,c),c=(f.x-e.x)*d.x+(f.y-e.y)*d.y,Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(f);break;case Box2D.Collision.b2SeparationFunction.e_faceB:d=Box2D.Common.Math.b2Math.MulMV(b.R,this.m_axis),f=d.GetNegative(),c=Box2D.Common.Math.b2Math.MulTMV(a.R,f),Box2D.Common.Math.b2Vec2.Free(f),f=this.m_proxyA.GetSupportVertex(c),Box2D.Common.Math.b2Vec2.Free(c),e=Box2D.Common.Math.b2Math.MulX(a,f),f=Box2D.Common.Math.b2Math.MulX(b,this.m_localPoint),c=(e.x-f.x)*d.x+(e.y-f.y)*d.y,Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(f);break;default:Box2D.Common.b2Settings.b2Assert(!1)}return c},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Common.Math.b2Transform=function(a,b){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,a&&this.position.SetV(a),b&&this.R.SetM(b)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(a){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var b=a.proxyA,c=a.proxyB,d=a.sweepA,e=a.sweepB;Box2D.Common.b2Settings.b2Assert(d.t0==e.t0),Box2D.Common.b2Settings.b2Assert(1-d.t0>Number.MIN_VALUE);var f=b.m_radius+c.m_radius,a=a.tolerance,g=0,h=0,i=0;for(Box2D.Collision.b2TimeOfImpact.s_cache.count=0,Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(d.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,g),e.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,g),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=b,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=c,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput),0>=Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance){g=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,b,Box2D.Collision.b2TimeOfImpact.s_xfA,c,Box2D.Collision.b2TimeOfImpact.s_xfB);var j=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(0>=j){g=1;break}if(0==h&&(i=j>f?Math.max(f-a,.75*f):Math.max(j-a,.02*f)),.5*a>j-i){if(0==h){g=1;break}break}var k=g,l=g,m=1;d.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,m),e.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,m);var n=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(n>=i){g=1;break}for(var o=0;;){var p=0,p=1&o?l+(i-j)*(m-l)/(n-j):.5*(l+m);d.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,p),e.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,p);var q=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(q-i)<.025*a){k=p;break}if(q>i?(l=p,j=q):(m=p,n=q),o++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++,50==o)break}if(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,o),k<(1+100*Number.MIN_VALUE)*g)break;if(g=k,h++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++,1e3==h)break}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,h),g},Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.Contacts={},Box2D.Dynamics.Contacts.b2Contact=function(a,b){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var c=a.GetBody(),d=b.GetBody();this.continuous=c.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||c.IsBullet()||d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||d.IsBullet(),this.sensor=a.IsSensor()||b.IsSensor(),this.filtering=!1,this.m_fixtureA=a,this.m_fixtureB=b,this.enabled=!0,this.bodyAList=c.GetContactList(),this.bodyBList=d.GetContactList(),this.worldList=d.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(a,b){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var c=a.GetBody(),d=b.GetBody();this.continuous=c.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||c.IsBullet()||d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||d.IsBullet(),this.sensor=a.IsSensor()||b.IsSensor(),this.filtering=!1,this.m_fixtureA=a,this.m_fixtureB=b,this.enabled=!0,this.bodyAList=c.GetContactList(),this.bodyBList=d.GetContactList(),this.worldList=d.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var a=!1,b=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(a=!0),this.IsContinuous()&&(b=!0)),this.bodyAList.UpdateContact(this,a,b),this.bodyBList.UpdateContact(this,a,b),this.worldList.UpdateContact(this,a,b)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(a){this.sensor=a,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(a){this.enabled=a,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(a){var b=this.m_fixtureA.GetBody();return b!=a?b:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.enabled=!0;var b=!1,c=this.IsTouching(),d=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),f=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor)f&&(b=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),d.GetTransform(),this.m_fixtureB.GetShape(),e.GetTransform())),this.m_manifold.m_pointCount=0;else{if(this.continuous=d.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||d.IsBullet()||e.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||e.IsBullet()?!0:!1,f)for(this.Evaluate(),b=0<this.m_manifold.m_pointCount,f=0;f<this.m_manifold.m_pointCount;f++){var g=this.m_manifold.m_points[f];g.m_normalImpulse=0;for(var h=g.m_tangentImpulse=0;h<this.m_oldManifold.m_pointCount;h++){var i=this.m_oldManifold.m_points[h];if(i.m_id.GetKey()==g.m_id.GetKey()){g.m_normalImpulse=i.m_normalImpulse,g.m_tangentImpulse=i.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;b!=c&&(d.SetAwake(!0),e.SetAwake(!0))}this.touching=b,b!=c&&this.UpdateLists(),!c&&b&&a.BeginContact(this),c&&!b&&a.EndContact(this),this.sensor||a.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(a,b){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=a,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=b,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2MassData._freeCache=[],Box2D.Collision.Shapes.b2MassData.Get=function(){if(0<Box2D.Collision.Shapes.b2MassData._freeCache.length){var a=Box2D.Collision.Shapes.b2MassData._freeCache.pop();return a.mass=0,a.center.SetZero(),a.I=0,a}return new Box2D.Collision.Shapes.b2MassData},Box2D.Collision.Shapes.b2MassData.Free=function(a){null!=a&&Box2D.Collision.Shapes.b2MassData._freeCache.push(a)},Box2D.Collision.Shapes.b2MassData.prototype.SetV=function(a,b,c){this.mass=a,this.center.SetV(b),this.I=c},Box2D.Collision.Shapes.b2MassData.prototype.Set=function(a,b,c,d){this.mass=a,this.center.Set(b,c),this.I=d},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},goog.inherits(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var a=new Box2D.Collision.Shapes.b2PolygonShape;return a.Set(this),a},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(a){if(Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,a),a instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(a.m_centroid),this.m_vertexCount=a.m_vertexCount,this.Reserve(this.m_vertexCount);for(var b=0;b<this.m_vertexCount;b++)this.m_vertices[b].SetV(a.m_vertices[b]),this.m_normals[b].SetV(a.m_normals[b])}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(a){this.SetAsVector(a)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(a){var b=new Box2D.Collision.Shapes.b2PolygonShape;return b.SetAsArray(a),b},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(a){var b=a.length;for(Box2D.Common.b2Settings.b2Assert(b>=2),this.m_vertexCount=b,this.Reserve(b),b=b=0;b<this.m_vertexCount;b++)this.m_vertices[b].SetV(a[b]);for(b=0;b<this.m_vertexCount;++b){a=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[b+1<this.m_vertexCount?b+1:0],this.m_vertices[b]),Box2D.Common.b2Settings.b2Assert(a.LengthSquared()>Number.MIN_VALUE);var c=Box2D.Common.Math.b2Math.CrossVF(a,1);Box2D.Common.Math.b2Vec2.Free(a),this.m_normals[b].SetV(c),Box2D.Common.Math.b2Vec2.Free(c),this.m_normals[b].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(a){var b=new Box2D.Collision.Shapes.b2PolygonShape;return b.SetAsVector(a),b},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(a,b){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(a,b){var c=new Box2D.Collision.Shapes.b2PolygonShape;return c.SetAsBox(a,b),c},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(a,b,c,d){for(this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c,a=new Box2D.Common.Math.b2Mat22,a.Set(d),c=new Box2D.Common.Math.b2Transform(c,a),d=0;d<this.m_vertexCount;++d)this.m_vertices[d]=Box2D.Common.Math.b2Math.MulX(c,this.m_vertices[d]),this.m_normals[d]=Box2D.Common.Math.b2Math.MulMV(c.R,this.m_normals[d])},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(a,b,c,d){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsOrientedBox(a,b,c,d),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y);var c=Box2D.Common.Math.b2Math.SubtractVV(b,a),d=Box2D.Common.Math.b2Math.CrossVF(c,1);Box2D.Common.Math.b2Vec2.Free(c),this.m_normals[0]=d,Box2D.Common.Math.b2Vec2.Free(d),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(a,b){var c=new Box2D.Collision.Shapes.b2PolygonShape;return c.SetAsEdge(a,b),c},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(a,b){var c;c=a.R;for(var d=b.x-a.position.x,e=b.y-a.position.y,f=d*c.col1.x+e*c.col1.y,g=d*c.col2.x+e*c.col2.y,h=0;h<this.m_vertexCount;++h)if(c=this.m_vertices[h],d=f-c.x,e=g-c.y,c=this.m_normals[h],0<c.x*d+c.y*e)return!1;return!0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(a,b,c){var d,e,f=0,g=b.maxFraction,h=0,i=0,h=b.p1.x-c.position.x,i=b.p1.y-c.position.y;d=c.R;var j=h*d.col1.x+i*d.col1.y,k=h*d.col2.x+i*d.col2.y,h=b.p2.x-c.position.x,i=b.p2.y-c.position.y;d=c.R,b=h*d.col1.x+i*d.col1.y-j,d=h*d.col2.x+i*d.col2.y-k;for(var l=-1,m=0;m<this.m_vertexCount;++m){if(e=this.m_vertices[m],h=e.x-j,i=e.y-k,e=this.m_normals[m],h=e.x*h+e.y*i,i=e.x*b+e.y*d,0==i){if(0>h)return!1}else 0>i&&f*i>h?(f=h/i,l=m):i>0&&g*i>h&&(g=h/i);if(g<f-Number.MIN_VALUE)return!1}return l>=0?(a.fraction=f,d=c.R,e=this.m_normals[l],a.normal.x=d.col1.x*e.x+d.col2.x*e.y,a.normal.y=d.col1.y*e.x+d.col2.y*e.y,!0):!1},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i)var d=this.m_vertices[i],j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),d=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),e=j>e?e:j,f=d>f?f:d,g=g>j?g:j,h=h>d?h:d;a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(a,b){if(2==this.m_vertexCount)a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var c=0,d=0,e=0,f=0,g=1/3,h=0;h<this.m_vertexCount;++h)var i=this.m_vertices[h],j=h+1<this.m_vertexCount?this.m_vertices[h+1]:this.m_vertices[0],k=i.x-0,l=i.y-0,m=j.x-0,n=j.y-0,o=k*n-l*m,p=.5*o,e=e+p,c=c+p*g*(0+i.x+j.x),d=d+p*g*(0+i.y+j.y),i=k,f=f+o*(g*(.25*(i*i+m*i+m*m)+(0*i+0*m))+0+(g*(.25*(l*l+n*l+n*n)+(0*l+0*n))+0));a.Set(b*e,c*(1/e),d*(1/e),b*f)}},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(a,b,c,d){for(var e=Box2D.Common.Math.b2Math.MulTMV(c.R,a),f=b-Box2D.Common.Math.b2Math.Dot(a,c.position),g=[],h=0,i=-1,b=-1,j=!1,a=a=0;a<this.m_vertexCount;++a){g[a]=Box2D.Common.Math.b2Math.Dot(e,this.m_vertices[a])-f;var k=g[a]<-Number.MIN_VALUE;a>0&&(k?j||(i=a-1,h++):j&&(b=a-1,h++)),j=k}switch(Box2D.Common.Math.b2Vec2.Free(e),h){case 0:return j?(a=Box2D.Collision.Shapes.b2MassData.Get(),this.ComputeMass(a,1),c=Box2D.Common.Math.b2Math.MulX(c,a.center),d.SetV(c),Box2D.Common.Math.b2Vec2.Free(c),d=a.mass,Box2D.Collision.Shapes.b2MassData.Free(a),d):0;case 1:-1==i?i=this.m_vertexCount-1:b=this.m_vertexCount-1}for(a=(i+1)%this.m_vertexCount,e=(b+1)%this.m_vertexCount,f=(0-g[i])/(g[a]-g[i]),g=(0-g[b])/(g[e]-g[b]),i=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[i].x*(1-f)+this.m_vertices[a].x*f,this.m_vertices[i].y*(1-f)+this.m_vertices[a].y*f),f=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[b].x*(1-g)+this.m_vertices[e].x*g,this.m_vertices[b].y*(1-g)+this.m_vertices[e].y*g),b=0,g=Box2D.Common.Math.b2Vec2.Get(0,0),h=this.m_vertices[a];a!=e;)a=(a+1)%this.m_vertexCount,j=a==e?f:this.m_vertices[a],k=.5*((h.x-i.x)*(j.y-i.y)-(h.y-i.y)*(j.x-i.x)),b+=k,g.x+=k*(i.x+h.x+j.x)/3,g.y+=k*(i.y+h.y+j.y)/3,h=j;return Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(f),g.Multiply(1/b),c=Box2D.Common.Math.b2Math.MulX(c,g),Box2D.Common.Math.b2Vec2.Free(g),d.SetV(c),Box2D.Common.Math.b2Vec2.Free(c),b},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(a){a.SetValues(this.m_vertexCount,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(a){for(var b=0;b<this.m_vertices.length;b++)Box2D.Common.Math.b2Vec2.Free(this.m_vertices[b]),Box2D.Common.Math.b2Vec2.Free(this.m_normals[b]);for(this.m_vertices=[],this.m_normals=[],b=0;a>b;b++)this.m_vertices[b]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[b]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(a,b){for(var c=Box2D.Common.Math.b2Vec2.Get(0,0),d=0,e=1/3,f=0;b>f;++f){var g=a[f],h=b>f+1?a[f+1]:a[0],i=.5*((g.x-0)*(h.y-0)-(g.y-0)*(h.x-0)),d=d+i;c.x+=i*e*(0+g.x+h.x),c.y+=i*e*(0+g.y+h.y)}return c.x*=1/d,c.y*=1/d,c},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.Shapes.b2EdgeShape=function(a,b){Box2D.Collision.Shapes.b2Shape.call(this),this.m_nextEdge=this.m_prevEdge=null,this.m_v1=a,this.m_v2=b,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex2=this.m_cornerConvex1=!1},goog.inherits(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(){return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(a,b,c){var d=b.p2.x-b.p1.x,e=b.p2.y-b.p1.y,f=c.R,g=c.position.x+(f.col1.x*this.m_v1.x+f.col2.x*this.m_v1.y),h=c.position.y+(f.col1.y*this.m_v1.x+f.col2.y*this.m_v1.y),i=c.position.y+(f.col1.y*this.m_v2.x+f.col2.y*this.m_v2.y)-h,c=-(c.position.x+(f.col1.x*this.m_v2.x+f.col2.x*this.m_v2.y)-g),f=100*Number.MIN_VALUE,j=-(d*i+e*c);if(j>f){var g=b.p1.x-g,k=b.p1.y-h,h=g*i+k*c;if(h>=0&&h<=b.maxFraction*j&&(b=-d*k+e*g,b>=-f*j&&j*(1+f)>=b))return a.fraction=h/j,b=Math.sqrt(i*i+c*c),a.normal.x=i/b,a.normal.y=c/b,!0}return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),c=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);f>d?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),c>e?(a.lowerBound.y=e,a.upperBound.y=c):(a.lowerBound.y=c,a.upperBound.y=e)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(a){a.mass=0,a.center.SetV(this.m_v1),a.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=Box2D.Common.Math.b2Vec2.Get(a.x*b,a.y*b),f=Box2D.Common.Math.b2Math.MulX(c,this.m_v1),c=Box2D.Common.Math.b2Math.MulX(c,this.m_v2),g=Box2D.Common.Math.b2Math.Dot(a,f)-b,a=Box2D.Common.Math.b2Math.Dot(a,c)-b;if(g>0){if(a>0)return 0;f.x=-a/(g-a)*f.x+g/(g-a)*c.x,f.y=-a/(g-a)*f.y+g/(g-a)*c.y}else a>0&&(c.x=-a/(g-a)*f.x+g/(g-a)*c.x,c.y=-a/(g-a)*f.y+g/(g-a)*c.y);return d.x=(e.x+f.x+c.x)/3,d.y=(e.y+f.y+c.y)/3,.5*((f.x-e.x)*(c.y-e.y)-(f.y-e.y)*(c.x-e.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal
},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(a){var b=a.R;return Box2D.Common.Math.b2Vec2.Get(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(a,b,c){var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),a=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+a*c?Box2D.Common.Math.b2Vec2.Get(e,f):Box2D.Common.Math.b2Vec2.Get(g,a)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(a,b){Box2D.Common.b2Settings.b2Assert(a.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(b.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.call(this,a,b)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(a,b){Box2D.Common.b2Settings.b2Assert(a.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(b.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,a,b)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},Box2D.Dynamics.b2TimeStep=function(a,b,c,d,e){this.Reset(a,b,c,d,e)},Box2D.Dynamics.b2TimeStep.prototype.Reset=function(a,b,c,d,e){this.dt=a;var f=0;a>0&&(f=1/a),this.inv_dt=f,this.dtRatio=b,this.positionIterations=c,this.velocityIterations=d,this.warmStarting=e},Box2D.Dynamics.Joints.b2FrictionJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new Box2D.Common.Math.b2Vec2.Get(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(a){void 0===a&&(a=0),this.m_maxTorque=a},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;b=d.m_invMass;var c=e.m_invMass,j=d.m_invI,k=e.m_invI,l=new b2Mat22;l.col1.x=b+c,l.col2.x=0,l.col1.y=0,l.col2.y=b+c,l.col1.x+=j*g*g,l.col2.x+=-j*f*g,l.col1.y+=-j*f*g,l.col2.y+=j*f*f,l.col1.x+=k*i*i,l.col2.x+=-k*h*i,l.col1.y+=-k*h*i,l.col2.y+=k*h*h,l.GetInverse(this.m_linearMass),this.m_angularMass=j+k,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,d.m_linearVelocity.x-=b*a.x,d.m_linearVelocity.y-=b*a.y,d.m_angularVelocity-=j*(f*a.y-g*a.x+this.m_angularImpulse),e.m_linearVelocity.x+=c*a.x,e.m_linearVelocity.y+=c*a.y,e.m_angularVelocity+=k*(h*a.y-i*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,f=d.m_linearVelocity,g=d.m_angularVelocity,h=e.m_linearVelocity,i=e.m_angularVelocity,j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;b=d.m_xf.R;var n=this.m_localAnchorA.x-d.m_sweep.localCenter.x,o=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c;b=e.m_xf.R;var p=this.m_localAnchorB.x-e.m_sweep.localCenter.x,q=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c;b=0;var c=-this.m_angularMass*(i-g),r=this.m_angularImpulse;b=a.dt*this.m_maxTorque,this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+c,-b,b),c=this.m_angularImpulse-r,g-=l*c,i+=m*c,b=Box2D.Common.Math.b2Vec2.Get(-(h.x-i*q-f.x+g*o),-(h.y+i*p-f.y-g*n)),b.MulM(this.m_linearMass),c=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(b),Box2D.Common.Math.b2Vec2.Free(b),b=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b)),b=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,c),Box2D.Common.Math.b2Vec2.Free(c),f.x-=j*b.x,f.y-=j*b.y,g-=l*(n*b.y-o*b.x),h.x+=k*b.x,h.y+=k*b.y,i+=m*(p*b.y-q*b.x),Box2D.Common.Math.b2Vec2.Free(b),d.m_angularVelocity=g,e.m_angularVelocity=i},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var a=new Box2D.Dynamics.b2FilterData;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},Box2D.Dynamics.b2Fixture=function(a,b,c){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=c.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_aabb_temp=Box2D.Collision.b2AABB.Get(),this.m_body=a,this.m_shape=c.shape.Copy(),this.m_density=c.density,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_isSensor=c.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){var b=a.contact.GetFixtureA(),c=a.contact.GetFixtureB();(b==this||c==this)&&a.contact.SetSensor(b.IsSensor()||c.IsSensor())}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),null!=this.m_body)for(a=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())(a.contact.GetFixtureA()==this||a.contact.GetFixtureB()==this)&&a.contact.FlagForFiltering()},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(a){return a||(a=Box2D.Collision.Shapes.b2MassData.Get()),this.m_shape.ComputeMass(a,this.m_density),a},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(a){this.m_density=a},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(a){this.m_friction=a},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(a){this.m_restitution=a},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(a,b,c){this.m_proxy&&(this.m_shape.ComputeAABB(this.m_aabb,b),this.m_shape.ComputeAABB(this.m_aabb_temp,c),this.m_aabb.Combine(this.m_aabb,this.m_aabb_temp),b=Box2D.Common.Math.b2Math.SubtractVV(c.position,b.position),a.MoveProxy(this.m_proxy,this.m_aabb,b),Box2D.Common.Math.b2Vec2.Free(b))},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.iContactListener=function(){},Box2D.Dynamics.iContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.iContactListener.prototype.EndContact=function(){},Box2D.Dynamics.iContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.iContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.Contacts.b2CircleContact=function(a,b){Box2D.Dynamics.Contacts.b2Contact.call(this,a,b)},goog.inherits(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(a,b){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,a,b)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetShape(),b=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,a,this.m_fixtureA.GetBody().m_xf,b,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(a,b){Box2D.Dynamics.Contacts.b2Contact.call(this,a,b)},goog.inherits(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(a,b){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,a,b)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody(),this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_motorMass=0},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(a){this.m_enableLimit=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_lowerAngle=a,this.m_upperAngle=b},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(a){this.m_enableMotor=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0),this.m_maxMotorTorque=a},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB,e=0;b=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y;e=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=e,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;e=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=e;var j=c.m_invMass,k=d.m_invMass,l=c.m_invI,m=d.m_invI;if(this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,this.m_motorMass=0==l+m?0:.01,this.m_enableMotor||(this.m_motorImpulse=0),this.m_enableLimit){var n=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:n<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):n>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(a.warmStarting){this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio;var o=this.m_impulse.x,p=this.m_impulse.y;c.m_linearVelocity.x-=j*o,c.m_linearVelocity.y-=j*p,c.m_angularVelocity-=l*(f*p-g*o+this.m_motorImpulse+this.m_impulse.z),d.m_linearVelocity.x+=k*o,d.m_linearVelocity.y+=k*p,d.m_angularVelocity+=m*(h*p-i*o+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=0,e=d=0,f=0,g=0,h=0,i=b.m_linearVelocity,j=b.m_angularVelocity,k=c.m_linearVelocity,l=c.m_angularVelocity,m=b.m_invMass,n=c.m_invMass,o=b.m_invI,p=c.m_invI;if(this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(e=this.m_motorMass*-(l-j-this.m_motorSpeed),f=this.m_motorImpulse,g=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+e,-g,g),e=this.m_motorImpulse-f,j-=o*e,l+=p*e),this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,d=a.col1.x*e+a.col2.x*f,f=a.col1.y*e+a.col2.y*f,e=d,a=c.m_xf.R,g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,d=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=d,a=k.x+-l*h-i.x- -j*f,q=k.y+l*g-i.y-j*e;this.m_mass.Solve33(this.impulse3,-a,-q,-(l-j)),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(d=this.m_impulse.z+this.impulse3.z,0>d&&(this.m_mass.Solve22(this.reduced,-a,-q),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(d=this.m_impulse.z+this.impulse3.z,d>0&&(this.m_mass.Solve22(this.reduced,-a,-q),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),i.x-=m*this.impulse3.x,i.y-=m*this.impulse3.y,j-=o*(e*this.impulse3.y-f*this.impulse3.x+this.impulse3.z),k.x+=n*this.impulse3.x,k.y+=n*this.impulse3.y,l+=p*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,d=a.col1.x*e+a.col2.x*f,f=a.col1.y*e+a.col2.y*f,e=d,a=c.m_xf.R,g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,d=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=d,this.m_mass.Solve22(this.impulse2,-(k.x+-l*h-i.x- -j*f),-(k.y+l*g-i.y-j*e)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,i.x-=m*this.impulse2.x,i.y-=m*this.impulse2.y,j-=o*(e*this.impulse2.y-f*this.impulse2.x),k.x+=n*this.impulse2.x,k.y+=n*this.impulse2.y,l+=p*(g*this.impulse2.y-h*this.impulse2.x);b.m_linearVelocity.SetV(i),b.m_angularVelocity=j,c.m_linearVelocity.SetV(k),c.m_angularVelocity=l},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB,e=0,f=a=0,g=0,h=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var b=d.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,i=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(b=Box2D.Common.Math.b2Math.Clamp(b-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),i=-this.m_motorMass*b,e=Math.abs(b)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(b-=this.m_lowerAngle,e=-b,b=Box2D.Common.Math.b2Math.Clamp(b+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),i=-this.m_motorMass*b):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(e=b-=this.m_upperAngle,b=Box2D.Common.Math.b2Math.Clamp(b-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),i=-this.m_motorMass*b),c.m_sweep.a-=c.m_invI*i,d.m_sweep.a+=d.m_invI*i,c.SynchronizeTransform(),d.SynchronizeTransform()}a=c.m_xf.R,i=this.m_localAnchor1.x-c.m_sweep.localCenter.x,b=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=a.col1.x*i+a.col2.x*b,b=a.col1.y*i+a.col2.y*b,i=f,a=d.m_xf.R;var j=this.m_localAnchor2.x-d.m_sweep.localCenter.x,k=this.m_localAnchor2.y-d.m_sweep.localCenter.y,f=a.col1.x*j+a.col2.x*k,k=a.col1.y*j+a.col2.y*k,j=f,g=d.m_sweep.c.x+j-c.m_sweep.c.x-i,h=d.m_sweep.c.y+k-c.m_sweep.c.y-b,l=g*g+h*h;a=Math.sqrt(l);var f=c.m_invMass,m=d.m_invMass,n=c.m_invI,o=d.m_invI,p=10*Box2D.Common.b2Settings.b2_linearSlop;return l>p*p&&(l=1/(f+m),g=l*-g,h=l*-h,c.m_sweep.c.x-=.5*f*g,c.m_sweep.c.y-=.5*f*h,d.m_sweep.c.x+=.5*m*g,d.m_sweep.c.y+=.5*m*h,g=d.m_sweep.c.x+j-c.m_sweep.c.x-i,h=d.m_sweep.c.y+k-c.m_sweep.c.y-b),this.K1.col1.x=f+m,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=f+m,this.K2.col1.x=n*b*b,this.K2.col2.x=-n*i*b,this.K2.col1.y=-n*i*b,this.K2.col2.y=n*i*i,this.K3.col1.x=o*k*k,this.K3.col2.x=-o*j*k,this.K3.col1.y=-o*j*k,this.K3.col2.y=o*j*j,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-g,-h),g=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,h=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,c.m_sweep.c.x-=c.m_invMass*g,c.m_sweep.c.y-=c.m_invMass*h,c.m_sweep.a-=c.m_invI*(i*h-b*g),d.m_sweep.c.x+=d.m_invMass*g,d.m_sweep.c.y+=d.m_invMass*h,d.m_sweep.a+=d.m_invI*(j*h-k*g),c.SynchronizeTransform(),d.SynchronizeTransform(),a<=Box2D.Common.b2Settings.b2_linearSlop&&e<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(a){switch(Box2D.Common.b2Settings.b2Assert(0<a.pointCount),a.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(a);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(a);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(a)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(a){var b=a.bodyA.m_xf.R,c=a.localPoint,d=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),e=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),b=a.bodyB.m_xf.R,c=a.points[0].localPoint,f=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),b=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),c=f-d,g=b-e,h=c*c+g*g;h>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(h=Math.sqrt(h),this.m_normal.x=c/h,this.m_normal.y=g/h):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(d+f),this.m_points[0].y=.5*(e+b),this.m_separations[0]=c*this.m_normal.x+g*this.m_normal.y-a.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(a){this.m_normal.x=a.bodyA.m_xf.R.col1.x*a.localPlaneNormal.x+a.bodyA.m_xf.R.col2.x*a.localPlaneNormal.y,this.m_normal.y=a.bodyA.m_xf.R.col1.y*a.localPlaneNormal.x+a.bodyA.m_xf.R.col2.y*a.localPlaneNormal.y;for(var b=a.bodyA.m_xf.position.x+(a.bodyA.m_xf.R.col1.x*a.localPoint.x+a.bodyA.m_xf.R.col2.x*a.localPoint.y),c=a.bodyA.m_xf.position.y+(a.bodyA.m_xf.R.col1.y*a.localPoint.x+a.bodyA.m_xf.R.col2.y*a.localPoint.y),d=0;d<a.pointCount;d++){var e=a.bodyB.m_xf.position.x+(a.bodyB.m_xf.R.col1.x*a.points[d].localPoint.x+a.bodyB.m_xf.R.col2.x*a.points[d].localPoint.y),f=a.bodyB.m_xf.position.y+(a.bodyB.m_xf.R.col1.y*a.points[d].localPoint.x+a.bodyB.m_xf.R.col2.y*a.points[d].localPoint.y);this.m_separations[d]=(e-b)*this.m_normal.x+(f-c)*this.m_normal.y-a.radius,this.m_points[d].x=e,this.m_points[d].y=f}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(a){this.m_normal.x=a.bodyB.m_xf.R.col1.x*a.localPlaneNormal.x+a.bodyB.m_xf.R.col2.x*a.localPlaneNormal.y,this.m_normal.y=a.bodyB.m_xf.R.col1.y*a.localPlaneNormal.x+a.bodyB.m_xf.R.col2.y*a.localPlaneNormal.y;for(var b=a.bodyB.m_xf.position.x+(a.bodyB.m_xf.R.col1.x*a.localPoint.x+a.bodyB.m_xf.R.col2.x*a.localPoint.y),c=a.bodyB.m_xf.position.y+(a.bodyB.m_xf.R.col1.y*a.localPoint.x+a.bodyB.m_xf.R.col2.y*a.localPoint.y),d=0;d<a.pointCount;d++){var e=a.bodyA.m_xf.position.x+(a.bodyA.m_xf.R.col1.x*a.points[d].localPoint.x+a.bodyA.m_xf.R.col2.x*a.points[d].localPoint.y),f=a.bodyA.m_xf.position.y+(a.bodyA.m_xf.R.col1.y*a.points[d].localPoint.x+a.bodyA.m_xf.R.col2.y*a.points[d].localPoint.y);this.m_separations[d]=(e-b)*this.m_normal.x+(f-c)*this.m_normal.y-a.radius,this.m_points[d].Set(e,f)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(a,b){Box2D.Common.b2Settings.b2Assert(a.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(b.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.call(this,a,b)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(a,b){Box2D.Common.b2Settings.b2Assert(a.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(b.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,a,b)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetShape(),b=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,a,this.m_fixtureA.GetBody().m_xf,b,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var a=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++)this.points[a]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint},Box2D.Dynamics.b2FixtureList=function(){this.fixtureLastNode=this.fixtureFirstNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(a){var b=a.ID;if(null==this.fixtureNodeLookup[b]){var a=new Box2D.Dynamics.b2FixtureListNode(a),c=this.fixtureLastNode;null!=c?c.SetNextNode(a):this.fixtureFirstNode=a,a.SetPreviousNode(c),this.fixtureLastNode=a,this.fixtureNodeLookup[b]=a,this.fixtureCount++}},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(a){var a=a.ID,b=this.fixtureNodeLookup[a];if(null!=b){var c=b.GetPreviousNode(),b=b.GetNextNode();null==c?this.fixtureFirstNode=b:c.SetNextNode(b),null==b?this.fixtureLastNode=c:b.SetPreviousNode(c),delete this.fixtureNodeLookup[a],this.fixtureCount--}},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(a,b,c,d){void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(a,b,c,d){return void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},Box2D.Dynamics.Joints.b2GearJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var b=a.joint1.m_type,c=a.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var d=0,e=0;
this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=a.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=a.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e,this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d;return a*(this.m_impulse*this.m_J.angularB-e*this.m_impulse*this.m_J.linearB.y+d*this.m_impulse*this.m_J.linearB.x)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(a){void 0===a&&(a=0),this.m_ratio=a},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(a){var b=this.m_ground1,c=this.m_ground2,d=this.m_bodyA,e=this.m_bodyB,f=0,g=0,h=0,i=0,j=h=0,k=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,k+=d.m_invI):(b=b.m_xf.R,g=this.m_prismatic1.m_localXAxis1,f=b.col1.x*g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=d.m_xf.R,h=this.m_localAnchor1.x-d.m_sweep.localCenter.x,i=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=j*g-i*f,this.m_J.linearA.Set(-f,-g),this.m_J.angularA=-h,k+=d.m_invMass+d.m_invI*h*h),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,k+=this.m_ratio*this.m_ratio*e.m_invI):(b=c.m_xf.R,g=this.m_prismatic2.m_localXAxis1,f=b.col1.x*g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=e.m_xf.R,h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y,j=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=j*g-i*f,this.m_J.linearB.Set(-this.m_ratio*f,-this.m_ratio*g),this.m_J.angularB=-this.m_ratio*h,k+=this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*h*h)),this.m_mass=k>0?1/k:0,a.warmStarting?(d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearA.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearA.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=c,a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearA.x,a.m_linearVelocity.y+=a.m_invMass*c*this.m_J.linearA.y,a.m_angularVelocity+=a.m_invI*c*this.m_J.angularA,b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearB.x,b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearB.y,b.m_angularVelocity+=b.m_invI*c*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=0,d=0,c=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),d=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),c=-this.m_mass*(this.m_constant-(c+this.m_ratio*d));return a.m_sweep.c.x+=a.m_invMass*c*this.m_J.linearA.x,a.m_sweep.c.y+=a.m_invMass*c*this.m_J.linearA.y,a.m_sweep.a+=a.m_invI*c*this.m_J.angularA,b.m_sweep.c.x+=b.m_invMass*c*this.m_J.linearB.x,b.m_sweep.c.y+=b.m_invMass*c*this.m_J.linearB.y,b.m_sweep.a+=b.m_invI*c*this.m_J.angularB,a.SynchronizeTransform(),b.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},goog.inherits(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(a,b,c){this.joint1=a,this.bodyA=a.GetBodyA(),this.joint2=b,this.bodyB=b.GetBodyA(),this.ratio=c},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=Math.min(a.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(a.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f,f=b.col1.y*e+b.col2.y*f,e=g;b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y,g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;b=d.m_sweep.c.x+h;var g=d.m_sweep.c.y+i,j=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,k=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(c.m_sweep.c.x+e-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),c.m_sweep.c.y+f-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(b-j,g-k),b=this.m_u1.Length(),g=this.m_u2.Length(),b>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),g>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero(),0<this.m_constant-b-this.m_ratio*g?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,g<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,b=e*this.m_u1.y-f*this.m_u1.x,g=h*this.m_u2.y-i*this.m_u2.x,this.m_limitMass1=c.m_invMass+c.m_invI*b*b,this.m_limitMass2=d.m_invMass+d.m_invI*g*g,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,b=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,g=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,j=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*a,c.m_linearVelocity.y+=c.m_invMass*b,c.m_angularVelocity+=c.m_invI*(e*b-f*a),d.m_linearVelocity.x+=d.m_invMass*g,d.m_linearVelocity.y+=d.m_invMass*j,d.m_angularVelocity+=d.m_invI*(h*j-i*g)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=f;a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,i=f=a=0,j=0;a=j=a=j=i=f=a=0,this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=b.m_linearVelocity.x+-b.m_angularVelocity*e,f=b.m_linearVelocity.y+b.m_angularVelocity*d,i=c.m_linearVelocity.x+-c.m_angularVelocity*h,j=c.m_linearVelocity.y+c.m_angularVelocity*g,a=-(this.m_u1.x*a+this.m_u1.y*f)-this.m_ratio*(this.m_u2.x*i+this.m_u2.y*j),j=this.m_pulleyMass*-a,a=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+j),j=this.m_impulse-a,a=-j*this.m_u1.x,f=-j*this.m_u1.y,i=-this.m_ratio*j*this.m_u2.x,j=-this.m_ratio*j*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*f,b.m_angularVelocity+=b.m_invI*(d*f-e*a),c.m_linearVelocity.x+=c.m_invMass*i,c.m_linearVelocity.y+=c.m_invMass*j,c.m_angularVelocity+=c.m_invI*(g*j-h*i)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=b.m_linearVelocity.x+-b.m_angularVelocity*e,f=b.m_linearVelocity.y+b.m_angularVelocity*d,a=-(this.m_u1.x*a+this.m_u1.y*f),j=-this.m_limitMass1*a,a=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+j),j=this.m_limitImpulse1-a,a=-j*this.m_u1.x,f=-j*this.m_u1.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*f,b.m_angularVelocity+=b.m_invI*(d*f-e*a)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(i=c.m_linearVelocity.x+-c.m_angularVelocity*h,j=c.m_linearVelocity.y+c.m_angularVelocity*g,a=-(this.m_u2.x*i+this.m_u2.y*j),j=-this.m_limitMass2*a,a=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+j),j=this.m_limitImpulse2-a,i=-j*this.m_u2.x,j=-j*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*i,c.m_linearVelocity.y+=c.m_invMass*j,c.m_angularVelocity+=c.m_invI*(g*j-h*i))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB,d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,e=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,h=0,i=0,j=0,k=0,l=a=0,m=0,n=0,o=l=n=a=l=a=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=b.m_xf.R,h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,i=this.m_localAnchor1.y-b.m_sweep.localCenter.y,l=a.col1.x*h+a.col2.x*i,i=a.col1.y*h+a.col2.y*i,h=l,a=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,l=a.col1.x*j+a.col2.x*k,k=a.col1.y*j+a.col2.y*k,j=l,a=b.m_sweep.c.x+h,l=b.m_sweep.c.y+i,m=c.m_sweep.c.x+j,n=c.m_sweep.c.y+k,this.m_u1.Set(a-d,l-e),this.m_u2.Set(m-f,n-g),a=this.m_u1.Length(),l=this.m_u2.Length(),a>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/a):this.m_u1.SetZero(),l>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/l):this.m_u2.SetZero(),a=this.m_constant-a-this.m_ratio*l,o=Math.max(o,-a),a=Box2D.Common.Math.b2Math.Clamp(a+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),n=-this.m_pulleyMass*a,a=-n*this.m_u1.x,l=-n*this.m_u1.y,m=-this.m_ratio*n*this.m_u2.x,n=-this.m_ratio*n*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*a,b.m_sweep.c.y+=b.m_invMass*l,b.m_sweep.a+=b.m_invI*(h*l-i*a),c.m_sweep.c.x+=c.m_invMass*m,c.m_sweep.c.y+=c.m_invMass*n,c.m_sweep.a+=c.m_invI*(j*n-k*m),b.SynchronizeTransform(),c.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=b.m_xf.R,h=this.m_localAnchor1.x-b.m_sweep.localCenter.x,i=this.m_localAnchor1.y-b.m_sweep.localCenter.y,l=a.col1.x*h+a.col2.x*i,i=a.col1.y*h+a.col2.y*i,h=l,a=b.m_sweep.c.x+h,l=b.m_sweep.c.y+i,this.m_u1.Set(a-d,l-e),a=this.m_u1.Length(),a>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/a,this.m_u1.y*=1/a):this.m_u1.SetZero(),a=this.m_maxLength1-a,o=Math.max(o,-a),a=Box2D.Common.Math.b2Math.Clamp(a+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass1*a,a=-n*this.m_u1.x,l=-n*this.m_u1.y,b.m_sweep.c.x+=b.m_invMass*a,b.m_sweep.c.y+=b.m_invMass*l,b.m_sweep.a+=b.m_invI*(h*l-i*a),b.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,k=this.m_localAnchor2.y-c.m_sweep.localCenter.y,l=a.col1.x*j+a.col2.x*k,k=a.col1.y*j+a.col2.y*k,j=l,m=c.m_sweep.c.x+j,n=c.m_sweep.c.y+k,this.m_u2.Set(m-f,n-g),l=this.m_u2.Length(),l>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/l,this.m_u2.y*=1/l):this.m_u2.SetZero(),a=this.m_maxLength2-l,o=Math.max(o,-a),a=Box2D.Common.Math.b2Math.Clamp(a+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),n=-this.m_limitMass2*a,m=-n*this.m_u2.x,n=-n*this.m_u2.y,c.m_sweep.c.x+=c.m_invMass*m,c.m_sweep.c.y+=c.m_invMass*n,c.m_sweep.a+=c.m_invI*(j*n-k*m),c.SynchronizeTransform()),o<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactImpulse.prototype.Reset=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.Contacts.b2ContactListNode=function(a){this.contact=a,this.previous=this.next=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(a){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var b=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return b.next=null,b.previous=null,b.contact=a,b}return new Box2D.Dynamics.Contacts.b2ContactListNode(a)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(a){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(a)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var a=0;a<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;a++)this.contactFirstNodes[a]=null;for(this.contactLastNodes=[],a=0;a<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;a++)this.contactLastNodes[a]=null;this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(a){return this.contactFirstNodes[a]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(a){var b=a.ID;if(null==this.contactNodeLookup[b]){this.contactNodeLookup[b]=[];for(var c=0;c<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;c++)this.contactNodeLookup[b][c]=null;this.CreateNode(a,b,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(a,b,c){b?this.CreateNode(a,a.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(a.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),c?this.CreateNode(a,a.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(a.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(a){if(a=a.ID,null!=this.contactNodeLookup[a]){for(var b=0;b<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;b++)this.RemoveNode(a,b);delete this.contactNodeLookup[a],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(a,b){var c=this.contactNodeLookup[a];if(null!=c){var d=c[b];if(null!=d){c[b]=null;var c=d.GetPreviousNode(),e=d.GetNextNode();null==c?this.contactFirstNodes[b]=e:c.SetNextNode(e),null==e?this.contactLastNodes[b]=c:e.SetPreviousNode(c),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(d)}}},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(a,b,c){b=this.contactNodeLookup[b],null==b[c]&&(b[c]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(a),a=this.contactLastNodes[c],null!=a?(a.SetNextNode(b[c]),b[c].SetPreviousNode(a)):this.contactFirstNodes[c]=b[c],this.contactLastNodes[c]=b[c])},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(a,b,c,d){var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,c=this.p2.y-this.p1.y,h=-(this.p2.x-this.p1.x),i=100*Number.MIN_VALUE,j=-(f*c+g*h);if(j>i){var k=e.x-this.p1.x,l=e.y-this.p1.y,e=k*c+l*h;if(e>=0&&d*j>=e&&(d=-f*l+g*k,d>=-i*j&&j*(1+i)>=d))return e/=j,d=Math.sqrt(c*c+h*h),a[0]=e,b.Set(c/d,h/d),!0}return!1},Box2D.Collision.b2Segment.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,a=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:0>c?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*a,this.p2.y=this.p1.y+c*a},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,a=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:0>c?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*a,this.p1.y=this.p2.y+c*a},Box2D.Dynamics.Joints.b2MouseJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.m_localAnchor=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_mass=new Box2D.Common.Math.b2Mat22,this.m_C=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_gamma=this.m_beta=0},goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA=function(){return Box2D.Common.Math.b2Vec2.Get(this.m_target.x,this.m_target.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse.x,a*this.m_impulse.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget=function(){return this.m_target},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=c*d*d;this.m_gamma=a.dt*(2*c*this.m_dampingRatio*d+a.dt*e),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*e*this.m_gamma;var e=b.m_xf.R,c=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y,f=e.col1.x*c+e.col2.x*d,d=e.col1.y*c+e.col2.y*d,c=f,e=b.m_invMass,f=b.m_invI;this.K1.col1.x=e,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=e,this.K2.col1.x=f*d*d,this.K2.col2.x=-f*c*d,this.K2.col1.y=-f*c*d,this.K2.col2.y=f*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+c-this.m_target.x,this.m_C.y=b.m_sweep.c.y+d-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=e*this.m_impulse.x,b.m_linearVelocity.y+=e*this.m_impulse.y,b.m_angularVelocity+=f*(c*this.m_impulse.y-d*this.m_impulse.x)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyB,d=0,e=0;b=c.m_xf.R;var f=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y,d=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=d,d=c.m_linearVelocity.x+-c.m_angularVelocity*g,h=c.m_linearVelocity.y+c.m_angularVelocity*f;b=this.m_mass,d=d+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,e=h+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,h=-(b.col1.x*d+b.col2.x*e),e=-(b.col1.y*d+b.col2.y*e),b=this.m_impulse.x,d=this.m_impulse.y,this.m_impulse.x+=h,this.m_impulse.y+=e,a=a.dt*this.m_maxForce,this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length()),h=this.m_impulse.x-b,e=this.m_impulse.y-d,c.m_linearVelocity.x+=c.m_invMass*h,c.m_linearVelocity.y+=c.m_invMass*e,c.m_angularVelocity+=c.m_invI*(f*e-g*h)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2BodyListNode=function(a){this.body=a,this.previous=this.next=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Common.b2Color=function(a,b,c){this._r=255*Box2D.Common.Math.b2Math.Clamp(a,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(b,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(c,0,1)},Box2D.Common.b2Color.prototype.Set=function(a,b,c){this._r=255*Box2D.Common.Math.b2Math.Clamp(a,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(b,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(c,0,1)},Box2D.Common.b2Color.prototype.GetColor=function(){return this._r<<16|this._g<<8|this._b},Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++)this.bodyFirstNodes[a]=null;for(this.bodyLastNodes=[],a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++)this.bodyLastNodes[a]=null;this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(a){return this.bodyFirstNodes[a]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(a){var b=a.ID;null==this.bodyNodeLookup[b]&&(this.CreateNode(a,b,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(a),a.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(a){var b=a.GetType(),c=a.ID,d=a.IsAwake(),e=a.IsActive();b==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(a,c,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(c,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),b!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(a,c,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(c,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),b!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&e&&d?this.CreateNode(a,c,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(c,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),d?this.CreateNode(a,c,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(c,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),e?this.CreateNode(a,c,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(c,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(a){var b=a.ID;if(null!=this.bodyNodeLookup[b]){for(goog.array.remove(a.m_lists,this),a=0;a<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;a++)this.RemoveNode(b,a);delete this.bodyNodeLookup[b],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(a,b){var c=this.bodyNodeLookup[a];if(null!=c){var d=c[b];null!=d&&(c[b]=null,c=d.GetPreviousNode(),d=d.GetNextNode(),null==c?this.bodyFirstNodes[b]=d:c.SetNextNode(d),null==d?this.bodyLastNodes[b]=c:d.SetPreviousNode(c))}},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(a,b,c){var d=this.bodyNodeLookup[b];if(null==d){for(var d=[],e=0;e<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;e++)d[e]=null;this.bodyNodeLookup[b]=d}null==d[c]&&(d[c]=new Box2D.Dynamics.b2BodyListNode(a),a=this.bodyLastNodes[c],null!=a?a.SetNextNode(d[c]):this.bodyFirstNodes[c]=d[c],d[c].SetPreviousNode(a),this.bodyLastNodes[c]=d[c])},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.Controllers={},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.Draw=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(a){this.bodyList.AddBody(a),a.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(a){this.bodyList.RemoveBody(a),a.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode())this.RemoveBody(a.body)},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(a){for(var a=Box2D.Common.Math.b2Vec2.Get(this.A.x*a.dt,this.A.y*a.dt),b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);b;b=b.GetNextNode()){var c=b.body,d=c.GetLinearVelocity(),d=Box2D.Common.Math.b2Vec2.Get(d.x+a.x,d.y+a.y);c.SetLinearVelocity(d),Box2D.Common.Math.b2Vec2.Free(d)}Box2D.Common.Math.b2Vec2.Free(a)},Box2D.Dynamics.Contacts.b2PolygonContact=function(a,b){Box2D.Dynamics.Contacts.b2Contact.call(this,a,b)},goog.inherits(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(a,b){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,a,b)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){var a=this.m_fixtureA.GetShape(),b=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,a,this.m_fixtureA.GetBody().m_xf,b,this.m_fixtureB.GetBody().m_xf)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Dynamics.b2Island=function(a,b){this.m_listener=a,this.m_contactSolver=b,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[],this.impulse=new Box2D.Dynamics.b2ContactImpulse},Box2D.Dynamics.b2Island.prototype.Reset=function(a,b){this.m_listener=a,this.m_contactSolver=b},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(a,b,c){this._InitializeVelocities(a,b),this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(a),this._SolveBodies(a),this._SolvePositionConstraints(a),this.Report(this.m_contactSolver.m_constraints),c&&this._SleepIfTired(a)
},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(a,b){for(var c=0;c<this.m_dynamicBodies.length;c++){var d=this.m_dynamicBodies[c],e=b.x,f=b.y;void 0!=d._pc_gravityX&&(e=d._pc_gravityX),void 0!=d._pc_gravityY&&(f=d._pc_gravityY),d.m_linearVelocity.x+=a.dt*(e+d.m_invMass*d.m_force.x),d.m_linearVelocity.y+=a.dt*(f+d.m_invMass*d.m_force.y),d.m_angularVelocity+=a.dt*d.m_invI*d.m_torque,d.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-a.dt*d.m_linearDamping,0,1)),d.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-a.dt*d.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(a){this.m_contactSolver.InitVelocityConstraints(a);for(var b=0;b<this.m_joints.length;b++)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;b++){for(var c=0;c<this.m_joints.length;c++)this.m_joints[c].SolveVelocityConstraints(a);this.m_contactSolver.SolveVelocityConstraints()}for(a=0;a<this.m_joints.length;a++)this.m_joints[a].FinalizeVelocityConstraints();this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(a){for(var b=0;b<this.m_nonStaticBodies.length;++b){var c=this.m_nonStaticBodies[b],d=a.dt*c.m_linearVelocity.x,e=a.dt*c.m_linearVelocity.y;d*d+e*e>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*a.inv_dt),d=a.dt*c.m_angularVelocity,d*d>Box2D.Common.b2Settings.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*a.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*a.inv_dt),c.m_sweep.c0.SetV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y,c.m_sweep.a+=a.dt*c.m_angularVelocity,c.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(a){for(var b=0;b<a.positionIterations;b++){for(var c=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),d=!0,e=0;e<this.m_joints.length;e++)var f=this.m_joints[e].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),d=d&&f;if(c&&d)break}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(a){for(var b=Number.MAX_VALUE,c=0;c<this.m_nonStaticBodies.length;c++){var d=this.m_nonStaticBodies[c];!d.m_allowSleep||Math.abs(d.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(d.m_linearVelocity,d.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?b=d.m_sleepTime=0:(d.m_sleepTime+=a.dt,b=Math.min(b,d.m_sleepTime))}if(b>=Box2D.Common.b2Settings.b2_timeToSleep)for(a=0;a<this.m_bodies.length;a++)this.m_bodies[a].SetAwake(!1)},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contacts.length);for(var d=this.m_contactSolver,b=0;b<this.m_joints.length;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),c=0;c<this.m_joints.length;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_nonStaticBodies.length;++b){var c=this.m_nonStaticBodies[b],e=a.dt*c.m_linearVelocity.x,f=a.dt*c.m_linearVelocity.y;e*e+f*f>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*a.inv_dt),e=a.dt*c.m_angularVelocity,e*e>Box2D.Common.b2Settings.b2_maxRotationSquared&&(c.m_angularVelocity=0>c.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*a.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*a.inv_dt),c.m_sweep.c0.SetV(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x,c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y,c.m_sweep.a+=a.dt*c.m_angularVelocity,c.SynchronizeTransform()}for(b=0;b<a.positionIterations;++b){for(e=d.SolvePositionConstraints(.75),f=!0,c=0;c<this.m_joints.length;++c)var g=this.m_joints[c].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),f=f&&g;if(e&&f)break}this.Report(d.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contacts.length;++b){var c=this.m_contacts[b],d=a[b];this.impulse.Reset();for(var e=0;e<d.pointCount;++e)this.impulse.normalImpulses[e]=d.points[e].normalImpulse,this.impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,this.impulse)}},Box2D.Dynamics.b2Island.prototype.AddBody=function(a){this.m_bodies.push(a),a.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(a),a.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(a))},Box2D.Dynamics.b2Island.prototype.AddContact=function(a){this.m_contacts.push(a)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(a){this.m_joints.push(a)},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Collision.b2DynamicTreePair=function(a,b){this.fixtureA=a,this.fixtureB=b},Box2D.Collision.b2DynamicTreePair._freeCache=[],Box2D.Collision.b2DynamicTreePair.Get=function(a,b){if(0<Box2D.Collision.b2DynamicTreePair._freeCache.length){var c=Box2D.Collision.b2DynamicTreePair._freeCache.pop();return c.fixtureA=a,c.fixtureB=b,c}return new Box2D.Collision.b2DynamicTreePair(a,b)},Box2D.Collision.b2DynamicTreePair.Free=function(a){null!=a&&Box2D.Collision.b2DynamicTreePair._freeCache.push(a)},Box2D.Dynamics.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1,this.m_drawFlags=0,this.m_originX=0,this.m_originY=0,this.m_ctx=null},Box2D.Dynamics.b2DebugDraw.prototype.SetOrigin=function(a,b){this.m_originX=a,this.m_originY=b},Box2D.Dynamics.b2DebugDraw.prototype.Clear=function(){},Box2D.Dynamics.b2DebugDraw.prototype._color=function(a,b){return"rgba("+((16711680&a)>>16)+","+((65280&a)>>8)+","+(255&a)+","+b+")"},Box2D.Dynamics.b2DebugDraw.prototype.SetFlags=function(a){this.m_drawFlags=a},Box2D.Dynamics.b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},Box2D.Dynamics.b2DebugDraw.prototype.AppendFlags=function(a){this.m_drawFlags|=a},Box2D.Dynamics.b2DebugDraw.prototype.ClearFlags=function(a){this.m_drawFlags&=~a},Box2D.Dynamics.b2DebugDraw.prototype.SetSprite=function(a){this.m_ctx=a},Box2D.Dynamics.b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx},Box2D.Dynamics.b2DebugDraw.prototype.SetDrawScale=function(a){this.m_drawScale=a},Box2D.Dynamics.b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},Box2D.Dynamics.b2DebugDraw.prototype.SetLineThickness=function(a){this.m_lineThickness=a,this.m_ctx.strokeWidth=a},Box2D.Dynamics.b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},Box2D.Dynamics.b2DebugDraw.prototype.SetAlpha=function(a){this.m_alpha=a},Box2D.Dynamics.b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},Box2D.Dynamics.b2DebugDraw.prototype.SetFillAlpha=function(a){this.m_fillAlpha=a},Box2D.Dynamics.b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},Box2D.Dynamics.b2DebugDraw.prototype.SetXFormScale=function(a){this.m_xformScale=a},Box2D.Dynamics.b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},function(a){a.prototype.DrawPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;for(d.beginPath(),d.strokeStyle=this._color(c.GetColor(),this.m_alpha),d.moveTo(a[0].x*e-this.m_originX,a[0].y*e-this.m_originY),c=1;b>c;c++)d.lineTo(a[c].x*e-this.m_originX,a[c].y*e-this.m_originY);d.lineTo(a[0].x*e-this.m_originX,a[0].y*e-this.m_originY),d.closePath(),d.stroke()}},a.prototype.DrawSolidPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;for(d.beginPath(),d.strokeStyle=this._color(c.GetColor(),this.m_alpha),d.fillStyle=this._color(c.GetColor(),this.m_fillAlpha),d.moveTo(a[0].x*e-this.m_originX,a[0].y*e-this.m_originY),c=1;b>c;c++)d.lineTo(a[c].x*e-this.m_originX,a[c].y*e-this.m_originY);d.lineTo(a[0].x*e-this.m_originX,a[0].y*e-this.m_originY),d.closePath(),d.fill(),d.stroke()}},a.prototype.DrawCircle=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.GetColor(),this.m_alpha),d.arc(a.x*e-this.m_originX,a.y*e-this.m_originY,b*e,0,2*Math.PI,!0),d.closePath(),d.stroke()}},a.prototype.DrawSolidCircle=function(a,b,c,d){if(b){var e=this.m_ctx,f=this.m_drawScale,g=a.x*f-this.m_originX,h=a.y*f-this.m_originY;e.moveTo(0,0),e.beginPath(),e.strokeStyle=this._color(d.GetColor(),this.m_alpha),e.fillStyle=this._color(d.GetColor(),this.m_fillAlpha),e.arc(g,h,b*f,0,2*Math.PI,!0),e.moveTo(g,h),e.lineTo((a.x+c.x*b)*f-this.m_originX,(a.y+c.y*b)*f-this.m_originY),e.closePath(),e.fill(),e.stroke()}},a.prototype.DrawSegment=function(a,b,c){var d=this.m_ctx,e=this.m_drawScale;d.strokeStyle=this._color(c.GetColor(),this.m_alpha),d.beginPath(),d.moveTo(a.x*e-this.m_originX,a.y*e-this.m_originY),d.lineTo(b.x*e-this.m_originX,b.y*e-this.m_originY),d.closePath(),d.stroke()},a.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath(),b.strokeStyle=this._color(16711680,this.m_alpha),b.moveTo(a.position.x*c-this.m_originX,a.position.y*c-this.m_originY),b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c-this.m_originX,(a.position.y+this.m_xformScale*a.R.col1.y)*c-this.m_originY),b.strokeStyle=this._color(65280,this.m_alpha),b.moveTo(a.position.x*c-this.m_originX,a.position.y*c-this.m_originY),b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c-this.m_originX,(a.position.y+this.m_xformScale*a.R.col2.y)*c-this.m_originY),b.closePath(),b.stroke()}}(Box2D.Dynamics.b2DebugDraw),Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32,Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.iContactFilter=function(){},Box2D.Dynamics.iContactFilter.prototype.ShouldCollide=function(){},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();return c.groupIndex==d.groupIndex&&0!=c.groupIndex?0<c.groupIndex:0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.Joints.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.target=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},goog.inherits(Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2MouseJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2MouseJoint(this)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(a,b,c){this.m_freeContacts[b]=this.m_freeContacts[b]||{},this.m_freeContacts[b][c]=this.m_freeContacts[b][c]||[],this.m_registers[b]=this.m_registers[b]||{},this.m_registers[b][c]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[b][c].ctor=a,this.m_registers[b][c].primary=!0,b!=c&&(this.m_registers[c]=this.m_registers[c]||{},this.m_registers[c][b]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[c][b].ctor=a,this.m_registers[c][b].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(a,b){var c=a.GetShape().GetTypeName(),d=b.GetShape().GetTypeName(),e=this.m_registers[c][d],f=e.ctor;return null!=f?e.primary?0<this.m_freeContacts[c][d].length?(c=this.m_freeContacts[c][d].pop(),c.Reset(a,b),c):new f(a,b):0<this.m_freeContacts[d][c].length?(c=this.m_freeContacts[d][c].pop(),c.Reset(b,a),c):new f(b,a):null},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(a){var b=a.GetFixtureA().GetShape().GetTypeName(),c=a.GetFixtureB().GetShape().GetTypeName();this.m_freeContacts[b][c].push(a)},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[],this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return this.BufferMove(c),c},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(a){this.UnBufferMove(a),this.m_tree.DestroyProxy(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(a,b,c){this.m_tree.MoveProxy(a,b,c)&&this.BufferMove(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(a){for(this.lastQueryFixtureB=this.lastQueryFixtureA=null,this.updatePairsCallback=a;0<this.m_moveBuffer.length;)this.queryProxy=this.m_moveBuffer.pop(),this.m_tree.Query(this.QueryCallback,this.m_tree.GetFatAABB(this.queryProxy),this);this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.QueryCallback=function(a){return a!=this.queryProxy.fixture&&!(this.queryProxy.fixture==this.lastQueryFixtureA&&a==this.lastQueryFixtureB)&&!(this.queryProxy.fixture==this.lastQueryFixtureB&&a==this.lastQueryFixtureA)&&(this.updatePairsCallback(this.queryProxy.fixture,a),this.lastQueryFixtureA=this.queryProxy.fixture,this.lastQueryFixtureB=a),!0},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(a,b){this.m_tree.Query(a,b)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(a){this.m_tree.Rebalance(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(a){this.m_moveBuffer.push(a)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(a){goog.array.remove(this.m_moveBuffer,a)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Dynamics.b2ContactManager=function(a){this.m_world=a,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(a,b){var c=a.GetBody(),d=b.GetBody();if(c!=d&&d.ShouldCollide(c)&&this.m_contactFilter.ShouldCollide(a,b)){for(c=d.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);c;c=c.GetNextNode())if(d=c.contact.GetFixtureA(),d==a){if(d=c.contact.GetFixtureB(),d==b)return}else if(d==b&&(d=c.contact.GetFixtureB(),d==a))return;this.m_contactFactory.Create(a,b)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var a=this;this.m_broadPhase.UpdatePairs(function(b,c){a.AddPair(b,c)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),0<a.m_manifold.m_pointCount&&(b.SetAwake(!0),c.SetAwake(!0)),a.RemoveFromLists(),this.m_contactFactory.Destroy(a)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var a=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode()){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB(),e=c.GetBody(),f=d.GetBody();if(e.IsAwake()||f.IsAwake()){if(b.IsFiltering()){if(!f.ShouldCollide(e)){this.Destroy(b);continue}if(!this.m_contactFilter.ShouldCollide(c,d)){this.Destroy(b);continue}b.ClearFiltering()}this.m_broadPhase.TestOverlap(c.m_proxy,d.m_proxy)?b.Update(this.m_contactListener):this.Destroy(b)}}},Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.Joints.b2DistanceJoint=function(a){Box2D.Dynamics.Joints.b2Joint.call(this,a),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(a){return Box2D.Common.Math.b2Vec2.Get(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(a){this.m_length=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(a){this.m_frequencyHz=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(a){this.m_dampingRatio=a},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;b=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,i=this.m_localAnchor2.y-e.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;this.m_u.x=e.m_sweep.c.x+h-d.m_sweep.c.x-f,this.m_u.y=e.m_sweep.c.y+i-d.m_sweep.c.y-g,c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),c>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero(),b=f*this.m_u.y-g*this.m_u.x;var j=h*this.m_u.y-i*this.m_u.x;if(b=d.m_invMass+d.m_invI*b*b+e.m_invMass+e.m_invI*j*j,this.m_mass=0!=b?1/b:0,0<this.m_frequencyHz){var c=c-this.m_length,j=2*Math.PI*this.m_frequencyHz,k=this.m_mass*j*j;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*j+a.dt*k),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=c*a.dt*k*this.m_gamma,this.m_mass=b+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y,d.m_linearVelocity.x-=d.m_invMass*a,d.m_linearVelocity.y-=d.m_invMass*b,d.m_angularVelocity-=d.m_invI*(f*b-g*a),e.m_linearVelocity.x+=e.m_invMass*a,e.m_linearVelocity.y+=e.m_invMass*b,e.m_angularVelocity+=e.m_invI*(h*b-i*a)):this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var a=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,b=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,c=this.m_bodyA.m_xf.R.col1.x*a+this.m_bodyA.m_xf.R.col2.x*b,b=this.m_bodyA.m_xf.R.col1.y*a+this.m_bodyA.m_xf.R.col2.y*b,a=c,d=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,c=this.m_bodyB.m_xf.R.col1.x*d+this.m_bodyB.m_xf.R.col2.x*e,e=this.m_bodyB.m_xf.R.col1.y*d+this.m_bodyB.m_xf.R.col2.y*e,d=c,f=-this.m_mass*(this.m_u.x*(this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*e-(this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*b))+this.m_u.y*(this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*d-(this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*a))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f,c=f*this.m_u.x,f*=this.m_u.y,this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*c,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*f,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(a*f-b*c),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*c,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*f,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(d*f-e*c)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(){if(0<this.m_frequencyHz)return!0;var a=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,b=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,c=this.m_bodyA.m_xf.R.col1.x*a+this.m_bodyA.m_xf.R.col2.x*b,b=this.m_bodyA.m_xf.R.col1.y*a+this.m_bodyA.m_xf.R.col2.y*b,a=c,d=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,c=this.m_bodyB.m_xf.R.col1.x*d+this.m_bodyB.m_xf.R.col2.x*e,e=this.m_bodyB.m_xf.R.col1.y*d+this.m_bodyB.m_xf.R.col2.y*e,d=c,f=this.m_bodyB.m_sweep.c.x+d-this.m_bodyA.m_sweep.c.x-a,g=this.m_bodyB.m_sweep.c.y+e-this.m_bodyA.m_sweep.c.y-b,c=Math.sqrt(f*f+g*g),f=f/c,g=g/c,c=Box2D.Common.Math.b2Math.Clamp(c-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),h=-this.m_mass*c;return this.m_u.Set(f,g),f=h*this.m_u.x,g=h*this.m_u.y,this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*f,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*g,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(a*g-b*f),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*f,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*g,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(d*g-e*f),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(c)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d)),a=d.x-c.x,c=d.y-c.y,this.length=Math.sqrt(a*a+c*c),this.dampingRatio=this.frequencyHz=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.density=this.offset=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},goog.inherits(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity());for(var a=Box2D.Common.Math.b2Vec2.Get(0,0),b=Box2D.Common.Math.b2Vec2.Get(0,0),c=Box2D.Common.Math.b2Vec2.Get(0,0),d=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);d;d=d.GetNextNode()){b.Set(0,0),a.Set(0,0);for(var e=d.body,f=0,g=0,h=e.GetFixtureList().GetFirstNode();h;h=h.GetNextNode()){c.Set(0,0);var i=h.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),c),f=f+i;a.x+=i*c.x,a.y+=i*c.y;var j=0,j=1,g=g+i*j;b.x+=i*c.x*j,b.y+=i*c.y*j}f<Number.MIN_VALUE||(a.x/=f,a.y/=f,b.x/=g,b.y/=g,g=this.gravity.GetNegative(),g.Multiply(this.density*f),e.ApplyForce(g,b),Box2D.Common.Math.b2Vec2.Free(g),g=e.GetLinearVelocityFromWorldPoint(a),g.Subtract(this.velocity),g.Multiply(-this.linearDrag*f),e.ApplyForce(g,a),Box2D.Common.Math.b2Vec2.Free(g),e.ApplyTorque(-e.GetInertia()/e.GetMass()*f*e.GetAngularVelocity()*this.angularDrag))}Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(a)},Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Draw=function(a){var b=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset+1e3*this.normal.y,this.normal.y*this.offset-1e3*this.normal.x),c=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset-1e3*this.normal.y,this.normal.y*this.offset+1e3*this.normal.x);a.DrawSegment(b,c,Box2D.Dynamics.Controllers.b2BuoyancyController.color),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c)},Box2D.Dynamics.Controllers.b2BuoyancyController.color=new Box2D.Common.b2Color(0,0,1),Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},goog.inherits(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(){var a=null,b=null,c=0,d=null,e=null,f=0,g=0,h=0,f=null;if(this.invSqr)for(var i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode())for(var a=i.body,b=a.GetWorldCenter(),c=a.GetMass(),j=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);j;j=j.GetNextNode())d=j.body,(a.IsAwake()||d.IsAwake())&&(e=d.GetWorldCenter(),f=e.x-b.x,g=e.y-b.y,h=f*f+g*g,h<Number.MIN_VALUE||(f=Box2D.Common.Math.b2Vec2.Get(f,g),f.Multiply(this.G/h/Math.sqrt(h)*c*d.GetMass()),a.IsAwake()&&a.ApplyForce(f,b),f.Multiply(-1),d.IsAwake()&&d.ApplyForce(f,e),Box2D.Common.Math.b2Vec2.Free(f)));else for(i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);i;i=i.GetNextNode())for(a=bodyNode.body,b=a.GetWorldCenter(),c=a.GetMass(),j=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);j;j=j.GetNextNode())d=bodyNode.body,(a.IsAwake()||d.IsAwake())&&(e=d.GetWorldCenter(),f=e.x-b.x,g=e.y-b.y,h=f*f+g*g,h<Number.MIN_VALUE||(f=Box2D.Common.Math.b2Vec2.Get(f,g),f.Multiply(this.G/h*c*d.GetMass()),a.IsAwake()&&a.ApplyForce(f,b),f.Multiply(-1),d.IsAwake()&&d.ApplyForce(f,e),Box2D.Common.Math.b2Vec2.Free(f)))},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[];for(var a=this.m_pointCount=0;a<Box2D.Common.b2Settings.b2_maxManifoldPoints;a++)this.m_points[a]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(a,b,c,d,e){if(0!=a.m_pointCount){var f,g,h=0,i=0,j=0,k=0,l=0,m=0;switch(f=0,a.m_type){case Box2D.Collision.b2Manifold.e_circles:g=b.R,f=a.m_localPoint,h=b.position.x+g.col1.x*f.x+g.col2.x*f.y,b=b.position.y+g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_points[0].m_localPoint,a=d.position.x+g.col1.x*f.x+g.col2.x*f.y,d=d.position.y+g.col1.y*f.x+g.col2.y*f.y,f=a-h,g=d-b,i=f*f+g*g,i>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(i=Math.sqrt(i),this.m_normal.x=f/i,this.m_normal.y=g/i):(this.m_normal.x=1,this.m_normal.y=0),f=b+c*this.m_normal.y,d-=e*this.m_normal.y,this.m_points[0].x=.5*(h+c*this.m_normal.x+(a-e*this.m_normal.x)),this.m_points[0].y=.5*(f+d);break;case Box2D.Collision.b2Manifold.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,k=b.position.x+g.col1.x*f.x+g.col2.x*f.y,l=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=i,this.m_normal.y=j,h=0;h<a.m_pointCount;h++)g=d.R,f=a.m_points[h].m_localPoint,m=d.position.x+g.col1.x*f.x+g.col2.x*f.y,f=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(c-(m-k)*i-(f-l)*j-e)*i,this.m_points[h].y=f+.5*(c-(m-k)*i-(f-l)*j-e)*j;break;case Box2D.Collision.b2Manifold.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,k=d.position.x+g.col1.x*f.x+g.col2.x*f.y,l=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-i,this.m_normal.y=-j,h=0;h<a.m_pointCount;h++)g=b.R,f=a.m_points[h].m_localPoint,m=b.position.x+g.col1.x*f.x+g.col2.x*f.y,f=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(e-(m-k)*i-(f-l)*j-c)*i,this.m_points[h].y=f+.5*(e-(m-k)*i-(f-l)*j-c)*j}}},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(a,b,c){for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint;for(a=0;c>a;a++){var d=b[a],e=d.m_fixtureA,f=d.m_fixtureB,g=e.m_shape.m_radius,h=f.m_shape.m_radius,i=e.GetBody(),j=f.GetBody(),k=d.GetManifold(),l=Box2D.Common.b2Settings.b2MixFriction(e.GetFriction(),f.GetFriction()),m=Box2D.Common.b2Settings.b2MixRestitution(e.GetRestitution(),f.GetRestitution()),n=i.m_linearVelocity.x,o=i.m_linearVelocity.y,p=j.m_linearVelocity.x,q=j.m_linearVelocity.y,r=i.m_angularVelocity,s=j.m_angularVelocity;for(Box2D.Common.b2Settings.b2Assert(0<k.m_pointCount),Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(k,i.m_xf,g,j.m_xf,h),f=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,d=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,e=this.m_constraints[a],e.bodyA=i,e.bodyB=j,e.manifold=k,e.normal.x=f,e.normal.y=d,e.pointCount=k.m_pointCount,e.friction=l,e.restitution=m,e.localPlaneNormal.x=k.m_localPlaneNormal.x,e.localPlaneNormal.y=k.m_localPlaneNormal.y,e.localPoint.x=k.m_localPoint.x,e.localPoint.y=k.m_localPoint.y,e.radius=g+h,e.type=k.m_type,g=0;g<e.pointCount;++g){l=k.m_points[g],h=e.points[g],h.normalImpulse=l.m_normalImpulse,h.tangentImpulse=l.m_tangentImpulse,h.localPoint.SetV(l.m_localPoint);var l=h.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[g].x-i.m_sweep.c.x,m=h.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[g].y-i.m_sweep.c.y,t=h.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[g].x-j.m_sweep.c.x,u=h.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[g].y-j.m_sweep.c.y,v=l*d-m*f,w=t*d-u*f,v=v*v,w=w*w;
h.normalMass=1/(i.m_invMass+j.m_invMass+i.m_invI*v+j.m_invI*w);var x=i.m_mass*i.m_invMass+j.m_mass*j.m_invMass,x=x+(i.m_mass*i.m_invI*v+j.m_mass*j.m_invI*w);h.equalizedMass=1/x,w=d,x=-f,v=l*x-m*w,w=t*x-u*w,v*=v,w*=w,h.tangentMass=1/(i.m_invMass+j.m_invMass+i.m_invI*v+j.m_invI*w),h.velocityBias=0,l=e.normal.x*(p+-s*u-n- -r*m)+e.normal.y*(q+s*t-o-r*l),l<-Box2D.Common.b2Settings.b2_velocityThreshold&&(h.velocityBias+=-e.restitution*l)}2==e.pointCount&&(q=e.points[0],p=e.points[1],k=i.m_invMass,i=i.m_invI,n=j.m_invMass,j=j.m_invI,o=q.rA.x*d-q.rA.y*f,q=q.rB.x*d-q.rB.y*f,r=p.rA.x*d-p.rA.y*f,p=p.rB.x*d-p.rB.y*f,f=k+n+i*o*o+j*q*q,d=k+n+i*r*r+j*p*p,j=k+n+i*o*r+j*q*p,100*(f*d-j*j)>f*f?(e.K.col1.Set(f,j),e.K.col2.Set(j,d),e.K.GetInverse(e.normalMass)):e.pointCount=1)}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,e=c.bodyB,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=c.normal.x,k=c.normal.y,l=k,m=-j,n=0,o=0;if(a.warmStarting)for(o=c.pointCount,n=0;o>n;++n){var p=c.points[n];p.normalImpulse*=a.dtRatio,p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,r=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.rA.x*r-p.rA.y*q),d.m_linearVelocity.x-=f*q,d.m_linearVelocity.y-=f*r,e.m_angularVelocity+=i*(p.rB.x*r-p.rB.y*q),e.m_linearVelocity.x+=h*q,e.m_linearVelocity.y+=h*r}else for(o=c.pointCount,n=0;o>n;++n)d=c.points[n],d.normalImpulse=0,d.tangentImpulse=0}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;a++)this.SolveVelocityConstraints_Constraint(this.m_constraints[a])},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(a){for(var b=a.normal.x,c=a.normal.y,d=0;d<a.pointCount;d++)Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(a,a.points[d]);if(1==a.pointCount){var d=a.points[0],e=d.normalImpulse-d.normalMass*((a.bodyB.m_linearVelocity.x-a.bodyB.m_angularVelocity*d.rB.y-a.bodyA.m_linearVelocity.x+a.bodyA.m_angularVelocity*d.rA.y)*b+(a.bodyB.m_linearVelocity.y+a.bodyB.m_angularVelocity*d.rB.x-a.bodyA.m_linearVelocity.y-a.bodyA.m_angularVelocity*d.rA.x)*c-d.velocityBias),e=e>0?e:0,f=e-d.normalImpulse,g=f*b,c=f*c;a.bodyA.m_linearVelocity.x-=a.bodyA.m_invMass*g,a.bodyA.m_linearVelocity.y-=a.bodyA.m_invMass*c,a.bodyA.m_angularVelocity-=a.bodyA.m_invI*(d.rA.x*c-d.rA.y*g),a.bodyB.m_linearVelocity.x+=a.bodyB.m_invMass*g,a.bodyB.m_linearVelocity.y+=a.bodyB.m_invMass*c,a.bodyB.m_angularVelocity+=a.bodyB.m_invI*(d.rB.x*c-d.rB.y*g),d.normalImpulse=e}else for(var d=a.points[0],e=a.points[1],f=d.normalImpulse,g=e.normalImpulse,h=(a.bodyB.m_linearVelocity.x-a.bodyB.m_angularVelocity*d.rB.y-a.bodyA.m_linearVelocity.x+a.bodyA.m_angularVelocity*d.rA.y)*b+(a.bodyB.m_linearVelocity.y+a.bodyB.m_angularVelocity*d.rB.x-a.bodyA.m_linearVelocity.y-a.bodyA.m_angularVelocity*d.rA.x)*c-d.velocityBias,c=(a.bodyB.m_linearVelocity.x-a.bodyB.m_angularVelocity*e.rB.y-a.bodyA.m_linearVelocity.x+a.bodyA.m_angularVelocity*e.rA.y)*b+(a.bodyB.m_linearVelocity.y+a.bodyB.m_angularVelocity*e.rB.x-a.bodyA.m_linearVelocity.y-a.bodyA.m_angularVelocity*e.rA.x)*c-e.velocityBias,h=h-(a.K.col1.x*f+a.K.col2.x*g),c=c-(a.K.col1.y*f+a.K.col2.y*g);;){if(b=-(a.normalMass.col1.x*h+a.normalMass.col2.x*c),b>=0){var i=-(a.normalMass.col1.y*h+a.normalMass.col2.y*c);if(i>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(a,d,e,b-f,i-g),d.normalImpulse=b,e.normalImpulse=i;break}}if(b=-d.normalMass*h,b>=0&&0<=a.K.col1.y*b+c){this.SolveVelocityConstraints_ConstraintPointUpdate(a,d,e,b-f,-g),d.normalImpulse=b,e.normalImpulse=0;break}if(b=-e.normalMass*c,b>=0&&0<=a.K.col2.x*b+h){this.SolveVelocityConstraints_ConstraintPointUpdate(a,d,e,-f,b-g),d.normalImpulse=0,e.normalImpulse=b;break}if(h>=0&&c>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(a,d,e,-f,-g),d.normalImpulse=0,e.normalImpulse=0;break}break}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(a,b){var c=a.normal.y,d=-a.normal.x,e=a.friction*b.normalImpulse,e=Box2D.Common.Math.b2Math.Clamp(b.tangentImpulse-b.tangentMass*((a.bodyB.m_linearVelocity.x-a.bodyB.m_angularVelocity*b.rB.y-a.bodyA.m_linearVelocity.x+a.bodyA.m_angularVelocity*b.rA.y)*c+(a.bodyB.m_linearVelocity.y+a.bodyB.m_angularVelocity*b.rB.x-a.bodyA.m_linearVelocity.y-a.bodyA.m_angularVelocity*b.rA.x)*d),-e,e),f=e-b.tangentImpulse,c=f*c,d=f*d;a.bodyA.m_linearVelocity.x-=a.bodyA.m_invMass*c,a.bodyA.m_linearVelocity.y-=a.bodyA.m_invMass*d,a.bodyA.m_angularVelocity-=a.bodyA.m_invI*(b.rA.x*d-b.rA.y*c),a.bodyB.m_linearVelocity.x+=a.bodyB.m_invMass*c,a.bodyB.m_linearVelocity.y+=a.bodyB.m_invMass*d,a.bodyB.m_angularVelocity+=a.bodyB.m_invI*(b.rB.x*d-b.rB.y*c),b.tangentImpulse=e},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(a,b,c,d,e){var f=d*a.normal.x,d=d*a.normal.y,g=e*a.normal.x,e=e*a.normal.y;a.bodyA.m_linearVelocity.x-=a.bodyA.m_invMass*(f+g),a.bodyA.m_linearVelocity.y-=a.bodyA.m_invMass*(d+e),a.bodyA.m_angularVelocity-=a.bodyA.m_invI*(b.rA.x*d-b.rA.y*f+c.rA.x*e-c.rA.y*g),a.bodyB.m_linearVelocity.x+=a.bodyB.m_invMass*(f+g),a.bodyB.m_linearVelocity.y+=a.bodyB.m_invMass*(d+e),a.bodyB.m_angularVelocity+=a.bodyB.m_invI*(b.rB.x*d-b.rB.y*f+c.rB.x*e-c.rB.y*g),b.normalImpulse=0,c.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(d);for(var k=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[l],o=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[l],p=n.x-e.m_sweep.c.x,q=n.y-e.m_sweep.c.y,r=n.x-f.m_sweep.c.x,n=n.y-f.m_sweep.c.y,b=o>b?b:o,o=Box2D.Common.Math.b2Math.Clamp(a*(o+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),o=-m.equalizedMass*o,m=o*k.x,o=o*k.y;e.m_sweep.c.x-=g*m,e.m_sweep.c.y-=g*o,e.m_sweep.a-=h*(p*o-q*m),e.SynchronizeTransform(),f.m_sweep.c.x+=i*m,f.m_sweep.c.y+=i*o,f.m_sweep.a+=j*(r*o-n*m),f.SynchronizeTransform()}}return b>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(a){void 0===a&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(d);for(var k=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,l=0;l<d.pointCount;l++){var m=d.points[l],n=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[l],o=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[l],p=n.x-e.m_sweep.c.x,q=n.y-e.m_sweep.c.y,r=n.x-f.m_sweep.c.x,n=n.y-f.m_sweep.c.y;b>o&&(b=o),0!=a&&Box2D.Common.Math.b2Math.Clamp(a*(o+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),o=0*-m.equalizedMass,m=o*k.x,o*=k.y,e.m_sweep.c.x-=g*m,e.m_sweep.c.y-=g*o,e.m_sweep.a-=h*(p*o-q*m),e.SynchronizeTransform(),f.m_sweep.c.x+=i*m,f.m_sweep.c.y+=i*o,f.m_sweep.a+=j*(r*o-n*m),f.SynchronizeTransform()}}return b>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2ControllerListNode=function(a){this.controller=a,this.previous=this.next=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(a){this.next=a},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(a){this.previous=a},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerLastNode=this.controllerFirstNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(a){var b=a.ID;if(null==this.controllerNodeLookup[b]){var a=new Box2D.Dynamics.Controllers.b2ControllerListNode(a),c=this.controllerLastNode;null!=c?c.SetNextNode(a):this.controllerFirstNode=a,a.SetPreviousNode(c),this.controllerLastNode=a,this.controllerNodeLookup[b]=a,this.controllerCount++}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(a){var a=a.ID,b=this.controllerNodeLookup[a];if(null!=b){var c=b.GetPreviousNode(),b=b.GetNextNode();null==c?this.controllerFirstNode=b:c.SetNextNode(b),null==b?this.controllerLastNode=c:b.SetPreviousNode(c),delete this.controllerNodeLookup[a],this.controllerCount--}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=.2,this.density=this.restitution=0,this.isSensor=!1},Box2D.Dynamics.b2Body=function(a,b){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=a.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=a.bullet,this.m_fixedRotation=a.fixedRotation,this.m_allowSleep=a.allowSleep,this.m_awake=a.awake,this.m_active=a.active,this.m_world=b,this.m_userData=null,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_sleepTime=this.m_torque=0,this.m_type=a.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=a.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(a){return Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),a=new Box2D.Dynamics.b2Fixture(this,this.m_xf,a),this.m_active&&a.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),this.fixtureList.AddFixture(a),a.m_body=this,0<a.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,a},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(a,b){var c=new Box2D.Dynamics.b2FixtureDef;return c.shape=a,c.density=b,this.CreateFixture(c)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(a){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.fixtureList.RemoveFixture(a);for(var b=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode())(a==b.contact.GetFixtureA()||a==b.contact.GetFixtureB())&&this.m_world.m_contactManager.Destroy(b.contact);this.m_active&&a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),a.Destroy(),this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(a,b){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_xf.R.Set(b),this.m_xf.position.SetV(a);var c=this.m_xf.R,d=this.m_sweep.localCenter;for(this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b,c=this.m_world.m_contactManager.m_broadPhase,d=this.fixtureList.GetFirstNode();d;d=d.GetNextNode())d.fixture.Synchronize(c,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(a){this.SetPositionAndAngle(this.GetPosition(),a)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetUserData=function(){return this.m_userData},Box2D.Dynamics.b2Body.prototype.SetUserData=function(a){this.m_userData=a},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(a){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(a)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(a){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=a)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var a=new Box2D.Dynamics.b2BodyDef;return a.type=this.GetType(),a.allowSleep=this.m_allowSleep,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=this.m_fixedRotation,a.bullet=this.m_bullet,a.active=this.m_active,a.awake=this.m_awake,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position.SetV(this.GetPosition()),a},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(a,b){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(a){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=a)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(a,b){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},Box2D.Dynamics.b2Body.prototype.Split=function(a){for(var b=this.GetLinearVelocity().Copy(),c=this.GetAngularVelocity(),d=this.GetWorldCenter(),e=this.m_world.CreateBody(this.GetDefinition()),f=this.fixtureList.GetFirstNode();f;f=f.GetNextNode()){var g=f.fixture;a(g)&&(this.fixtureList.RemoveFixture(g),e.fixtureList.AddFixture(g))}return this.ResetMassData(),e.ResetMassData(),f=this.GetWorldCenter(),a=e.GetWorldCenter(),g=Box2D.Common.Math.b2Math.SubtractVV(f,d),f=Box2D.Common.Math.b2Math.CrossFV(c,g),Box2D.Common.Math.b2Vec2.Free(g),g=Box2D.Common.Math.b2Math.AddVV(b,f),Box2D.Common.Math.b2Vec2.Free(f),this.SetLinearVelocity(g),Box2D.Common.Math.b2Vec2.Free(g),a=Box2D.Common.Math.b2Math.SubtractVV(a,d),d=Box2D.Common.Math.b2Math.CrossFV(c,a),Box2D.Common.Math.b2Vec2.Free(a),a=Box2D.Common.Math.b2Math.AddVV(b,d),Box2D.Common.Math.b2Vec2.Free(d),e.SetLinearVelocity(a),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(b),this.SetAngularVelocity(c),e.SetAngularVelocity(c),this.SynchronizeFixtures(),e.SynchronizeFixtures(),e},Box2D.Dynamics.b2Body.prototype.Merge=function(a){for(var b=a.fixtureList.GetFirstNode();b;b=b.GetNextNode())this.fixtureList.AddFixture(b.fixture),a.fixtureList.RemoveFixture(b.fixture);a.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(a){return a||(a=Box2D.Collision.Shapes.b2MassData.Get()),a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter),a},Box2D.Dynamics.b2Body.prototype.SetMassData=function(a){if(Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=a.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<a.I&&!this.m_fixedRotation&&(this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I);var b=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x),Box2D.Common.Math.b2Vec2.Free(b)}},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){if(this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero(),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var a=Box2D.Common.Math.b2Vec2.Get(0,0),b=this.fixtureList.GetFirstNode();b;b=b.GetNextNode()){var c=b.fixture;0!=c.m_density&&(c=c.GetMassData(),this.m_mass+=c.mass,a.x+=c.center.x*c.mass,a.y+=c.center.y*c.mass,this.m_I+=c.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):this.m_invMass=this.m_mass=1,0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,Box2D.Common.b2Settings.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,b=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(a),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-b.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-b.x),Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(b)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,a=Box2D.Common.Math.b2Vec2.Get(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return a.x+=this.m_xf.position.x,a.y+=this.m_xf.position.y,a},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(a){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,a)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(a){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,a)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(a){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,a)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(a){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,a=Box2D.Common.Math.b2Vec2.Get(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return a.x+=this.m_xf.position.x,a.y+=this.m_xf.position.y,b=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x)),Box2D.Common.Math.b2Vec2.Free(a),b},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(a){this.m_linearDamping=a},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(a){this.m_angularDamping=a},Box2D.Dynamics.b2Body.prototype.SetType=function(a){if(this.m_type!=a){for(this.m_type=a,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())a.contact.FlagForFiltering();for(a=0;a<this.m_lists.length;a++)this.m_lists[a].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(a){this.m_bullet=a},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(a){(this.m_allowSleep=a)||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(a){if(this.m_awake!=a)for(this.m_awake=a,this.m_sleepTime=0,a||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0),a=0;a<this.m_lists.length;a++)this.m_lists[a].UpdateBody(this)},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(a){this.m_fixedRotation=a,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(a){if(a!=this.m_active){if(a){this.m_active=!0;for(var a=this.m_world.m_contactManager.m_broadPhase,b=this.fixtureList.GetFirstNode();b;b=b.GetNextNode())b.fixture.CreateProxy(a,this.m_xf)}else{for(this.m_active=!1,a=this.m_world.m_contactManager.m_broadPhase,b=this.fixtureList.GetFirstNode();b;b=b.GetNextNode())b.fixture.DestroyProxy(a);for(a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())this.m_world.m_contactManager.Destroy(a.contact)}for(a=0;a<this.m_lists.length;a++)this.m_lists[a].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(a){this.controllerList.AddController(a)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(a){this.controllerList.RemoveController(a)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var a=Box2D.Dynamics.b2Body.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;for(a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y),b=this.m_world.m_contactManager.m_broadPhase,c=this.fixtureList.GetFirstNode();c;c=c.GetNextNode())c.fixture.Synchronize(b,a,this.m_xf)},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(a){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&a.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},Box2D.Dynamics.b2Body.prototype.Advance=function(a){this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World=function(a,b){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_newFixture=this.m_isLocked=!1,this.m_debugDraw=this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_continuousPhysics=this.m_warmStarting=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef),this.mainTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.islandTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.island=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},Box2D.Dynamics.b2World.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},Box2D.Dynamics.b2World.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())for(var d=c.body.GetFixtureList().GetFirstNode();d;d=d.GetNextNode()){var e=d.fixture;e.m_proxy=a.CreateProxy(b.GetFatAABB(e.m_proxy),e)}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(a){return Box2D.Common.b2Settings.b2Assert(!this.IsLocked()),a=new Box2D.Dynamics.b2Body(a,this),this.bodyList.AddBody(a),a},Box2D.Dynamics.b2World.prototype.DestroyBody=function(a){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(b=a.GetControllerList().GetFirstNode();b;b=b.GetNextNode())b.controller.RemoveBody(a);for(b=a.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);b;b=b.GetNextNode())this.m_contactManager.Destroy(b.contact);for(b=a.GetFixtureList().GetFirstNode();b;b=b.GetNextNode())this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(b.fixture),a.DestroyFixture(b.fixture);a.Destroy(),this.bodyList.RemoveBody(a)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(a){var b=Box2D.Dynamics.Joints.b2Joint.Create(a);b.m_prev=null,(b.m_next=this.m_jointList)&&(this.m_jointList.m_prev=b),this.m_jointList=b,this.m_jointCount++,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,(b.m_edgeA.next=b.m_bodyA.m_jointList)&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,(b.m_edgeB.next=b.m_bodyB.m_jointList)&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(!a.collideConnected)for(a=d.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())a.contact.GetOther(d)==c&&a.contact.FlagForFiltering();return b},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,this.m_jointCount--,!b)for(a=d.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())a.contact.GetOther(d)==c&&a.contact.FlagForFiltering()},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(a){if(null!==a.m_world&&a.m_world!=this)throw Error("Controller can only be a member of one world");return this.controllerList.AddController(a),a.m_world=this,a},Box2D.Dynamics.b2World.prototype.RemoveController=function(a){this.controllerList.RemoveController(a),a.m_world=null,a.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(a){return this.AddController(a)},Box2D.Dynamics.b2World.prototype.DestroyController=function(a){this.RemoveController(a)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(a){this.m_warmStarting=a},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(a){this.m_continuousPhysics=a},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(a){this.m_gravity=a},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(a,b,c){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0,this.mainTimeStep.Reset(a,this.m_inv_dt0*a,b,c,this.m_warmStarting),this.m_contactManager.Collide(),0<this.mainTimeStep.dt&&(this.Solve(this.mainTimeStep),this.m_continuousPhysics&&this.SolveTOI(this.mainTimeStep),this.m_inv_dt0=this.mainTimeStep.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);a;a=a.GetNextNode())a.body.m_force.SetZero(),a.body.m_torque=0},Box2D.Dynamics.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){this.m_debugDraw.Clear();var a=this.m_debugDraw.GetFlags();if(a&Box2D.Dynamics.b2DebugDraw.e_shapeBit)for(var b=Box2D.Dynamics.b2World.s_color_inactive,c=Box2D.Dynamics.b2World.s_color_static,d=Box2D.Dynamics.b2World.s_color_kinematic,e=Box2D.Dynamics.b2World.s_color_dynamic_sleeping,f=Box2D.Dynamics.b2World.s_color_dynamic_awake,g=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);g;g=g.GetNextNode())for(var h=g.body,i=h.GetFixtureList().GetFirstNode();i;i=i.GetNextNode()){var j=i.fixture,j=j.GetShape();h.IsActive()?h.GetType()==Box2D.Dynamics.b2BodyDef.b2_staticBody?this.DrawShape(j,h.m_xf,c):h.GetType()==Box2D.Dynamics.b2BodyDef.b2_kinematicBody?this.DrawShape(j,h.m_xf,d):h.IsAwake()?this.DrawShape(j,h.m_xf,f):this.DrawShape(j,h.m_xf,e):this.DrawShape(j,h.m_xf,b)
}if(a&Box2D.Dynamics.b2DebugDraw.e_jointBit)for(g=this.m_jointList;g;g=g.m_next)this.DrawJoint(g);if(a&Box2D.Dynamics.b2DebugDraw.e_controllerBit)for(g=this.controllerList.GetFirstNode();g;g=g.GetNextNode())g.controller.Draw(this.m_debugDraw);if(a&Box2D.Dynamics.b2DebugDraw.e_pairBit)for(g=Box2D.Dynamics.b2World.s_pairColor,i=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);i;i=i.GetNextNode())b=i.contact.GetFixtureA(),h=i.contact.GetFixtureB(),b=b.GetAABB().GetCenter(),h=h.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(b,h,g),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(h);if(a&Box2D.Dynamics.b2DebugDraw.e_aabbBit)for(b=Box2D.Dynamics.b2World.s_aabbColor,g=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.activeBodies);g;g=g.GetNextNode())for(h=g.body,i=h.GetFixtureList().GetFirstNode();i;i=i.GetNextNode())j=i.fixture,h=this.m_contactManager.m_broadPhase.GetFatAABB(j.m_proxy),h=[Box2D.Common.Math.b2Vec2.Get(h.lowerBound.x,h.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(h.upperBound.x,h.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(h.upperBound.x,h.upperBound.y),Box2D.Common.Math.b2Vec2.Get(h.lowerBound.x,h.upperBound.y)],this.m_debugDraw.DrawPolygon(h,4,b),Box2D.Common.Math.b2Vec2.Free(h[0]),Box2D.Common.Math.b2Vec2.Free(h[1]),Box2D.Common.Math.b2Vec2.Free(h[2]),Box2D.Common.Math.b2Vec2.Free(h[3]);if(a&Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit)for(g=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);g;g=g.GetNextNode())h=g.body,Box2D.Dynamics.b2World.s_xf.R=h.m_xf.R,Box2D.Dynamics.b2World.s_xf.position=h.GetWorldCenter(),this.m_debugDraw.DrawTransform(Box2D.Dynamics.b2World.s_xf)}},Box2D.Dynamics.b2World.prototype.QueryAABB=function(a,b){this.m_contactManager.m_broadPhase.Query(a,b)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(a,b){var c=Box2D.Collision.b2AABB.Get();c.lowerBound.Set(b.x-Box2D.Common.b2Settings.b2_linearSlop,b.y-Box2D.Common.b2Settings.b2_linearSlop),c.upperBound.Set(b.x+Box2D.Common.b2Settings.b2_linearSlop,b.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(c){return c.TestPoint(b)?a(c):!0},c),Box2D.Collision.b2AABB.Free(c)},Box2D.Dynamics.b2World.prototype.RayCast=function(a,b,c){var d=this.m_contactManager.m_broadPhase,e=new Box2D.Collision.b2RayCastOutput,f=new Box2D.Collision.b2RayCastInput(b,c,1);d.RayCast(function(d,f){if(f.RayCast(e,d)){var g=1-e.fraction,g=Box2D.Common.Math.b2Vec2.Get(g*b.x+e.fraction*c.x,g*b.y+e.fraction*c.y),h=a(f,g,e.normal,e.fraction);return Box2D.Common.Math.b2Vec2.Free(g),h}return d.maxFraction},f)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(a,b){var c=null;return this.RayCast(function(a,b,d,e){return c=a,e},a,b),c},Box2D.Dynamics.b2World.prototype.RayCastAll=function(a,b){var c=[];return this.RayCast(function(a){return c.push(a),1},a,b),c},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked},Box2D.Dynamics.b2World.prototype.Solve=function(a){for(var b=this.controllerList.GetFirstNode();b;b=b.GetNextNode())b.controller.Step(a);b=this.island,b.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())c.body.m_islandFlag=!1;for(var d=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);d;d=d.GetNextNode())d.contact.m_islandFlag=!1;for(c=this.m_jointList;c;c=c.m_next)c.m_islandFlag=!1;for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);c;c=c.GetNextNode())if(d=c.body,!d.m_islandFlag){b.Clear();var e=[];for(e.push(d),d.m_islandFlag=!0;0<e.length;){var f=e.pop();if(b.AddBody(f),f.IsAwake()||f.SetAwake(!0),f.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(d=f.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);d;d=d.GetNextNode()){var g=d.contact;g.m_islandFlag||(b.AddContact(g),g.m_islandFlag=!0,g=g.GetOther(f),g.m_islandFlag||(e.push(g),g.m_islandFlag=!0))}for(d=f.m_jointList;d;d=d.next)!d.joint.m_islandFlag&&d.other.IsActive()&&(b.AddJoint(d.joint),d.joint.m_islandFlag=!0,d.other.m_islandFlag||(e.push(d.other),d.other.m_islandFlag=!0))}}b.Solve(a,this.m_gravity,this.m_allowSleep)}for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);c;c=c.GetNextNode())c.body.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(a){var b=this.island;b.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode()){var d=c.body;d.m_islandFlag=!1,d.m_sweep.t0=0}for(var e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.m_islandFlag=!1,e.contact.m_toi=null;for(c=this.m_jointList;c;c=c.m_next)c.m_islandFlag=!1;for(;;){var c=this._SolveTOI2(a),f=c.minContact,c=c.minTOI;if(null===f||Box2D.Dynamics.b2World.MAX_TOI<c)break;if(e=f.m_fixtureA.GetBody(),d=f.m_fixtureB.GetBody(),Box2D.Dynamics.b2World.s_backupA.Set(e.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(d.m_sweep),e.Advance(c),d.Advance(c),f.Update(this.m_contactManager.m_contactListener),f.m_toi=null,f.IsSensor()||!f.IsEnabled())e.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),d.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),e.SynchronizeTransform(),d.SynchronizeTransform();else if(f.IsTouching()){for(e.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(e=d),b.Clear(),f=new goog.structs.Queue,f.enqueue(e),e.m_islandFlag=!0;0<f.size;)if(d=f.dequeue(),b.AddBody(d),d.IsAwake()||d.SetAwake(!0),d.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(e=d.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);e&&b.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;e=e.GetNextNode()){var g=e.contact;g.m_islandFlag||(b.AddContact(g),g.m_islandFlag=!0,g=g.GetOther(d),g.m_islandFlag||(g.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(g.Advance(c),g.SetAwake(!0),f.enqueue(g)),g.m_islandFlag=!0))}for(d=d.m_jointList;d;d=d.next)b.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!d.joint.m_islandFlag&&d.other.IsActive()&&(b.AddJoint(d.joint),d.joint.m_islandFlag=!0,d.other.m_islandFlag||(d.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(d.other.Advance(c),d.other.SetAwake(!0),f.enqueue(d.other)),d.other.m_islandFlag=!0))}for(this.islandTimeStep.Reset((1-c)*a.dt,0,a.velocityIterations,a.positionIterations,!1),b.SolveTOI(this.islandTimeStep),c=0;c<b.m_bodies.length;c++)if(b.m_bodies[c].m_islandFlag=!1,b.m_bodies[c].IsAwake()&&b.m_bodies[c].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody)for(b.m_bodies[c].SynchronizeFixtures(),e=b.m_bodies[c].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.m_toi=null;for(c=0;c<b.m_contactCount;c++)b.m_contacts[c].m_islandFlag=!1,b.m_contacts[c].m_toi=null;for(c=0;c<b.m_jointCount;c++)b.m_joints[c].m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(a){for(var b=null,c=1,d=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);d;d=d.GetNextNode()){var e=d.contact;if(!this._SolveTOI2SkipContact(a,e)){var f=1;if(null!=e.m_toi)f=e.m_toi;else{if(e.IsTouching())f=1;else{var f=e.m_fixtureA.GetBody(),g=e.m_fixtureB.GetBody(),h=f.m_sweep.t0;f.m_sweep.t0<g.m_sweep.t0?(h=g.m_sweep.t0,f.m_sweep.Advance(h)):g.m_sweep.t0<f.m_sweep.t0&&(h=f.m_sweep.t0,g.m_sweep.Advance(h)),f=e.ComputeTOI(f.m_sweep,g.m_sweep),Box2D.Common.b2Settings.b2Assert(f>=0&&1>=f),f>0&&1>f&&(f=(1-f)*h+f)}e.m_toi=f}Number.MIN_VALUE<f&&c>f&&(b=e,c=f)}}return{minContact:b,minTOI:c}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(a,b){var c=b.m_fixtureA.GetBody(),d=b.m_fixtureB.GetBody();return c.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&c.IsAwake()||d.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&d.IsAwake()?!1:!0},Box2D.Dynamics.b2World.prototype.DrawJoint=function(a){if(a instanceof Box2D.Dynamics.Joints.b2DistanceJoint||a instanceof Box2D.Dynamics.Joints.b2MouseJoint){var b=a.GetAnchorA(),c=a.GetAnchorB();this.m_debugDraw.DrawSegment(b,c,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c)}else if(a instanceof Box2D.Dynamics.Joints.b2PulleyJoint){var b=a.GetAnchorA(),c=a.GetAnchorB(),d=a.GetGroundAnchorA(),a=a.GetGroundAnchorB();this.m_debugDraw.DrawSegment(d,b,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(a,c,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(d,a,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(a)}else b=a.GetAnchorA(),c=a.GetAnchorB(),a.GetBodyA()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(a.GetBodyA().m_xf.position,b,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(b,c,Box2D.Dynamics.b2World.s_jointColor),a.GetBodyB()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(a.GetBodyB().m_xf.position,c,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(b),Box2D.Common.Math.b2Vec2.Free(c)},Box2D.Dynamics.b2World.prototype.DrawShape=function(a,b,c){if(a instanceof Box2D.Collision.Shapes.b2CircleShape){var d=Box2D.Common.Math.b2Math.MulX(b,a.m_p);this.m_debugDraw.DrawSolidCircle(d,a.m_radius,b.R.col1,c),Box2D.Common.Math.b2Vec2.Free(d)}else if(a instanceof Box2D.Collision.Shapes.b2PolygonShape){for(var d=0,e=a.GetVertexCount(),a=a.GetVertices(),f=[],d=0;e>d;d++)f[d]=Box2D.Common.Math.b2Math.MulX(b,a[d]);for(this.m_debugDraw.DrawSolidPolygon(f,e,c),d=0;e>d;d++)Box2D.Common.Math.b2Vec2.Free(f[d])}else a instanceof Box2D.Collision.Shapes.b2EdgeShape&&(d=Box2D.Common.Math.b2Math.MulX(b,a.GetVertex1()),b=Box2D.Common.Math.b2Math.MulX(b,a.GetVertex2()),this.m_debugDraw.DrawSegment(d,b,c),Box2D.Common.Math.b2Vec2.Free(d),Box2D.Common.Math.b2Vec2.Free(b))},Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_jointColor=new Box2D.Common.b2Color(.5,.8,.8),Box2D.Dynamics.b2World.s_color_inactive=new Box2D.Common.b2Color(.5,.5,.3),Box2D.Dynamics.b2World.s_color_static=new Box2D.Common.b2Color(.3,.3,.3),Box2D.Dynamics.b2World.s_color_kinematic=new Box2D.Common.b2Color(.5,.5,.9),Box2D.Dynamics.b2World.s_color_dynamic_sleeping=new Box2D.Common.b2Color(.6,.6,.6),Box2D.Dynamics.b2World.s_color_dynamic_awake=new Box2D.Common.b2Color(.6,.9,.6),Box2D.Dynamics.b2World.s_pairColor=new Box2D.Common.b2Color(.3,.9,.9),Box2D.Dynamics.b2World.s_aabbColor=new Box2D.Common.b2Color(0,0,.8),Box2D.generateCallback=function(a,b){return function(){b.apply(a,arguments)}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},goog.inherits(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(a,b){this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,this.maxTimestep=a>0||b>0?1/Math.max(a,b):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(a){if(a=a.dt,!(a<=Number.MIN_VALUE)){a>this.maxTimestep&&0<this.maxTimestep&&(a=this.maxTimestep);for(var b=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);b;b=b.GetNextNode()){var c=b.body,d=c.GetLocalVector(c.GetLinearVelocity()),e=Box2D.Common.Math.b2Math.MulMV(this.T,d);Box2D.Common.Math.b2Vec2.Free(d),d=c.GetWorldVector(e),Box2D.Common.Math.b2Vec2.Free(e),e=Box2D.Common.Math.b2Vec2.Get(c.GetLinearVelocity().x+d.x*a,c.GetLinearVelocity().y+d.y*a),Box2D.Common.Math.b2Vec2.Free(d),c.SetLinearVelocity(e),Box2D.Common.Math.b2Vec2.Free(e)}}},Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);a;a=a.GetNextNode()){var b=a.body;b.ApplyForce(this.F,b.GetWorldCenter())}},Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(a,b,c,d,e,f,g){void 0===g&&(g=0),this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f),a=e.x-c.x,c=e.y-c.y,this.lengthA=Math.sqrt(a*a+c*c),c=f.x-d.x,d=f.y-d.y,this.lengthB=Math.sqrt(c*c+d*d),this.ratio=g,g=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=g-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(g-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},define("playcraft/ext/box2dweb.2.1a-pc",function(){}),pc.Hashtable=gamecore.Hashtable,pc.Base=gamecore.Base("pc.Base",{},{}),pc.Pool=gamecore.Pool.extend("pc.Pool",{},{}),pc.Pooled=gamecore.Pooled.extend("pc.Pooled",{},{}),pc.LinkedList=gamecore.LinkedList.extend("pc.LinkedList",{},{}),pc.LinkedListNode=gamecore.LinkedListNode.extend("pc.LinkedListNode",{},{}),pc.HashList=gamecore.HashList.extend("pc.HashList",{},{}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),define("playcraft/boot",function(){}),pc.Input=pc.Base("pc.Input",{_eventPos:null,getEventPosition:function(a,b){null==this._eventPos&&(this._eventPos=pc.Point.create(0,0));var c=b;return pc.Tools.isValid(b)||(c=this._eventPos),a.pageX||a.pageY?(c.x=a.pageX,c.y=a.pageY):(c.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),pc.Tools.isValid(a.alpha)&&(c.x=a.alpha,c.y=a.gamma),c}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:!1,mouseRightButtonDown:!1,deviceOrientation:null,init:function(){this._super(),this.stateBindings=new pc.Hashtable,this.states=new pc.Hashtable,this.actionBindings=new pc.Hashtable,this.mousePos=pc.Point.create(0,0),this.deviceOrientation=pc.Point.create(0,0)},bindState:function(a,b,c,d){if(null==a.uniqueId)throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function";if(!pc.InputType.getCode(c))throw"Unknown input code "+c+" - see pc.InputType for a list of input names";c=c.toUpperCase();var e={stateName:b,object:a,input:c,state:{on:!1,event:null},uiTarget:d},f=this.stateBindings.get(c);null==f?this.stateBindings.put(c,[e]):f.push(e),this.states.put(a.uniqueId+"\\\\"+b,{on:!1,event:null}),pc.InputType.isPositional(pc.InputType.getCode(c))&&this._positionals.push(e)},clearStates:function(a){for(var b=this.stateBindings.entries(),c=0;c<b.length;c++)for(var d=b[c],e=0;e<d.length;e++){var f=d[e];if(f.object==a){var g=this.states.get(next.object.uniqueId+"\\\\"+next.stateName);g.on=!1,g.event=null,pc.InputType.isPositional(f.input)&&pc.tools.arrayRemove(this._positionals,f)}}},isInputState:function(a,b){var c=this.states.get(a.uniqueId+"\\\\"+b);if(null==c)throw"Ooops, unknown state "+b;return c.on},getInputState:function(a,b){return this.states.get(a.uniqueId+"\\\\"+b)},bindAction:function(a,b,c,d){c=c.toUpperCase();var e=this.actionBindings.get(c);null==e?this.actionBindings.put(c,[{actionName:b,object:a,input:c,uiTarget:d}]):e.push({actionName:b,input:c,object:a,uiTarget:d})},fireAction:function(a,b){var c=this.actionBindings.get(pc.InputType.getName(a));if(null==c)return!1;for(var d=0;d<c.length;d++){var e=c[d],f=c[d].object;if(!f.isActive||f.isActive())if(pc.InputType.isPositional(a)){var g=this.Class.getEventPosition(b);if(pc.InputType.isDeviceOrientation(a))return f.onAction(e.actionName,b,g,e.uiTarget),!0;var h=null;if(h=pc.valid(e.uiTarget)?e.uiTarget.getScreenRect():f.getScreenRect?f.getScreenRect():null,h&&h.containsPoint(g)){var i=f.onAction(e.actionName,b,g,e.uiTarget);if(pc.valid(i)&&!i)break}}else{var j=f.onAction(e.actionName);if(pc.valid(j)&&!j)break}}return!0},_onReady:function(){pc.device.canvas.addEventListener("touchstart",this._touchStart.bind(this),!0),pc.device.canvas.addEventListener("touchend",this._touchEnd.bind(this),!0),pc.device.canvas.addEventListener("touchmove",this._touchMove.bind(this),!0),pc.device.canvas.addEventListener("mouseup",this._mouseUp.bind(this),!0),pc.device.canvas.addEventListener("mousedown",this._mouseDown.bind(this),!0),pc.device.canvas.addEventListener("mousemove",this._mouseMove.bind(this),!0),pc.device.canvas.addEventListener("mousewheel",this._mouseWheel.bind(this),!0),pc.device.canvas.addEventListener("contextmenu",this._contextMenu.bind(this),!0),window.addEventListener("keydown",this._keyDown.bind(this),!0),window.addEventListener("keyup",this._keyUp.bind(this),!0),window.addEventListener("deviceorientation",this._deviceOrientation.bind(this),!0)},_positionals:[],_checkPositional:function(a){for(var b=0;b<this._positionals.length;b++){var c=this._positionals[b];if(!("mousemove"==a.type&&pc.InputType.isTouch(pc.InputType.getCode(c.input))||"touchmove"==a.type&&!pc.InputType.isTouch(pc.InputType.getCode(c.input))||pc.InputType.getCode(c.input)==pc.InputType.MOUSE_BUTTON_LEFT_UP||pc.InputType.getCode(c.input)==pc.InputType.MOUSE_BUTTON_LEFT_DOWN||pc.InputType.getCode(c.input)==pc.InputType.MOUSE_BUTTON_RIGHT_UP||pc.InputType.getCode(c.input)==pc.InputType.MOUSE_BUTTON_RIGHT_DOWN)){var d=null;if(d=pc.valid(c.uiTarget)?c.uiTarget.getScreenRect():c.object.getScreenRect?c.object.getScreenRect():null)if(d.containsPoint(this.Class.getEventPosition(a))){var e=this.states.get(c.object.uniqueId+"\\\\"+c.stateName);e.on=!0,e.event=a}else{var f=this.states.get(c.object.uniqueId+"\\\\"+c.stateName);f.on=!1,f.event=a}}}},_changeState:function(a,b,c){var d=pc.InputType.getName(a);if(null==d)return this.log("Unknown keycode = "+a),!1;var e=this.stateBindings.get(d);if(null==e)return!1;for(var f=0;f<e.length;f++){var g=e[f];if(!g.object.isActive||g.object.isActive())if(pc.InputType.isPositional(a)){var h=this.Class.getEventPosition(c),i=null;if(i=pc.valid(g.uiTarget)?g.uiTarget.getScreenRect():g.object.getScreenRect?g.object.getScreenRect():null){if(i.containsPoint(h)){var j=this.states.get(g.object.uniqueId+"\\\\"+g.stateName);j.on=b,j.event=c}}else j=this.states.get(g.object.uniqueId+"\\\\"+g.stateName),j.on=b,j.event=c}else j=this.states.get(g.object.uniqueId+"\\\\"+g.stateName),j.on=b,j.event=c}return!0},_lastMouseMove:null,_lastDeviceOrientation:null,process:function(){this._lastMouseMove&&(this._checkPositional(this._lastMouseMove),this.fireAction(pc.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null),this._lastDeviceOrientation&&(this._changeState(pc.InputType.DEVICE_ORIENTATION,!0,this._lastDeviceOrientation),this.fireAction(pc.InputType.DEVICE_ORIENTATION,this._lastDeviceOrientation),this.Class.getEventPosition(this._lastDeviceOrientation,this.deviceOrientation),this._lastDeviceOrientation=null)},_keyDown:function(a){this._changeState(a.keyCode,!0,a)&&a.preventDefault(),this.fireAction(a.keyCode,a)&&a.preventDefault()},_keyUp:function(a){this._changeState(a.keyCode,!1,a)&&a.preventDefault()},_deviceOrientation:function(a){this._lastDeviceOrientation=a,a.preventDefault()},_touchStart:function(a){for(var b=0,c=a.touches.length;c>b;b++)this._changeState(pc.InputType.TOUCH,!0,a.touches[b]),this.fireAction(pc.InputType.TOUCH,a.touches[b]);a.preventDefault()},_touchEnd:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)this._checkPositional(a.touches[b]),this._changeState(pc.InputType.TOUCH_END,!1,a.changedTouches[b]),this.fireAction(pc.InputType.TOUCH_END,a.changedTouches[b]);a.preventDefault()},_touchMove:function(a){for(var b=0,c=a.touches.length;c>b;b++)this._checkPositional(a.touches[b]),this._changeState(pc.InputType.TOUCH_MOVE,!1,a.changedTouches[b]),this.fireAction(pc.InputType.TOUCH_MOVE,a.touches[b]);a.preventDefault()},_mouseUp:function(a){0==a.button||1==a.button?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!1,a),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!0,a),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_UP,a),this.mouseLeftButtonDown=!1):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!1,a),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,a),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,a),this.mouseRightButtonDown=!1),a.preventDefault()},_mouseDown:function(a){0==a.button||1==a.button?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!0,a),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!1,a),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,a),this.mouseLeftButtonDown=!0):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!0,a),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!1,a),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,a),this.mouseRightButtonDown=!0),a.preventDefault()},_mouseMove:function(a){this._lastMouseMove=a,a.preventDefault()},_contextMenu:function(a){this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,a),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,a)},_mouseWheel:function(a){a.wheel>0?this.fireAction(pc.InputType.MOUSE_WHEEL_UP,a):this.fireAction(pc.InputType.MOUSE_WHEEL_DOWN,a),a.preventDefault()}}),pc.InputType=pc.Base.extend("pc.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1e3,MOUSE_MOVE:1100,MOUSE_BUTTON_LEFT_UP:1110,MOUSE_BUTTON_LEFT_DOWN:1111,MOUSE_BUTTON_RIGHT_UP:1120,MOUSE_BUTTON_RIGHT_DOWN:1121,MOUSE_WHEEL_UP:1130,MOUSE_WHEEL_DOWN:1131,TOUCH:1e3,TOUCH_MOVE:1001,TOUCH_END:1002,DEVICE_ORIENTATION:1020,init:function(){this.nameToCode=new pc.Hashtable,this.codeToName=new pc.Hashtable,this.addInput(8,"BACKSPACE"),this.addInput(9,"TAB"),this.addInput(13,"ENTER"),this.addInput(16,"SHIFT"),this.addInput(17,"CTRL"),this.addInput(18,"ALT"),this.addInput(19,"PAUSE"),this.addInput(20,"CAPS"),this.addInput(27,"ESC"),this.addInput(32,"SPACE"),this.addInput(33,"PAGE_UP"),this.addInput(34,"PAGE_DOWN"),this.addInput(35,"END"),this.addInput(36,"HOME"),this.addInput(37,"LEFT"),this.addInput(38,"UP"),this.addInput(39,"RIGHT"),this.addInput(40,"DOWN"),this.addInput(45,"INSERT"),this.addInput(46,"DELETE");for(var a=48;91>a;a++){var b=String.fromCharCode(a);this.addInput(a,b)}this.addInput(91,"WINDOW_LEFT"),this.addInput(92,"WINDOW_RIGHT"),this.addInput(93,"SELECT"),this.addInput(96,"NUM_0"),this.addInput(97,"NUM_1"),this.addInput(98,"NUM_2"),this.addInput(99,"NUM_3"),this.addInput(100,"NUM_4"),this.addInput(101,"NUM_5"),this.addInput(102,"NUM_6"),this.addInput(103,"NUM_7"),this.addInput(104,"NUM_8"),this.addInput(105,"NUM_9"),this.addInput(106,"*"),this.addInput(107,"+"),this.addInput(109,"-"),this.addInput(110,"."),this.addInput(111,"/"),this.addInput(112,"F1"),this.addInput(113,"F2"),this.addInput(114,"F3"),this.addInput(115,"F4"),this.addInput(116,"F5"),this.addInput(117,"F6"),this.addInput(118,"F7"),this.addInput(119,"F8"),this.addInput(120,"F9"),this.addInput(121,"F10"),this.addInput(122,"F11"),this.addInput(123,"F12"),this.addInput(144,"NUM_LOCK"),this.addInput(145,"SCROLL_LOCK"),this.addInput(186,";"),this.addInput(187,"="),this.addInput(188,","),this.addInput(189,"-"),this.addInput(190,"."),this.addInput(191,"/"),this.addInput(192,"`"),this.addInput(219,"["),this.addInput(220,"\\"),this.addInput(221,"]"),this.addInput(222,"'"),this.addInput(this.DEVICE_ORIENTATION,"DEVICE_ORIENTATION"),this.addInput(this.TOUCH,"TOUCH"),this.addInput(this.TOUCH_MOVE,"TOUCH_MOVE"),this.addInput(this.TOUCH_END,"TOUCH_END"),this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN"),this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP"),this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN"),this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP"),this.nameToCode.put("MOUSE_LEFT_BUTTON",this.MOUSE_BUTTON_LEFT_UP),this.nameToCode.put("MOUSE_RIGHT_BUTTON",this.MOUSE_BUTTON_RIGHT_UP),this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP"),this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN"),this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE")},isDeviceOrientation:function(a){return a==this.DEVICE_ORIENTATION},isTouch:function(a){return a==this.TOUCH},isPositional:function(a){return a>=this.POSITIONAL_EVENT_START},addInput:function(a,b){this.codeToName.put(a,b),this.nameToCode.put(b,a)},getName:function(a){return this.codeToName.get(a)},getCode:function(a){return this.nameToCode.get(a)}},{}),define("playcraft/input",function(){}),pc.Hashmap=pc.Base.extend("pc.Hashmap",{},{init:function(){this._super(),this.items={}},length:0,items:{},put:function(a,b){if(!pc.valid(a))throw"invaid key";this.items[a]=b,this.length++},get:function(a){return this.items[a]},hasKey:function(a){return this.items.hasOwnProperty(a)},remove:function(a){this.hasKey(a)&&(this.length--,delete this.items[a])},keys:function(){var a=[];for(var b in this.items)a.push(b);return a},values:function(){var a=[];for(var b in this.items)a.push(this.items[b]);return a},clear:function(){this.items={},this.length=0}}),define("playcraft/hashmap",function(){}),pc.Tools=pc.Base.extend("pc.Tools",{checked:function(a,b){return pc.valid(a)?a:b},isValid:function(a){return!(null==a||"undefined"==typeof a)},assert:function(a,b){if(!a)throw b},arrayRemove:function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1)},arrayExclusiveAdd:function(a,b){-1==a.indexOf(b)&&a.push(b)},xmlToJson:function(a,b){var c={toObj:function(a){var b={};if(1==a.nodeType){if(a.attributes.length)for(var d=0;d<a.attributes.length;d++)b[a.attributes[d].nodeName]=(a.attributes[d].nodeValue||"").toString();if(a.firstChild){for(var e=0,f=0,g=!1,h=a.firstChild;h;h=h.nextSibling)1==h.nodeType?g=!0:3==h.nodeType&&h.nodeValue.match(/[^ \f\n\r\t\v]/)?e++:4==h.nodeType&&f++;if(g)if(2>e&&2>f){c.removeWhite(a);for(var h=a.firstChild;h;h=h.nextSibling)3==h.nodeType?b["#text"]=c.escape(h.nodeValue):4==h.nodeType?b["#cdata"]=c.escape(h.nodeValue):b[h.nodeName]?b[h.nodeName]instanceof Array?b[h.nodeName][b[h.nodeName].length]=c.toObj(h):b[h.nodeName]=[b[h.nodeName],c.toObj(h)]:b[h.nodeName]=c.toObj(h)}else a.attributes.length?b["#text"]=c.escape(c.innerXml(a)):b=c.escape(c.innerXml(a));else if(e)a.attributes.length?b["#text"]=c.escape(c.innerXml(a)):b=c.escape(c.innerXml(a));else if(f)if(f>1)b=c.escape(c.innerXml(a));else for(var h=a.firstChild;h;h=h.nextSibling)b["#cdata"]=c.escape(h.nodeValue)}a.attributes.length||a.firstChild||(b=null)}else 9==a.nodeType?b=c.toObj(a.documentElement):alert("unhandled node type: "+a.nodeType);return b},toJson:function(a,b,d){var e=b?'"'+b+'"':"";if(a instanceof Array){for(var f=0,g=a.length;g>f;f++)a[f]=c.toJson(a[f],"",d+"	");e+=(b?":[":"[")+(a.length>1?"\n"+d+"	"+a.join(",\n"+d+"	")+"\n"+d:a.join(""))+"]"}else if(null==a)e+=(b&&":")+"null";else if("object"==typeof a){var h=[];for(var i in a)h[h.length]=c.toJson(a[i],i,d+"	");e+=(b?":{":"{")+(h.length>1?"\n"+d+"	"+h.join(",\n"+d+"	")+"\n"+d:h.join(""))+"}"}else e+="string"==typeof a?(b&&":")+'"'+a.toString()+'"':(b&&":")+a.toString();return e},innerXml:function(a){var b="";if("innerHTML"in a)b=a.innerHTML;else for(var c=function(a){var b="";if(1==a.nodeType){b+="<"+a.nodeName;for(var d=0;d<a.attributes.length;d++)b+=" "+a.attributes[d].nodeName+'="'+(a.attributes[d].nodeValue||"").toString()+'"';if(a.firstChild){b+=">";for(var e=a.firstChild;e;e=e.nextSibling)b+=c(e);b+="</"+a.nodeName+">"}else b+="/>"}else 3==a.nodeType?b+=a.nodeValue:4==a.nodeType&&(b+="<![CDATA["+a.nodeValue+"]]>");return b},d=a.firstChild;d;d=d.nextSibling)b+=c(d);return b},escape:function(a){return a.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(a){a.normalize();for(var b=a.firstChild;b;)if(3==b.nodeType)if(b.nodeValue.match(/[^ \f\n\r\t\v]/))b=b.nextSibling;else{var d=b.nextSibling;a.removeChild(b),b=d}else 1==b.nodeType?(c.removeWhite(b),b=b.nextSibling):b=b.nextSibling;return a}};9==a.nodeType&&(a=a.documentElement);var d=c.toJson(c.toObj(c.removeWhite(a)),a.nodeName,"	");return"{\n"+b+(b?d.replace(/\t/g,b):d.replace(/\t|\n/g,""))+"\n}"}},{}),pc.tools=new pc.Tools,pc.valid=pc.Tools.isValid,pc.checked=pc.Tools.checked,pc.assert=pc.Tools.assert,pc.Base64=pc.Base.extend("pc.Base64",{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=pc.Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i=[],j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i.push(String.fromCharCode(b)),64!=g&&i.push(String.fromCharCode(c)),64!=h&&i.push(String.fromCharCode(d));return i.join("")},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(192|d>>6),b+=String.fromCharCode(128|63&d)):(b+=String.fromCharCode(224|d>>12),b+=String.fromCharCode(128|63&d>>6),b+=String.fromCharCode(128|63&d))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);
return b}},{}),window.btoa||(window.btoa=pc.Base64.encode),window.atob||(window.atob=pc.Base64.decode),define("playcraft/tools",function(){}),pc.Color=pc.Pooled.extend("pc.Color",{create:function(a){var b=this._super();return b.config(a),b}},{rgb:[],color:null,init:function(a){void 0!=a&&this.config(a)},config:function(a){if(Array.isArray(a))this.rgb=a;else{if("#"!==a.charAt(0))throw"Invalid color: use either array [r,g,b] or '#RRGGBB'";this.rgb[0]=parseInt(a.substring(1,3),16),this.rgb[1]=parseInt(a.substring(3,5),16),this.rgb[2]=parseInt(a.substring(5,7),16)}this._updateColorCache()},set:function(a){this.config(a)},setRed:function(a){this.rgb[0]=pc.Math.limit(a,0,255),this._updateColorCache()},addRed:function(a){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],a,0,255),this._updateColorCache()},subRed:function(a){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],-a,0,255),this._updateColorCache()},setGreen:function(a){this.rgb[1]=pc.Math.limit(a,0,255),this._updateColorCache()},addGreen:function(a){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],a,0,255),this._updateColorCache()},subGreen:function(a){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],-a,0,255),this._updateColorCache()},setBlue:function(a){this.rgb[2]=pc.Math.limit(a,0,255),this._updateColorCache()},addBlue:function(a){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],a,0,255),this._updateColorCache()},subBlue:function(a){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],-a,0,255),this._updateColorCache()},darken:function(a){this.subRed(a),this.subGreen(a),this.subBlue(a)},lighten:function(a){this.addRed(a),this.addGreen(a),this.addBlue(a)},_updateColorCache:function(){this.color="rgb("+this.rgb[0]+","+this.rgb[1]+","+this.rgb[2]+")"}}),define("playcraft/color",function(){}),pc.DebugPanel=pc.Base("pc.DebugPanel",{},{x:0,y:0,panelHeight:0,panelWidth:0,canvas:null,ctx:null,statusText:null,active:!1,timeGraph:null,memGraph:null,entityGraph:null,poolGraph:null,currentMem:0,lastMem:0,init:function(){this._super()},onReady:function(){this.attach("pcDebug")},attach:function(a){if(this.canvas=document.getElementById(a),null==this.canvas)return this.warn('Showing debug requires a div with an id of "debug" to be added to your dom.'),pc.device.showDebug=!1,void 0;this.panelElement=this.canvas.parentNode,this.ctx=this.canvas.getContext("2d"),this.onResize();var b=4;this.timeGraph=new pc.CanvasLineGraph(this.ctx,"Performance","",10,[{name:"process (ms)",color:"#f55"},{name:"render (ms)",color:"#5f5"}],10,10,this.panelWidth/b-10,this.panelHeight-20),this.memGraph="undefined"==typeof console.memory||0==console.memory.totalJSHeapSize?new pc.CanvasLineGraph(this.ctx,"Memory","Memory profiling not available",0,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/b+10,10,this.panelWidth/b-10,this.panelHeight-20):new pc.CanvasLineGraph(this.ctx,"Memory","",1.2*(console.memory.totalJSHeapSize/1024/1024),[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/b+10,10,this.panelWidth/b-10,this.panelHeight-20),this.poolGraph=new pc.CanvasLineGraph(this.ctx,"Pool Size","",100,[{name:"pooled",color:"#5b1654"}],this.panelWidth-2*(this.panelWidth/b)+10,10,this.panelWidth/b-20,this.panelHeight-20),this.entityGraph=new pc.CanvasLineGraph(this.ctx,"Entities","",100,[{name:"drawn (total)",color:"#f9f007"}],this.panelWidth-this.panelWidth/b+10,10,this.panelWidth/b-20,this.panelHeight-20),this.active=!0},onResize:function(){if(null!=this.canvas){this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight,this.panelWidth=this.panelElement.offsetWidth,this.panelHeight=this.panelElement.offsetHeight,this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.panelWidth,this.panelHeight);var a=4;null!=this.timeGraph&&this.timeGraph.resize(10,10,this.panelWidth/a-10,this.panelHeight-20),null!=this.memGraph&&this.memGraph.resize(this.panelWidth/a+10,10,this.panelWidth/a-10,this.panelHeight-20),null!=this.poolGraph&&this.poolGraph.resize(this.panelWidth-2*(this.panelWidth/a)+20,10,this.panelWidth/a-20,this.panelHeight-20),null!=this.entityGraph&&this.entityGraph.resize(this.panelWidth-this.panelWidth/a+10,10,this.panelWidth/a-20,this.panelHeight-20)}},_timeSince:0,update:function(a){this.active&&(this._timeSince+=a,this._timeSince>30&&(this._timeSince=0,null!=this.timeGraph&&this.timeGraph.addLine2(pc.device.lastProcessMS,pc.device.lastDrawMS),null!=this.entityGraph&&this.entityGraph.addLine1(pc.device.elementsDrawn),null!=this.memGraph&&"undefined"!=typeof console.memory&&0!=console.memory.totalJSHeapSize&&this.memGraph.addLine1(window.performance.memory.usedJSHeapSize/1024/1024),null!=this.poolGraph&&this.poolGraph.addLine1(gamecore.Pool.totalPooled)))},draw:function(){this.active&&(null!=this.timeGraph&&this.timeGraph.draw(),null!=this.entityGraph&&this.entityGraph.draw(),null!=this.memGraph&&this.memGraph.draw(),null!=this.poolGraph&&this.poolGraph.draw())}}),pc.CanvasLineGraph=pc.Base.extend("pc.CanvasLineGraph",{height:0,width:0,ctx:null,data:null,maxY:0,x:0,y:0,labels:null,graphName:null,bgCanvas:null,graphCanvas:null,message:null,cursor:0,init:function(a,b,c,d,e,f,g,h,i){this._super(),this.ctx=a,this.message=c,this.graphName=b,this.maxY=d,this.x=f,this.y=g,this.width=h,this.height=i,this.labels=e,this.graphX=this.x+this.graphLeftMargin,this.graphY=this.y+20,this.cursor=0,this.graphCanvas=document.createElement("canvas"),this.bgCanvas=document.createElement("canvas"),this.resize(f,g,h,i)},resize:function(a,b,c,d){this.width>c&&(this.data=this.data.slice(this.width-c,c)),this.width=c,this.height=d,this.x=a,this.y=b,this.graphHeight=this.height-40,this.graphWidth=this.width-(this.graphLeftMargin+this.graphRightMargin),this.graphX=this.graphLeftMargin,this.graphY=20,this.bgCanvas.width=this.width,this.bgCanvas.height=this.height,this.graphCanvas.width=Math.max(this.graphWidth,1),this.graphCanvas.height=Math.max(this.graphHeight,1),this.resizeDataArray(this.graphWidth,this.labels.length),this.renderBackground()},resizeDataArray:function(a,b){var c=0;if(!(0>=a)){if(null==this.data)this.data=[];else{if(!(a>this.data.length))return this.data.splice(0,a-this.data.length),this.cursor>this.data.length-1&&(this.cursor=this.data.length-1),void 0;c=this.data.length-1}for(var d=c;a>d;d++)this.data.push(new Array(b))}},_totalAdded:0,linesSinceLastPeak:0,lastPeak:0,_total:0,addLine2:function(a,b){this.data&&(this._totalAdded++,this._total=a+b,this.checkMaxRange(this._total),this.data[this.cursor][0]=a,this.data[this.cursor][1]=b,this._updateGraph(this._total))},addLine1:function(a){this.data&&(this._totalAdded++,this._total=a,this.checkMaxRange(this._total),this.data[this.cursor][0]=a,this._updateGraph(a))},checkMaxRange:function(a){a>this.maxY&&(this.maxY=1.4*a,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.renderBackground(),this.renderGraph(!0))},_updateGraph:function(a){this.linesSinceLastPeak++,this.linesSinceLastPeak>1.5*this.width&&(this.linesSinceLastPeak++,this.maxY=1.4*a,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.lastPeak=1.4*a,this.renderBackground(),this.linesSinceLastPeak=0),a>this.lastPeak&&(this.lastPeak=1.4*a),this.cursor++,this.cursor>this.data.length-1&&(this.cursor=0)},margin:20,linePixelSize:0,yline:0,unit:0,gridY:0,i:0,n:0,graphLeftMargin:30,graphRightMargin:15,graphHeight:0,graphWidth:0,graphX:0,graphY:0,gridLineInc:15,renderBackground:function(){var a=this.bgCanvas.getContext("2d");a.fillStyle="#000",a.fillRect(0,0,this.width,this.height),a.fillStyle="#aaa",a.font="11px sans-serif",a.fillText(this.graphName,this.graphX,this.graphY-6),a.strokeStyle="#111",a.strokeRect(this.graphX+.5,this.graphY+.5,this.graphWidth,this.graphHeight),this.unit=this.graphHeight/this.maxY;var b=(this.graphHeight+this.gridLineInc)/this.gridLineInc,c=this.maxY/b,d=0,e=0;for(this.gridY=this.graphHeight+this.graphY;this.gridY>this.graphY+1;this.gridY-=this.gridLineInc){e++,a.textAlign="right",a.fillStyle=0==e%2?"#111":"#000";var f=this.gridLineInc;this.gridY-f<this.graphY?(f=this.gridY-this.graphY,a.fillRect(this.graphX+1,this.graphY+1,this.graphWidth-2,f-1)):a.fillRect(this.graphX+1,this.gridY-f-1,this.graphWidth-2,f),d=Math.round(c*e),a.fillStyle="#777",a.fillText(""+d,this.graphX-5,this.gridY)}a.globalAlpha=1,a.textAlign="left";var g=this.height-13,h=this.graphLeftMargin+3;for(this.n=0;this.n<this.labels.length;this.n++)a.fillStyle=this.labels[this.n].color,a.fillRect(h,g,5,5),a.fillStyle="#888",a.fillText(this.labels[this.n].name,h+8,g+6),h+=a.measureText(this.labels[this.n].name).width+18;this.renderGraph(!0)},renderGraph:function(a){if(this.data){var b=this.graphCanvas.getContext("2d");a?(b.fillStyle="#000",b.fillRect(0,0,this.graphWidth,this.graphHeight)):this._totalAdded>this.graphWidth&&b.drawImage(this.graphCanvas,-1,0);var c=0;if(a?(c=this.data.length-1,this.dx=1):(this.dx=this._totalAdded<this.graphWidth?this.cursor:this.graphWidth-1,c=this.dx+1),0!=c){var d=this.cursor-1;for(0>d&&(d=this.data.length-1);this.dx<c;this.dx++){for(d>this.data.length-1&&(d=0),b.fillStyle="#000",b.fillRect(this.dx,0,1,this.graphHeight),this.yline=this.graphHeight,this.i=0;this.i<this.data[d].length;this.i++){this.linePixelSize=this.data[d][this.i]*this.unit,b.strokeStyle=this.labels[this.i].color,b.beginPath(),b.moveTo(this.dx,this.yline);var e=this.yline-this.linePixelSize;0>e&&(e=0),b.lineTo(this.dx,e),b.closePath(),b.stroke(),this.yline-=this.linePixelSize}d++}}}},draw:function(){this.ctx.save(),this.ctx.drawImage(this.bgCanvas,this.x,this.y),this.renderGraph(!1),this.ctx.globalAlpha=.4,this.ctx.drawImage(this.graphCanvas,this.x+this.graphX,this.y+this.graphY),this.message&&(this.ctx.font="13px sans-serif",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2-9)),this.ctx.restore()}}),define("playcraft/debug",function(){}),pc.Device=pc.Base.extend("pc.Device",{},{canvasId:null,canvas:null,canvasWidth:0,canvasHeight:0,loader:null,timer:null,ctx:null,started:!1,fps:0,currentFPS:0,tick:0,running:!0,scale:1,xmlParser:null,debugPanel:null,showDebug:!0,devMode:!0,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,screen:null,pixelRatio:1,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isTouch:!1,isiOS:!1,isiPod:!1,requestAnimFrame:null,input:null,gameClass:null,game:null,elapsed:0,lastFrame:0,now:Date.now(),boot:function(a,b){this.devMode&&this.info("Playcraft Engine v"+pc.VERSION+" starting"),this.canvasId=a,this.gameClass=b,this.fps=60,this.tick=1e3/this.fps,this.debugPanel=new pc.DebugPanel,this.input=new pc.Input,this.loader=new pc.Loader,this.isAppMobi="undefined"!=typeof AppMobi,this.pixelRatio=gamecore.Device.pixelRatio,this.isiPhone=gamecore.Device.isiPhone,this.isiPhone4=gamecore.Device.isiPhone4,this.isiPad=gamecore.Device.isiPad,this.isAndroid=gamecore.Device.isAndroid,this.isTouch=gamecore.Device.isTouch,this.isiOS=this.isiPhone||this.isiPad,this.device=gamecore.Device,this.requestAnimFrame=gamecore.Device.requestAnimFrame,this.requestAnimFrame=function(){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60,Date.now())};return function(b,c){a.apply(window,[b,c])}}(),window.onresize=this.onResize.bind(this),this.onReady()},canPlay:function(a){return gamecore.Device.canPlay(a)},_calcScreenSize:function(){this.isAppMobi?(null!=this.screen&&this.screen.release(),this.screen=pc.Dim.create(document.body.offsetWidth,document.body.offsetHeight),this.canvas.width=this.screen.x,this.canvas.height=this.screen.y,this.canvas.innerWidth=this.screen.x,this.canvas.innerHeight=this.screen.y,this.canvasWidth=this.screen.x,this.canvasHeight=this.screen.y):(this.isiPad||this.isiPhone?(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight):this.panelElement&&(this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.screen=pc.Dim.create(this.canvasWidth,this.canvasHeight))},onReady:function(){if(this.isiOS&&(this.showDebug=!1,this.soundEnabled=!1),!this.started){if(this.game=eval("new "+this.gameClass+"()"),!this.game)throw"Invalid game class";if(this.canvas=document.getElementById(this.canvasId),!this.canvas)throw"Abort! Could not attach to a canvas element using the id ["+this.canvasId+"]. "+'Add a canvas element to your HTML, such as <canvas id="pcGameCanvas"></canvas>';this.input._onReady(),this.ctx=this.canvas.getContext("2d"),this.panelElement=this.canvas.parentNode,this.onResize(),this.showDebug&&this.debugPanel.onReady(),this.lastFrame=Date.now(),this.game.onReady(),this.requestAnimFrame(this.cycle.bind(this)),this.started=!0}},startTime:0,cycle:function(){this.running!==!1&&(this.now=Date.now(),this.elapsed=this.now-this.lastFrame,this.lastDrawMS=0,this.currentFPS=Math.round(1e3/this.elapsed),this.elementsDrawn=0,this.startTime=Date.now(),this.elapsed<200&&(this.running=this.game.process()),this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,pc.device.input.process(),this.showDebug&&(this.debugPanel.update(this.elapsed),this.debugPanel.draw(this.ctx)),this.lastFrame=this.now,this.requestAnimFrame(this.cycle.bind(this)))},resize:function(a,b){this.canvas.width=a,this.canvas.height=b,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize(this.canvasWidth,this.canvasHeight)},onResize:function(){if(null!=this.canvas){this._calcScreenSize();var a=!1;"undefined"!=typeof window.orientation&&0!=window.orientation&&(a=!0),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize()}},isOnScreen:function(a,b,c,d){return pc.Math.isRectColliding(a,b,c,d,0,0,this.canvasWidth,this.canvasHeight)},parseXML:function(a){if(window.DOMParser)return this.xmlParser||(this.xmlParser=new DOMParser),this.xmlParser.parseFromString(a,"text/xml");var b=new ActiveXObject("Microsoft.XMLDOM");return b.loadXML(a),b}}),pc.device=new pc.Device,define("playcraft/device",function(){}),pc.Sound=pc.Base.extend("pc.Sound",{},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(a,b,c,d,e,f){this._super(),this.name=a,this.channels=d;for(var g=!1,h=0;h<c.length;h++)if(pc.device.canPlay(c[h])){this.src=pc.device.loader.makeUrl(b+"."+c[h]),g=!0;break}g?pc.device.loader.started&&this.load(e,f):this.errored=!0},pause:function(){if(this.canPlay())for(var a=0,b=this.sounds.length;b>a;a++)this.sounds[a].pause()},stop:function(){this.canPlay()&&this.pause()},setVolume:function(a){if(this.canPlay())for(var b=0,c=this.sounds.length;c>b;b++)this.sounds[b].volume=a},getDuration:function(){return this.canPlay()?this.sounds[0].duration:-1},setPlaybackRate:function(a){if(this.canPlay())for(var b=0,c=this.sounds.length;c>b;b++)this.sounds[b].playbackRate=a},setPlayPosition:function(a){if(this.canPlay())for(var b=0,c=this.sounds.length;c>b;b++)this.sounds[b].currentTime=a},load:function(a,b){if(this.onLoadCallback=a,this.onErrorCallback=b,this.loaded&&a)return this.onLoadCallback(this),void 0;for(var c=0;c<this.channels;c++){var d=new Audio;d.preload="auto",d.addEventListener("canplaythrough",this.onLoad.bind(this),!1),d.addEventListener("error",this.onError.bind(this),!1),d.onerror=this.onError.bind(this),d.onload=this.onLoad.bind(this),d.src=this.src,d.load(),this.sounds.push(d),pc.device.isAppMobi&&this.onLoad(null)}},reload:function(){this.loaded=!1,this.errored=!1,this.load()},onLoad:function(a){this.numLoaded++,pc.device.isAppMobi||a.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1),this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback&&this.onLoadCallback(this))},onError:function(){this.errored=!0,this.loaded=!1,this.onErrorCallback&&this.onErrorCallback(this)},play:function(a){if(!this.canPlay())return null;for(var b=0,c=this.sounds.length;c>b;b++)if(this.sounds[b].paused||this.sounds[b].ended)return a&&(this.sounds[b].loop=!0),this.sounds[b].play(),this.sounds[b];return this.warn(this.name+" - all channels are in use"),null},canPlay:function(){return this.loaded&&pc.device.soundEnabled&&!this.errored}}),define("playcraft/sound",function(){}),pc.Layer=pc.Base.extend("pc.Layer",{},{name:null,paused:!1,active:!1,scene:null,zIndex:0,originTrack:null,originTrackXRatio:1,originTrackYRatio:1,origin:null,init:function(a,b){this._super(),this.name=a,this.origin=pc.Point.create(0,0),this._worldPos=pc.Point.create(0,0),this._screenPos=pc.Point.create(0,0),this.zIndex=pc.checked(b,0),this.originTrack=null,this.originTrackXRatio=0,this.originTrackYRatio=0},toString:function(){return""+this.name+" (origin: "+this.origin+", zIndex: "+this.zIndex+")"},release:function(){this.origin.release()},isActive:function(){return null==this.scene||this.scene.active?this.active:!1},setActive:function(){this.scene.setLayerActive(this)},setInactive:function(){this.scene.setLayerInactive(this)},setZIndex:function(a){this.zIndex=a,this.scene&&this.scene.sortLayers()},_worldPos:null,worldPos:function(a){return this._worldPos.x=a.x+this.origin.x,this._worldPos.y=a.y+this.origin.y,this._worldPos},screenX:function(a){return a+this.scene.viewPort.x-this.origin.x},screenY:function(a){return a+this.scene.viewPort.y-this.origin.y},getScreenRect:function(){return this.scene.getScreenRect()},draw:function(){},setOriginTrack:function(a,b,c){this.originTrack=a,this.originTrackXRatio=pc.checked(b,1),this.originTrackYRatio=pc.checked(c,1)},setOrigin:function(a,b){return this.origin.x==Math.round(a)&&this.origin.y==Math.round(b)?!1:(this.origin.x=Math.round(a),this.origin.y=Math.round(b),!0)},process:function(){this.originTrack&&this.setOrigin(this.originTrack.origin.x*this.originTrackXRatio,this.originTrack.origin.y*this.originTrackYRatio)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onResize:function(){},onAddedToScene:function(){},onRemovedFromScene:function(){},onAction:function(){}}),define("playcraft/layer",function(){}),pc.EntityLayer=pc.Layer.extend("pc.EntityLayer",{loadFromTMX:function(a,b,c){var d=b.getAttribute("name"),e=new pc.EntityLayer(d);a.addLayer(e);for(var f=b.getElementsByTagName("object"),g=0;g<f.length;g++){var h=f[g],i=null,j=parseInt(h.getAttribute("x")),k=parseInt(h.getAttribute("y")),l=parseInt(h.getAttribute("width")),m=parseInt(h.getAttribute("height")),n=null,o=h.getElementsByTagName("polygon");if(o.length>0){for(var p=o[0].getAttribute("points"),q=[],r=p.split(" "),s=0;s<r.length;s++){var t=r[s].split(",");q.push([parseInt(t[0]),parseInt(t[1])])}n=pc.Poly.create(j,k,q)}else n=pc.Dim.create(l,m);var u={},v=h.getElementsByTagName("properties");if(v.length)for(var w=v[0].getElementsByTagName("property"),x=0;x<w.length;x++){var y=w[x].getAttribute("name"),z=w[x].getAttribute("value");u[y]=z,"entity"===y&&(i=z)}i?c.createEntity(e,i,j,k,0,n,u):this.warn('Entity loaded from map with no "entity" type property set. x='+j+" y="+k)}}},{worldSize:null,entityManager:null,systemManager:null,init:function(a,b,c,d){this._super(a),this.entityFactory=d,this.systemManager=new pc.SystemManager(this),this.entityManager=new pc.EntityManager(this),this.worldSize=pc.Dim.create(pc.checked(b,1e4),pc.checked(c,1e4))},setOrigin:function(a,b){var c=this._super(a,b);return c&&this.systemManager.onOriginChange(a,b),c},getEntityManager:function(){return this.entityManager},getSystemManager:function(){return this.systemManager},addSystem:function(a){this.systemManager.add(a,this.entityManager)},getSystemsByComponentType:function(a){return this.systemManager.getByComponentType(a)},removeSystem:function(a){this.systemManager.remove(a)},process:function(){this._super(),this.systemManager.processAll(),this.entityManager.cleanup()},onResize:function(a,b){this.systemManager.onResize(a,b)}}),define("playcraft/entitylayer",function(){}),pc.TileSet=pc.Base.extend("pc.TileSet",{},{tileSpriteSheet:null,props:null,init:function(a){this.tileSpriteSheet=a,this.props=new Array(a.totalFrames);for(var b=0;b<this.props.length;b++)this.props[b]=new pc.Hashmap},drawTile:function(a,b,c,d){this.tileSpriteSheet.drawFrame(a,b%this.tileSpriteSheet.framesWide,pc.Math.floor(b/this.tileSpriteSheet.framesWide),c,d)},addProperty:function(a,b,c){this.props[a].put(b,c)},hasProperty:function(a,b){return this.props[a].hasKey(b)},getProperties:function(a){return this.props[a]}}),define("playcraft/tileset",function(){}),pc.TileMap=pc.Base.extend("pc.TileMap",{EMPTY_TILE:-1},{tiles:null,tilesWide:0,tilesHigh:0,tileWidth:0,tileHeight:0,tileSet:null,init:function(a,b,c,d,e,f){this.tiles=f,this.tileWidth=pc.Math.round(d),this.tileHeight=pc.Math.round(e),this.tilesWide=pc.Math.round(b),this.tilesHigh=pc.Math.round(c),this.tileSet=a},tileHasProperty:function(a,b,c){var d=this.getTile(a,b);return d>=0?this.tileSet.hasProperty(d,c):!1},generate:function(a){this.tiles=new Array(this.tilesHigh);for(var b=pc.checked(a,this.Class.EMPTY_TILE),c=0;c<this.tilesHigh;c++){this.tiles[c]=new Array(this.tilesWide);for(var d=0;d<this.tilesWide;d++)this.tiles[c][d]=b}},paint:function(a,b,c,d,e){for(var f=b;b+d>f;f++)for(var g=a;a+c>g;g++)this.tiles[f][g]=e},isOnMap:function(a,b){return a>=0&&a<this.tilesWide&&b>=0&&b<this.tilesHigh},clear:function(a,b,c,d){this.paint(a,b,c,d,this.Class.EMPTY_TILE)},setTile:function(a,b,c){this.tiles[b][a]=c},getTile:function(a,b){return this.isOnMap(a,b)?this.tiles[b][a]:-1},loadFromTMX:function(a,b,c){this.tileWidth=b,this.tileHeight=c,this.tilesWide=parseInt(a.getAttribute("width")),this.tilesHigh=parseInt(a.getAttribute("height"));var d=a.getElementsByTagName("data")[0];if(d.getAttribute("compression"))return this.error("map: "+name+": TMX map compression not supported, use base64 encoding"),void 0;if("base64"==d.getAttribute("encoding")){for(var e="",f=0;f<d.childNodes.length;f++)e+=d.childNodes[f].nodeValue;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var g=pc.Base64.decode(e),h=[],i=0;i<g.length/4;i++){h[i]=0;for(var j=3;j>=0;--j)h[i]+=g.charCodeAt(4*i+j)<<(j<<3)}}this.tiles=new Array(this.tilesHigh);for(var k=0;k<this.tilesHigh;k++){this.tiles[k]=new Array(this.tilesWide);for(var l=0;l<this.tilesWide;l++)this.tiles[k][l]=h[k*this.tilesWide+l]-1}}}),define("playcraft/tilemap",function(){}),pc.TileLayer=pc.Layer.extend("pc.TileLayer",{loadFromTMX:function(a,b,c,d,e){var f=b.getAttribute("name"),g=new pc.TileLayer(f,!0,null,e);g.tileMap.loadFromTMX(b,c,d),a.addLayer(g)}},{tileMap:null,debugShowGrid:!1,prerenders:null,usePrerendering:!0,prerenderSize:512,init:function(a,b,c,d){this._super(a),this.tileMap=pc.checked(c,new pc.TileMap(d)),this.usePrerendering=pc.checked(b,!0),this.tileMap&&this.tileMap.tileWidth>256&&(this.usePrerendering=!1)},setTileMap:function(a){this.tileMap=a,this.usePrerendering&&this.prerender()},prerender:function(){var a=this.tileMap.tilesWide*this.tileMap.tileWidth,b=this.tileMap.tilesHigh*this.tileMap.tileHeight,c=Math.ceil(a/this.prerenderSize),d=Math.ceil(b/this.prerenderSize);this.prerenders=[];for(var e=0;d>e;e++){this.prerenders[e]=[];for(var f=0;c>f;f++){var g=q==c-1?a-q*this.prerenderSize:this.prerenderSize,h=r==d-1?b-r*this.prerenderSize:this.prerenderSize,i=g/this.tileMap.tileWidth+1,j=h/this.tileMap.tileHeight+1,k=f*this.prerenderSize%this.tileMap.tileWidth,l=e*this.prerenderSize%this.tileMap.tileHeight,m=Math.floor(f*this.prerenderSize/this.tileMap.tileWidth),n=Math.floor(e*this.prerenderSize/this.tileMap.tileHeight),o=document.createElement("canvas");o.width=g,o.height=h;for(var p=o.getContext("2d"),q=0;i>q;q++)for(var r=0;j>r;r++)if(q+m<this.tileMap.tilesWide&&r+n<this.tileMap.tilesHigh){var s=this.tileMap.getTile(q+m,r+n);s>=0&&this.tileMap.tileSet.drawTile(p,s,q*this.tileMap.tileWidth-k,r*this.tileMap.tileHeight-l)}this.prerenders[e][f]=o}}},draw:function(){this._super(),this.tileMap&&this.tileMap.tilesWide&&(this.usePrerendering?this.drawPrerendered():this.drawTiled())},drawTiled:function(){var a=Math.floor(this.origin.x/this.tileMap.tileWidth);0>a&&(a=0);var b=Math.floor(this.origin.y/this.tileMap.tileHeight);0>b&&(b=0);var c=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-a+2;a+c>=this.tileMap.tilesWide-1&&(c=this.tileMap.tilesWide-1-a);var d=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-b+2;b+d>=this.tileMap.tilesHigh-1&&(d=this.tileMap.tilesHigh-1-b);for(var e=b,f=b+d;f+1>e;e++)for(var g=this.screenY(e*this.tileMap.tileHeight),h=a,i=a+c;i>h;h++){var j=this.tileMap.tiles[e][h];j>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,j,this.screenX(h*this.tileMap.tileWidth),g),this.debugShowGrid&&(pc.device.ctx.save(),pc.device.ctx.strokeStyle="#222222",pc.device.ctx.strokeRect(this.screenX(h*this.tileMap.tileWidth),this.screenY(e*this.tileMap.tileHeight),this.tileMap.tileWidth,this.tileMap.tileHeight),pc.device.ctx.restore())}},drawPrerendered:function(){this.prerenders||this.prerender();var a=-this.origin.x+this.scene.viewPort.x,b=-this.origin.y+this.scene.viewPort.y,c=Math.max(Math.floor(this.origin.x/this.prerenderSize),0),d=Math.max(Math.floor(this.origin.y/this.prerenderSize),0),e=c+Math.ceil((this.origin.x+this.scene.viewPort.w)/this.prerenderSize),f=d+Math.ceil((this.origin.y+this.scene.viewPort.h)/this.prerenderSize);e=Math.min(e,this.prerenders[0].length),f=Math.min(f,this.prerenders.length);for(var g=d;f>g;g++)for(var h=c;e>h;h++)pc.device.ctx.drawImage(this.prerenders[g%this.prerenders.length][h%this.prerenders[0].length],a+h*this.prerenderSize,b+g*this.prerenderSize)}}),define("playcraft/tilelayer",function(){}),pc.HexTileLayer=pc.TileLayer.extend("pc.HexTileLayer",{},{init:function(a,b,c){this._super(a),this.tileMap=pc.checked(b,new pc.TileMap(c)),this.usePrerendering=!1},drawTiled:function(){var a=Math.floor(this.origin.x/this.tileMap.tileWidth);0>a&&(a=0);var b=Math.floor(this.origin.y/this.tileMap.tileHeight);0>b&&(b=0);var c=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-a;a+c>=this.tileMap.tilesWide-1&&(c=this.tileMap.tilesWide-1-a);var d=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-b;b+d>=this.tileMap.tilesHigh-1&&(d=this.tileMap.tilesHigh-1-b);for(var e=b,f=d+b;f+1>e;e++)for(var g=e*this.tileMap.tileHeight,h=a,i=c+a;i>h;h++){var j=h*this.tileMap.tileWidth;e%2&&(j+=this.tileMap.tileWidth/2);var k=this.tileMap.tiles[e][h];k>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,k,this.screenX(j),this.screenY(g))}}}),define("playcraft/hextilelayer",function(){}),pc.Entity=pc.Pooled.extend("pc.Entity",{create:function(a){var b=this._super();if(!a)throw"Entity requires a valid layer to be placed on";if(!a.Class.isA)throw"Entity requires a valid layer to be placed on";if(!a.Class.isA("pc.EntityLayer"))throw"Entities can only be placed on pc.EntityLayer objects";return b.config(a),b}},{layer:null,tags:[],active:!0,_componentCache:null,init:function(a){this._super(),this.tags=[],this.layer=null,this.active=!0,this._componentCache=new pc.Hashmap,pc.valid(a)&&this.config(a)},config:function(a){this.layer=a,this.active=!0,a.entityManager.add(this)},release:function(){this.tags.length=0,this.active=!1,this._componentCache.clear(),this._super()},addTag:function(a){this.layer.entityManager.addTag(this,a)},hasTag:function(a){for(var b=0;b<this.tags.length;b++)if(this.tags[b].toLowerCase()===a.toLowerCase())return!0;return!1},removeTag:function(a){this.layer.entityManager.removeTag(this,a)},addComponent:function(a){return this.layer.entityManager.addComponent(this,a)},removeComponent:function(a){this.layer.entityManager.removeComponent(this,a)},removeComponentByType:function(a){this.removeComponent(this._componentCache.get(a))},getComponent:function(a){return this._componentCache.get(a)},getAllComponents:function(){return this._componentCache},getComponentTypes:function(){return this._componentCache.keys()},hasComponentOfType:function(a){return this._componentCache.hasKey(a)},remove:function(){this.layer.entityManager.remove(this)},_handleComponentRemoved:function(a){this._componentCache.remove(a.getType())},_handleComponentAdded:function(a){this._componentCache.put(a.getType(),a)}}),pc.EntityFactory=pc.Base.extend("pc.EntityFactory",{},{createEntity:function(){}}),define("playcraft/entity",function(){}),pc.Sprite=pc.Pooled.extend("pc.Sprite",{create:function(a){var b=this._super();return b.config(a),b}},{currentFrame:0,currentAnim:null,spriteSheet:null,animSpeedOffset:0,currentAnimName:null,alpha:1,scaleX:1,scaleY:1,active:!0,hold:!1,loopCount:0,compositeOperation:null,_acDelta:0,init:function(a){this._super(),this.config(a)},config:function(a){this.spriteSheet=pc.checked(a,null),this.spriteSheet&&this.reset()},reset:function(){this.currentFrame=0,this.alpha=1,this.loopCount=0,this.scaleX=1,this.scaleY=1,this.active=!0,this.hold=!1,this.spriteSheet.animations.size()>0?(this.currentAnim=this.spriteSheet.animations.get(this.spriteSheet.animations.keys()[0]),this.currentFrame=0):this.currentAnim=null},setSpriteSheet:function(a){this.spriteSheet=a,this.reset()},setScale:function(a,b){this.scaleX=a,this.scaleY=b},setCompositeOperation:function(a){this.compositeOperation=a},draw:function(a,b,c,d){1!=this.alpha&&(this.spriteSheet.alpha=this.alpha),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation(this.compositeOperation),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.spriteSheet.draw(a,this,b,c,d),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(1,1),1!=this.alpha&&(this.spriteSheet.alpha=1),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation("source-over")},drawFrame:function(a,b,c,d,e,f){1!=this.alpha&&(this.spriteSheet.alpha=this.alpha),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation(this.compositeOperation),this.spriteSheet.drawFrame(a,b,c,d,e,f),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(1,1),1!=this.alpha&&(this.spriteSheet.alpha=1),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation("source-over")},update:function(a){null!=this.currentAnim&&this.active&&!this.hold&&this.spriteSheet.update(this,a)},setAnimation:function(a,b,c){var d=pc.checked(c,!0);(d||this.currentAnim.name!==a)&&(this.currentAnim=this.spriteSheet.animations.get(a),this.currentFrame=0,this.loopCount=0,this.active=!0,this.held=!1,this.animSpeedOffset=pc.checked(b,0),this.currentAnimName=a)},setAnimationSpeedOffset:function(a){this.animSpeedOffset=a},setCurrentFrame:function(a){this.currentFrame=a},getAnimation:function(){return this.currentAnimName},setAlpha:function(a){this.alpha=a},addAlpha:function(a){this.alpha+=a,this.alpha>1&&(this.alpha=1)},subAlpha:function(a){this.alpha-=a,this.alpha<0&&(this.alpha=0)}}),define("playcraft/sprite",function(){}),pc.SpriteSheet=pc.Base.extend("pc.SpriteSheet",{},{image:null,frameWidth:0,frameHeight:0,framesWide:1,framesHigh:1,scaleX:1,scaleY:1,sourceX:0,sourceY:0,alpha:1,useRotation:!1,compositeOperation:null,totalFrames:0,animations:null,frameOffsetX:0,frameOffsetY:0,_frameXPos:null,_frameYPos:null,init:function(a){if(this._super(),!pc.checked(a.image))throw"No image supplied";if(this.image=a.image,!this.image.width||!this.image.height)throw"Invalid image (zero width or height)";this.frameWidth=pc.valid(a.frameWidth)?a.frameWidth:pc.valid(a.framesWide)&&a.framesWide>0?Math.floor(this.image.width/a.framesWide):this.image.width,this.frameHeight=pc.valid(a.frameHeight)?a.frameHeight:pc.valid(a.framesHigh)&&a.framesHigh>0?Math.floor(this.image.height/a.framesHigh):this.image.height,this.framesWide=Math.floor(pc.checked(a.framesWide,this.image.width/this.frameWidth)),this.framesHigh=Math.floor(pc.checked(a.framesHigh,this.image.height/this.frameHeight)),this.scaleX=pc.checked(a.scaleX,1),this.scaleY=pc.checked(a.scaleY,1),this.sourceX=pc.checked(a.sourceX,0),this.sourceY=pc.checked(a.sourceY,0),this.frameOffsetX=pc.checked(a.frameOffsetX,0),this.frameOffsetY=pc.checked(a.frameOffsetY,0),this.alpha=pc.checked(a.alpha,1),this.useRotation=pc.checked(a.useRotation,!0),this.totalFrames=this.framesWide*this.framesHigh,this.animations=new pc.Hashtable,this._frameXPos=[];
for(var b=0;b<this.framesWide;b++)this._frameXPos.push(b*this.frameWidth);this._frameYPos=[];for(var c=0;c<this.framesHigh;c++)this._frameYPos.push(c*this.frameHeight)},addAnimation:function(a){if(!pc.valid(a.name))throw"Animation requires a name for reference";if(a.frameX=pc.checked(a.frameX,0),a.frameY=pc.checked(a.frameY,0),a.directions=pc.checked(a.directions,1),a.time=pc.checked(a.time,1e3),a.loops=pc.checked(a.loops,0),a.holdOnEnd=pc.checked(a.holdOnEnd,!1),a.dirAcross=pc.checked(a.dirAcross,!1),a.scaleX=pc.checked(a.scaleX,1),a.scaleY=pc.checked(a.scaleY,1),a.offsetX=pc.checked(a.offsetX,0),a.offsetY=pc.checked(a.offsetY,0),a.framesWide=pc.checked(a.framesWide,this.framesWide),a.framesHigh=pc.checked(a.framesHigh,this.framesHigh),a.frameCount=pc.checked(a.frameCount,this.framesWide*this.framesHigh),0==a.frameCount&&(a.frameCount=pc.checked(a.frameCount,this.framesWide*this.framesHigh)),!pc.valid(a.frames)){var b=a.frameX+a.frameY*a.framesWide;a.frames=[];for(var c=b;c<b+a.frameCount;c++)a.frames.push([c%a.framesWide,Math.floor(c/a.framesWide)])}a.frameRate=a.time/a.frames.length,a.degreesPerDir=360/a.directions,this.animations.put(a.name,a)},setAnimation:function(a,b,c){a.currentAnim=this.animations.get(b),null==a.currentAnim&&this.warn("attempt to set unknown animation ["+b+"]"),a.currentFrame=0,a.held=!1,a.animSpeedOffset=pc.checked(c,0)},hasAnimation:function(a){return null!=this.animations.get(a)},setScale:function(a,b){this.scaleX=a,this.scaleY=b},setCompositeOperation:function(a){this.compositeOperation=a},dirTmp:0,draw:function(a,b,c,d,e){if(this.image.loaded&&null!=b&&b.active){if((1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),1!=b.alpha&&(this.image.alpha=b.alpha),null!=this.compositeOperation&&this.image.setCompositeOperation(this.compositeOperation),null==b.currentAnim)(1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),this.image.draw(a,this.sourceX,this.sourceY,Math.round(c+this.frameOffsetX),Math.round(d+this.frameOffsetY),this.frameWidth+this.frameOffsetX,this.frameHeight+this.frameOffsetY,this.useRotation?e:0);else{var f=0,g=0;(1!=b.currentAnim.scaleX||1!=b.currentAnim.scaleY||1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(b.currentAnim.scaleX*this.scaleX,b.currentAnim.scaleY*this.scaleY),this.useRotation?(f=b.currentAnim.frames[b.currentFrame][0],g=b.currentAnim.frames[b.currentFrame][1],this.image.draw(a,this.sourceX+this._frameXPos[f],this.sourceY+this._frameYPos[g],b.currentAnim.offsetX+pc.Math.round(c)+this.frameOffsetX,b.currentAnim.offsetY+pc.Math.round(d)+this.frameOffsetY,this.frameWidth,this.frameHeight,e)):(this.dirTmp=Math.round(e/b.currentAnim.degreesPerDir),this.dirTmp>b.currentAnim.directions-1&&(this.dirTmp=0),f=b.currentAnim.frames[b.currentFrame][1]+this.dirTmp,g=b.currentAnim.frames[b.currentFrame][0],1==b.currentAnim.directions&&(g=b.currentAnim.frames[b.currentFrame][1],f=b.currentAnim.frames[b.currentFrame][0]),this.image.draw(a,this.sourceX+this._frameXPos[f],this.sourceY+this._frameYPos[g],b.currentAnim.offsetX+pc.Math.round(c)+this.frameOffsetX,b.currentAnim.offsetY+pc.Math.round(d)+this.frameOffsetY,this.frameWidth,this.frameHeight),(1!=b.currentAnim.scaleX||1!=b.currentAnim.scaleY||1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(b.currentAnim.scaleX*this.scaleX,b.currentAnim.scaleY*this.scaleY))}(1!=this.image.scaleX||1!=this.image.scaleY)&&this.image.setScale(1,1),1!=b.alpha&&(this.image.alpha=1),null!=this.compositeOperation&&this.image.setCompositeOperation("source-over")}},drawFrame:function(a,b,c,d,e,f){this.image.loaded&&(this.alpha<1&&(a.globalAlpha=this.alpha),(1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),null!=this.compositeOperation&&this.image.setCompositeOperation(this.compositeOperation),this.image.draw(a,this.sourceX+this._frameXPos[b],this.sourceY+this._frameYPos[c],pc.Math.round(d)+this.frameOffsetX,pc.Math.round(e)+this.frameOffsetY,this.frameWidth,this.frameHeight,f),(1!=this.image.scaleX||1!=this.image.scaleY)&&this.image.setScale(1,1),this.alpha<1&&(a.globalAlpha=1),null!=this.compositeOperation&&this.image.setCompositeOperation("source-over"))},drawAllFrames:function(a,b,c){for(var d=0;d<this.framesHigh;d++)for(var e=0;e<this.framesWide;e++)this.drawFrame(a,e,d,b+e*this.frameWidth,c+d*this.frameHeight)},update:function(a,b){null!=a.currentAnim&&a.active&&!a.held&&(a.currentAnim.frames.length<=1||(a._acDelta>a.currentAnim.frameRate+a.animSpeedOffset?(a.currentFrame++,a.currentFrame>=a.currentAnim.frames.length&&(a.loopCount++,a.currentAnim.loops&&a.loopCount>=a.currentAnim.loops&&(a.currentAnim.holdOnEnd?(a.held=!0,a.currentFrame&&a.currentFrame--):a.active=!1),a.held||(a.currentFrame=0)),a._acDelta-=a.currentAnim.frameRate):a._acDelta+=b))},reset:function(){this.image=null,this.animations=null}}),define("playcraft/spritesheet",function(){}),pc.Math=pc.Base("pc.Math",{RADIAN_TO_DEGREE:180/Math.PI,DEGREE_TO_RADIAN:Math.PI/180,PI:Math.PI,round:Math.round,random:Math.random,floor:Math.floor,sqr:function(a){return a*a},rand:function(a,b){return pc.Math.round(pc.Math.random()*(b-a)+a)},randFloat:function(a,b){return pc.Math.random()*(b-a)+a},rotate:function(a,b){for(var c=a+b;c>359;)c-=360;for(;0>c;)c=360+c;return c},angleDiff:function(a,b,c){if(c)return a>b&&(b+=360),b-a;var d=a-b;return 0>d&&(d+=360),d},isClockwise:function(a,b){return a>b?Math.abs(a-b)<b+(360-a):a+(360-b)<Math.abs(b-a)},isFacingRight:function(a){return a>270||90>a?!0:!1},radToDeg:function(a){return a*pc.Math.RADIAN_TO_DEGREE},degToRad:function(a){return a*pc.Math.DEGREE_TO_RADIAN},angleFromVector:function(a,b){var c=pc.Math.radToDeg(Math.atan2(b,a));return 0>c&&(c+=360),c},vectorFromAngle:function(a){var b=Math.cos(pc.Math.degToRad(a)),c=Math.sin(pc.Math.degToRad(a));return pc.Point.create(b,c)},isPointInRect:function(a,b,c,d,e,f){return a>=c&&c+e>=a&&b>=d&&d+f>=b},isRectInRect:function(a,b,c,d,e,f,g,h){return pc.Math.isPointInRect(a,b,e,f,g,h)?pc.Math.isPointInRect(a+c,b,e,f,g,h)?pc.Math.isPointInRect(a,b+d,e,f,g,h)?pc.Math.isPointInRect(a+c,b+d,e,f,g,h):!1:!1:!1},isRectColliding:function(a,b,c,d,e,f,g,h){return!(f>b+d||b>f+h||e>a+c||a>e+g)},limit:function(a,b,c){return b>a?b:a>c?c:a},limitAdd:function(a,b,c,d){return c>a+b?c:a+b>d?d:a+b}},{}),pc.Rect=pc.Pooled("pc.Rect",{create:function(a,b,c,d){var e=this._super();return e.x=a,e.y=b,e.w=c,e.h=d,e}},{x:0,y:0,w:0,h:0,containsRect:function(a,b,c,d,e,f,g,h){return pc.Math.isPointInRect(a,b,e,f,g,h)?pc.Math.isPointInRect(a+c,b,e,f,g,h)?pc.Math.isPointInRect(a,b+d,e,f,g,h)?pc.Math.isPointInRect(a+c,b+d,e,f,g,h):!1:!1:!1},containsPoint:function(a){return a.x>=this.x&&a.x<=this.x+this.w&&a.y>=this.y&&a.y<=this.y+this.h},overlaps:function(a,b,c,d,e){var f=c,g=d;if(pc.valid(e)&&0!=e){var h=Math.sin(pc.Math.degToRad(e)),i=Math.cos(pc.Math.degToRad(e));0>h&&(h=-h),0>i&&(i=-i),f=d*h+c*i,g=d*i+c*h}return!(this.y+this.h<b||this.y>b+g||this.x+this.w<a||this.x>a+f)},toString:function(){return this.x+" x "+this.y+" by "+this.w+" x "+this.h}}),pc.Point=pc.Pooled("pc.Point",{create:function(a,b){var c=this._super();return c.x=a,c.y=b,c}},{x:0,y:0,match:function(a){this.x=a.x,this.y=a.y},set:function(a){this.match(a)},setXY:function(a,b){return this.x=a,this.y=b,this},add:function(a,b){return this.x+=a,this.y+=b,this},subtract:function(a,b){return this.x-=a,this.y-=b,this},dirTo:function(a){return 180*Math.atan2(a.y-this.y,a.x-this.x)/Math.PI},moveInDir:function(a,b){return this.x+=b*Math.cos(pc.Math.degToRad(a)),this.y+=b*Math.sin(pc.Math.degToRad(a)),this},moveTowards:function(a,b){this.moveInDir(this.dirTo(a),b)},distance:function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))},toString:function(){return this.x+"x"+this.y}}),pc.Poly=pc.Pooled("pc.Poly",{create:function(a,b,c){var d=this._super();return d.x=a,d.y=b,d.points=c,d}},{x:0,y:0,points:null,_boundingRect:null,init:function(a,b,c){this.x=a,this.y=b,this.points=c,this._boundingRect=pc.Rect.create(0,0,0,0)},getBoundingRect:function(){}}),pc.Dim=pc.Point,pc.Vector=pc.Point,define("playcraft/math",function(){}),pc.Image=pc.Base.extend("pc.Image",{},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(a,b,c,d){this._super(),this.name=a,this.src=pc.device.loader.makeUrl(b),this.image=new Image,this.onLoadCallback=c,this.onErrorCallback=d,this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.scaleX=1,this.scaleY=1,this.alpha=1,pc.device.loader.started&&this.load()},setAlpha:function(a){this.alpha=a},setScale:function(a,b){this.scaleX=a,this.scaleY=b},setCompositeOperation:function(a){this.compositeOperation=a},load:function(a,b){this.onLoadCallback=a,this.onErrorCallback=b,this.loaded&&a&&this.onLoadCallback(this),this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.image.src=this.src},reload:function(){this.loaded=!1,this.load()},draw:function(a,b,c,d,e,f,g,h){if(null!=this.compositeOperation&&(a.globalCompositeOperation=this.compositeOperation),3==arguments.length)a.save(),1!=this.alpha&&(a.globalAlpha=this.alpha),a.translate(b+this.width/2,c+this.height/2),a.scale(this.scaleX,this.scaleY),a.drawImage(this.image,0,0,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height),a.restore();else if(pc.valid(h)){if(a.save(),1!=this.alpha&&(a.globalAlpha=this.alpha),this.scaleX<0||this.scaleY<0){var i=1==this.scaleY?0:this.scaleY,j=1==this.scaleX?0:this.scaleX;a.translate(d+f/2*j,e+g/2*i)}else a.translate(d+f/2,e+g/2);a.rotate(h*(Math.PI/180)),a.drawImage(this.image,b,c,f,g,-f/2,-g/2,f,g),a.restore()}else{if(a.save(),1!=this.alpha&&(a.globalAlpha=this.alpha),this.scaleX<0||this.scaleY<0){var k=1==this.scaleY?0:this.scaleY,l=1==this.scaleX?0:this.scaleX;a.translate(d+-(f/2)*l,e+-(g/2)*k)}else a.translate(d,e);a.scale(this.scaleX,this.scaleY),a.drawImage(this.image,b,c,f,g,0,0,f,g),a.restore()}null!=this.compositeOperation&&(a.globalCompositeOperation="source-over"),pc.device.elementsDrawn++},_onLoad:function(){this.loaded=!0,this.width=this.image.width,this.height=this.image.height,this.onLoadCallback&&this.onLoadCallback(this)},_onError:function(){this.onErrorCallback&&this.onErrorCallback(this)},expand:function(a,b){this.image.width=this.width+a,this.image.height=this.height+b,this.width=this.image.width,this.height=this.image.height},resize:function(a,b){var c=this.width*a,d=this.height*b,e=document.createElement("canvas");e.width=this.width,e.height=this.height;var f=document.createElement("canvas");f.width=c,f.height=d;var g=f.getContext("2d"),h=g.getImageData(0,0,c,d),i=e.getContext("2d");i.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);for(var j=i.getImageData(0,0,this.width,this.height),k=0;d>k;k++)for(var l=0;c>l;l++)for(var m=4*(Math.floor(k/b)*this.width+Math.floor(l/a)),n=4*(k*c+l),o=0;4>o;o++)h.data[n+o]=j.data[m+o];return g.putImageData(h,0,0),this.image=f,this}}),pc.CanvasImage=pc.Base.extend("pc.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(a){this.canvas=a,this.width=a.width,this.height=a.height},draw:function(a,b,c,d,e,f,g){void 0==f||void 0==g||0==f||0==g?a.drawImage(this.canvas,b,c):a.drawImage(this.canvas,b,c,f,g,d*this.scaleX,e*this.scaleY,f*this.scaleX,g*this.scaleY)},setScale:function(a,b){this.scaleX=a,this.scaleY=b}}),pc.ImageTools=pc.Base.extend("pc.ImageTools",{rotate:function(a,b,c,d){var e=document.createElement("canvas");e.width=b*d,e.height=c;for(var f=e.getContext("2d"),g=0;d>g;g++)f.save(),f.translate(g*b+b/2,c/2),f.rotate(360/d*g*(Math.PI/180)),f.drawImage(a,-(b/2),-(c/2)),f.restore();return new pc.CanvasImage(e)}},{}),define("playcraft/image",function(){}),pc.Scene=pc.Base.extend("pc.Scene",{},{name:null,layersByName:null,layers:null,activeLayers:null,paused:!1,active:!1,viewPort:null,viewPortCenter:null,init:function(a){this._super(),this.active=!1,this.name=a,this.layersByName=new pc.Hashtable,this.layers=new pc.LinkedList,this.activeLayers=new pc.LinkedList,this.viewPort=pc.Rect.create(0,0,0,0),this.viewPortCenter=pc.Point.create(0,0),this.setViewPort(0,0,pc.device.canvasWidth,pc.device.canvasHeight),pc.device.started&&this.onReady()},onReady:function(){for(var a=this.layers.first;a;)a.obj.onReady(),a=a.next()},onActivated:function(){},onDeactivated:function(){},onResize:function(a,b){this.setViewPort(this.viewPort.x,this.viewPort.y,a,b);for(var c=this.layers.first;c;)c.obj.onResize(a,b),c=c.next()},setViewPort:function(a,b,c,d){this.viewPort.x=a,this.viewPort.y=b,this.viewPort.w=c,this.viewPort.h=d,this.viewPortCenter.x=this.viewPort.w/2,this.viewPortCenter.y=this.viewPort.h/2},getScreenRect:function(){return this.viewPort},sortLayers:function(){this.activeLayers.sort(function(a,b){return a.zIndex-b.zIndex})},onAction:function(){},isActive:function(){return this.active},get:function(a){return this.layersByName.get(a)},addLayer:function(a){if(!pc.valid(a))throw"Error: invalid layer";if(!pc.valid(a.name))throw"Error: trying to add a layer that has no name (forget to call this._super in your layer init?)";return this.layersByName.put(a.name,a),this.layers.add(a),this.activeLayers.add(a),a.active=!0,a.scene=this,a.onAddedToScene(),this.sortLayers(),a},removeLayer:function(a){this.layersByName.remove(a.name),this.layers.remove(a),this.activeLayers.remove(a),a.active=!1,a.scene=null,a.onRemovedFromScene()},setLayerActive:function(a){this.activeLayers.add(a),this.sortLayers(),a.active=!0},setLayerInactive:function(a){this.activeLayers.remove(a),a.active=!1},toggleLayerActive:function(a){a.active?this.setLayerInactive(a):this.setLayerActive(a)},getFirstActiveLayer:function(){return this.activeLayers.first},getFirstLayer:function(){return this.layers.first},startTime:0,process:function(){for(var a=this.activeLayers.first;a;)a.obj.paused||(a.obj.process(),this.startTime=Date.now(),a.obj.draw(),pc.device.lastDrawMS+=Date.now()-this.startTime),a=a.next()},pause:function(){this.paused=!0;for(var a=this.activeLayers.first;a;)a.obj.pause(),a=a.next()},resume:function(){this.paused=!1;for(var a=this.activeLayers.first;a;)a.obj.resume(),a=a.next()},reset:function(){for(var a=this.layers.first;a;)a.obj.reset(),a=a.next();this.layers.clear(),this.activeLayers.clear()},entitiesUnderXY:function(a,b){for(var c=[],d=this.layers.first;d;)c.push(d.obj.entitiesUnderXY(a,b)),d=d.next()},loadFromTMX:function(a,b){var c=pc.device.parseXML(a.data),d=c.getElementsByTagName("map")[0],e=parseInt(d.getAttribute("tilewidth")),f=parseInt(d.getAttribute("tileheight")),g=c.getElementsByTagName("tileset")[0],h=g.getAttribute("name");g.getAttribute("width"),g.getAttribute("height");var i=pc.device.loader.get(h);pc.assert(i,"Unable to locate tile image resource: "+h+". It must match the tileset name in tiled.");for(var j=pc.device.loader.get(h).resource,k=new pc.SpriteSheet({image:j,frameWidth:e,frameHeight:f}),l=new pc.TileSet(k),m=c.getElementsByTagName("tile"),n=0;n<m.length;n++){var o=m[n],p=parseInt(o.getAttribute("id")),q=o.getElementsByTagName("properties");if(q.length){q=q[0];for(var r=q.getElementsByTagName("property"),s=0;s<r.length;s++){var t=r[s],u=t.getAttribute("name"),v=t.getAttribute("value");l.addProperty(p,u,v)}}}for(var w=c.getElementsByTagName("layer"),x=0;x<w.length;x++)switch(d.getAttribute("orientation")){case"isometric":pc.IsoTileLayer.loadFromTMX(this,w[x],e,f,l);break;default:pc.TileLayer.loadFromTMX(this,w[x],e,f,l)}for(var y=c.getElementsByTagName("objectgroup"),z=0;z<y.length;z++)pc.EntityLayer.loadFromTMX(this,y[z],b)}}),define("playcraft/scene",function(){}),pc.Game=pc.Base.extend("pc.Game",{},{scenes:null,activeScenes:null,paused:!1,init:function(){this._super(),this.scenes=new pc.LinkedList,this.activeScenes=new pc.LinkedList,pc.device.devMode&&(pc.device.input.bindAction(this,"physics debug","F9"),pc.device.input.bindAction(this,"pool dump","F10"),pc.device.input.bindAction(this,"toggle sound","F11"))},process:function(){if(this.paused)return!0;for(var a=this.getFirstActiveScene();a;)a.object().process(),a=a.next();return!0},stopAllSounds:function(){for(var a=pc.device.loader.getAllSounds(),b=0;b<a.length;b++)pc.device.soundEnabled&&a[b].stop()},onAction:function(a){if("toggle sound"===a&&(this.stopAllSounds(),pc.device.soundEnabled=!pc.device.soundEnabled),"physics debug"===a)for(var b=this.getFirstScene();b;){for(var c=b.object().getFirstActiveLayer();c;){var d=c.object();if(d.Class.isA("pc.EntityLayer"))for(var e=d.systemManager.systems.first;e;){var f=e.object();f.Class.isA("pc.systems.Physics")&&f.setDebug(!f.debug),e=e.next()}c=c.next()}b=b.next()}},addScene:function(a,b){this.scenes.add(a),this.onSceneAdded(a),pc.checked(b,!0)&&this.activateScene(a)},onSceneAdded:function(){},removeScene:function(a){this.scenes.remove(a),this.activeScenes.remove(a),this.onSceneRemoved(a)},onSceneRemoved:function(){},activateScene:function(a){a.active||(this.activeScenes.add(a),a.active=!0,this.onSceneActivated(a),a.onActivated())},onSceneActivated:function(){},deactivateScene:function(a){a.active&&(this.activeScenes.remove(a),a.active=!1,this.onSceneDeactivated(a),a.onDeactivated())},onSceneDeactivated:function(){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){this.paused=!0;for(var a=this.getFirstScene();a;)a.object().pause(),a=a.next()},isActive:function(){return!this.paused},resume:function(){this.paused=!1;for(var a=this.getFirstScene();a;)a.object().resume(),a=a.next()},togglePauseResume:function(){pc.device.game.paused?pc.device.game.resume():pc.device.game.pause()},reset:function(){for(var a=this.getFirstScene();a;)a.obj.reset(),a=a.next();this.scenes.clear(),this.activeScenes.clear(),this.onReady()},onReady:function(){},onResize:function(a,b){for(var c=this.getFirstActiveScene();c;)c.obj.onResize(a,b),c=c.next()},getScreenRect:function(){return pc.Rect.create(0,0,pc.device.canvasWidth,pc.device.canvasHeight)}}),define("playcraft/game",function(){}),pc.Loader=pc.Base.extend("pc.Loader",{},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},resources:new pc.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",started:!1,finished:!1,_noCacheString:"",init:function(){this._super()},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(a){this.baseUrl=a},setListener:function(a,b){this.loadingListener=a,this.loadedListener=b},add:function(a){a.name=a.name.toLowerCase(),this.resources.put(a.name.toLowerCase(),{resource:a,state:this.State.QUEUED}),this.info("Adding resource "+a.src+" to the queue.")},get:function(a){var b=this.resources.get(a.toLowerCase());if(!b)throw"Attempting to get a resource that hasn't been added: "+a;if(b.state<this.State.READY)throw"Attempting to get a resource that hasn't been loaded yet (calling before onLoaded?)";return b},getAllSounds:function(){for(var a=[],b=this.resources.keys(),c=0;c<b.length;c++){var d=this.resources.get(b[c]).resource;d.Class.isA("pc.Sound")&&a.push(d)}return a},getAllImages:function(){for(var a=[],b=this.resources.keys(),c=0;c<b.length;c++){var d=this.resources.get(b[c]);d.isA("pc.Image")&&a.push(d)}return a},start:function(a,b){this.setListener(a,b),this.progress=0,this.errored=0;for(var c=this.resources.keys(),d=0;d<c.length;d++){var e=this.resources.get(c[d]);e.state==this.State.QUEUED&&(e.resource.load(this._onLoad.bind(this),this._onError.bind(this)),e.state=this.State.LOADING,this.totalBeingLoaded++)}this.info("Started loading "+this.totalBeingLoaded+" resource(s)."),this._checkAllDone()},makeUrl:function(a){return this.baseUrl+a+this._noCacheString},_onLoad:function(a){var b=this.resources.get(a.name);null==b?this.error("Unable to get resource ["+a.name+"] - Please make sure you are using all lowercase."):(b.state=this.State.READY,this.progress++,null!=this.loadingListener&&this.loadingListener(Math.round(100*(this.progress/this.totalBeingLoaded))),this.info(a.name+" loaded ("+Math.round(100*(this.progress/this.totalBeingLoaded))+"% done)")),this._checkAllDone()},_onError:function(a){var b=this.resources.get(a.name);b.state=this.State.FAILED,this.progress++,this.errored++,null!=this.loadingListener&&this.loadingListener(this.progress/this.totalBeingLoaded),this.warn(a.name+" ("+a.src+") failed."),this._checkAllDone()},_checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.finished=!0,this.loadedListener(this.progress,this.errored),this.progress=0,this.errored=0,this.totalBeingLoaded=0)}}),define("playcraft/loader",function(){}),pc.DataResource=pc.Base.extend("pc.DataResource",{},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(a,b,c,d){this._super(),this.src=pc.device.loader.makeUrl(b),this.name=a,this.onLoadCallback=c,this.onErrorCallback=d,this.request=new XMLHttpRequest,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.onload=this.onReadyStateChange.bind(this),this.request.onloadend=this.onReadyStateChange.bind(this),this.load()},load:function(a,b){this.onLoadCallback=a,this.onErrorCallback=b,this.request.open("get",this.src),this.request.send(null)},reload:function(){this.loaded=!1,this.load()},onReadyStateChange:function(){this.loaded||4==this.request.readyState&&(200==this.request.status?(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback&&this.onLoadCallback(this)):404==this.request.status&&(this.warn("resource "+this.src+" error "+this.request.status),this.onErrorCallback&&this.onErrorCallback(this)))}}),define("playcraft/dataresource",function(){}),pc.components={},pc.components.Component=pc.Pooled.extend("pc.components.Component",{create:function(){return this._super()}},{_entity:null,_type:null,active:!0,init:function(a){this._super(),this._type=a,this.active=!0},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}}),define("playcraft/components/component",function(){}),pc.components.Physics=pc.components.Component.extend("pc.components.Physics",{create:function(a){var b=this._super();return b.config(a),b}},{maxSpeed:null,bounce:.5,faceVel:!1,density:0,mass:-1,friction:0,linearDamping:0,linearVelocity:null,angularDamping:0,fixedRotation:!1,bullet:!1,collisionGroup:0,collisionCategory:0,collisionMask:0,sensorOnly:!1,immovable:!1,centerOfMass:null,centered:!0,gravity:null,shapes:null,force:0,turn:0,torque:0,_body:null,_fixtures:null,_lastSpatialPos:null,_lastSpatialDim:null,_lastSpatialDir:0,init:function(a){this._super("physics"),this.centerOfMass=pc.Point.create(0,0),this.margin={x:0,y:0},this.linearVelocity=pc.Dim.create(0,0),pc.valid(a)&&this.config(a),this._velReturn=pc.Dim.create(0,0),this.gravity={}},config:function(a){this._body=null,this._fixtures?this._fixtures.length=0:this._fixtures=[],this.collisionGroup=pc.checked(a.collisionGroup,0),this.collisionCategory=pc.checked(a.collisionCategory,0),this.collisionMask=pc.checked(a.collisionMask,0),this.sensorOnly=pc.checked(a.sensorOnly,!1),this.centered=pc.checked(a.centered,!0),pc.valid(a.shapes)||Array.isArray(a.shapes)||(a.shapes=[{}],a.shapes[0].shape=pc.CollisionShape.RECT);for(var b=0;b<a.shapes.length;b++){var c=a.shapes[b];c.offset||(c.offset={}),c.offset.x=pc.checked(c.offset.x,0),c.offset.y=pc.checked(c.offset.y,0),c.offset.w=pc.checked(c.offset.w,0),c.offset.h=pc.checked(c.offset.h,0),c.type=pc.checked(c.type,0),c.shape=pc.checked(c.shape,pc.CollisionShape.RECT),c.sensorOnly=pc.checked(c.sensorOnly,this.sensorOnly),c.collisionGroup=pc.checked(c.collisionGroup,this.collisionGroup),c.collisionCategory=pc.checked(c.collisionCategory,this.collisionCategory),c.collisionMask=pc.checked(c.collisionMask,this.collisionMask)}this.shapes=a.shapes,a.linearVelocity?(this.linearVelocity.x=pc.checked(a.linearVelocity.x,0),this.linearVelocity.y=pc.checked(a.linearVelocity.y,0)):(this.linearVelocity.x=0,this.linearVelocity.y=0),this.maxSpeed||(this.maxSpeed={}),a.maxSpeed?(this.maxSpeed.x=pc.checked(a.maxSpeed.x,0),this.maxSpeed.y=pc.checked(a.maxSpeed.y,0)):(this.maxSpeed.x=0,this.maxSpeed.y=0),a.gravity?(this.gravity.x=a.gravity.x,this.gravity.y=a.gravity.y):(this.gravity.x=void 0,this.gravity.y=void 0),this.mass=pc.checked(a.mass,-1),this.fixedRotation=pc.checked(a.fixedRotation,!1),this.thrust=pc.checked(a.thrust,0),this.bounce=pc.checked(a.bounce,.5),this.faceVel=pc.checked(a.faceVel,0),this.shape=pc.checked(a.shape,pc.CollisionShape.RECT),this.immovable=pc.checked(a.immovable,!1),this.density=pc.checked(a.density,1),this.friction=pc.checked(a.friction,.2),this.linearDamping=pc.checked(a.linearDamping,0),this.angularDamping=pc.checked(a.angularDamping,0),this.bullet=pc.checked(a.bullet,!1),this.torque=pc.checked(a.torque,0),this.impulse=pc.checked(a.impulse,0),this.turn=pc.checked(a.turn,0),this.force=pc.checked(a.force,0),pc.valid(a.centerOfMass)&&(this.centerOfMass.x=pc.checked(a.centerOfMass.x),this.centerOfMass.y=pc.checked(a.centerOfMass.y))},applyTurn:function(a){this._body?(this._body.SetAngularVelocity(pc.Math.degToRad(a)),this._body.SetAwake(!0)):this._pendingDir=a},clearGravity:function(){this.setGravity()},setGravity:function(a,b){this.gravity.x=a,this.gravity.y=b,this._body&&((void 0!=this.gravity.x||void 0!=this._body._pc_gravityX)&&(this._body._pc_gravityX=this.gravity.x),(void 0!=this.gravity.y||void 0!=this._body._pc_gravityY)&&(this._body._pc_gravityY=this.gravity.y))},setDir:function(a){this._body?(this._body.SetAngle(pc.Math.degToRad(a)),this._body.SetAwake(!0)):this.dir=a},getDir:function(){return this._body?pc.Math.radToDeg(this._body.GetAngle()):0},applyForce:function(a,b){if(this._body){var c=this._body.GetAngle();pc.valid(b)&&(c=pc.Math.degToRad(b)),this._body.ApplyForce(Box2D.Common.Math.b2Vec2.Get(Math.cos(c)*a,Math.sin(c)*a),this._body.GetWorldCenter())}else this.force=a},applyImpulse:function(a,b){if(this._body){var c=this._body.GetAngle();pc.valid(b)&&(c=pc.Math.degToRad(b)),this._body.ApplyImpulse(Box2D.Common.Math.b2Vec2.Get(Math.cos(c)*a,Math.sin(c)*a),this._body.GetWorldCenter())}else this.impulse=a},applyTorque:function(a){this._body?this._body.ApplyTorque(pc.Math.degToRad(a)):this.torque=a},setCenterOfMass:function(a,b){if(this._body){var c=new Box2D.Collision.Shapes.b2MassData;c.center=Box2D.Common.Math.b2Vec2.Get(pc.systems.Physics.toP(a),pc.systems.Physics.toP(b)),this._body.SetMassData(c)}else this.centerOfMass.x=a,this.centerOfMass.y=b},getSpeed:function(){return this._body?this._body.GetLinearVelocity().Length()/pc.systems.Physics.SCALE:0},setLinearVelocity:function(a,b){this._body?(this._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(a*pc.systems.Physics.SCALE,b*pc.systems.Physics.SCALE)),this._body.SetAwake(!0)):(this.linearVelocity.x=a,this.linearVelocity.y=b)},_velReturn:null,getLinearVelocity:function(){if(this._body){var a=this._body.GetLinearVelocity();this._velReturn.setXY(pc.systems.Physics.fromP(a.x),pc.systems.Physics.fromP(a.y))}return this._velReturn},getVelocityAngle:function(){return pc.Math.angleFromVector(this._body.GetLinearVelocity().x,this._body.GetLinearVelocity().y)},setAngularVelocity:function(a){this._body&&(this._body.SetAngularVelocity(a),this._body.SetAwake(!0))},setLinearDamping:function(){this._body&&(this._body.SetLinearDamping(a),this._body.SetAwake(!0))},setFriction:function(a){this._body&&(this._body.SetFriction(a),this._body.SetAwake(!0))},setCollisionCategory:function(a){if(this._fixtures.length){this.collisionCategory=a;for(var b=0;b<this._fixtures.length;b++){var c=this._fixtures[b].GetFilterData();c.collisionCategory=a,this._fixtures[b].SetFilterData(c),this._fixtures[b].GetFilterData().categoryBits=a}}},setCollisionGroup:function(a){if(this._fixtures.length){this.collisionGroup=a;for(var b=0;b<this._fixtures.length;b++){var c=this._fixtures[b].GetFilterData();c.groupIndex=a,this._fixtures[b].SetFilterData(c)}}},setCollisionMask:function(a){if(this._fixtures.length){this.collisionMask=a;for(var b=0;b<this._fixtures.length;b++){var c=this._fixtures[b].GetFilterData();c.maskBits=a,this._fixtures[b].SetFilterData(c)}}},setIsSensor:function(a,b){this._fixtures.length&&(this._fixtures[b].isSensor=a)}}),define("playcraft/components/physics",function(){}),pc.components.Alpha=pc.components.Component.extend("pc.components.Alpha",{create:function(a){var b=this._super();return b.config(a),b}},{level:1,init:function(){this._super("alpha")},config:function(a){this.level=pc.checked(a.level,1)},setAlpha:function(a){this.level=a,this._fix(this.level)},addAlpha:function(a){this.level+=a,this._fix(this.level)},subAlpha:function(a){this.level-=a,this._fix(this.level)},_fix:function(a){a>1||0>a||(this.level=a)}}),define("playcraft/components/alpha",function(){}),pc.JointType={WELD:0,REVOLUTE:1,DISTANCE:2},pc.components.Joint=pc.components.Component.extend("pc.components.Joint",{create:function(a){var b=this._super();return b.config(a),b}},{attachTo:null,offset:null,attachmentOffset:null,distance:0,type:0,frequency:0,dampingRatio:0,angle:0,lowerAngleLimit:0,upperAngleLimit:0,enableLimit:!1,maxMotorTorque:0,enableMotor:0,motorSpeed:0,_joint:null,init:function(a){this._super("joint"),this.offset=pc.Point.create(0,0),this.attachmentOffset=pc.Point.create(0,0),pc.valid(a)&&this.config(a)},config:function(a){this.attachTo=pc.checked(a.attachedTo,null),a.offset&&this.offset.setXY(pc.checked(a.offset.x,0),pc.checked(a.offset.y,0)),a.attachmentOffset&&this.attachmentOffset.setXY(pc.checked(a.attachmentOffset.x,0),pc.checked(a.attachmentOffset.y,0)),this.distance=pc.checked(a.distance,0),this.type=pc.checked(a.type,pc.JointType.WELD),this.dampingRatio=pc.checked(a.dampingRatio,0),this.lowerAngleLimit=pc.checked(a.lowerAngleLimit,0),this.upperAngleLimit=pc.checked(a.upperAngleLimit,359),this.enableLimit=pc.checked(a.enableLimit,!1),this.maxMotorTorque=pc.checked(a.maxMotorTorque,100),this.enableMotor=pc.checked(a.enableMotor,!1),this.motorSpeed=pc.checked(a.motorSpeed,0),this.angle=pc.checked(a.angle,0),this._joint=null},getAngle:function(){return pc.Math.radToDeg(this._joint.GetJointAngle())},getSpeed:function(){return this._joint.GetJointSpeed()},setMotorSpeed:function(a){this.motorSpeed=a,this._joint.SetMotorSpeed(a)},getMotorTorque:function(){return this._joint.GetMotorTorque()},isLimitEnabled:function(){return this.enableLimit},isMotorEnabled:function(){return this.enableMotor},setMaxMotorTorque:function(a){this.maxMotorTorque=a,this._joint.SetMaxMotorTorque(a)},getMaxMotorTorque:function(){return this.maxMotorTorque}}),define("playcraft/components/joint",function(){}),pc.components.Expiry=pc.components.Component.extend("pc.components.Expiry",{create:function(a){var b=this._super();return b.config(a),b}},{lifetime:0,init:function(){this._super("expiry")},config:function(a){this.lifetime=pc.checked(a.lifetime,1e3)},decrease:function(a){this.lifetime-=a},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/expiry",function(){}),pc.components.OriginShifter=pc.components.Component.extend("pc.components.OriginShifter",{create:function(a){var b=this._super();return b.config(a),b}},{ratio:1,_offsetX:0,_offsetY:0,init:function(a){this._super("originshifter"),pc.valid(a)&&this.config(a)},config:function(a){this.ratio=pc.checked(a.ratio,1)}}),define("playcraft/components/originshifter",function(){}),pc.components.Spatial=pc.components.Component.extend("pc.components.Spatial",{create:function(a){var b=this._super();return b.config(a),b}},{lastMove:null,pos:null,dim:null,scaleX:0,scaleY:0,dir:0,_centerPos:null,_screenRect:null,init:function(a){this._super("spatial"),this.pos=pc.Point.create(0,0),this.dim=pc.Dim.create(0,0),this._screenRect=pc.Rect.create(0,0,0,0),this._centerPos=pc.Point.create(0,0),this._unscaledPos=pc.Point.create(0,0),this._unscaledDim=pc.Point.create(0,0),this.lastMove=pc.Dim.create(0,0),this.scaleX=1,this.scaleY=1,pc.valid(a)&&this.config(a)
},config:function(a){this.pos.x=pc.checked(a.x,0),this.pos.y=pc.checked(a.y,0),this.dim.x=pc.checked(a.w,0),this.dim.y=pc.checked(a.h,0),this.dir=pc.checked(a.dir,0),this.scaleX=pc.checked(a.scaleX,1),this.scaleY=pc.checked(a.scaleY,1),this._centerPos.x=0,this._centerPos.y=0,this._screenRect.x=0,this._screenRect.y=0,this._screenRect.w=0,this._screenRect.h=0,this.lastMove.x=0,this.lastMove.y=0},getPos:function(){return this.pos},getDim:function(){return this.dim},addScale:function(a,b){this.pos.x-=Math.abs((this.dim.x-this.dim.x*a)/2),this.pos.y-=Math.abs((this.dim.y-this.dim.y*b)/2),this.dim.x*=a,this.dim.y*=b,this.scaleX+=a,this.scaleY+=b},_unscaledPos:null,getUnscaledPos:function(){return this._unscaledPos.x=this.pos.x/this.scaleX,this._unscaledPos.y=this.pos.y/this.scaleY,this._unscaledPos},_unscaledDim:null,getUnscaledDim:function(){return this._unscaledDim.x=this.dim.x/this.scaleX,this._unscaledDim.y=this.dim.y/this.scaleY,this._unscaledDim},subtractScale:function(a,b){this.addScale(-a,-b)},setDir:function(a){this.dir=a},getDir:function(){return this.dir},getCenterPos:function(){return this._centerPos.x=this.pos.x+this.dim.x/2,this._centerPos.y=this.pos.y+this.dim.y/2,this._centerPos},getScreenRect:function(){return this._entity&&this._entity.layer?(this._screenRect.x=this._entity.layer.screenX(this.pos.x),this._screenRect.y=this._entity.layer.screenY(this.pos.y),this._screenRect.w=this.dim.x,this._screenRect.h=this.dim.y,this._screenRect):null},toString:function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z+" dir: "+this.dir}}),define("playcraft/components/spatial",function(){}),pc.components.Overlay=pc.components.Component.extend("pc.components.Overlay",{create:function(a){var b=this._super();return b.config(a),b}},{lifetime:0,sprite:null,init:function(a){this._super("overlay"),this.sprite=pc.Sprite.create(),pc.valid(a)&&this.config(a)},config:function(a){this.lifetime=pc.checked(a.lifetime,1e3);var b=pc.checked(a.spriteSheet,null);if(null==b)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(b);var c=pc.checked(a.animationStart,null),d=pc.checked(a.animationStartDelay,0);null!=c&&this.sprite.setAnimation(c,d)},decrease:function(a){this.lifetime-=a},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/overlay",function(){}),pc.components.Clip=pc.components.Component.extend("pc.components.Clip",{create:function(a){var b=this._super();return b.config(a),b}},{clipEntity:null,x:0,y:0,w:0,h:0,init:function(){this._super("clip")},config:function(a){this.clipEntity=pc.checked(a.clipEntity,null),this.x=pc.checked(a.x,0),this.y=pc.checked(a.y,0),this.w=pc.checked(a.w,0),this.h=pc.checked(a.h,0)}}),define("playcraft/components/clip",function(){}),pc.components.Activator=pc.components.Component.extend("pc.components.Activator",{create:function(a){var b=this._super();return b.config(a),b}},{tag:null,layer:null,range:0,stayActive:!1,_cacheLayer:null,init:function(){this._super("activator")},config:function(a){if(!a.tag)throw"Activator requires an entity to track against";this.tag=a.tag,this.layer=pc.checked(a.layer,null),this.range=pc.checked(a.range,300),this.stayActive=pc.checked(a.stayActive,!1)}}),define("playcraft/components/activator",function(){}),pc.components.Input=pc.components.Component.extend("pc.components.Input",{create:function(a){var b=this._super();return b.config(a),b}},{target:null,states:null,actions:null,_bound:!1,init:function(){this._super("input")},config:function(a){if(!a.states&&!a.actions)throw"Input requires at least an action or state set";this.states=a.states,this.actions=a.actions,this.target=a.target}}),define("playcraft/components/input",function(){}),pc.components.Fade=pc.components.Component.extend("pc.components.Fade",{create:function(a){var b=this._super();return b.config(a),b}},{startDelay:0,fadeInTime:0,fadeOutTime:0,holdTime:0,startTime:0,timeLimit:0,state:0,loops:1,loopsSoFar:0,init:function(){this._super("fade")},config:function(a){this.startDelay=pc.checked(a.startDelay,0),this.fadeInTime=pc.checked(a.fadeInTime,0),this.fadeOutTime=pc.checked(a.fadeOutTime,0),this.holdTime=pc.checked(a.holdTime,0),this.loops=pc.checked(a.loops,1),this.timeLimit=0,this.state=0,this.loopsSoFar=0}}),define("playcraft/components/fade",function(){}),pc.components.Spin=pc.components.Component.extend("pc.components.Spin",{create:function(a){var b=this._super();return b.config(a),b}},{rate:0,max:0,clockwise:!0,spinSoFar:0,spinning:!0,init:function(a){this._super("spin"),pc.valid(a)&&this.config(a)},config:function(a){this.rate=pc.checked(a.rate,15),this.max=pc.checked(a.max,0),this.clockwise=pc.checked(a.clockwise,!0),this.spinSoFar=0,this.spinning=!0}}),define("playcraft/components/spin",function(){}),pc.components.Scale=pc.components.Component.extend("pc.components.Scale",{create:function(a){var b=this._super();return b.config(a),b}},{x:1,y:1,growX:0,growY:0,maxX:0,maxY:0,scaledXSoFar:0,scaledYSoFar:0,scaling:!0,_bound:!1,init:function(a){this._super("scale"),pc.valid(a)&&this.config(a)},config:function(a){this.x=pc.checked(a.x,1),this.y=pc.checked(a.y,1),this.growX=pc.checked(a.growX,0),this.growY=pc.checked(a.growY,0),this.maxX=pc.checked(a.maxX,0),this.maxY=pc.checked(a.maxY,0),this.scaledXSoFar=0,this.scaledYSoFar=0}}),define("playcraft/components/scale",function(){}),pc.components.Rect=pc.components.Component.extend("pc.components.Rect",{create:function(a){var b=this._super();return b.config(a),b}},{color:null,lineColor:null,lineWidth:0,cornerRadius:0,init:function(a){this._super("rect"),this.color=pc.Color.create("#ffffff"),this.lineColor=pc.Color.create("#888888"),pc.valid(a)&&this.config(a)},config:function(a){a.color?this.color.set(pc.checked(a.color,"#ffffff")):this.color.set("#ffffff"),a.lineColor?this.lineColor.set(pc.checked(a.lineColor,"#888888")):this.lineColor.set("#ffffff"),this.lineWidth=pc.checked(a.lineWidth,0),this.cornerRadius=pc.checked(a.cornerRadius,0)}}),define("playcraft/components/rect",function(){}),pc.components.Poly=pc.components.Component.extend("pc.components.Poly",{create:function(a){var b=this._super();return b.config(a),b}},{color:null,lineColor:null,lineWidth:0,points:[],init:function(a){this._super("poly"),this.color=pc.Color.create("#ffffff"),this.lineColor=null,pc.valid(a)&&this.config(a)},config:function(a){if(a.color?this.color.set(pc.checked(a.color,"#ffffff")):this.color.set("#ffffff"),pc.valid(a.lineColor)&&(null==this.lineColor?this.lineColor=pc.Color.create(a.lineColor):this.lineColor.set(pc.checked(a.lineColor,"#888888"))),this.lineWidth=pc.checked(a.lineWidth,0),a.points.length<3)throw"Invalid polygon, requires at least 3 points";this.points=a.points}}),define("playcraft/components/poly",function(){}),pc.components.Circle=pc.components.Component.extend("pc.components.Circle",{create:function(a){var b=this._super();return b.config(a),b}},{color:null,lineColor:null,lineWidth:0,init:function(){this._super("circle")},config:function(a){a.color?null==this.color?this.color=pc.Color.create(a.color):this.color.set(a.color):this.color=null,a.lineColor?null==this.lineColor?this.lineColor=pc.Color.create(a.lineColor):this.lineColor.set(a.lineColor):this.lineColor=null,this.lineWidth=pc.checked(a.lineWidth,0)}}),define("playcraft/components/circle",function(){}),pc.components.Text=pc.components.Component.extend("pc.components.Text",{create:function(a){var b=this._super();return b.config(a),b}},{color:null,strokeColor:null,font:null,fontHeight:0,text:null,lineWidth:0,offset:null,_fontCache:null,init:function(a){this._super("text"),this.color=pc.Color.create("#ffffff"),this.strokeColor=pc.Color.create("#888888"),this.text=[],this.font="Calibri",this.fontHeight=20,this.offset=pc.Dim.create(0,0),this._fontCache="",pc.valid(a)&&this.config(a)},config:function(a){this.color.set(pc.checked(a.color,"#ffffff")),this.strokeColor.set(pc.checked(a.strokeColor,"#888888")),this.lineWidth=pc.checked(a.lineWidth,0),this.text=pc.checked(a.text,[""]),this.font=pc.checked(a.font,"Arial"),this.fontHeight=pc.checked(a.fontHeight,20),pc.valid(a.offset)&&(this.offset.x=pc.checked(a.offset.x),this.offset.y=pc.checked(a.offset.y)),this._updateFont()},setHeight:function(a){this.fontHeight=a,this._updateFont()},setFont:function(a){this.font=a,this._updateFont()},_updateFont:function(){this._fontCache=""+this.fontHeight+"px "+this.font}}),define("playcraft/components/text",function(){}),pc.components.Sprite=pc.components.Component.extend("pc.components.Sprite",{create:function(a){var b=this._super();return b.config(a),b}},{sprite:null,offset:null,init:function(a){this._super("sprite"),this.sprite=pc.Sprite.create(),this.offset=pc.Point.create(0,0),pc.valid(a)&&this.config(a)},config:function(a){var b=pc.checked(a.spriteSheet,null);if(null==b)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(b),pc.valid(a.offset)?(this.offset.x=pc.checked(a.offset.x,0),this.offset.y=pc.checked(a.offset.y,0)):(this.offset.x=0,this.offset.y=0);var c=pc.checked(a.animationStart,null),d=pc.checked(a.animationStartDelay,0);null!=c&&this.sprite.setAnimation(c,d),this.sprite.currentFrame=pc.checked(a.currentFrame,0)}}),define("playcraft/components/sprite",function(){}),pc.components.Layout=pc.components.Component.extend("pc.components.Layout",{create:function(a){var b=this._super();return b.config(a),b}},{vertical:null,horizontal:null,margin:null,init:function(){this._super("layout"),this.margin={}},config:function(a){pc.checked(a.margin)?(this.margin.left=pc.checked(a.margin.left,0),this.margin.right=pc.checked(a.margin.right,0),this.margin.top=pc.checked(a.margin.top,0),this.margin.bottom=pc.checked(a.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0),this.horizontal=pc.checked(a.horizontal,"left"),this.vertical=pc.checked(a.vertical,"top")}}),define("playcraft/components/layout",function(){}),pc.components.ParticleEmitter=pc.components.Component.extend("pc.components.ParticleEmitter",{create:function(a){var b=this._super();return b.config(a),b}},{active:!0,emitting:!0,growXMin:0,growXMax:0,growYMin:0,growYMax:0,scaleXMin:0,scaleXMax:0,scaleYMin:0,scaleYMax:0,fadeInTime:0,fadeOutTime:0,angleMin:0,angleMax:0,thrustMin:0,thrustMax:0,thrustTime:0,spinMin:0,spinMax:0,rangeX:1,rangeY:1,burst:1,delay:25,spriteSheet:null,lifeMin:0,lifeMax:0,rotateSprite:!1,offsetX:null,offsetY:null,compositeOperation:null,relativeAngle:!0,shots:0,alphaMin:1,alphaMax:1,alphaDelay:0,_particles:null,_lastEmitTime:0,_shotCount:0,init:function(a){this._super("emitter"),pc.valid(a)&&this.config(a)},reset:function(){this._shotCount=0,this._lastEmitTime=0},config:function(a){if(this._lastEmitTime=0,this._shotCount=0,this.active=pc.checked(a.active,!0),this.emitting=pc.checked(a.emitting,!0),this.growXMin=pc.checked(a.growXMin,0),this.growXMax=pc.checked(a.growXMax,this.growXMin),this.growYMin=pc.checked(a.growYMin,0),this.growYMax=pc.checked(a.growYMax,this.growYMin),this.scaleXMin=pc.checked(a.scaleXMin,1),this.scaleYMin=pc.checked(a.scaleYMin,1),this.scaleXMax=pc.checked(a.scaleXMax,1),this.scaleYMax=pc.checked(a.scaleYMax,1),this.compositeOperation=pc.checked(a.compositeOperation,null),this.alphaMin=pc.checked(a.alphaMin,1),this.alphaMax=pc.checked(a.alphaMax,this.alphaMin),this.alphaDelay=pc.checked(a.alphaDelay,50),this.shots=pc.checked(a.shots,0),this.relativeAngle=pc.checked(a.relativeAngle,!0),this.rangeX=pc.checked(a.rangeX,1),this.rangeY=pc.checked(a.rangeY,1),this.fadeInTime=pc.checked(a.fadeInTime,0),this.fadeOutTime=pc.checked(a.fadeOutTime,0),this.angleMin=pc.checked(a.angleMin,0),this.angleMax=pc.checked(a.angleMax,359),this.thrustMin=pc.checked(a.thrustMin,1),this.thrustMax=pc.checked(a.thrustMax,this.thrustMin),this.thrustTime=pc.checked(a.thrustTime,100),this.burst=pc.checked(a.burst,1),this.delay=pc.checked(a.delay,25),this.lifeMin=pc.checked(a.lifeMin,100),this.lifeMax=pc.checked(a.lifeMin,this.lifeMin),this.rotateSprite=pc.checked(a.rotateSprite,!1),this.spinMin=pc.checked(a.spinMin,0),this.spinMax=pc.checked(a.spinMax,this.spinMin),this.offsetX=pc.checked(a.offsetX,0),this.offsetY=pc.checked(a.offsetY,0),this.gravityX=pc.checked(a.gravityX,0),this.gravityY=pc.checked(a.gravityY,0),this.maxVelX=pc.checked(a.maxVelX,50),this.maxVelY=pc.checked(a.maxVelY,50),!pc.valid(a.spriteSheet))throw"A spritesheet is required for the emitter";this.spriteSheet=a.spriteSheet,Array.isArray(this._particles)?this._particles.clear():this._particles=new pc.LinkedList},onBeforeRemoved:function(){for(var a=this._particles.first;a;)a.obj.release(),a=a.next()}}),define("playcraft/components/particleemitter",function(){}),pc.systems={},pc.systems.System=pc.Base.extend("pc.System",{},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(a,b){if(this._super(),this.delay=pc.checked(b,0),!a instanceof Array)throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system.";this.componentTypes=a},processAll:function(){},onResize:function(){},onOriginChange:function(){},onAddedToLayer:function(){},onRemovedFromLayer:function(){}}),define("playcraft/systems/system",function(){}),pc.EntityManager=pc.Base.extend("pc.EntityManager",{},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(a){this.layer=a,this.entitiesByTag=new pc.HashList,this.entities=new pc.LinkedList,this.componentsByEntity=new pc.Hashmap,this.componentsByEntityPlusType=new pc.Hashmap,this.entitySuicides=new pc.LinkedList},cleanup:function(){for(var a=this.entitySuicides.first;a;)this._doRemoveEntity(a.object()),a=a.next();this.entitySuicides.clear()},add:function(a,b){this.entities.add(a),void 0!=b&&this.entitiesByTag.add(b,a);var c=a.getAllComponents();if(null!=c)for(var d=c.values(),e=0;e<d.length;e++)this._addToComponentMap(a,d[e]);this.layer.systemManager._handleEntityAdded(a)},remove:function(a){this.entitySuicides.has(a)||(this.entitySuicides.add(a),a.active=!1)},removeComponent:function(a,b){this._removeFromComponentMap(a,b),this.layer.systemManager._handleComponentRemoved(a,b),a._handleComponentRemoved(b),b._entity=null},addTag:function(a,b){-1==a.tags.indexOf(b.toLowerCase())&&(this.entitiesByTag.add(b.toLowerCase(),a),a.tags.push(b.toLowerCase()))},removeTag:function(a,b){this.entitiesByTag.remove(b.toLowerCase(),a),pc.Tools.arrayRemove(a.tags,b.toLowerCase())},getTagged:function(a){return this.entitiesByTag.get(a.toLowerCase())},activate:function(a){a.active||(this.layer.systemManager._handleEntityAdded(a),a.active=!0)},deactivate:function(a){a.active&&(this.layer.systemManager._handleEntityRemoved(a),a.active=!1)},_doRemoveEntity:function(a){this.entities.remove(a);var b=a.getAllComponents();if(null!=b)for(var c=b.values(),d=0;d<c.length;d++)this._removeFromComponentMap(a,c[d]);for(var e=0;e<a.tags.length;e++)this.entitiesByTag.remove(a.tags[e],a);this.layer.systemManager._handleEntityRemoved(a),a.release()},addComponent:function(a,b){return this._addToComponentMap(a,b),a._handleComponentAdded(b),this.layer.systemManager._handleComponentAdded(a,b),b._entity=a,b},getComponent:function(a,b){return this.componentsByEntityPlusType.get(a.objectId+":"+b)},getComponents:function(a){return this.componentsByEntity.get(a.objectId)},hasComponentOfType:function(a,b){return this.componentsByEntityPlusType.containsKey(a.objectId+":"+b)},_addToComponentMap:function(a,b){if(this.componentsByEntityPlusType.get(a.objectId+":"+b.getType()))throw"adding component "+b.getType()+" to entity "+a+" when it already has one of that type";this.componentsByEntityPlusType.put(a.objectId+":"+b.getType(),b),this.componentsByEntity.put(a.objectId,b)},_removeFromComponentMap:function(a,b){b.onBeforeRemoved(),this.componentsByEntityPlusType.remove(a.objectId+":"+b.getType()),this.componentsByEntity.remove(a.objectId),b.release()}}),define("playcraft/es/entitymanager",function(){}),pc.SystemManager=pc.Base.extend("pc.SystemManager",{},{systems:null,systemsByComponentType:null,layer:null,init:function(a){this.systems=new pc.LinkedList,this.systemsByComponentType=new pc.Hashtable,this.layer=a},add:function(a){if(a.layer=this.layer,a.systemManager=this,this.systems.add(a),!pc.valid(a.componentTypes))throw"Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)";for(var b=0;b<a.componentTypes.length;b++){var c=a.componentTypes[b].toLowerCase(),d=this.systemsByComponentType.get(c);null==d&&(d=new pc.LinkedList,this.systemsByComponentType.put(c,d)),d.has(a)||d.add(a)}for(var e=this.layer.entityManager.entities.first;e;)this._handleEntityAdded(e.object()),e=e.next();a.onAddedToLayer(this.layer)},remove:function(a){a.onRemovedFromLayer(a.layer),this.systems.remove(a);for(var b=0;b<a.componentTypes;b++){var c=this.systemsByComponentType.get(a.componentTypes[b].toLowerCase());assert(null!=c,"Oops, trying to remove a system and it's not in the by type list"),a.systemManager=null,c.remove(a)}},getByComponentType:function(a){return this.systemsByComponentType.get(a)},onOriginChange:function(a,b){for(var c=this.systems.first;c;)c.object().onOriginChange(a,b),c=c.next()},_handleEntityAdded:function(a){for(var b=a.getComponentTypes(),c=0;c<b.length;c++){var d=this.systemsByComponentType.get(b[c].toLowerCase());if(d)for(var e=d.first;e;)e.obj.add(a),e=e.next()}},_handleEntityRemoved:function(a){var b=a.getAllComponents();if(null!=b)for(var c=b.keys(),d=0;d<c.length;d++){var e=this.systemsByComponentType.get(c[d].toLowerCase());if(e)for(var f=e.first;f;)f.obj.remove(a),f=f.next()}},_handleComponentAdded:function(a,b){var c=this.systemsByComponentType.get(b.getType());if(null!=c)for(var d=c.first;d;)d.obj.add(a),d.obj.onComponentAdded(a,b),d=d.next()},_handleComponentRemoved:function(a,b){var c=this.systemsByComponentType.get(b.getType());if(null!=c)for(var d=c.first;d;)d.obj.removeIfNotMatched(a),d.obj.onComponentRemoved(a,b),d=d.next()},processAll:function(){for(var a=this.systems.first;a;)(0==a.obj.delay||pc.device.now-a.obj._lastRun>a.obj.delay)&&(a.obj.processAll(),0!=a.obj.delay&&(a.obj._lastRun=pc.device.now)),a=a.next()},onResize:function(a,b){for(var c=this.systems.first;c;)c.obj.onResize(a,b),c=c.next()}}),define("playcraft/es/systemmanager",function(){}),pc.systems.EntitySystem=pc.systems.System.extend("pc.systems.EntitySystem",{},{entities:null,suicides:null,init:function(a,b){this._super(a,b),this.entities=new pc.LinkedList,this.suicides=new pc.LinkedList},addIfMatched:function(a){for(var b=0;b<this.componentTypes.length;b++)if(a.hasComponentOfType(this.componentTypes[b]))return this.entities.add(a),this.onEntityAdded(a),void 0},add:function(a){this.entities.has(a)||(this.entities.add(a),this.onEntityAdded(a))},remove:function(a){this.entities.remove(a)&&this.onEntityRemoved(a)},removeIfNotMatched:function(a){for(var b=0;b<this.componentTypes.length;b++)if(a.hasComponentOfType(this.componentTypes[b]))return;this.remove(a)},processAll:function(){for(var a=this.entities.first;a;)this.process(a.obj),a=a.next();for(a=this.suicides.first;a;)this.remove(a.obj),a=a.next();this.suicides.clear()},process:function(){},suicide:function(a){this.suicides.add(a)},onEntityAdded:function(){},onEntityRemoved:function(){},onComponentAdded:function(){},onComponentRemoved:function(){}}),define("playcraft/systems/entitysystem",function(){}),pc.CollisionShape={RECT:0,CIRCLE:1,POLY:2},pc.BodyType={ENTITY:0,TILE:1},pc.systems.Physics=pc.systems.EntitySystem.extend("pc.systems.Physics",{SCALE:.1,toP:function(a){return a*this.SCALE},fromP:function(a){return a/this.SCALE}},{world:null,gravity:null,debug:!1,debugDraw:null,init:function(a){this._super(["physics"]),this.gravity=a&&a.gravity?pc.Point.create(pc.checked(a.gravity.x,0),pc.checked(a.gravity.y,0)):pc.Point.create(0,0);var b=new Box2D.Common.Math.b2Vec2(this.gravity.x*this.Class.SCALE,this.gravity.y*this.Class.SCALE);this.world=new Box2D.Dynamics.b2World(b,!0),a&&pc.valid(a.tileCollisionMap)&&(pc.assert(pc.valid(a.tileCollisionMap.tileMap),"A tileMap is required for a tileCollisionMap"),this.addTileCollisionMap(a.tileCollisionMap.tileMap,pc.checked(a.tileCollisionMap.collisionGroup,0),pc.checked(a.tileCollisionMap.collisionCategory,0),pc.checked(a.tileCollisionMap.collisionMask,0)));var c=new Box2D.Dynamics.b2ContactListener;c.BeginContact=this._beginContactListener.bind(this),c.EndContact=this._endContactListener.bind(this),c.PostSolve=this._postSolveListener.bind(this),this.world.SetContactListener(c);var d=Box2D.Dynamics.b2DebugDraw;this.debugDraw=new d,this.debugDraw.SetSprite(pc.device.ctx),this.debugDraw.SetDrawScale(100*this.Class.SCALE),this.debugDraw.SetFillAlpha(.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(d.e_shapeBit|d.e_jointBit|d.e_centerOfMassBit),a&&1==a.debug&&(this.debug=a.debug,this.setDebug(a.debug))},_beginContactListener:function(a){this.onCollisionStart(a.GetFixtureA().GetBody()._pc_bodyType,a.GetFixtureB().GetBody()._pc_bodyType,a.GetFixtureA().GetBody().GetUserData(),a.GetFixtureB().GetBody().GetUserData(),a.GetFixtureA()._pc_type,a.GetFixtureB()._pc_type,a)},_endContactListener:function(a){this.onCollisionEnd(a.GetFixtureA().GetBody()._pc_bodyType,a.GetFixtureB().GetBody()._pc_bodyType,a.GetFixtureA().GetBody().GetUserData(),a.GetFixtureB().GetBody().GetUserData(),a.GetFixtureA()._pc_type,a.GetFixtureB()._pc_type,a)},_postSolveListener:function(a,b){var c=b.normalImpulses[0];this.onCollision(a.GetFixtureA().GetBody()._pc_bodyType,a.GetFixtureB().GetBody()._pc_bodyType,a.GetFixtureA().GetBody().GetUserData(),a.GetFixtureB().GetBody().GetUserData(),c,a.GetFixtureA()._pc_type,a.GetFixtureB()._pc_type,a)},process:function(a){if(a.active){var b=a.getComponent("spatial"),c=a.getComponent("physics");if(c.active){var d=a.getComponent("joint");if(!c._body){var e=new Box2D.Dynamics.b2BodyDef;e.type=c.immovable?Box2D.Dynamics.b2BodyDef.b2_staticBody:e.type=Box2D.Dynamics.b2BodyDef.b2_dynamicBody,c.centered?(e.position.x=this.Class.toP(b.pos.x+b.dim.x/2),e.position.y=this.Class.toP(b.pos.y+b.dim.y/2)):(e.position.x=this.Class.toP(b.pos.x),e.position.y=this.Class.toP(b.pos.y)),e.linearDamping=c.linearDamping,e.angularDamping=c.angularDamping,e.isBullet=c.bullet,e.fixedRotation=c.fixedRotation,c._body=this.world.CreateBody(e),c._body.SetAngle(pc.Math.degToRad(b.dir)),c._body.SetUserData(a),c._body._pc_bodyType=pc.BodyType.ENTITY,c.linearVelocity&&c._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(c.linearVelocity.x*pc.systems.Physics.SCALE,c.linearVelocity.y*pc.systems.Physics.SCALE)),c.gravity&&c.setGravity(c.gravity.x,c.gravity.y),pc.assert(c.shapes.length,"You must specify at least one shape for a physics entity");for(var f=0;f<c.shapes.length;f++){var g=c.shapes[f],h=(b.dim.x+g.offset.w)*this.Class.SCALE,i=(b.dim.y+g.offset.h)*this.Class.SCALE,j=h/2,k=i/2,l=g.offset.x*this.Class.SCALE/2,m=g.offset.y*this.Class.SCALE/2;pc.assert(j>0&&k>0,"Physics requires a spatial size minimum of 1");var n=new Box2D.Dynamics.b2FixtureDef;switch(n.density=c.density,n.friction=c.friction,n.restitution=c.bounce,g.shape){case pc.CollisionShape.CIRCLE:n.shape=new Box2D.Collision.Shapes.b2CircleShape(h/2),n.shape.SetLocalPosition(Box2D.Common.Math.b2Vec2.Get(g.offset.x*this.Class.SCALE,g.offset.y*this.Class.SCALE));break;case pc.CollisionShape.POLY:n.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var o=[],p=0;p<g.points.length;p++)o.push(Box2D.Common.Math.b2Vec2.Get((g.offset.x+g.points[p][0])*this.Class.SCALE,(g.offset.y+g.points[p][1])*this.Class.SCALE));n.shape.SetAsArray(o,o.length);break;default:n.shape=new Box2D.Collision.Shapes.b2PolygonShape,o=[],o.push(Box2D.Common.Math.b2Vec2.Get(-j+l,-k+m)),o.push(Box2D.Common.Math.b2Vec2.Get(j,-k+m)),o.push(Box2D.Common.Math.b2Vec2.Get(j,k)),o.push(Box2D.Common.Math.b2Vec2.Get(-j+l,k)),n.shape.SetAsArray(o,o.length)}n.filter.groupIndex=g.collisionGroup,n.filter.categoryBits=g.collisionCategory,n.filter.maskBits=g.collisionMask,n.isSensor=g.sensorOnly;var q=c._body.CreateFixture(n);q._pc_type=g.type,c._fixtures.push(q)}if(0!=c.centerOfMass.x||0!=c.centerOfMass.y||-1!=c.mass){var r=new Box2D.Collision.Shapes.b2MassData;r.center=Box2D.Common.Math.b2Vec2.Get(c.centerOfMass.x*pc.systems.Physics.SCALE,c.centerOfMass.y*pc.systems.Physics.SCALE),-1!=c.mass&&(r.mass=c.mass),r.I=1,c._body.SetMassData(r)}else r=new Box2D.Collision.Shapes.b2MassData,r.mass=1,r.I=1,c._body.SetMassData(r);c.torque&&c.applyTorque(c.torque),c.turn&&c.applyTurn(c.turn),c.force&&c.applyForce(c.force),c.impulse&&c.applyImpulse(c.impulse),c._lastSpatialPos=pc.Point.create(b.pos.x,b.pos.y),c._lastSpatialDim=pc.Dim.create(b.dim.x,b.dim.y),c._lastSpatialDir=b.dir}if(d&&!d._joint){var s=d.attachTo.getComponent("physics");if(s._body){var t=null;switch(d.type){case pc.JointType.WELD:t=new Box2D.Dynamics.Joints.b2WeldJointDef,t.bodyA=s._body,t.bodyB=c._body,t.collideConnected=!1,t.localAnchorA.Set(d.offset.x*this.Class.SCALE,d.offset.y*this.Class.SCALE),t.localAnchorB.Set(d.attachmentOffset.x*this.Class.SCALE,d.attachmentOffset.y*this.Class.SCALE),s._body.SetAwake(!0);var u=s._body.GetPosition();c._body.SetPosition({x:u.x+d.offset.x*this.Class.SCALE,y:u.y+d.offset.y*this.Class.SCALE});break;case pc.JointType.DISTANCE:t=new Box2D.Dynamics.Joints.b2DistanceJointDef,t.bodyA=s._body,t.bodyB=c._body,t.frequency=d.frequency,t.dampingRatio=d.dampingRatio,t.collideConnected=!1,t.length=d.distance,t.localAnchorA.Set(d.offset.x*this.Class.SCALE,d.offset.y*this.Class.SCALE),t.localAnchorB.Set(d.attachmentOffset.x*this.Class.SCALE,d.attachmentOffset.y*this.Class.SCALE),s._body.SetAwake(!0),u=s._body.GetPosition(),c._body.SetPosition({x:u.x+d.offset.x*this.Class.SCALE,y:u.y+d.offset.y*this.Class.SCALE});break;case pc.JointType.REVOLUTE:t=new Box2D.Dynamics.Joints.b2RevoluteJointDef,t.bodyA=s._body,t.bodyB=c._body,t.collideConnected=!1,t.referenceAngle=d.angle,t.localAnchorA.Set(d.offset.x*this.Class.SCALE,d.offset.y*this.Class.SCALE),t.localAnchorB.Set(d.attachmentOffset.x*this.Class.SCALE,d.attachmentOffset.y*this.Class.SCALE),s._body.SetAwake(!0),d.enableLimit&&(t.enableLimit=d.enableLimit,t.lowerAngle=pc.Math.degToRad(d.lowerAngleLimit),t.upperAngle=pc.Math.degToRad(d.upperAngleLimit)),d.enableMotor&&(t.enableMotor=d.enableMotor,t.motorSpeed=pc.Math.degToRad(d.motorSpeed),t.maxMotorTorque=d.maxMotorTorque);var v=s._body.GetPosition();c._body.SetPosition({x:v.x+this.Class.toP(d.offset.x),y:v.y+this.Class.toP(d.offset.y)})}if(!t)throw"Invalid attachment config";d._joint=this.world.CreateJoint(t)}}var w=c._body.GetPosition(),x=Math.round(pc.Math.radToDeg(c._body.GetAngle()));if(c._lastSpatialPos.x!=b.pos.x||c._lastSpatialPos.y!=b.pos.y){var y=c._lastSpatialPos.x!=b.pos.x?this.Class.toP(b.pos.x+b.dim.x/2):w.x,z=c._lastSpatialPos.y!=b.pos.y?this.Class.toP(b.pos.y+b.dim.y/2):w.y;c._body.SetPosition(Box2D.Common.Math.b2Vec2.Get(y,z))}if(c._lastSpatialDir!=b.dir&&(c._body.SetAngle(pc.Math.degToRad(b.dir)),x=Math.round(pc.Math.radToDeg(c._body.GetAngle()))),b.pos.x=Math.round(this.Class.fromP(w.x)-b.dim.x/2),b.pos.y=Math.round(this.Class.fromP(w.y)-b.dim.y/2),b.dir=x,c._lastSpatialPos.x=b.pos.x,c._lastSpatialPos.y=b.pos.y,c._lastSpatialDir=x,c.maxSpeed.x>0||c.maxSpeed.y>0){var A=c._body.GetLinearVelocity();if(0!=A.x||0!=A.y){var B=this.Class.toP(c.maxSpeed.x);A.x>0&&A.x>B&&c._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(B,A.y)),A.x<0&&A.x<-B&&c._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(-B,A.y));var C=this.Class.toP(c.maxSpeed.y);A.y>0&&A.y>C&&c._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(A.x,C)),A.y<0&&A.y<-C&&c._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(A.x,-C))}}}}},onOriginChange:function(a,b){this.debugDraw.SetOrigin(a,b)},processAll:function(){this.world.Step(.08,10,10),this.world.DrawDebugData(),this.world.ClearForces(),this._super()},onAddedToLayer:function(a){var b=new Box2D.Collision.b2AABB;b.lowerBound.Set(0,0),b.upperBound.Set(this.Class.toP(a.worldSize.x),this.Class.toP(a.worldSize.y))},setDebug:function(a){a?this.world.SetDebugDraw(this.debugDraw):this.world.SetDebugDraw(null),this.debug=a},getEntitiesInArea:function(a){var b=new Box2D.Collision.b2AABB,c=[];return b.lowerBound.Set(a.x,a.y),b.upperBound.Set(a.w,a.h),this.world.QueryAABB(function(a){return c.push(a.GetBody().GetUserData()),!0},b),c},createStaticBody:function(a,b,c,d,e,f,g){var h=this.Class.toP(c/2),i=this.Class.toP(d/2),j=new Box2D.Dynamics.b2FixtureDef,k=new Box2D.Dynamics.b2BodyDef;k.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,j.shape=new Box2D.Collision.Shapes.b2PolygonShape;var l=[];l.push(Box2D.Common.Math.b2Vec2.Get(-h,-i)),l.push(Box2D.Common.Math.b2Vec2.Get(h,-i)),l.push(Box2D.Common.Math.b2Vec2.Get(h,i)),l.push(Box2D.Common.Math.b2Vec2.Get(-h,i)),j.shape.SetAsArray(l,l.length),j.filter.groupIndex=e,j.filter.categoryBits=f,j.filter.maskBits=g,k.position.x=this.Class.toP(a)+h,k.position.y=this.Class.toP(b)+i;var m=this.world.CreateBody(k);m._pc_bodyType=pc.BodyType.TILE,m.CreateFixture(j)},addTileCollisionMap:function(a,b,c,d){for(var e=0;e<a.tilesHigh;e++)for(var f=0,g=0,h=0;h<a.tilesWide;h++)a.tiles[e][h]>=0?g+=a.tileWidth:(g>0&&(this.createStaticBody(f,e*a.tileHeight,g,a.tileHeight,b,c,d),g=0),f=(h+1)*a.tileWidth)},onCollisionStart:function(){},onCollision:function(){},onCollisionEnd:function(){},onEntityAdded:function(){},onEntityRemoved:function(a){var b=a.getComponent("physics");if(b._body){this.world.DestroyBody(b._body);var c=a.getComponent("attachment");c&&this.world.DestroyJoint(c._joint)}}}),define("playcraft/systems/physics",function(){}),pc.systems.Effects=pc.systems.EntitySystem.extend("pc.systems.Effects",{FadeState:{NOT_STARTED:0,DELAYING:1,FADING_IN:2,HOLDING:3,FADING_OUT:4,DONE:5}},{init:function(){this._super(["fade","spin","scale"])},processAll:function(){for(var a=this.entities.first;a;){var b=a.obj;if(b.active){var c=b.getComponent("fade");if(c&&c.active){var d=b.getComponent("alpha");d||(d=b.addComponent(pc.components.Alpha.create({}))),c.state!=this.Class.FadeState.DONE&&(this._fade(d,c)||b.removeComponent(c))}var e=b.getComponent("spin");if(e&&e.spinning&&e.active){var f=b.getComponent("spatial"),g=e.rate/pc.device.elapsed;e.max>0&&e.spinSoFar+g>=e.max&&(e.spinning=!1,g=e.max-e.spinSoFar),e.spinSoFar+=g,f.setDir(pc.Math.rotate(f.getDir(),e.clockwise?g:-g))}var h=b.getComponent("scale");if(h&&h.scaling&&h.active){f=b.getComponent("spatial"),h._bound||1==h.x&&1==h.y||(f.addScale(h.x,h.y),h._bound=!0,0==h.growX&&0==h.growY&&(h.scaling=!1));var i=h.growX/pc.device.elapsed,j=h.growY/pc.device.elapsed;0!=h.maxX&&h.scaledXSoFar>0&&h.scaledXSoFar+i>=h.maxX&&(i=h.maxX-h.scaledXSoFar),0!=h.maxY&&h.scaledYSoFar>0&&h.scaledYSoFar+j>=h.maxY&&(j=h.maxY-h.scaledYSoFar),0!=i&&0!=j&&(h.scaledXSoFar+=i,h.scaledYSoFar+=j,f.addScale(i,j)),0!=h.maxX&&h.scaledXSoFar>=h.maxX&&0!=h.maxY&&h.scaledYSoFar>=h.maxY&&(h.scaling=!1),h._bound=!0}}a=a.next()}},_fade:function(a,b){var c=pc.device.now-b.startTime;switch(b.state){case this.Class.FadeState.NOT_STARTED:b.startTime=pc.device.now,b.startDelay>0?(b.state=this.Class.FadeState.DELAYING,b.timeLimit=b.startDelay,a.setAlpha(0)):b.fadeInTime>0?(b.state=this.Class.FadeState.FADING_IN,b.timeLimit=b.fadeInTime,a.setAlpha(0)):b.holdTime>0?(b.state=this.Class.FadeState.HOLDING,b.timeLimit=b.holdTime):b.fadeOutTime>0&&(b.state=this.Class.FadeState.FADING_OUT,b.timeLimit=b.fadeOutTime);break;case this.Class.FadeState.DELAYING:c>b.timeLimit&&(b.timeLimit=b.fadeInTime,b.startTime=pc.device.now,b.state=this.Class.FadeState.FADING_IN);break;case this.Class.FadeState.FADING_IN:a.addAlpha(pc.device.elapsed*(100/b.timeLimit)/100),c>b.timeLimit&&(b.timeLimit=b.holdTime,b.startTime=pc.device.now,b.state=this.Class.FadeState.HOLDING);break;case this.Class.FadeState.HOLDING:c>b.timeLimit&&(b.timeLimit=b.fadeOutTime,b.startTime=pc.device.now,b.state=this.Class.FadeState.FADING_OUT);break;case this.Class.FadeState.FADING_OUT:if(c>b.timeLimit){if(b.loopsSoFar++,(b.loops>1||0==b.loops)&&(b.startTime=pc.device.now,b.timeLimit=b.fadeInTime,b.state=this.Class.FadeState.FADING_IN,b.timeLimit>0&&a.setAlpha(0)),b.loopsSoFar>=b.loops&&b.loops)return b.state=this.Class.FadeState.DONE,b.timeLimit>0&&a.setAlpha(0),!1
}else a.subAlpha(pc.device.elapsed*(100/b.timeLimit)/100)}return!0}}),define("playcraft/systems/effects",function(){}),pc.systems.Particles=pc.systems.EntitySystem.extend("pc.systems.Particles",{},{init:function(){this._super(["emitter"])},_drawStartTime:0,process:function(a){if(a.active){var b=a.getComponent("emitter");if(b.active){var c=a.getComponent("spatial");if(c||(c=a.addComponent(new pc.components.Spatial({}))),b){if(!b.active)return;if(b.emitting&&Date.now()-b._lastEmitTime>b.delay&&(0==b.shots||b._shotCount<b.shots)){for(var d=0;d<b.burst;d++){var e=0;0==b.spriteSheet.animations.size()&&(e=pc.Math.rand(0,b.spriteSheet.framesHigh*b.spriteSheet.framesWide-1)),b._particles.add(pc._Particle.create(c.pos.x+b.offsetX+pc.Math.rand(-(b.rangeX/2),b.rangeX/2),c.pos.y+b.offsetY+pc.Math.rand(-(b.rangeY/2),b.rangeY/2),pc.Math.rotate(b.relativeAngle?c.dir:0,pc.Math.rand(b.angleMin,b.angleMax)),pc.Math.randFloat(b.thrustMin,b.thrustMax),pc.Math.randFloat(b.lifeMin,b.lifeMax),pc.Math.randFloat(b.spinMin,b.spinMax),pc.Math.randFloat(b.growXMin,b.growXMax),pc.Math.randFloat(b.growYMin,b.growYMax),pc.Math.randFloat(b.scaleXMin,b.scaleXMax),pc.Math.randFloat(b.scaleYMin,b.scaleYMax),b.fadeInTime,b.fadeOutTime,b.alphaMin,b.alphaMax,b.spriteSheet,b.compositeOperation,e))}b._lastEmitTime=Date.now(),b._shotCount++}for(var f=b._particles.first;f;){var g=f.obj;pc.device.now-g.start>b.thrustTime&&(g.thrust=0);var h=g.thrust*Math.cos(pc.Math.degToRad(g.dir)),i=g.thrust*Math.sin(pc.Math.degToRad(g.dir));if(g.velX+=h*(pc.device.elapsed/1e3)+b.gravityX,g.velY+=i*(pc.device.elapsed/1e3)+b.gravityY,g.velX=pc.Math.limit(g.velX,-b.maxVelX,b.maxVelX),g.velY=pc.Math.limit(g.velY,-b.maxVelY,b.maxVelY),g.x+=g.velX,g.y+=g.velY,g.spin&&(g.rotation=pc.Math.rotate(g.rotation,g.spin*(pc.device.elapsed/1e3))),(0!=g.growXRate||0!=g.growYRate)&&(g.scaleX+=g.growXRate*(pc.device.elapsed/1e3),g.scaleY+=g.growYRate*(pc.device.elapsed/1e3)),0==g.fadeState&&(g.sprite.addAlpha(pc.device.elapsed*(100/g.fadeInTime)/100),pc.device.now-g.fadeStateStart>g.fadeInTime&&(g.fadeState++,g.fadeStateStart=pc.device.now)),1==g.fadeState&&pc.device.now-g.fadeStateStart>g.holdTime&&(g.fadeState++,g.fadeStateStart=pc.device.now),2==g.fadeState&&g.fadeOutTime>0){var j=pc.device.elapsed*(100/g.fadeOutTime)/100;g.sprite.subAlpha(j)}(1!=g.alphaMin||1!=g.alphaMax)&&pc.device.now-g.lastAlpha>b.alphaDelay&&(g.sprite.setAlpha(pc.Math.rand(g.alphaMin,g.alphaMax)),g.lastAlpha=pc.device.now),this.drawStartTime=Date.now(),(1!=g.scaleX||1!=g.scaleY)&&b.spriteSheet.setScale(g.scaleX,g.scaleY),g.sprite.currentAnim?(g.sprite.draw(pc.device.ctx,g.x-a.layer.origin.x-a.layer.scene.viewPort.x,g.y-a.layer.origin.y-a.layer.scene.viewPort.y,g.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime,g.sprite.update(pc.device.elapsed)):(g.sprite.drawFrame(pc.device.ctx,g.frame%b.spriteSheet.framesWide,Math.floor(g.frame/b.spriteSheet.framesWide),g.x-a.layer.origin.x-a.layer.scene.viewPort.x,g.y-a.layer.origin.y-a.layer.scene.viewPort.y,b.rotateSprite?g.rotation:g.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime),(1!=g.scaleX||1!=g.scaleY)&&b.spriteSheet.setScale(1,1),f=f.next(),pc.device.now-g.start>g.lifetime&&(g.release(),b._particles.remove(g))}0!=b.shots&&null==b._particles.first&&b._shotCount>=b.shots&&(b.active=!1)}}}}}),pc._Particle=pc.Pooled.extend("pc._Particle",{create:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this._super();return r.x=a,r.y=b,r.dir=c,r.thrust=d,r.frame=q,r.lifetime=e,r.spin=f,r.growXRate=g,r.growYRate=h,r.scaleX=i,r.scaleY=j,null==r.sprite?r.sprite=pc.Sprite.create(o):r.sprite.setSpriteSheet(o),r.start=pc.device.now,r.fadeStart=0,r.velX=0,r.velY=0,r.rotation=0,r.alphaMin=m,r.alphaMax=n,r.lastAlpha=pc.device.now,r.fadeInTime=k,r.fadeOutTime=l,r.holdTime=r.lifetime-(r.fadeInTime+r.fadeOutTime),p?r.sprite.setCompositeOperation(p):r.sprite.setCompositeOperation("source-over"),r.fadeState=1,r.fadeStateStart=pc.device.now,r.fadeInTime>0?(r.fadeState=0,r.sprite.setAlpha(0)):r.sprite.setAlpha(1),r}},{x:0,y:0,dir:0,rotation:0,thrust:0,sprite:null,start:0,frame:0,fadeStart:0,velX:0,velY:0,spin:0,growXRate:0,growYRate:0,scaleX:1,scaleY:1,fadeInTime:0,fadeOutTime:0,fadeStateStart:0,holdTime:0,fadeState:1,alphaMin:1,alphaMax:1,lastAlpha:0}),define("playcraft/systems/particles",function(){}),pc.systems.Input=pc.systems.EntitySystem.extend("pc.systems.Input",{},{init:function(){this._super(["input"])},process:function(a){var b=a.getComponent("input");if(b.active&&!b._bound){var c=a.getComponent("spatial"),d=a;if(b.target&&(d=b.target),b.states)for(var e=0;e<b.states.length;e++)for(var f=b.states[e][1],g=0;g<f.length;g++){var h=c;pc.valid(b.states[e][2])&&0==b.states[e][2]&&(h=null),pc.device.input.bindState(d,b.states[e][0],f[g],h)}if(b.actions)for(d=this,e=0;e<b.actions.length;e++)for(f=b.actions[e][1],g=0;g<f.length;g++)h=c,pc.valid(b.actions[e][2])&&0==b.actions[e][2]&&(h=null),pc.device.input.bindAction(d,b.actions[e][0],f[g],h);b._bound=!0}},onAction:function(){},isInputState:function(a,b){return a.getComponent("input")._bound?pc.device.input.isInputState(a,b):!1}}),define("playcraft/systems/input",function(){}),pc.systems.Expiration=pc.systems.EntitySystem.extend("pc.systems.Expiration",{},{init:function(){this._super(["expiry"])},process:function(a){var b=a.getComponent("expiry");b.active&&(b.decrease(pc.device.elapsed),b.hasExpired()&&a.remove())}}),define("playcraft/systems/expiry",function(){}),pc.systems.Activation=pc.systems.EntitySystem.extend("pc.systems.Activation",{},{init:function(a){this._super(["activator"],a)},onEntityAdded:function(a){a.active=!1},process:function(a){var b=a.getComponent("activator");if(b.active&&(!a.active||!b.stayActive)){b._cacheLayer||(b._cacheLayer=b.layer?a.layer.scene.get(b.layer):a.layer);var c=b._cacheLayer.getEntityManager().getTagged(b.tag);if(c)for(var d=c.first;d;){var e=a.getComponent("spatial"),f=d.object().getComponent("spatial"),g=e.getCenterPos().distance(f.getCenterPos());a.active?g>=b.range&&(a.active=!1):g<b.range&&(a.active=!0),d=d.next()}}}}),define("playcraft/systems/activation",function(){}),pc.systems.Render=pc.systems.EntitySystem.extend("pc.systems.Render",{},{init:function(){this._super(["sprite","overlay","rect","text","poly","circle"])},processAll:function(){for(var a=Date.now(),b=this.entities.first;b;){var c=b.obj;if(c.active){var d=c.getComponent("spatial"),e=c.getComponent("alpha"),f=c.getComponent("clip"),g=c.layer.screenX(d.pos.x),h=c.layer.screenY(d.pos.y),i=d.getUnscaledPos(),j=d.getUnscaledDim(),k=pc.device.ctx;if(k.save(),(1!=d.scaleX||1!=d.scaleY)&&(g=c.layer.screenX(i.x),h=c.layer.screenY(i.y),k.scale(d.scaleX,d.scaleY)),c.layer.scene.viewPort.overlaps(g,h,d.dim.x,d.dim.y,0,d.dir)){if(f&&f.active){if(k.beginPath(),f.clipEntity){var l=f.clipEntity.getComponent("spatial");k.rect(c.layer.screenX(l.pos.x)+f.x,c.layer.screenY(l.pos.y)+f.y,l.dim.x+f.w,l.dim.y+f.h)}else k.rect(c.layer.screenX(d.pos.x)+f.x,c.layer.screenY(d.pos.y)+f.y,f.w,f.h);k.closePath(),k.clip()}var m=c.getComponent("originshifter");if(m&&m.active){var n=d.pos.x-m._offsetX,o=d.pos.y-m._offsetY;m._offsetX=this.layer.origin.x*m.ratio,m._offsetY=this.layer.origin.y*m.ratio,d.pos.x=n+m._offsetX,d.pos.y=o+m._offsetY}var p=c.getComponent("sprite");p&&p.active&&(p.sprite.update(pc.device.elapsed),e&&1!=e.level&&0!=e.level&&(p.sprite.alpha=e.level),(1!=d.scaleX||1!=d.scaleY)&&p.sprite.setScale(d.scaleX,d.scaleY),p.sprite.draw(k,g+p.offset.x,h+p.offset.y,d.dir),(1!=d.scaleX||1!=d.scaleY)&&p.sprite.setScale(1,1));var q=c.getComponent("overlay");q&&q.active&&(q.sprite.update(pc.device.elapsed),e&&(q.sprite.alpha=e.level),q.sprite.draw(k,g,h,d.dir),q.decrease(pc.device.elapsed),q.hasExpired()&&c.removeComponent(q));var r=b.obj.getComponent("rect");r&&r.active&&(k.save(),e&&(k.globalAlpha=e.level),k.translate(g+j.x/2,h+j.y/2),k.rotate(d.dir*(Math.PI/180)),r.cornerRadius>0?(-j.x/2,-j.y/2,k.beginPath(),k.moveTo(-j.x/2+r.cornerRadius,-j.y),k.lineTo(g+j.x-r.cornerRadius,h),k.quadraticCurveTo(g+j.x,h,g+j.x,h+r.cornerRadius),k.lineTo(g+j.x,h+j.y-r.cornerRadius),k.quadraticCurveTo(g+j.x,h+j.y,g+j.x-r.cornerRadius,h+j.y),k.lineTo(g+r.cornerRadius,h+j.y),k.quadraticCurveTo(g,h+j.y,g,h+j.y-r.cornerRadius),k.lineTo(g,h+r.cornerRadius),k.quadraticCurveTo(g,h,g+r.cornerRadius,h),k.closePath(),r.color&&(k.fillStyle=r.color.color,k.fill()),r.lineColor&&r.lineWidth&&(k.lineWidth=r.lineWidth,k.strokeStyle=r.lineColor.color,k.stroke())):(r.color&&(k.fillStyle=r.color.color,k.fillRect(-j.x/2,-j.y/2,j.x,j.y)),r.lineColor&&r.lineWidth&&(k.lineWidth=r.lineWidth,k.strokeStyle=r.lineColor.color,k.strokeRect(-j.x/2,-j.y/2,j.x,j.y))),e&&(k.globalAlpha=1),k.restore(),pc.device.elementsDrawn++);var s=b.obj.getComponent("circle");s&&s.active&&(k.save(),k.lineWidth=s.lineWidth,e&&(k.globalAlpha=e.level),k.translate(g+d.dim.x/2,h+d.dim.y/2),k.rotate(d.dir*(Math.PI/180)),k.beginPath(),k.arc(0,0,d.dim.x/2,0,2*pc.Math.PI,!0),k.closePath(),s.color&&(k.fillStyle=s.color.color,k.fill()),s.lineColor&&(k.lineWidth=s.lineWidth,k.strokeStyle=s.lineColor.color,k.stroke()),e&&(k.globalAlpha=1),k.restore(),pc.device.elementsDrawn++);var t=b.obj.getComponent("poly");if(t&&t.active){k.save(),e&&(k.globalAlpha=e.level);var u=d.dim.x/2,v=d.dim.y/2;k.translate(g+u,h+v),k.rotate(d.dir*(Math.PI/180)),k.beginPath(),k.moveTo(t.points[0][0]-u,t.points[0][1]-v);for(var w=1;w<t.points.length;w++)k.lineTo(t.points[w][0]-u,t.points[w][1]-v);k.closePath(),t.color&&(k.fillStyle=t.color.color,k.fill()),t.lineColor&&(k.lineWidth=t.lineWidth,k.strokeStyle=t.lineColor.color,k.stroke()),e&&(k.globalAlpha=1),k.restore(),pc.device.elementsDrawn++}var x=c.getComponent("text");if(x&&x.active){k.save();var y=0;e&&(k.globalAlpha=e.level),u=d.dim.x/2,v=d.dim.y/2,k.font=x._fontCache,k.lineWidth=x.lineWidth,k.translate(g+u,h+v),k.rotate(d.dir*(Math.PI/180));for(var z=0;z<x.text.length;z++)x.color&&(k.fillStyle=x.color.color,k.fillText(x.text[z],x.offset.x-u,y+d.dim.y+x.offset.y-v)),x.strokeColor&&x.lineWidth&&(k.strokeStyle=x.strokeColor.color,k.strokeText(x.text[z],x.offset.x-u,y+d.dim.y+x.offset.y-v)),y+=1.1*x.fontHeight;e&&(k.globalAlpha=1),pc.device.elementsDrawn++,k.restore()}k.restore()}}b=b.next()}pc.device.lastDrawMS+=Date.now()-a}}),define("playcraft/systems/render",function(){}),pc.systems.Layout=pc.systems.EntitySystem.extend("pc.systems.Layout",{},{margin:null,init:function(a){this._super(["layout"]),this.margin={},pc.checked(a)&&pc.checked(a.margin)?(this.margin.left=pc.checked(a.margin.left,0),this.margin.right=pc.checked(a.margin.right,0),this.margin.top=pc.checked(a.margin.top,0),this.margin.bottom=pc.checked(a.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0)},_getAnchorLocation:function(a,b){if("left"===a){if("top"===b)return"top-left";if("middle"===b)return"middle-left";if("bottom"===b)return"bottom-left"}if("center"===a){if("top"===b)return"top-center";if("middle"===b)return"middle-center";if("bottom"===b)return"bottom-center"}if("right"===a){if("top"===b)return"top-right";if("middle"===b)return"middle-right";if("bottom"===b)return"bottom-right"}return null},doLayout:function(){for(var a=new pc.HashList,b=this.entities.first;b;){var c=b.obj,d=c.getComponent("spatial");d||c.addComponent(pc.components.Spatial({}));var e=c.getComponent("layout"),f=this._getAnchorLocation(e.horizontal,e.vertical);a.add(f,b.obj),b=b.next()}for(var g=a.hashtable.keys(),h=0;h<g.length;h++){var i=g[h],j=a.get(g[h]),k=this._getEntityDimensions(j),l=this.margin.left,m=this.margin.top;switch(i){case"top-left":break;case"middle-left":m+=this.layer.getScreenRect().h/2-k.y/2;break;case"bottom-left":m=this.layer.getScreenRect().h-k.y-this.margin.bottom;break;case"top-center":l+=this.layer.getScreenRect().w/2-k.x/2;break;case"middle-center":l+=this.layer.getScreenRect().w/2-k.x/2,m+=this.layer.getScreenRect().h/2-k.y/2;break;case"bottom-center":l=this.layer.getScreenRect().w/2-k.x/2-this.margin.bottom,m+=this.layer.getScreenRect().h-k.y;break;case"top-right":l+=this.layer.getScreenRect().w-k.x;break;case"middle-right":l+=this.layer.getScreenRect().w-k.x,m+=this.layer.getScreenRect().h/2-k.y/2;break;case"bottom-right":l+=this.layer.getScreenRect().w-k.x,m=this.layer.getScreenRect().h-k.y-this.margin.bottom}for(var n=j.first;n;){switch(c=n.obj,d=c.getComponent("spatial"),e=c.getComponent("layout"),m+=e.margin.top,i){case"top-left":case"middle-left":case"bottom-left":l=e.margin.left+this.margin.left;break;case"top-center":case"middle-center":case"bottom-center":l=e.margin.left+this.layer.getScreenRect().w/2-d.dim.x/2;break;case"top-right":case"middle-right":case"bottom-right":l=this.layer.getScreenRect().w-d.dim.x-e.margin.right-this.margin.right}d.pos.x=l,d.pos.y=m,m+=d.dim.y+e.margin.bottom,n=n.next()}}},_entityDim:null,_getEntityDimensions:function(a){this._entityDim||(this._entityDim=new pc.Dim),this._entityDim.x=0,this._entityDim.y=0;for(var b=a.first;b;){var c=b.obj.getComponent("spatial"),d=b.obj.getComponent("layout");c&&(this._entityDim.x+=d.margin.left+c.dim.x+d.margin.right,this._entityDim.y+=d.margin.top+c.dim.y+d.margin.bottom),b=b.nextLinked}return this._entityDim},onResize:function(){this.doLayout()},onEntityAdded:function(){this._super(),this.doLayout()},onEntityRemoved:function(){this._super(),this.doLayout()},onComponentAdded:function(){this._super(),this.doLayout()}}),define("playcraft/systems/layout",function(){}),window.pc||(window.pc={},pc.VERSION="0.5.6"),define("pc",["playcraft/ext/gamecore.js/src/gamecore","playcraft/ext/gamecore.js/src/class","playcraft/ext/gamecore.js/src/base","playcraft/ext/gamecore.js/src/jhashtable","playcraft/ext/gamecore.js/src/device","playcraft/ext/gamecore.js/src/perf","playcraft/ext/gamecore.js/src/linkedlist","playcraft/ext/gamecore.js/src/hashlist","playcraft/ext/gamecore.js/src/stacktrace","playcraft/ext/gamecore.js/src/pooled","playcraft/ext/box2dweb.2.1a-pc","playcraft/boot","playcraft/input","playcraft/hashmap","playcraft/tools","playcraft/color","playcraft/debug","playcraft/device","playcraft/sound","playcraft/layer","playcraft/entitylayer","playcraft/tileset","playcraft/tilemap","playcraft/tilelayer","playcraft/hextilelayer","playcraft/entity","playcraft/sprite","playcraft/spritesheet","playcraft/math","playcraft/image","playcraft/scene","playcraft/game","playcraft/loader","playcraft/dataresource","playcraft/components/component","playcraft/components/physics","playcraft/components/alpha","playcraft/components/joint","playcraft/components/expiry","playcraft/components/originshifter","playcraft/components/spatial","playcraft/components/overlay","playcraft/components/clip","playcraft/components/activator","playcraft/components/input","playcraft/components/fade","playcraft/components/spin","playcraft/components/scale","playcraft/components/rect","playcraft/components/poly","playcraft/components/circle","playcraft/components/text","playcraft/components/sprite","playcraft/components/layout","playcraft/components/particleemitter","playcraft/systems/system","playcraft/es/entitymanager","playcraft/es/systemmanager","playcraft/systems/entitysystem","playcraft/systems/physics","playcraft/systems/effects","playcraft/systems/particles","playcraft/systems/input","playcraft/systems/expiry","playcraft/systems/activation","playcraft/systems/render","playcraft/systems/layout"],function(){return window.pc}),function(a){function b(a,b,c){for(var d=(c||0)-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function c(a,c){var d=typeof c;if(a=a.cache,"boolean"==d||null==c)return a[c];"number"!=d&&"string"!=d&&(d="object");var e="number"==d?c:w+c;return a=a[d]||(a[d]={}),"object"==d?a[e]&&b(a[e],c)>-1?0:-1:a[e]?0:-1}function d(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:w+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a)==this.array.length&&(b[c]=!1):e[d]=!0}}function e(a){return a.charCodeAt(0)}function f(a,b){var c=a.index,d=b.index;if(a=a.criteria,b=b.criteria,a!==b){if(a>b||"undefined"==typeof a)return 1;if(b>a||"undefined"==typeof b)return-1}return d>c?-1:1}function g(a){var b=-1,c=a.length,e=j();e["false"]=e["null"]=e["true"]=e.undefined=!1;var f=j();for(f.array=a,f.cache=e,f.push=d;++b<c;)f.push(a[b]);return e.object===!1?(o(f),null):f}function h(a){return"\\"+_[a]}function i(){return s.pop()||[]}function j(){return t.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,undefined:!1,useHas:!1,useKeys:!1,value:null}}function l(a){return"function"!=typeof a.toString&&"string"==typeof(a+"")}function m(){}function n(a){a.length=0,s.length<y&&s.push(a)}function o(a){var b=a.cache;b&&o(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,t.length<y&&t.push(a)}function p(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function q(d){function s(a){return a&&"object"==typeof a&&!Pd(a)&&pd.call(a,"__wrapped__")?a:new t(a)}function t(a){this.__wrapped__=a}function y(a,b,c,d){function e(){var d=arguments,j=g?this:b;if(f||(a=b[h]),c.length&&(d=d.length?(d=Fd.call(d),i?d.concat(c):c.concat(d)):c),this instanceof e){j=ab(a.prototype);var k=a.apply(j,d);return wb(k)?k:j}return a.apply(j,d)}var f=vb(a),g=!c,h=b;if(g){var i=d;c=b}else if(!f){if(!d)throw new cd;b=a}return e}function _(){var a=j();a.shadowedProps=N,a.array=a.bottom=a.loop=a.top="",a.init="iterable",a.useHas=!0,a.useKeys=!!Rd;for(var b,c=0;b=arguments[c];c++)for(var d in b)a[d]=b[d];var e=a.args;a.firstArg=/^[^,]+/.exec(e)[0];var f=Yc("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+e+") {\n"+Ld(a)+"\n}");return o(a),f(T,ed,pd,ib,Pd,Bb,Rd,s,fd,$,Jd,Y,gd,ud)}function ab(a){return wb(a)?wd(a):{}}function cb(a){return Td[a]}function eb(){var a=(a=s.indexOf)===fc?b:a;return a}function fb(a){return function(b,c,d,e){return"boolean"!=typeof c&&null!=c&&(e=d,d=e&&e[c]===b?r:c,c=!1),null!=d&&(d=s.createCallback(d,e)),a(b,c,d,e)}}function gb(a){var b,c;return!a||ud.call(a)!=W||(b=a.constructor,vb(b)&&!(b instanceof b))||!Kd.argsClass&&ib(a)||!Kd.nodeClass&&l(a)?!1:Kd.ownLast?(Xd(a,function(a,b,d){return c=pd.call(d,b),!1}),c!==!1):(Xd(a,function(a,b){c=b}),c===r||pd.call(a,c))}function hb(a){return Ud[a]}function ib(a){return ud.call(a)==P}function jb(a,b,c,d,e,f){var g=a;if("boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),"function"==typeof c){if(c="undefined"==typeof d?c:s.createCallback(c,d,1),g=c(g),"undefined"!=typeof g)return g;g=a}var h=wb(g);if(h){var j=ud.call(g);if(!Z[j]||!Kd.nodeClass&&l(g))return g;var k=Pd(g)}if(!h||!b)return h?k?p(g):Vd({},g):g;var m=Id[j];switch(j){case R:case S:return new m(+g);case V:case Y:return new m(g);case X:return m(g.source,E.exec(g))}var o=!e;e||(e=i()),f||(f=i());for(var q=e.length;q--;)if(e[q]==a)return f[q];return g=k?m(g.length):{},k&&(pd.call(a,"index")&&(g.index=a.index),pd.call(a,"input")&&(g.input=a.input)),e.push(a),f.push(g),(k?Sd:Yd)(a,function(a,d){g[d]=jb(a,b,c,r,e,f)}),o&&(n(e),n(f)),g}function kb(a,b,c){return jb(a,!0,b,c)}function lb(a,b,c){var d;return b=s.createCallback(b,c),Yd(a,function(a,c,e){return b(a,c,e)?(d=c,!1):void 0}),d}function mb(a){var b=[];return Xd(a,function(a,c){vb(a)&&b.push(c)}),b.sort()}function nb(a,b){return a?pd.call(a,b):!1}function ob(a){for(var b=-1,c=Rd(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function pb(a){return a===!0||a===!1||ud.call(a)==R}function qb(a){return a?"object"==typeof a&&ud.call(a)==S:!1}function rb(a){return a?1===a.nodeType:!1}function sb(a){var b=!0;if(!a)return b;var c=ud.call(a),d=a.length;return c==Q||c==Y||(Kd.argsClass?c==P:ib(a))||c==W&&"number"==typeof d&&vb(a.splice)?!d:(Yd(a,function(){return b=!1}),b)}function tb(a,b,c,d,e,f){var g=c===v;if("function"==typeof c&&!g){c=s.createCallback(c,d,2);var h=c(a,b);if("undefined"!=typeof h)return!!h}if(a===b)return 0!==a||1/a==1/b;var j=typeof a,k=typeof b;if(a===a&&(!a||"function"!=j&&"object"!=j)&&(!b||"function"!=k&&"object"!=k))return!1;if(null==a||null==b)return a===b;var m=ud.call(a),o=ud.call(b);if(m==P&&(m=W),o==P&&(o=W),m!=o)return!1;switch(m){case R:case S:return+a==+b;case V:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case X:case Y:return a==bd(b)}var p=m==Q;if(!p){if(pd.call(a,"__wrapped__ ")||pd.call(b,"__wrapped__"))return tb(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(m!=W||!Kd.nodeClass&&(l(a)||l(b)))return!1;var q=!Kd.argsObject&&ib(a)?_c:a.constructor,r=!Kd.argsObject&&ib(b)?_c:b.constructor;if(q!=r&&!(vb(q)&&q instanceof q&&vb(r)&&r instanceof r))return!1}var t=!e;e||(e=i()),f||(f=i());for(var u=e.length;u--;)if(e[u]==a)return f[u]==b;var w=0;if(h=!0,e.push(a),f.push(b),p){if(u=a.length,w=b.length,h=w==a.length,!h&&!g)return h;for(;w--;){var x=u,y=b[w];if(g)for(;x--&&!(h=tb(a[x],y,c,d,e,f)););else if(!(h=tb(a[w],y,c,d,e,f)))break}return h}return Xd(b,function(b,g,i){return pd.call(i,g)?(w++,h=pd.call(a,g)&&tb(a[g],b,c,d,e,f)):void 0}),h&&!g&&Xd(a,function(a,b,c){return pd.call(c,b)?h=--w>-1:void 0}),t&&(n(e),n(f)),h}function ub(a){return yd(a)&&!zd(parseFloat(a))}function vb(a){return"function"==typeof a}function wb(a){return!(!a||!$[typeof a])}function xb(a){return zb(a)&&a!=+a}function yb(a){return null===a}function zb(a){return"number"==typeof a||ud.call(a)==V}function Ab(a){return!(!a||!$[typeof a])&&ud.call(a)==X}function Bb(a){return"string"==typeof a||ud.call(a)==Y}function Cb(a){return"undefined"==typeof a}function Db(a,b,c){var d=arguments,e=0,f=2;if(!wb(a))return a;if(c===v)var g=d[3],h=d[4],j=d[5];else{var k=!0;h=i(),j=i(),"number"!=typeof c&&(f=d.length),f>3&&"function"==typeof d[f-2]?g=s.createCallback(d[--f-1],d[f--],2):f>2&&"function"==typeof d[f-1]&&(g=d[--f])}for(;++e<f;)(Pd(d[e])?Pb:Yd)(d[e],function(b,c){var d,e,f=b,i=a[c];if(b&&((e=Pd(b))||Zd(b))){for(var k=h.length;k--;)if(d=h[k]==b){i=j[k];break}if(!d){var l;g&&(f=g(i,b),(l="undefined"!=typeof f)&&(i=f)),l||(i=e?Pd(i)?i:[]:Zd(i)?i:{}),h.push(b),j.push(i),l||(i=Db(i,b,v,g,h,j))}}else g&&(f=g(i,b),"undefined"==typeof f&&(f=b)),"undefined"!=typeof f&&(i=f);a[c]=i});return k&&(n(h),n(j)),a}function Eb(a,b,c){var d=eb(),e="function"==typeof b,f={};if(e)b=s.createCallback(b,c);else var g=ld.apply(dd,Fd.call(arguments,1));return Xd(a,function(a,c,h){(e?!b(a,c,h):d(g,c)<0)&&(f[c]=a)}),f}function Fb(a){for(var b=-1,c=Rd(a),d=c.length,e=Uc(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Gb(a,b,c){var d={};if("function"!=typeof b)for(var e=-1,f=ld.apply(dd,Fd.call(arguments,1)),g=wb(a)?f.length:0;++e<g;){var h=f[e];h in a&&(d[h]=a[h])}else b=s.createCallback(b,c),Xd(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function Hb(a,b,c,d){var e=Pd(a);if(b=s.createCallback(b,d,4),null==c)if(e)c=[];else{var f=a&&a.constructor,g=f&&f.prototype;c=ab(g)}return(e?Sd:Yd)(a,function(a,d,e){return b(c,a,d,e)}),c}function Ib(a){for(var b=-1,c=Rd(a),d=c.length,e=Uc(d);++b<d;)e[b]=a[c[b]];return e}function Jb(a){var b=-1,c=ld.apply(dd,Fd.call(arguments,1)),d=c.length,e=Uc(d);for(Kd.unindexedChars&&Bb(a)&&(a=a.split(""));++b<d;)e[b]=a[c[b]];return e}function Kb(a,b,c){var d=-1,e=eb(),f=a?a.length:0,g=!1;return c=(0>c?Bd(0,f+c):c)||0,f&&"number"==typeof f?g=(Bb(a)?a.indexOf(b,c):e(a,b,c))>-1:Sd(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Lb(a,b,c){var d={};return b=s.createCallback(b,c),Pb(a,function(a,c,e){c=bd(b(a,c,e)),pd.call(d,c)?d[c]++:d[c]=1}),d}function Mb(a,b,c){var d=!0;if(b=s.createCallback(b,c),Pd(a))for(var e=-1,f=a.length;++e<f&&(d=!!b(a[e],e,a)););else Sd(a,function(a,c,e){return d=!!b(a,c,e)});return d}function Nb(a,b,c){var d=[];if(b=s.createCallback(b,c),Pd(a))for(var e=-1,f=a.length;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else Sd(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function Ob(a,b,c){if(b=s.createCallback(b,c),!Pd(a)){var d;return Sd(a,function(a,c,e){return b(a,c,e)?(d=a,!1):void 0}),d}for(var e=-1,f=a.length;++e<f;){var g=a[e];if(b(g,e,a))return g}}function Pb(a,b,c){if(b&&"undefined"==typeof c&&Pd(a))for(var d=-1,e=a.length;++d<e&&b(a[d],d,a)!==!1;);else Sd(a,b,c);return a}function Qb(a,b,c){var d={};return b=s.createCallback(b,c),Pb(a,function(a,c,e){c=bd(b(a,c,e)),(pd.call(d,c)?d[c]:d[c]=[]).push(a)}),d}function Rb(a,b){var c=Fd.call(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=Uc("number"==typeof f?f:0);return Pb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function Sb(a,b,c){var d=-1,e=a?a.length:0,f=Uc("number"==typeof e?e:0);if(b=s.createCallback(b,c),Pd(a))for(;++d<e;)f[d]=b(a[d],d,a);else Sd(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function Tb(a,b,c){var d=-1/0,f=d;if(!b&&Pd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];i>f&&(f=i)}else b=!b&&Bb(a)?e:s.createCallback(b,c),Sd(a,function(a,c,e){var g=b(a,c,e);g>d&&(d=g,f=a)});return f}function Ub(a,b,c){var d=1/0,f=d;if(!b&&Pd(a))for(var g=-1,h=a.length;++g<h;){var i=a[g];f>i&&(f=i)}else b=!b&&Bb(a)?e:s.createCallback(b,c),Sd(a,function(a,c,e){var g=b(a,c,e);d>g&&(d=g,f=a)});return f}function Vb(a,b,c,d){var e=arguments.length<3;if(b=s.createCallback(b,d,4),Pd(a)){var f=-1,g=a.length;for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a)}else Sd(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function Wb(a,b,c,d){var e=a,f=a?a.length:0,g=arguments.length<3;if("number"!=typeof f){var h=Rd(a);f=h.length}else Kd.unindexedChars&&Bb(a)&&(e=a.split(""));return b=s.createCallback(b,d,4),Pb(a,function(a,d,i){d=h?h[--f]:--f,c=g?(g=!1,e[d]):b(c,e[d],d,i)}),c}function Xb(a,b,c){return b=s.createCallback(b,c),Nb(a,function(a,c,d){return!b(a,c,d)})}function Yb(a){var b=-1,c=a?a.length:0,d=Uc("number"==typeof c?c:0);return Pb(a,function(a){var c=md(Ed()*(++b+1));d[b]=d[c],d[c]=a}),d}function Zb(a){var b=a?a.length:0;return"number"==typeof b?b:Rd(a).length}function $b(a,b,c){var d;if(b=s.createCallback(b,c),Pd(a))for(var e=-1,f=a.length;++e<f&&!(d=b(a[e],e,a)););else Sd(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function _b(a,b,c){var d=-1,e=a?a.length:0,g=Uc("number"==typeof e?e:0);for(b=s.createCallback(b,c),Pb(a,function(a,c,e){var f=g[++d]=j();f.criteria=b(a,c,e),f.index=d,f.value=a}),e=g.length,g.sort(f);e--;){var h=g[e];g[e]=h.value,o(h)}return g}function ac(a){return a&&"number"==typeof a.length?Kd.unindexedChars&&Bb(a)?a.split(""):p(a):Ib(a)}function bc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function cc(a){var d=-1,e=eb(),f=a?a.length:0,h=ld.apply(dd,Fd.call(arguments,1)),i=[],j=f>=x&&e===b;if(j){var k=g(h);k?(e=c,h=k):j=!1}for(;++d<f;){var l=a[d];e(h,l)<0&&i.push(l)}return j&&o(h),i}function dc(a,b,c){var d=-1,e=a?a.length:0;for(b=s.createCallback(b,c);++d<e;)if(b(a[d],d,a))return d;return-1}function ec(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=-1;for(b=s.createCallback(b,c);++f<e&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[0];return p(a,0,Cd(Bd(0,d),e))}}function fc(a,c,d){if("number"==typeof d){var e=a?a.length:0;d=0>d?Bd(0,e+d):d||0}else if(d){var f=mc(a,c);return a[f]===c?f:-1}return a?b(a,c,d):-1}function gc(a,b,c){if(!a)return[];var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=s.createCallback(b,c);f--&&b(a[f],f,a);)d++}else d=null==b||c?1:b||d;return p(a,0,Cd(Bd(0,e-d),e))}function hc(a){for(var d=arguments,e=d.length,f=-1,h=i(),j=-1,k=eb(),l=a?a.length:0,m=[],p=i();++f<e;){var q=d[f];h[f]=k===b&&(q?q.length:0)>=x&&g(f?d[f]:p)}a:for(;++j<l;){var r=h[0];if(q=a[j],(r?c(r,q):k(p,q))<0){for(f=e,(r||p).push(q);--f;)if(r=h[f],(r?c(r,q):k(d[f],q))<0)continue a;m.push(q)}}for(;e--;)r=h[e],r&&o(r);return n(h),n(p),m}function ic(a,b,c){if(a){var d=0,e=a.length;if("number"!=typeof b&&null!=b){var f=e;for(b=s.createCallback(b,c);f--&&b(a[f],f,a);)d++}else if(d=b,null==d||c)return a[e-1];return p(a,Bd(0,e-d))}}function jc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Bd(0,d+c):Cd(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function kc(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Bd(0,jd((b-a)/c)),f=Uc(e);++d<e;)f[d]=a,a+=c;return f}function lc(a,b,c){if("number"!=typeof b&&null!=b){var d=0,e=-1,f=a?a.length:0;for(b=s.createCallback(b,c);++e<f&&b(a[e],e,a);)d++}else d=null==b||c?1:Bd(0,b);return p(a,d)}function mc(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?s.createCallback(c,d,1):Ic,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function nc(a){return Pd(a)||(arguments[0]=a?Fd.call(a):dd),be(ld.apply(dd,arguments))}function oc(a){for(var b=-1,c=a?Tb($d(a,"length")):0,d=Uc(0>c?0:c);++b<c;)d[b]=$d(a,b);return d}function pc(a){return cc(a,Fd.call(arguments,1))}function qc(a){return a?oc(arguments):[]}function rc(a,b){for(var c=-1,d=a?a.length:0,e={};++c<d;){var f=a[c];b?e[f]=b[c]:e[f[0]]=f[1]}return e}function sc(a,b){return 1>a?b():function(){return--a<1?b.apply(this,arguments):void 0}}function tc(a,b){return Kd.fastBind||vd&&arguments.length>2?vd.call.apply(vd,arguments):y(a,b,Fd.call(arguments,2))}function uc(a){for(var b=arguments.length>1?ld.apply(dd,Fd.call(arguments,1)):mb(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=tc(a[e],a)}return a}function vc(a,b){return y(a,b,Fd.call(arguments,2),v)}function wc(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function xc(a,b,c){if(null==a)return Ic;var d=typeof a;if("function"!=d){if("object"!=d)return function(b){return b[a]};var e=Rd(a);return function(b){for(var c=e.length,d=!1;c--&&(d=tb(b[e[c]],a[e[c]],v)););return d}}return"undefined"==typeof b||G&&!G.test(nd.call(a))?a:1===c?function(c){return a.call(b,c)}:2===c?function(c,d){return a.call(b,c,d)}:4===c?function(c,d,e,f){return a.call(b,c,d,e,f)}:function(c,d,e){return a.call(b,c,d,e)}}function yc(a,b,c){function d(){kd(m),kd(n),j=0,m=n=null}function e(){var b=o&&(!p||j>1);d(),b&&(l!==!1&&(k=new Wc),h=a.apply(i,g))}function f(){d(),(o||l!==b)&&(k=new Wc,h=a.apply(i,g))}var g,h,i,j=0,k=0,l=!1,m=null,n=null,o=!0;if(b=Bd(0,b||0),c===!0){var p=!0;o=!1}else wb(c)&&(p=c.leading,l="maxWait"in c&&Bd(b,c.maxWait||0),o="trailing"in c?c.trailing:o);return function(){if(g=arguments,i=this,j++,kd(n),l===!1)p&&2>j&&(h=a.apply(i,g));else{var c=new Wc;m||p||(k=c);var d=l-(c-k);0>=d?(kd(m),m=null,k=c,h=a.apply(i,g)):m||(m=td(f,d))}return b!==l&&(n=td(e,b)),h}}function zc(a){var b=Fd.call(arguments,1);return td(function(){a.apply(r,b)},1)}function Ac(a,b){var c=Fd.call(arguments,2);return td(function(){a.apply(r,c)},b)}function Bc(a,b){function c(){var d=c.cache,e=w+(b?b.apply(this,arguments):arguments[0]);return pd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)}return c.cache={},c}function Cc(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Dc(a){return y(a,Fd.call(arguments,1))}function Ec(a){return y(a,Fd.call(arguments,1),null,v)}function Fc(a,b,c){var d=!0,e=!0;c===!1?d=!1:wb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c=j(),c.leading=d,c.maxWait=b,c.trailing=e;var f=yc(a,b,c);return o(c),f}function Gc(a,b){return function(){var c=[a];return qd.apply(c,arguments),b.apply(this,c)}}function Hc(a){return null==a?"":bd(a).replace(K,cb)}function Ic(a){return a}function Jc(a){Pb(mb(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=this.__wrapped__,b=[a];qd.apply(b,arguments);var d=c.apply(s,b);return a&&"object"==typeof a&&a===d?this:new t(d)}})}function Kc(){return d._=hd,this}function Lc(a,b){null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0;var c=Ed();return a%1||b%1?a+Cd(c*(b-a+parseFloat("1e-"+((c+"").length-1))),b):a+md(c*(b-a+1))}function Mc(a,b){var c=a?a[b]:r;return vb(c)?a[b]():c}function Nc(a,b,c){var d=s.templateSettings;a||(a=""),c=Wd({},c,d);var e,f=Wd({},c.imports,d.imports),g=Rd(f),i=Ib(f),j=0,k=c.interpolate||J,l="__p += '",m=ad((c.escape||J).source+"|"+k.source+"|"+(k===F?D:J).source+"|"+(c.evaluate||J).source+"|$","g");
a.replace(m,function(b,c,d,f,g,i){return d||(d=f),l+=a.slice(j,i).replace(L,h),c&&(l+="' +\n__e("+c+") +\n'"),g&&(e=!0,l+="';\n"+g+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var n=c.variable,o=n;o||(n="obj",l="with ("+n+") {\n"+l+"\n}\n"),l=(e?l.replace(z,""):l).replace(A,"$1").replace(B,"$1;"),l="function("+n+") {\n"+(o?"":n+" || ("+n+" = {});\n")+"var __t, __p = '', __e = _.escape"+(e?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var p="\n/*\n//@ sourceURL="+(c.sourceURL||"/lodash/template/source["+O++ +"]")+"\n*/";try{var q=Yc(g,"return "+l+p).apply(r,i)}catch(t){throw t.source=l,t}return b?q(b):(q.source=l,q)}function Oc(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=Uc(a);for(b=s.createCallback(b,c,1);++d<a;)e[d]=b(d);return e}function Pc(a){return null==a?"":bd(a).replace(C,hb)}function Qc(a){var b=++u;return bd(null==a?"":a)+b}function Rc(a,b){return b(a),a}function Sc(){return bd(this.__wrapped__)}function Tc(){return this.__wrapped__}d=d?db.defaults(a.Object(),d,db.pick(a,M)):a;var Uc=d.Array,Vc=d.Boolean,Wc=d.Date,Xc=d.Error,Yc=d.Function,Zc=d.Math,$c=d.Number,_c=d.Object,ad=d.RegExp,bd=d.String,cd=d.TypeError,dd=[],ed=Xc.prototype,fd=_c.prototype,gd=bd.prototype,hd=d._,id=ad("^"+bd(fd.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),jd=Zc.ceil,kd=d.clearTimeout,ld=dd.concat,md=Zc.floor,nd=Yc.prototype.toString,od=id.test(od=_c.getPrototypeOf)&&od,pd=fd.hasOwnProperty,qd=dd.push,rd=fd.propertyIsEnumerable,sd=d.setImmediate,td=d.setTimeout,ud=fd.toString,vd=id.test(vd=ud.bind)&&vd,wd=id.test(wd=_c.create)&&wd,xd=id.test(xd=Uc.isArray)&&xd,yd=d.isFinite,zd=d.isNaN,Ad=id.test(Ad=_c.keys)&&Ad,Bd=Zc.max,Cd=Zc.min,Dd=d.parseInt,Ed=Zc.random,Fd=dd.slice,Gd=id.test(d.attachEvent),Hd=vd&&!/\n|true/.test(vd+Gd),Id={};Id[Q]=Uc,Id[R]=Vc,Id[S]=Wc,Id[U]=Yc,Id[W]=_c,Id[V]=$c,Id[X]=ad,Id[Y]=bd;var Jd={};Jd[Q]=Jd[S]=Jd[V]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Jd[R]=Jd[Y]={constructor:!0,toString:!0,valueOf:!0},Jd[T]=Jd[U]=Jd[X]={constructor:!0,toString:!0},Jd[W]={constructor:!0},function(){for(var a=N.length;a--;){var b=N[a];for(var c in Jd)pd.call(Jd,c)&&!pd.call(Jd[c],b)&&(Jd[c][b]=!1)}}(),t.prototype=s.prototype;var Kd=s.support={};!function(){var a=function(){this.x=1},b={0:1,length:1},c=[];a.prototype={valueOf:1,y:1};for(var d in new a)c.push(d);for(d in arguments);Kd.argsObject=arguments.constructor==_c&&!(arguments instanceof Uc),Kd.argsClass=ib(arguments),Kd.enumErrorProps=rd.call(ed,"message")||rd.call(ed,"name"),Kd.enumPrototypes=rd.call(a,"prototype"),Kd.fastBind=vd&&!Hd,Kd.ownLast="x"!=c[0],Kd.nonEnumArgs=0!=d,Kd.nonEnumShadows=!/valueOf/.test(c),Kd.spliceObjects=(dd.splice.call(b,0,1),!b[0]),Kd.unindexedChars="xx"!="x"[0]+_c("x")[0];try{Kd.nodeClass=!(ud.call(document)==W&&!({toString:0}+""))}catch(e){Kd.nodeClass=!0}}(1),s.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:F,variable:"",imports:{_:s}};var Ld=function(a){var b="var index, iterable = "+a.firstArg+", result = "+a.init+";\nif (!iterable) return result;\n"+a.top+";";a.array?(b+="\nvar length = iterable.length; index = -1;\nif ("+a.array+") {  ",Kd.unindexedChars&&(b+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),b+="\n  while (++index < length) {\n    "+a.loop+";\n  }\n}\nelse {  "):Kd.nonEnumArgs&&(b+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+a.loop+";\n    }\n  } else {  "),Kd.enumPrototypes&&(b+="\n  var skipProto = typeof iterable == 'function';\n  "),Kd.enumErrorProps&&(b+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var c=[];if(Kd.enumPrototypes&&c.push('!(skipProto && index == "prototype")'),Kd.enumErrorProps&&c.push('!(skipErrorProps && (index == "message" || index == "name"))'),a.useHas&&a.useKeys)b+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }  ";else if(b+="\n  for (index in iterable) {\n",a.useHas&&c.push("hasOwnProperty.call(iterable, index)"),c.length&&(b+="    if ("+c.join(" && ")+") {\n  "),b+=a.loop+";    ",c.length&&(b+="\n    }"),b+="\n  }    ",Kd.nonEnumShadows){for(b+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)b+="\n    index = '"+a.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",a.useHas||(b+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),b+=") {\n      "+a.loop+";\n    }      ";b+="\n  }    "}return(a.array||Kd.nonEnumArgs)&&(b+="\n}"),b+=a.bottom+";\nreturn result"},Md={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Nd={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Od={top:"if (!objectTypes[typeof iterable]) return result;\n"+Nd.top,array:!1};if(!wd)var ab=function(a){if(wb(a)){m.prototype=a;var b=new m;m.prototype=null}return b||{}};Kd.argsClass||(ib=function(a){return a?pd.call(a,"callee"):!1});var Pd=xd||function(a){return a?"object"==typeof a&&ud.call(a)==Q:!1},Qd=_({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Rd=Ad?function(a){return wb(a)?Kd.enumPrototypes&&"function"==typeof a||Kd.nonEnumArgs&&a.length&&ib(a)?Qd(a):Ad(a):[]}:Qd,Sd=_(Nd),Td={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ud=ob(Td),Vd=_(Md,{top:Md.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Wd=_(Md),Xd=_(Nd,Od,{useHas:!1}),Yd=_(Nd,Od);vb(/x/)&&(vb=function(a){return"function"==typeof a&&ud.call(a)==U});var Zd=od?function(a){if(!a||ud.call(a)!=W||!Kd.argsClass&&ib(a))return!1;var b=a.valueOf,c="function"==typeof b&&(c=od(b))&&od(c);return c?a==c||od(a)==c:gb(a)}:gb,$d=Sb,_d=Nb,ae=fb(function de(a,b,c){for(var d=-1,e=a?a.length:0,f=[];++d<e;){var g=a[d];c&&(g=c(g,d,a)),Pd(g)?qd.apply(f,b?g:de(g)):f.push(g)}return f}),be=fb(function(a,d,e){var f=-1,h=eb(),j=a?a.length:0,k=[],l=!d&&j>=x&&h===b,m=e||l?i():k;if(l){var p=g(m);p?(h=c,m=p):(l=!1,m=e?m:(n(m),k))}for(;++f<j;){var q=a[f],r=e?e(q,f,a):q;(d?!f||m[m.length-1]!==r:h(m,r)<0)&&((e||l)&&m.push(r),k.push(q))}return l?(n(m.array),o(m)):e&&n(m),k});Hd&&bb&&"function"==typeof sd&&(zc=tc(sd,d));var ce=8==Dd(H+"08")?Dd:function(a,b){return Dd(Bb(a)?a.replace(I,""):a,b||0)};return s.after=sc,s.assign=Vd,s.at=Jb,s.bind=tc,s.bindAll=uc,s.bindKey=vc,s.compact=bc,s.compose=wc,s.countBy=Lb,s.createCallback=xc,s.debounce=yc,s.defaults=Wd,s.defer=zc,s.delay=Ac,s.difference=cc,s.filter=Nb,s.flatten=ae,s.forEach=Pb,s.forIn=Xd,s.forOwn=Yd,s.functions=mb,s.groupBy=Qb,s.initial=gc,s.intersection=hc,s.invert=ob,s.invoke=Rb,s.keys=Rd,s.map=Sb,s.max=Tb,s.memoize=Bc,s.merge=Db,s.min=Ub,s.omit=Eb,s.once=Cc,s.pairs=Fb,s.partial=Dc,s.partialRight=Ec,s.pick=Gb,s.pluck=$d,s.range=kc,s.reject=Xb,s.rest=lc,s.shuffle=Yb,s.sortBy=_b,s.tap=Rc,s.throttle=Fc,s.times=Oc,s.toArray=ac,s.transform=Hb,s.union=nc,s.uniq=be,s.unzip=oc,s.values=Ib,s.where=_d,s.without=pc,s.wrap=Gc,s.zip=qc,s.zipObject=rc,s.collect=Sb,s.drop=lc,s.each=Pb,s.extend=Vd,s.methods=mb,s.object=rc,s.select=Nb,s.tail=lc,s.unique=be,Jc(s),s.chain=s,s.prototype.chain=function(){return this},s.clone=jb,s.cloneDeep=kb,s.contains=Kb,s.escape=Hc,s.every=Mb,s.find=Ob,s.findIndex=dc,s.findKey=lb,s.has=nb,s.identity=Ic,s.indexOf=fc,s.isArguments=ib,s.isArray=Pd,s.isBoolean=pb,s.isDate=qb,s.isElement=rb,s.isEmpty=sb,s.isEqual=tb,s.isFinite=ub,s.isFunction=vb,s.isNaN=xb,s.isNull=yb,s.isNumber=zb,s.isObject=wb,s.isPlainObject=Zd,s.isRegExp=Ab,s.isString=Bb,s.isUndefined=Cb,s.lastIndexOf=jc,s.mixin=Jc,s.noConflict=Kc,s.parseInt=ce,s.random=Lc,s.reduce=Vb,s.reduceRight=Wb,s.result=Mc,s.runInContext=q,s.size=Zb,s.some=$b,s.sortedIndex=mc,s.template=Nc,s.unescape=Pc,s.uniqueId=Qc,s.all=Mb,s.any=$b,s.detect=Ob,s.findWhere=Ob,s.foldl=Vb,s.foldr=Wb,s.include=Kb,s.inject=Vb,Yd(s,function(a,b){s.prototype[b]||(s.prototype[b]=function(){var b=[this.__wrapped__];return qd.apply(b,arguments),a.apply(s,b)})}),s.first=ec,s.last=ic,s.take=ec,s.head=ec,Yd(s,function(a,b){s.prototype[b]||(s.prototype[b]=function(b,c){var d=a(this.__wrapped__,b,c);return null==b||c&&"function"!=typeof b?d:new t(d)})}),s.VERSION="1.3.1",s.prototype.toString=Sc,s.prototype.value=Tc,s.prototype.valueOf=Tc,Sd(["join","pop","shift"],function(a){var b=dd[a];s.prototype[a]=function(){return b.apply(this.__wrapped__,arguments)}}),Sd(["push","reverse","sort","unshift"],function(a){var b=dd[a];s.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),Sd(["concat","slice","splice"],function(a){var b=dd[a];s.prototype[a]=function(){return new t(b.apply(this.__wrapped__,arguments))}}),Kd.spliceObjects||Sd(["pop","shift","splice"],function(a){var b=dd[a],c="splice"==a;s.prototype[a]=function(){var a=this.__wrapped__,d=b.apply(a,arguments);return 0===a.length&&delete a[0],c?new t(d):d}}),s}var r,s=[],t=[],u=0,v={},w=+new Date+"",x=75,y=40,z=/\b__p \+= '';/g,A=/\b(__p \+=) '' \+/g,B=/(__e\(.*?\)|\b__t\)) \+\n'';/g,C=/&(?:amp|lt|gt|quot|#39);/g,D=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,E=/\w*$/,F=/<%=([\s\S]+?)%>/g,G=(G=/\bthis\b/)&&G.test(q)&&G,H=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",I=RegExp("^["+H+"]*0+(?=.$)"),J=/($^)/,K=/[&<>"']/g,L=/['\n\r\t\u2028\u2029\\]/g,M=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],N=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],O=0,P="[object Arguments]",Q="[object Array]",R="[object Boolean]",S="[object Date]",T="[object Error]",U="[object Function]",V="[object Number]",W="[object Object]",X="[object RegExp]",Y="[object String]",Z={};Z[U]=!1,Z[P]=Z[Q]=Z[R]=Z[S]=Z[V]=Z[W]=Z[X]=Z[Y]=!0;var $={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},_={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},ab=$[typeof exports]&&exports,bb=$[typeof module]&&module&&module.exports==ab&&module,cb=$[typeof global]&&global;!cb||cb.global!==cb&&cb.window!==cb||(a=cb);var db=q();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(a._=db,define("lodash",[],function(){return db})):ab&&!ab.nodeType?bb?(bb.exports=db)._=db:ab._=db:a._=db}(this),define("vent",["lodash"],function(a){var b=/\s+/,c=function(a,c,d,e){if(!d)return!0;if("object"==typeof d){for(var f in d)a[c].apply(a,[f,d[f]].concat(e));return!1}if(b.test(d)){for(var g=d.split(b),h=0,i=g.length;i>h;h++)a[c].apply(a,[g[h]].concat(e));return!1}return!0},d=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},e={on:function(a,b,d){if(!c(this,"on",a,[b,d])||!b)return this;this._events||(this._events={});var e=this._events[a]||(this._events[a]=[]);return e.push({callback:b,context:d,ctx:d||this}),this},once:function(b,d,e){if(!c(this,"once",b,[d,e])||!d)return this;var f=this,g=a.once(function(){f.off(b,g),d.apply(this,arguments)});return g._callback=d,this.on(b,g,e)},off:function(b,d,e){var f,g,h,i,j,k,l,m;if(!this._events||!c(this,"off",b,[d,e]))return this;if(!b&&!d&&!e)return this._events={},this;for(i=b?[b]:a.keys(this._events),j=0,k=i.length;k>j;j++)if(b=i[j],h=this._events[b]){if(this._events[b]=f=[],d||e)for(l=0,m=h.length;m>l;l++)g=h[l],(d&&d!==g.callback&&d!==g.callback._callback||e&&e!==g.context)&&f.push(g);f.length||delete this._events[b]}return this},trigger:function(b){if(!this._events)return this;var e=a.toArray(arguments).slice(1);if(!c(this,"trigger",b,e))return this;var f=this._events[b],g=this._events.all;return f&&d(f,e),g&&d(g,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},f={};return a.extend(f,e)}),define("messaging/message",["lodash","messaging"],function(a){return Message=function(){},Message.from=function(b,c){var c=c||{},d=new this,e=function(d){if(d instanceof ArrayBuffer)for(var e,f,g,h,i=require("messaging"),j=new DataView(d),k=0,l=0;k<b.byteformat.length;)e=b.byteformat.charAt(k),g=i.format[e],f=i.extractValue(j["get"+g](l),e),h=c["hydrate"+b.format[k].charAt(0).toUpperCase()+b.format[k].substring(1)],h&&(f=h.call(c,f)),this[b.format[k]]=f,l+=i.getTypeByteLength(g),k++;else a.extend(this,d)};return d.toBuffer=function(){for(var a,d,e,f,g=require("messaging"),h=g.calcByteSize(b),i=new ArrayBuffer(h),j=new DataView(i),k=0,l=0;k<b.byteformat.length;)d=b.byteformat.charAt(k),a=g.format[d],f=c["dehydrate"+b.format[k].charAt(0).toUpperCase()+b.format[k].substring(1)],e=f?f.call(c,this[b.format[k]]):this[b.format[k]],j["set"+a](l,e),l+=g.getTypeByteLength(a),k++;return i},d.schema=b,e.prototype=d,e.prototype.constructor=e,e.extend=arguments.calee,e.schema=b,e},Message}),define("messaging/mixins/entity",[],function(){return{entityTypeLookup:{0:"unknown",1:"collidable",2:"archer",3:"arrow",4:"skeleton"},hydrateEntityType:function(a){return this.entityTypeLookup[a]}}}),define("messaging/mixins/state",[],function(){return{stateLookup:{0:"unknown",1:"standing",2:"walking",3:"shooting",4:"dying",5:"dead"},hydrateState:function(a){return this.stateLookup[a]}}}),define("messaging/mixins/direction",["lodash"],function(a){var b={0:"",1:"N",2:"S",3:"E",4:"W"},c=a.invert(b);return{directionLookup:b,directionRLookup:c,hydrateDirection:function(a){return this.directionLookup[a]},dehydrateDirection:function(a){return this.directionRLookup[a]}}}),define("messaging/frame",["lodash","messaging/message","messaging/mixins/entity","messaging/mixins/state","messaging/mixins/direction"],function(a,b,c,d,e){var f={id:1,format:["id","x","y","direction","state"],byteformat:"IIIBB"},g=b.from(f,a.extend({},d,e));return g}),define("messaging/update",["lodash","messaging/message","messaging/mixins/entity","messaging/mixins/state","messaging/mixins/direction"],function(a,b,c,d,e){var f={id:2,format:["id","entityType","width","height","x","y","direction","state","player"],byteformat:"IBIIIIBB?"},g=b.from(f,a.extend({},c,d,e));return g}),define("messaging/mixins/action",["lodash"],function(a){var b={1:"spawn",2:"stop",3:"move",4:"attack"},c=a.invert(b),d={actionLookup:b,actionRLookup:c,hydrateAction:function(a){return this.actionLookup[a]},dehydrateAction:function(a){return this.actionRLookup[a]}};return d}),define("messaging/useraction",["lodash","messaging/message","messaging/mixins/action","messaging/mixins/direction"],function(a,b,c,d){var e={id:3,format:["action","direction"],byteformat:"BB"},f=b.from(e,a.extend({},c,d));return f}),define("messaging/remove",["messaging/message"],function(a){var b={id:4,format:["id"],byteformat:"I"};return a.from(b)}),define("messaging",["require","lodash","messaging/frame","messaging/update","messaging/useraction","messaging/remove"],function(a,b,c,d,e,f){var g={format:{b:"Int8",B:"Uint8","?":"Uint8",h:"Int16",H:"Uint16",i:"Int32",I:"Uint32",f:"Float32",d:"Float64"},messages:{1:c,2:d,3:e,4:f},copyBytes:function(a,b,c,d,e){var f=new Uint8Array(b,d);f.set(new Uint8Array(a,c,e))},getTypeByteLength:function(a){return window[a+"Array"].BYTES_PER_ELEMENT},calcByteSize:function(a){for(var b,c=0,d=0;d<a.byteformat.length;)b=this.format[a.byteformat.charAt(d)],c+=this.getTypeByteLength(b),d++;return c},extractValue:function(a,b){return"?"===b&&(a=!!a),a},fromBuffer:function(a){for(var b,c=new DataView(a),d=this.messages[c.getUint8(0)],e=this.calcByteSize(d.schema),f=1,g=[];f<a.byteLength;)b=new d(a.slice(f,f+e)),g.push(b),f+=e;return g},toBuffer:function(a){var b,c,d,e,f,g=1,h=0;if(a.length){for(b=this.messages[a[0].constructor.schema.id],e=this.calcByteSize(a[0].constructor.schema),g+=a.length*e,c=new ArrayBuffer(g),d=new DataView(c),d.setUint8(0,a[0].constructor.schema.id),h=1;a.length;)f=a.shift(),this.copyBytes(f.toBuffer(),c,0,h,e),h+=e;return c}return new ArrayBuffer(0)}};return g}),define("networking",["lodash","vent","messaging","messaging/useraction"],function(a,b,c,d){return function(){var a=this;this.ws=new WebSocket("ws://"+window.location.hostname+":9000"),this.ws.binaryType="arraybuffer",this.oninput=function(b,e){var f=new d({action:b,direction:e});a.ws.send(c.toBuffer([f]))},this.onspawn=function(){var b=new d({action:"spawn",direction:"S"});a.ws.send(c.toBuffer([b]))},this.onUsernameChange=function(b){var c;b&&b.length&&(c={username:b},a.ws.send(JSON.stringify(c)))},this.onmessage=function(a){a.data instanceof ArrayBuffer?(messages=c.fromBuffer(a.data),2===messages[0].schema.id&&messages.forEach(function(a){b.trigger("update",a)}),1===messages[0].schema.id&&messages.forEach(function(a){b.trigger("frame",a)}),4===messages[0].schema.id&&messages.forEach(function(a){b.trigger("remove",a)})):(msg=JSON.parse(a.data),b.trigger("meta",msg))},this.ws.onopen=function(){a.ws.onmessage=a.onmessage,b.trigger("connected"),b.on("spawn",a.onspawn),b.on("input",a.oninput),b.on("username",a.onUsernameChange)},this.ws.onclose=function(a){b.trigger("disconnected",a)}}}),define("spritedef/archer",[],function(){return{spriteName:"archer",frameDefault:"standing S",frameWidth:64,frameHeight:64,frames:[{name:"standing N",frameX:0,frameY:8,frameCount:1,time:900},{name:"standing W",frameX:0,frameY:9,frameCount:1,time:900},{name:"standing S",frameX:0,frameY:10,frameCount:1,time:900},{name:"standing E",frameX:0,frameY:11,frameCount:1,time:900},{name:"casting N",frameX:0,frameY:0,frameCount:7,time:900},{name:"casting W",frameX:0,frameY:1,frameCount:7,time:900},{name:"casting S",frameX:0,frameY:2,frameCount:7,time:900},{name:"casting E",frameX:0,frameY:3,frameCount:7,time:900},{name:"piercing N",frameX:0,frameY:4,frameCount:8,time:900},{name:"piercing W",frameX:0,frameY:5,frameCount:8,time:900},{name:"piercing S",frameX:0,frameY:6,frameCount:8,time:900},{name:"piercing E",frameX:0,frameY:7,frameCount:8,time:900},{name:"walking N",frameX:0,frameY:8,frameCount:9,time:900},{name:"walking W",frameX:0,frameY:9,frameCount:9,time:900},{name:"walking S",frameX:0,frameY:10,frameCount:9,time:900},{name:"walking E",frameX:0,frameY:11,frameCount:9,time:900},{name:"slashing N",frameX:0,frameY:12,frameCount:6,time:900},{name:"slashing W",frameX:0,frameY:13,frameCount:6,time:900},{name:"slashing S",frameX:0,frameY:14,frameCount:6,time:900},{name:"slashing E",frameX:0,frameY:15,frameCount:6,time:900},{name:"shooting N",frameX:0,frameY:16,frameCount:13,time:900},{name:"shooting W",frameX:0,frameY:17,frameCount:13,time:900},{name:"shooting S",frameX:0,frameY:18,frameCount:13,time:900},{name:"shooting E",frameX:0,frameY:19,frameCount:13,time:900},{name:"dying",frameX:0,frameY:20,frameCount:6,time:900},{name:"dead",frameX:5,frameY:20,frameCount:1,time:900},{name:"unknown",frameX:19,frameY:20,frameCount:1,time:900}]}}),define("spritedef/arrow",[],function(){return{spriteName:"arrow",frameDefault:"shooting S",frameWidth:32,frameHeight:32,frames:[{name:"shooting N",frameX:1,frameY:0,frameCount:1,time:900},{name:"shooting W",frameX:3,frameY:0,frameCount:1,time:900},{name:"shooting S",frameX:2,frameY:0,frameCount:1,time:900},{name:"shooting E",frameX:0,frameY:0,frameCount:1,time:900}]}}),define("spritedef/skeleton",["lodash","spritedef/archer"],function(a,b){var c=a.clone(b);return c.spriteName="skeleton",c}),define("components/state",["pc"],function(a){return a.components.Component("State",{create:function(a,b){var c=this._super();return c.config(a,b),c}},{state:"unknown",direction:"S",init:function(){this._super(this.Class.shortName),this.config()},config:function(a,b){this.state=a||"unknown",this.direction=b||"S"},getStatedir:function(){return"unknown"===this.state?this.state:this.state+" "+this.direction},isAlive:function(){return"dead"===this.state||"unknown"===this.state?!1:!0},changeState:function(a,b,c,d){var e;if(this.state===b&&this.direction===c&&!d)return!1;if(this.state=b,this.direction=c,e=this.getStatedir(),a.sprite.spriteSheet.animations.containsKey(e))a.sprite.setAnimation(e);else{if(!a.sprite.spriteSheet.animations.containsKey(this.state))throw"Couldn't find animation for "+e;a.sprite.setAnimation(this.state)}return!0}})}),define("components/meta",["pc"],function(a){return a.components.Component("Meta",{create:function(){var a=this._super();return a.config(),a}},{username:"",init:function(){this._super(this.Class.shortName),this.config()},update:function(a){a.username&&(this.username=a.username)},config:function(){}})}),define("entityfactory",["pc","lodash","spritedef/archer","spritedef/arrow","spritedef/skeleton","components/state","components/meta"],function(a,b,c,d,e,f,g){var h=a.EntityFactory.extend("pc.archers.EntityFactory",{},{getSprite:function(c,d){var e=a.device.loader.get(c.spriteName).resource,f=new a.SpriteSheet({image:e,frameWidth:c.frameWidth,frameHeight:c.frameHeight});return d=d||c.frameDefault,b.each(c.frames,function(a){f.addAnimation(a)}),a.components.Sprite.create({spriteSheet:f,animationStart:d})},getSpatial:function(b,c,d,e){return a.components.Spatial.create({x:b,y:c,w:d,h:e})},getInput:function(){return a.components.Input.create({states:[["moving right",["D","RIGHT"]],["moving left",["A","LEFT"]],["moving up",["W","UP"]],["moving down",["S","DOWN"]],["attacking",["SPACE"]]]})},makeCollidable:function(b,c,d,e,f){var g=this.getSpatial(c,d,f.x,f.y),h=a.Entity.create(b);return h.addComponent(g),h},makeArcher:function(b,d,e,h,i,j){var k=this.getSpatial(d,e,64,64),l=f.create(j.state,h),m=g.create(),n=this.getSprite(c,l.getStatedir()),o=a.Entity.create(b);return o.addComponent(l),o.addComponent(m),o.addComponent(k),o.addComponent(n),j.player&&o.addTag("PLAYER"),o},makeSkeleton:function(b,c,d,h,i,j){var k=this.getSpatial(c,d,64,64),l=f.create(j.state,h),m=g.create(),n=this.getSprite(e,l.getStatedir()),o=a.Entity.create(b);return o.addComponent(l),o.addComponent(m),o.addComponent(k),o.addComponent(n),o},makeArrow:function(b,c,e,g,h,i){var j=this.getSpatial(c,e,32,32),k=f.create(i.state,g),l=this.getSprite(d,k.getStatedir()),m=a.Entity.create(b);return m.addComponent(j),m.addComponent(l),m},createEntity:function(a,b,c,d,e,f,g){var h,i="make"+b.charAt(0).toUpperCase()+b.slice(1);return this[i]?(h=this[i].call(this,a,c,d,e,f,g),h.addTag(b),h):null}});return h}),function(a,b){function c(a){var b=a.length,c=T.type(a);return T.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=db[a]={};return T.each(a.match(V)||[],function(a,c){b[c]=!0}),b}function e(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=T.expando+Math.random()}function f(a,c,d){var e;if(d===b&&1===a.nodeType)if(e="data-"+c.replace(hb,"-$1").toLowerCase(),d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:gb.test(d)?JSON.parse(d):d}catch(f){}eb.set(a,c,d)}else d=b;return d}function g(){return!0}function h(){return!1}function i(){try{return F.activeElement}catch(a){}}function j(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function k(a,b,c){if(T.isFunction(b))return T.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return T.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(rb.test(b))return T.filter(b,a,c);b=T.filter(b,a)}return T.grep(a,function(a){return P.call(b,a)>=0!==c})}function l(a,b){return T.nodeName(a,"table")&&T.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function m(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function n(a){var b=Cb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function o(a,b){for(var c=a.length,d=0;c>d;d++)fb.set(a[d],"globalEval",!b||fb.get(b[d],"globalEval"))}function p(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(fb.hasData(a)&&(f=fb.access(a),g=fb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)T.event.add(b,e,j[e][c])}eb.hasData(a)&&(h=eb.access(a),i=T.extend({},h),eb.set(b,i))}}function q(a,c){var d=a.getElementsByTagName?a.getElementsByTagName(c||"*"):a.querySelectorAll?a.querySelectorAll(c||"*"):[];return c===b||c&&T.nodeName(a,c)?T.merge([a],d):d}function r(a,b){var c=b.nodeName.toLowerCase();"input"===c&&zb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function s(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Qb.length;e--;)if(b=Qb[e]+c,b in a)return b;return d}function t(a,b){return a=b||a,"none"===T.css(a,"display")||!T.contains(a.ownerDocument,a)}function u(b){return a.getComputedStyle(b,null)}function v(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=fb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&t(d)&&(f[g]=fb.access(d,"olddisplay",z(d.nodeName)))):f[g]||(e=t(d),(c&&"none"!==c||!e)&&fb.set(d,"olddisplay",e?c:T.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function w(a,b,c){var d=Jb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function x(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=T.css(a,c+Pb[f],!0,e)),d?("content"===c&&(g-=T.css(a,"padding"+Pb[f],!0,e)),"margin"!==c&&(g-=T.css(a,"border"+Pb[f]+"Width",!0,e))):(g+=T.css(a,"padding"+Pb[f],!0,e),"padding"!==c&&(g+=T.css(a,"border"+Pb[f]+"Width",!0,e)));return g}function y(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=u(a),g=T.support.boxSizing&&"border-box"===T.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Fb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Kb.test(e))return e;d=g&&(T.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+x(a,b,c||(g?"border":"content"),d,f)+"px"}function z(a){var b=F,c=Mb[a];return c||(c=A(a,b),"none"!==c&&c||(Gb=(Gb||T("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Gb[0].contentWindow||Gb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=A(a,b),Gb.detach()),Mb[a]=c),c}function A(a,b){var c=T(b.createElement(a)).appendTo(b.body),d=T.css(c[0],"display");return c.remove(),d}function B(a,b,c,d){var e;if(T.isArray(b))T.each(b,function(b,e){c||Sb.test(a)?d(a,e):B(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==T.type(b))d(a,b);else for(e in b)B(a+"["+e+"]",b[e],c,d)}var C,D,E=typeof b,F=(a.location,a.document),G=F.documentElement,H=a.jQuery,I=a.$,J={},K=[],L="2.0.3 -sizzle,-wrap,-event-alias,-ajax,-ajax/script,-ajax/jsonp,-ajax/xhr,-effects,-offset,-dimensions,-deprecated",M=K.concat,N=K.push,O=K.slice,P=K.indexOf,Q=J.toString,R=J.hasOwnProperty,S=L.trim,T=function(a,b){return new T.fn.init(a,b,C)},U=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=/\S+/g,W=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,X=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Y=/^-ms-/,Z=/-([\da-z])/gi,$=function(a,b){return b.toUpperCase()},_=function(){F.removeEventListener("DOMContentLoaded",_,!1),a.removeEventListener("load",_,!1),T.ready()};T.fn=T.prototype={jquery:L,constructor:T,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:W.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof T?c[0]:c,T.merge(this,T.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:F,!0)),X.test(e[1])&&T.isPlainObject(c))for(e in c)T.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}return f=F.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=F,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):T.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),T.makeArray(a,this))},selector:"",length:0,toArray:function(){return O.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=T.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return T.each(this,a,b)},ready:function(a){return T.ready.promise().done(a),this},slice:function(){return this.pushStack(O.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(T.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:N,sort:[].sort,splice:[].splice},T.fn.init.prototype=T.fn,T.extend=T.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||T.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&(T.isPlainObject(e)||(f=T.isArray(e)))?(f?(f=!1,g=d&&T.isArray(d)?d:[]):g=d&&T.isPlainObject(d)?d:{},h[c]=T.extend(k,g,e)):e!==b&&(h[c]=e));return h},T.extend({expando:"jQuery"+(L+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===T&&(a.$=I),b&&a.jQuery===T&&(a.jQuery=H),T},isReady:!1,readyWait:1,holdReady:function(a){a?T.readyWait++:T.ready(!0)},ready:function(a){(a===!0?--T.readyWait:T.isReady)||(T.isReady=!0,a!==!0&&--T.readyWait>0||(D.resolveWith(F,[T]),T.fn.trigger&&T(F).trigger("ready").off("ready")))},isFunction:function(a){return"function"===T.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?J[Q.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==T.type(a)||a.nodeType||T.isWindow(a))return!1;try{if(a.constructor&&!R.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||F;var d=X.exec(a),e=!c&&[];
return d?[b.createElement(d[1])]:(d=T.buildFragment([a],b,e),e&&T(e).remove(),T.merge([],d.childNodes))},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||"string"!=typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,"text/xml")}catch(e){c=b}return(!c||c.getElementsByTagName("parsererror").length)&&T.error("Invalid XML: "+a),c},noop:function(){},globalEval:function(a){var b,c=eval;a=T.trim(a),a&&(1===a.indexOf("use strict")?(b=F.createElement("script"),b.text=a,F.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(Y,"ms-").replace(Z,$)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":S.call(a)},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?T.merge(d,"string"==typeof a?[a]:a):N.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:P.call(b,a,c)},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return M.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),T.isFunction(a)?(e=O.call(arguments,2),f=function(){return a.apply(c||this,e.concat(O.call(arguments)))},f.guid=a.guid=a.guid||T.guid++,f):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===T.type(d)){f=!0;for(i in d)T.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,T.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(T(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:Date.now,swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),T.ready.promise=function(b){return D||(D=T.Deferred(),"complete"===F.readyState?setTimeout(T.ready):(F.addEventListener("DOMContentLoaded",_,!1),a.addEventListener("load",_,!1))),D.promise(b)},T.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),C=T(F);var ab,bb=G.webkitMatchesSelector||G.mozMatchesSelector||G.oMatchesSelector||G.msMatchesSelector,cb=function(a,b){if(a===b)return ab=!0,0;var c=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return c?1&c?a===F||T.contains(F,a)?-1:b===F||T.contains(F,b)?1:0:4&c?-1:1:a.compareDocumentPosition?-1:1};T.extend({find:function(a,b,c,d){var e,f,g=0;if(c=c||[],b=b||F,!a||"string"!=typeof a)return c;if(1!==(f=b.nodeType)&&9!==f)return[];if(d)for(;e=d[g++];)T.find.matchesSelector(e,a)&&c.push(e);else T.merge(c,b.querySelectorAll(a));return c},unique:function(a){var b,c=[],d=0,e=0;if(ab=!1,a.sort(cb),ab){for(;b=a[d++];)b===a[d]&&(e=c.push(d));for(;e--;)a.splice(c[e],1)}return a},text:function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e)return a.textContent;if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=T.text(b);return c},contains:function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!c.contains(d))},isXMLDoc:function(a){return"HTML"!==(a.ownerDocument||a).documentElement.nodeName},expr:{attrHandle:{},match:{bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]/}}}),T.extend(T.find,{matches:function(a,b){return T.find(a,null,null,b)},matchesSelector:function(a,b){return bb.call(a,b)},attr:function(a,b){return a.getAttribute(b)}});var db={};T.Callbacks=function(a){a="string"==typeof a?db[a]||d(a):T.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(c=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;j&&h>i;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):c?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){T.each(b,function(b,c){var e=T.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),f?h=j.length:c&&(g=b,l(c))}return this},remove:function(){return j&&T.each(arguments,function(a,b){for(var c;(c=T.inArray(b,j,c))>-1;)j.splice(c,1),f&&(h>=c&&h--,i>=c&&i--)}),this},has:function(a){return a?T.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],h=0,this},disable:function(){return j=k=c=b,this},disabled:function(){return!j},lock:function(){return k=b,c||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return!j||e&&!k||(b=b||[],b=[a,b.slice?b.slice():b],f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},T.extend({Deferred:function(a){var b=[["resolve","done",T.Callbacks("once memory"),"resolved"],["reject","fail",T.Callbacks("once memory"),"rejected"],["notify","progress",T.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return T.Deferred(function(c){T.each(b,function(b,f){var g=f[0],h=T.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&T.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?T.extend(a,d):d}},e={};return d.pipe=d.then,T.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=O.call(arguments),g=f.length,h=1!==g||a&&T.isFunction(a.promise)?g:0,i=1===h?a:T.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?O.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&T.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),T.support=function(b){var c=F.createElement("input"),d=F.createDocumentFragment(),e=F.createElement("div"),f=F.createElement("select"),g=f.appendChild(F.createElement("option"));return c.type?(c.type="checkbox",b.checkOn=""!==c.value,b.optSelected=g.selected,b.reliableMarginRight=!0,b.boxSizingReliable=!0,b.pixelPosition=!1,c.checked=!0,b.noCloneChecked=c.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled,c=F.createElement("input"),c.value="t",c.type="radio",b.radioValue="t"===c.value,c.setAttribute("checked","t"),c.setAttribute("name","t"),d.appendChild(c),b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked,b.focusinBubbles="onfocusin"in a,e.style.backgroundClip="content-box",e.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===e.style.backgroundClip,T(function(){var c,d,f="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",g=F.getElementsByTagName("body")[0];g&&(c=F.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(e),e.innerHTML="",e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",T.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===e.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(e,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(e,null)||{width:"4px"}).width,d=e.appendChild(F.createElement("div")),d.style.cssText=e.style.cssText=f,d.style.marginRight=d.style.width="0",e.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),g.removeChild(c))}),b):b}({});var eb,fb,gb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,hb=/([A-Z])/g;e.uid=1,e.accepts=function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0},e.prototype={key:function(a){if(!e.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=e.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,T.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(T.isEmptyObject(f))T.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){var e;return c===b||c&&"string"==typeof c&&d===b?(e=this.get(a,c),e!==b?e:this.get(a,T.camelCase(c))):(this.set(a,c,d),d!==b?d:c)},remove:function(a,c){var d,e,f,g=this.key(a),h=this.cache[g];if(c===b)this.cache[g]={};else{T.isArray(c)?e=c.concat(c.map(T.camelCase)):(f=T.camelCase(c),c in h?e=[c,f]:(e=f,e=e in h?[e]:e.match(V)||[])),d=e.length;for(;d--;)delete h[e[d]]}},hasData:function(a){return!T.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}},eb=new e,fb=new e,T.extend({acceptData:e.accepts,hasData:function(a){return eb.hasData(a)||fb.hasData(a)},data:function(a,b,c){return eb.access(a,b,c)},removeData:function(a,b){eb.remove(a,b)},_data:function(a,b,c){return fb.access(a,b,c)},_removeData:function(a,b){fb.remove(a,b)}}),T.fn.extend({data:function(a,c){var d,e,g=this[0],h=0,i=null;if(a===b){if(this.length&&(i=eb.get(g),1===g.nodeType&&!fb.get(g,"hasDataAttrs"))){for(d=g.attributes;h<d.length;h++)e=d[h].name,0===e.indexOf("data-")&&(e=T.camelCase(e.slice(5)),f(g,e,i[e]));fb.set(g,"hasDataAttrs",!0)}return i}return"object"==typeof a?this.each(function(){eb.set(this,a)}):T.access(this,function(c){var d,e=T.camelCase(a);if(g&&c===b){if(d=eb.get(g,a),d!==b)return d;if(d=eb.get(g,e),d!==b)return d;if(d=f(g,e,b),d!==b)return d}else this.each(function(){var d=eb.get(this,e);eb.set(this,e,c),-1!==a.indexOf("-")&&d!==b&&eb.set(this,a,c)})},null,c,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){eb.remove(this,a)})}}),T.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=fb.get(a,b),c&&(!d||T.isArray(c)?d=fb.access(a,b,T.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=T.queue(a,b),d=c.length,e=c.shift(),f=T._queueHooks(a,b),g=function(){T.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return fb.get(a,c)||fb.access(a,c,{empty:T.Callbacks("once memory").add(function(){fb.remove(a,[b+"queue",c])})})}}),T.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?T.queue(this[0],a):c===b?this:this.each(function(){var b=T.queue(this,a,c);T._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&T.dequeue(this,a)})},dequeue:function(a){return this.each(function(){T.dequeue(this,a)})},delay:function(a,b){return a=T.fx?T.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=T.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=fb.get(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var ib,jb,kb=/[\t\r\n\f]/g,lb=/\r/g,mb=/^(?:input|select|textarea|button)$/i;T.fn.extend({attr:function(a,b){return T.access(this,T.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){T.removeAttr(this,a)})},prop:function(a,b){return T.access(this,T.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[T.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(T.isFunction(a))return this.each(function(b){T(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(V)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(kb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=T.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(T.isFunction(a))return this.each(function(b){T(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(V)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(kb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?T.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):T.isFunction(a)?this.each(function(c){T(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,e=T(this),f=a.match(V)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===E||"boolean"===c)&&(this.className&&fb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":fb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(kb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=T.isFunction(a),this.each(function(d){var f;1===this.nodeType&&(f=e?a.call(this,d,T(this).val()):a,null==f?f="":"number"==typeof f?f+="":T.isArray(f)&&(f=T.map(f,function(a){return null==a?"":a+""})),c=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=T.valHooks[f.type]||T.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(lb,""):null==d?"":d)}}}),T.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(T.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&T.nodeName(c.parentNode,"optgroup"))){if(b=T(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=T.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=T.inArray(T(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return typeof a.getAttribute===E?T.prop(a,c,d):(1===g&&T.isXMLDoc(a)||(c=c.toLowerCase(),e=T.attrHooks[c]||(T.expr.match.bool.test(c)?jb:ib)),d===b?e&&"get"in e&&null!==(f=e.get(a,c))?f:(f=T.find.attr(a,c),null==f?b:f):null!==d?e&&"set"in e&&(f=e.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):(T.removeAttr(a,c),void 0))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(V);if(f&&1===a.nodeType)for(;c=f[e++];)d=T.propFix[c]||c,T.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!T.support.radioValue&&"radio"===b&&T.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!T.isXMLDoc(a),g&&(c=T.propFix[c]||c,f=T.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||mb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),jb={set:function(a,b,c){return b===!1?T.removeAttr(a,c):a.setAttribute(c,c),c}},T.each(T.expr.match.bool.source.match(/\w+/g),function(a,c){var d=T.expr.attrHandle[c]||T.find.attr;T.expr.attrHandle[c]=function(a,c,e){var f=T.expr.attrHandle[c],g=e?b:(T.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return T.expr.attrHandle[c]=f,g}}),T.support.optSelected||(T.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){T.propFix[this.toLowerCase()]=this}),T.each(["radio","checkbox"],function(){T.valHooks[this]={set:function(a,b){return T.isArray(b)?a.checked=T.inArray(T(a).val(),b)>=0:void 0}},T.support.checkOn||(T.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var nb=/^key/,ob=/^(?:mouse|contextmenu)|click/,pb=/^(?:focusinfocus|focusoutblur)$/,qb=/^([^.]*)(?:\.(.+)|)$/;T.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=fb.get(a);if(r){for(d.handler&&(g=d,d=g.handler,f=g.selector),d.guid||(d.guid=T.guid++),(j=r.events)||(j=r.events={}),(h=r.handle)||(h=r.handle=function(a){return typeof T===E||a&&T.event.triggered===a.type?b:T.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=(c||"").match(V)||[""],k=c.length;k--;)i=qb.exec(c[k])||[],o=q=i[1],p=(i[2]||"").split(".").sort(),o&&(m=T.event.special[o]||{},o=(f?m.delegateType:m.bindType)||o,m=T.event.special[o]||{},l=T.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&T.expr.match.needsContext.test(f),namespace:p.join(".")},g),(n=j[o])||(n=j[o]=[],n.delegateCount=0,m.setup&&m.setup.call(a,e,p,h)!==!1||a.addEventListener&&a.addEventListener(o,h,!1)),m.add&&(m.add.call(a,l),l.handler.guid||(l.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,l):n.push(l),T.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=fb.hasData(a)&&fb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(V)||[""],j=b.length;j--;)if(h=qb.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=T.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||T.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)T.event.remove(a,n+b[j],c,d,!0);T.isEmptyObject(i)&&(delete q.handle,fb.remove(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||F],o=R.call(c,"type")?c.type:c,p=R.call(c,"namespace")?c.namespace.split("."):[];if(h=i=e=e||F,3!==e.nodeType&&8!==e.nodeType&&!pb.test(o+T.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),k=o.indexOf(":")<0&&"on"+o,c=c[T.expando]?c:new T.Event(o,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:T.makeArray(d,[c]),m=T.event.special[o]||{},f||!m.trigger||m.trigger.apply(e,d)!==!1)){if(!f&&!m.noBubble&&!T.isWindow(e)){for(j=m.delegateType||o,pb.test(j+o)||(h=h.parentNode);h;h=h.parentNode)n.push(h),i=h;i===(e.ownerDocument||F)&&n.push(i.defaultView||i.parentWindow||a)}for(g=0;(h=n[g++])&&!c.isPropagationStopped();)c.type=g>1?j:m.bindType||o,l=(fb.get(h,"events")||{})[c.type]&&fb.get(h,"handle"),l&&l.apply(h,d),l=k&&h[k],l&&T.acceptData(h)&&l.apply&&l.apply(h,d)===!1&&c.preventDefault();return c.type=o,f||c.isDefaultPrevented()||m._default&&m._default.apply(n.pop(),d)!==!1||!T.acceptData(e)||k&&T.isFunction(e[o])&&!T.isWindow(e)&&(i=e[k],i&&(e[k]=null),T.event.triggered=o,e[o](),T.event.triggered=b,i&&(e[k]=i)),c.result}},dispatch:function(a){a=T.event.fix(a);var c,d,e,f,g,h=[],i=O.call(arguments),j=(fb.get(this,"events")||{})[a.type]||[],k=T.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=T.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(g=f.handlers[d++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((T.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),e!==b&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!==this;j=j.parentNode||this)if(j.disabled!==!0||"click"!==a.type){for(e=[],d=0;i>d;d++)g=c[d],f=g.selector+" ",e[f]===b&&(e[f]=g.needsContext?T(f,this).index(j)>=0:T.find(f,this,null,[j]).length),e[f]&&e.push(g);e.length&&h.push({elem:j,handlers:e})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||F,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[T.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=ob.test(e)?this.mouseHooks:nb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new T.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=F),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==i()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===i()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&T.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return T.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=T.extend(new T.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?T.event.trigger(e,null,b):T.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},T.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},T.Event=function(a,b){return this instanceof T.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?g:h):this.type=a,b&&T.extend(this,b),this.timeStamp=a&&a.timeStamp||T.now(),this[T.expando]=!0,void 0):new T.Event(a,b)},T.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=g,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=g,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()}},T.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){T.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!T.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),T.support.focusinBubbles||T.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){T.event.simulate(b,a.target,T.event.fix(a),!0)};T.event.special[b]={setup:function(){0===c++&&F.addEventListener(a,d,!0)},teardown:function(){0===--c&&F.removeEventListener(a,d,!0)}}}),T.fn.extend({on:function(a,c,d,e,f){var g,i;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=h;else if(!e)return this;return 1===f&&(g=e,e=function(a){return T().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=T.guid++)),this.each(function(){T.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,T(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=h),this.each(function(){T.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){T.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?T.event.trigger(a,b,c,!0):void 0}});var rb=/^.[^:#\[\.,]*$/,sb=/^(?:parents|prev(?:Until|All))/,tb=T.expr.match.needsContext,ub={children:!0,contents:!0,next:!0,prev:!0};T.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(T(a).filter(function(){for(b=0;e>b;b++)if(T.contains(d[b],this))return!0}));for(b=0;e>b;b++)T.find(a,d[b],c);return c=this.pushStack(e>1?T.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b=T(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(T.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(k(this,a||[],!0))},filter:function(a){return this.pushStack(k(this,a||[],!1))},is:function(a){return!!k(this,"string"==typeof a&&tb.test(a)?T(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=tb.test(a)||"string"!=typeof a?T(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&T.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?T.unique(f):f)},index:function(a){return a?"string"==typeof a?P.call(T(a),this[0]):P.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?T(a,b):T.makeArray(a&&a.nodeType?[a]:a),d=T.merge(this.get(),c);return this.pushStack(T.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),T.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return T.dir(a,"parentNode")},parentsUntil:function(a,b,c){return T.dir(a,"parentNode",c)},next:function(a){return j(a,"nextSibling")},prev:function(a){return j(a,"previousSibling")},nextAll:function(a){return T.dir(a,"nextSibling")},prevAll:function(a){return T.dir(a,"previousSibling")},nextUntil:function(a,b,c){return T.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return T.dir(a,"previousSibling",c)},siblings:function(a){return T.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return T.sibling(a.firstChild)},contents:function(a){return a.contentDocument||T.merge([],a.childNodes)}},function(a,b){T.fn[a]=function(c,d){var e=T.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=T.filter(d,e)),this.length>1&&(ub[a]||T.unique(e),sb.test(a)&&e.reverse()),this.pushStack(e)}}),T.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?T.find.matchesSelector(d,a)?[d]:[]:T.find.matches(a,T.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=d!==b;(a=a[c])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&T(a).is(d))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var vb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,wb=/<([\w:]+)/,xb=/<|&#?\w+;/,yb=/<(?:script|style|link)/i,zb=/^(?:checkbox|radio)$/i,Ab=/checked\s*(?:[^=]|=\s*.checked.)/i,Bb=/^$|\/(?:java|ecma)script/i,Cb=/^true\/(.*)/,Db=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Eb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Eb.optgroup=Eb.option,Eb.tbody=Eb.tfoot=Eb.colgroup=Eb.caption=Eb.thead,Eb.th=Eb.td,T.fn.extend({text:function(a){return T.access(this,function(a){return a===b?T.text(this):this.empty().append((this[0]&&this[0].ownerDocument||F).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?T.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||T.cleanData(q(c)),c.parentNode&&(b&&T.contains(c.ownerDocument,c)&&o(q(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(T.cleanData(q(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return T.clone(this,a,b)})},html:function(a){return T.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b&&1===c.nodeType)return c.innerHTML;if("string"==typeof a&&!yb.test(a)&&!Eb[(wb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(vb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(T.cleanData(q(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=T.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),T(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=M.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,o=k-1,p=a[0],r=T.isFunction(p);if(r||!(1>=k||"string"!=typeof p||T.support.checkClone)&&Ab.test(p))return this.each(function(d){var e=l.eq(d);r&&(a[0]=p.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(d=T.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){for(f=T.map(q(d,"script"),m),g=f.length;k>j;j++)h=d,j!==o&&(h=T.clone(h,!0,!0),g&&T.merge(f,q(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,T.map(f,n),j=0;g>j;j++)h=f[j],Bb.test(h.type||"")&&!fb.access(h,"globalEval")&&T.contains(i,h)&&(h.src?T._evalUrl(h.src):T.globalEval(h.textContent.replace(Db,"")))}return this}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){T.fn[a]=function(a){for(var c,d=[],e=T(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),T(e[g])[b](c),N.apply(d,c.get());
return this.pushStack(d)}}),T.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=T.contains(a.ownerDocument,a);if(!(T.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||T.isXMLDoc(a)))for(g=q(h),f=q(a),d=0,e=f.length;e>d;d++)r(f[d],g[d]);if(b)if(c)for(f=f||q(a),g=g||q(h),d=0,e=f.length;e>d;d++)p(f[d],g[d]);else p(a,h);return g=q(h,"script"),g.length>0&&o(g,!i&&q(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),n=[];l>k;k++)if(e=a[k],e||0===e)if("object"===T.type(e))T.merge(n,e.nodeType?[e]:e);else if(xb.test(e)){for(f=f||m.appendChild(b.createElement("div")),g=(wb.exec(e)||["",""])[1].toLowerCase(),h=Eb[g]||Eb._default,f.innerHTML=h[1]+e.replace(vb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;T.merge(n,f.childNodes),f=m.firstChild,f.textContent=""}else n.push(b.createTextNode(e));for(m.textContent="",k=0;e=n[k++];)if((!d||-1===T.inArray(e,d))&&(i=T.contains(e.ownerDocument,e),f=q(m.appendChild(e),"script"),i&&o(f),c))for(j=0;e=f[j++];)Bb.test(e.type||"")&&c.push(e);return m},cleanData:function(a){for(var c,d,f,g,h,i,j=T.event.special,k=0;(d=a[k])!==b;k++){if(e.accepts(d)&&(h=d[fb.expando],h&&(c=fb.cache[h]))){if(f=Object.keys(c.events||{}),f.length)for(i=0;(g=f[i])!==b;i++)j[g]?T.event.remove(d,g):T.removeEvent(d,g,c.handle);fb.cache[h]&&delete fb.cache[h]}delete eb.cache[d[eb.expando]]}},_evalUrl:function(a){return T.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});var Fb,Gb,Hb=/^(none|table(?!-c[ea]).+)/,Ib=/^margin/,Jb=new RegExp("^("+U+")(.*)$","i"),Kb=new RegExp("^("+U+")(?!px)[a-z%]+$","i"),Lb=new RegExp("^([+-])=("+U+")","i"),Mb={BODY:"block"},Nb={position:"absolute",visibility:"hidden",display:"block"},Ob={letterSpacing:0,fontWeight:400},Pb=["Top","Right","Bottom","Left"],Qb=["Webkit","O","Moz","ms"];T.fn.extend({css:function(a,c){return T.access(this,function(a,c,d){var e,f,g={},h=0;if(T.isArray(c)){for(e=u(a),f=c.length;f>h;h++)g[c[h]]=T.css(a,c[h],!1,e);return g}return d!==b?T.style(a,c,d):T.css(a,c)},a,c,arguments.length>1)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){t(this)?T(this).show():T(this).hide()})}}),T.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Fb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=T.camelCase(c),j=a.style;return c=T.cssProps[i]||(T.cssProps[i]=s(j,i)),h=T.cssHooks[c]||T.cssHooks[i],d===b?h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c]:(g=typeof d,"string"===g&&(f=Lb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(T.css(a,c)),g="number"),null==d||"number"===g&&isNaN(d)||("number"!==g||T.cssNumber[i]||(d+="px"),T.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b||(j[c]=d)),void 0)}},css:function(a,c,d,e){var f,g,h,i=T.camelCase(c);return c=T.cssProps[i]||(T.cssProps[i]=s(a.style,i)),h=T.cssHooks[c]||T.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,d)),f===b&&(f=Fb(a,c,e)),"normal"===f&&c in Ob&&(f=Ob[c]),""===d||d?(g=parseFloat(f),d===!0||T.isNumeric(g)?g||0:f):f}}),Fb=function(a,c,d){var e,f,g,h=d||u(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||T.contains(a.ownerDocument,a)||(i=T.style(a,c)),Kb.test(i)&&Ib.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i},T.each(["height","width"],function(a,b){T.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Hb.test(T.css(a,"display"))?T.swap(a,Nb,function(){return y(a,b,d)}):y(a,b,d):void 0},set:function(a,c,d){var e=d&&u(a);return w(a,c,d?x(a,b,d,T.support.boxSizing&&"border-box"===T.css(a,"boxSizing",!1,e),e):0)}}}),T(function(){T.support.reliableMarginRight||(T.cssHooks.marginRight={get:function(a,b){return b?T.swap(a,{display:"inline-block"},Fb,[a,"marginRight"]):void 0}}),!T.support.pixelPosition&&T.fn.position&&T.each(["top","left"],function(a,b){T.cssHooks[b]={get:function(a,c){return c?(c=Fb(a,b),Kb.test(c)?T(a).position()[b]+"px":c):void 0}}})}),T.expr&&T.expr.filters&&(T.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},T.expr.filters.visible=function(a){return!T.expr.filters.hidden(a)}),T.each({margin:"",padding:"",border:"Width"},function(a,b){T.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+Pb[d]+b]=f[d]||f[d-2]||f[0];return e}},Ib.test(a)||(T.cssHooks[a+b].set=w)});var Rb=/%20/g,Sb=/\[\]$/,Tb=/\r?\n/g,Ub=/^(?:submit|button|image|reset|file)$/i,Vb=/^(?:input|select|textarea|keygen)/i;T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=T.prop(this,"elements");return a?T.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!T(this).is(":disabled")&&Vb.test(this.nodeName)&&!Ub.test(a)&&(this.checked||!zb.test(a))}).map(function(a,b){var c=T(this).val();return null==c?null:T.isArray(c)?T.map(c,function(a){return{name:b.name,value:a.replace(Tb,"\r\n")}}):{name:b.name,value:c.replace(Tb,"\r\n")}}).get()}}),T.param=function(a,c){var d,e=[],f=function(a,b){b=T.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=T.ajaxSettings&&T.ajaxSettings.traditional),T.isArray(a)||a.jquery&&!T.isPlainObject(a))T.each(a,function(){f(this.name,this.value)});else for(d in a)B(d,a[d],c,f);return e.join("&").replace(Rb,"+")},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=T:"function"==typeof define&&define.amd&&define("jquery",[],function(){return T}),"object"==typeof a&&"object"==typeof a.document&&(a.jQuery=a.$=T)}(window),define("virtualjoystick",[],function(){var a=function(a){a=a||{},this._container=a.container||document.body,this._strokeStyle=a.strokeStyle||"cyan",this._stickEl=a.stickElement||this._buildJoystickStick(),this._baseEl=a.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==a.mouseSupport?a.mouseSupport:!1,this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._baseX=0,this._baseY=0,this._stickX=0,this._stickY=0;var b=function(a,b){return function(){return a.apply(b,arguments)}};this._$onTouchStart=b(this._onTouchStart,this),this._$onTouchEnd=b(this._onTouchEnd,this),this._$onTouchMove=b(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=b(this._onMouseDown,this),this._$onMouseUp=b(this._onMouseUp,this),this._$onMouseMove=b(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};return a.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},a.touchScreenAvailable=function(){return"createTouch"in document?!0:!1},function(a){a.addEventListener=function(a,b){return void 0===this._events&&(this._events={}),this._events[a]=this._events[a]||[],this._events[a].push(b),b},a.removeEventListener=function(a,b){void 0===this._events&&(this._events={}),a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)},a.dispatchEvent=function(a){if(void 0===this._events&&(this._events={}),void 0!==this._events[a]){for(var b=this._events[a].slice(),c=0;c<b.length;c++){var d=b[c].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==d)return d}return void 0}}}(a.prototype),a.prototype.deltaX=function(){return this._stickX-this._baseX},a.prototype.deltaY=function(){return this._stickY-this._baseY},a.prototype.up=function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return b>=0?!1:Math.abs(a)>2*Math.abs(b)?!1:!0},a.prototype.down=function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return 0>=b?!1:Math.abs(a)>2*Math.abs(b)?!1:!0},a.prototype.right=function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return 0>=a?!1:Math.abs(b)>2*Math.abs(a)?!1:!0},a.prototype.left=function(){if(this._pressed===!1)return!1;var a=this.deltaX(),b=this.deltaY();return a>=0?!1:Math.abs(b)>2*Math.abs(a)?!1:!0},a.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0},a.prototype._onDown=function(a,b){this._pressed=!0,this._baseX=a,this._baseY=b,this._stickX=a,this._stickY=b,this._stickEl.style.display="",this._stickEl.style.left=a-this._stickEl.width/2+"px",this._stickEl.style.top=b-this._stickEl.height/2+"px",this._baseEl.style.display="",this._baseEl.style.left=a-this._baseEl.width/2+"px",this._baseEl.style.top=b-this._baseEl.height/2+"px"},a.prototype._onMove=function(a,b){this._pressed===!0&&(this._stickX=a,this._stickY=b,this._stickEl.style.left=a-this._stickEl.width/2+"px",this._stickEl.style.top=b-this._stickEl.height/2+"px")},a.prototype._onMouseUp=function(){return this._onUp()},a.prototype._onMouseDown=function(a){var b=a.clientX,c=a.clientY;return this._onDown(b,c)},a.prototype._onMouseMove=function(a){var b=a.clientX,c=a.clientY;return this._onMove(b,c)},a.prototype._onTouchStart=function(a){if(null===this._touchIdx){var b=this.dispatchEvent("touchStartValidation",a);if(b!==!1){a.preventDefault();var c=a.changedTouches[0];this._touchIdx=c.identifier;var d=c.pageX,e=c.pageY;return this._onDown(d,e)}}},a.prototype._onTouchEnd=function(a){if(null!==this._touchIdx){for(var b=a.changedTouches,c=0;c<b.length&&b[c].identifier!==this._touchIdx;c++);if(c!==b.length)return this._touchIdx=null,a.preventDefault(),this._onUp()}},a.prototype._onTouchMove=function(a){if(null!==this._touchIdx){for(var b=a.changedTouches,c=0;c<b.length&&b[c].identifier!==this._touchIdx;c++);if(c!==b.length){var d=b[c];a.preventDefault();var e=d.pageX,f=d.pageY;return this._onMove(e,f)}}},a.prototype._buildJoystickBase=function(){var a=document.createElement("canvas");a.width=126,a.height=126;var b=a.getContext("2d");return b.beginPath(),b.strokeStyle=this._strokeStyle,b.lineWidth=6,b.arc(a.width/2,a.width/2,40,0,2*Math.PI,!0),b.stroke(),b.beginPath(),b.strokeStyle=this._strokeStyle,b.lineWidth=2,b.arc(a.width/2,a.width/2,60,0,2*Math.PI,!0),b.stroke(),a},a.prototype._buildJoystickStick=function(){var a=document.createElement("canvas");a.width=86,a.height=86;var b=a.getContext("2d");return b.beginPath(),b.strokeStyle=this._strokeStyle,b.lineWidth=6,b.arc(a.width/2,a.width/2,40,0,2*Math.PI,!0),b.stroke(),a},a}),define("systems/playercontrol",["jquery","lodash","pc","vent","virtualjoystick"],function(a,b,c,d,e){return c.systems.Input.extend("PlayerControlSystem",{},{init:function(){this.joystickR=new e({container:a("#virtualjoystick")[0],strokeStyle:"cyan"}),this.joystickR.addEventListener("touchStartValidation",function(a){var b=a.changedTouches[0];return b.pageX>=window.innerWidth/2?!1:!0}),this.joystickL=new e({container:a("#virtualjoystick")[0],strokeStyle:"orange"}),this.joystickL.addEventListener("touchStartValidation",function(a){var b=a.changedTouches[0];return b.pageX<window.innerWidth/2?!1:!0}),this._super()},process:function(a){var b,e,f,g=a.getComponent("input"),h=a.getComponent("state");return g?(this._super(a),h.isAlive()&&(this.isInputState(a,"moving up")||this.joystickR.up()?b="N":this.isInputState(a,"moving down")||this.joystickR.down()?b="S":this.isInputState(a,"moving right")||this.joystickR.right()?b="E":(this.isInputState(a,"moving left")||this.joystickR.left())&&(b="W"),e=this.isInputState(a,"attacking"),e||(this.joystickL.up()?(b="N",e=!0):this.joystickL.down()?(b="S",e=!0):this.joystickL.right()?(b="E",e=!0):this.joystickL.left()&&(b="W",e=!0)),e?f=["attack",b||g.lastDirection||"S"]:b?f=["move",b||g.lastDirection||"S"]:g&&(f=["stop"]),(f[0]!==g.lastAction||f[1]!==g.lastDirection)&&(g.lastAction=f[0],g.lastDirection=f[1]||g.lastDirection,d.trigger("input",f[0],f[1]))),void 0):(c.device.input.stateBindings.clear(),void 0)}})}),define("systems/meta",["pc"],function(a){return a.systems.EntitySystem.extend("MetaSystem",{},{init:function(){this._super(["meta"])},process:function(b){var c=b.getComponent("spatial"),d=b.getComponent("meta"),e=(d.username,a.device.ctx);c&&d&&d.username&&(e.font="11px ponderosa,monospace",e.textAlign="center",e.fillStyle=b.hasTag("PLAYER")?"rgba(255,255,255,1.0)":"rgba(255,157,0,1.0)",e.fillText(d.username,b.layer.screenX(c.pos.x+.5*c.getDim().x),b.layer.screenY(c.pos.y+.12*c.getDim().y)))}})}),define("lobbymanager",["jquery","lodash","vent"],function(a,b,c){var d=function(){this.show=function(){this.$lobby.show()},this.hide=function(){this.$lobby.hide()},this.updatedLeaderBoard=function(){var b=this,c=a("<table/>"),d="<tr><td>Pos</td><td>Player</td><td>Kills</td><td>Deaths</td><td>Score</td></tr>",e=_.map(this.metacollector,function(a){return a}),e=_.sortBy(e,"score");c.append(d),_.each(e,function(a,d){a.position=d+1,c.append(b.leaderboardEntryTpl(a))}),this.$leaderboard.html(c)},this.getRandomName=function(){var a=["Aayla Secura","Ackbar","Isard","Motti","Ahsoka Tano","Anakin Solo","Asajj","Ventress","Aurra Sing","Bail Organa","Barriss","Offee","Bastila Shan","Bib Fortuna","Biggs","Boba Fett","Bossk","Boss Nass","C3P0","Cad Bane","Ordo","Captain Rex","Chewbacca","Cody","Count Dooku","Dak","Bane","Krayt","Malak","Maul","Nihilus","Revan","Sion","Traya","Vader","Dash Rendar","Dengar","Desann","Evazan","Durge","Palpatine","Exar Kun","Grievous","General","Madine","Gilad","Pellaeon","Thrawn","Greedo","Han Solo","HK-47","Hondo Ohnaka","IG-88","Jabba","Jacen Solo","Jaina Solo","Jango Fett","Jaxxon","Jek Porkins","Jerec","Joruus C'baoth","Ki-Adi-Mundi","Kir Kanos","Kit Fisto","Kyle Katarn","Lando","Calrissian","Lobot","Skywalker","Luminara","Unduli","Lumiya","Mace Windu","Mara Jade","Max Rebo","Mon Mothma","Natasi Daala","Nien Nunb","Noa","Briqualon","Obi-Wan Kenobi","Oola","Amidala","Plo Koon","Leia","Prince Xizor","PROXY","Qui-Gon Jinn","Quinlan Vos","R2-D2","Salacious","Sebulba","Shaak Ti","Starkiller","Talon Karrde","Uncle Owen","Watto","Antilles","Wicket","Yaddle","Yoda","Zam Wesell"],b=["Darth","Commander","Lord","Emperor","Duke"],c=a[_.random(a.length-1)],d=b[_.random(b.length-1)],e=d+" "+c;return e.length>12?c:e},this.init=function(){var b=this;this.metacollector={},this.leaderboardEntryTpl=_.template("<tr><td><%- position %></td><td><%- username %></td><td><%- kills %></td><td><%- deaths %></td><td><%- score %></td></tr>"),a(".username").val().length||a(".username").val(this.getRandomName()),this.$lobby=a(".lobby"),this.$leaderboard=this.$lobby.find(".leaderboard"),this.$lobby.on("change",".username",function(){c.trigger("username",a(this).val())}),this.$lobby.on("click",".spawn",function(){c.trigger("username",a(".username").val()),c.trigger("spawn")}),this.$lobby.on("click",".need-help",function(){a(".help").toggle()}),c.on("connected",function(){b.$lobby.find(".status").text("Connected :)"),_.delay(function(){c.trigger("username",a(".username").val())},100),b.$lobby.find(".spawn").show()}),c.on("disconnected",function(){b.$lobby.show(),b.$lobby.find(".status").text("Connection lost :("),b.$lobby.find(".spawn").hide()}),c.on("meta",function(a){b.metacollector[a.id]=a,b.updatedLeaderBoard()}),c.on("remove",function(a){b.metacollector[a.id]&&(delete b.metacollector[a.id],b.updatedLeaderBoard())})}};return new d}),define("scenes/game",["lodash","pc","vent","entityfactory","systems/playercontrol","systems/meta","lobbymanager"],function(a,b,c,d,e,f,g){var h=b.Scene.extend("pc.archers.GameScene",{},{entities:{},cameraOperationLag:0,init:function(){var h,i,j,k=this;for(this._super(),this.factory=new d,this.playercontrol=new e,this.loadFromTMX(b.device.loader.get("map").resource,this.factory),this.layer=this.get("500main"),j=this.layers.first;j;)h=j.object(),i=h.name.match(/\d+/),i&&i.length&&h.setZIndex(parseInt(i[0],10)),h.setOriginTrack(this.layer),j=j.next();this.layer.addSystem(new b.systems.Render),this.layer.addSystem(this.playercontrol),this.layer.addSystem(new f),c.on("update",function(a){if(k.isActive()){var c=b.Point.create(a.width,a.height),d={id:a.id,state:a.state,player:a.player};k.entities[a.id]=k.factory.createEntity(k.layer,a.entityType,a.x,a.y,a.direction,c,d)}}),c.on("frame",function(b){if(k.isActive()){var c=k.entities[b.id],d=c.getComponent("spatial"),e=c.getComponent("state"),f=c.getComponent("sprite"),h=["dead","unknown"];d&&(d.getPos().x=b.x-.5*d.getDim().x,d.getPos().y=b.y-.5*d.getDim().y),e&&f&&(c.hasTag("PLAYER")&&!a.contains(h,e.state)&&a.contains(h,b.state)&&(g.show(),k.player.getComponent("input")._bound=!1,k.player.removeComponentByType("input")),c.hasTag("PLAYER")&&a.contains(h,e.state)&&!a.contains(h,b.state)&&(g.hide(),k.player.addComponent(k.factory.getInput())),e.changeState(f,b.state,b.direction))}}),c.on("remove",function(a){if(k.isActive()){var b=k.entities[a.id];b.remove()}}),c.on("meta",function(a){var b,c=k.entities[a.id];c&&(b=c.getComponent("meta"),b&&b.update(a))})},onActivated:function(){g.show()},onDeactivated:function(){g.hide()},hoverCamera:function(){var a,b,c,d=this.layers.first.object(),e=d.tileMap.tileWidth*d.tileMap.tilesWide,f=d.tileMap.tileHeight*d.tileMap.tilesHigh,g=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};this.viewPort.w>=e||this.viewPort.h>=f||(this.cameraOperationLag++,4==this.cameraOperationLag?(a=this.layer.origin.x+1,this.cameraOperationLag=0):a=this.layer.origin.x,b=a+this.viewPort.w,c=this.layer.origin.y+this.viewPort.h,b>e||c>f?this.layer.setOrigin(g(1,e-this.viewPort.w),g(1,e-this.viewPort.h)):this.layer.setOrigin(a,this.layer.origin.y))},process:function(){var a,c;b.device.loader.finished&&(a=this.layer.entityManager.getTagged("PLAYER"),a&&(this.player=a=a.first.object(),c=a.getComponent("state")),a&&c.isAlive()?this.layer.setOrigin(a.getComponent("spatial").getCenterPos().x-this.viewPort.w/2,a.getComponent("spatial").getCenterPos().y-this.viewPort.h/2):this.hoverCamera(),b.device.ctx.clearRect(0,0,b.device.canvasWidth,b.device.canvasHeight),this._super())}});return h}),define("archers",["pc","networking","scenes/game","lobbymanager"],function(a,b,c,d){var e=a.Game.extend("Archers",{},{onReady:function(){this._super(),d.init(),a.device.loader.add(new a.DataResource("map","/resources/map.tmx")),a.device.loader.add(new a.Image("combined","/resources/tiles.png")),a.device.loader.add(new a.Image("archer","/resources/archer.png")),a.device.loader.add(new a.Image("arrow","/resources/arrow.png")),a.device.loader.add(new a.Image("skeleton","/resources/skeleton.png")),a.device.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this))},onLoading:function(b){var c=a.device.ctx;c.clearRect(0,0,a.device.canvasWidth,a.device.canvasHeight),c.font="normal 50px Times",c.fillStyle="#bbb",c.fillText("Archers!",40,a.device.canvasHeight/2-50),c.font="normal 14px Verdana",c.fillStyle="#777",c.fillText("Loading:  "+b+"%",40,a.device.canvasHeight/2)},onLoaded:function(){this.gameScene=new c,this.addScene(this.gameScene),this.activateScene(this.gameScene),this.networking=new b}});return e}),define("bootstrap",["pc","archers"],function(a,b){window.Archers=b,a.device.boot("game","Archers")}),require(["bootstrap"])}();