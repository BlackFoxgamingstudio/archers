!function(){function printStackTrace(t){t=t||{guess:!0};var e=t.e||null,o=!!t.guess,i=new printStackTrace.implementation,n=i.run(e);return o?i.guessAnonymousFunctions(n):n}window.pc||(window.pc={},pc.VERSION="0.5.6");var requirejs,require,define;!function(t){function e(t,e){return x.call(t,e)}function o(t,e){var o,i,n,s,a,r,c,l,h,m,u=e&&e.split("/"),p=d.map,y=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(u=u.slice(0,u.length-1),t=u.concat(t.split("/")),l=0;l<t.length;l+=1)if(m=t[l],"."===m)t.splice(l,1),l-=1;else if(".."===m){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((u||y)&&p){for(o=t.split("/"),l=o.length;l>0;l-=1){if(i=o.slice(0,l).join("/"),u)for(h=u.length;h>0;h-=1)if(n=p[u.slice(0,h).join("/")],n&&(n=n[i])){s=n,a=l;break}if(s)break;!r&&y&&y[i]&&(r=y[i],c=l)}!s&&r&&(s=r,a=c),s&&(o.splice(0,a,s),t=o.join("/"))}return t}function i(e,o){return function(){return h.apply(t,_.call(arguments,0).concat([e,o]))}}function n(t){return function(e){return o(e,t)}}function s(t){return function(e){p[t]=e}}function a(o){if(e(y,o)){var i=y[o];delete y[o],f[o]=!0,l.apply(t,i)}if(!e(p,o)&&!e(f,o))throw new Error("No "+o);return p[o]}function r(t){var e,o=t?t.indexOf("!"):-1;return o>-1&&(e=t.substring(0,o),t=t.substring(o+1,t.length)),[e,t]}function c(t){return function(){return d&&d.config&&d.config[t]||{}}}var l,h,m,u,p={},y={},d={},f={},x=Object.prototype.hasOwnProperty,_=[].slice;m=function(t,e){var i,s=r(t),c=s[0];return t=s[1],c&&(c=o(c,e),i=a(c)),c?t=i&&i.normalize?i.normalize(t,n(e)):o(t,e):(t=o(t,e),s=r(t),c=s[0],t=s[1],c&&(i=a(c))),{f:c?c+"!"+t:t,n:t,pr:c,p:i}},u={require:function(t){return i(t)},exports:function(t){var e=p[t];return"undefined"!=typeof e?e:p[t]={}},module:function(t){return{id:t,uri:"",exports:p[t],config:c(t)}}},l=function(o,n,r,c){var l,h,d,x,_,g,b=[];if(c=c||o,"function"==typeof r){for(n=!n.length&&r.length?["require","exports","module"]:n,_=0;_<n.length;_+=1)if(x=m(n[_],c),h=x.f,"require"===h)b[_]=u.require(o);else if("exports"===h)b[_]=u.exports(o),g=!0;else if("module"===h)l=b[_]=u.module(o);else if(e(p,h)||e(y,h)||e(f,h))b[_]=a(h);else{if(!x.p)throw new Error(o+" missing "+h);x.p.load(x.n,i(c,!0),s(h),{}),b[_]=p[h]}d=r.apply(p[o],b),o&&(l&&l.exports!==t&&l.exports!==p[o]?p[o]=l.exports:d===t&&g||(p[o]=d))}else o&&(p[o]=r)},requirejs=require=h=function(e,o,i,n,s){return"string"==typeof e?u[e]?u[e](o):a(m(e,o).f):(e.splice||(d=e,o.splice?(e=o,o=i,i=null):e=t),o=o||function(){},"function"==typeof i&&(i=n,n=s),n?l(t,e,o,i):setTimeout(function(){l(t,e,o,i)},4),h)},h.config=function(t){return d=t,d.deps&&h(d.deps,d.callback),h},define=function(t,o,i){o.splice||(i=o,o=[]),e(p,t)||e(y,t)||(y[t]=[t,o,i])},define.amd={jQuery:!0}}(),define("../components/almond/almond",function(){}),window.gamecore={hasOwn:Object.prototype.hasOwnProperty,isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},isWindow:function(t){return!(!t||!t.setInterval)},isArray:Array.isArray||function(t){return t.constructor===Array},isString:function(t){return"string"==typeof t},isObject:function(t){return t===Object(t)},isPlainObject:function(t){if(!t||this.isObject(t)||t.nodeType||this.isWindow(t))return!1;try{if(t.constructor&&!this.hasOwn.call(t,"constructor")&&!this.hasOwn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var o;for(o in t);return void 0===o||this.hasOwn.call(t,o)},extend:function(){var t,e,o,i,n,s,a=arguments[0]||{},r=1,c=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[1]||{},r=2),"object"==typeof a||gamecore.isFunction(a)||(a={}),c===r&&(a=this,--r);c>r;r++)if(null!=(t=arguments[r]))for(e in t)o=a[e],i=t[e],a!==i&&(l&&i&&(this.isPlainObject(i)||(n=this.isArray(i)))?(n?(n=!1,s=o&&this.isArray(o)?o:[]):s=o&&this.isPlainObject(o)?o:{},a[e]=this.extend(l,s,i)):void 0!==i&&(a[e]=i));return a}},gamecore.push=Array.prototype.push,gamecore.merge=function(t,e){var o=t.length,i=0;if("number"==typeof e.length)for(var n=e.length;n>i;i++)t[o++]=e[i];else for(;void 0!==e[i];)t[o++]=e[i++];return t.length=o,t},gamecore.makeArray=function(t,e){var o=e||[];return null!=t&&(null==t.length||gamecore.isString(t)||gamecore.isFunction(t)||gamecore.isWindow(t)?gamecore.push.call(o,t):gamecore.merge(o,t)),o},gamecore.each=function(t,e,o){var i,n=0,s=t.length,a=void 0===s||gamecore.isFunction(t);if(o)if(a){for(i in t)if(e.apply(t[i],o)===!1)break}else for(;s>n&&e.apply(t[n++],o)!==!1;);else if(a){for(i in t)if(e.call(t[i],i,t[i])===!1)break}else for(;s>n&&e.call(t[n],n,t[n++])!==!1;);return t},gamecore._flagsCache={},gamecore.createFlags=function(t){var e,o,i=gamecore._flagsCache[t]={};for(t=t.split(/\s+/),e=0,o=t.length;o>e;e++)i[t[e]]=!0;return i},gamecore.Callbacks=function(t){t=t?gamecore._flagsCache[t]||gamecore.createFlags(t):{};var e,o,i,n,s,a=[],r=[],c=function(e){var o,i,n;for(o=0,i=e.length;i>o;o++)n=e[o],gamecore.isArray(n)?c(n):gamecore.isFunction(n)&&(t.unique&&h.has(n)||a.push(n))},l=function(c,l){for(l=l||[],e=!t.memory||[c,l],o=!0,s=i||0,i=0,n=a.length;a&&n>s;s++)if(a[s].apply(c,l)===!1&&t.stopOnFalse){e=!0;break}o=!1,a&&(t.once?e===!0?h.disable():a=[]:r&&r.length&&(e=r.shift(),h.fireWith(e[0],e[1])))},h={add:function(){if(a){var t=a.length;c(arguments),o?n=a.length:e&&e!==!0&&(i=t,l(e[0],e[1]))}return this},remove:function(){if(a)for(var e=arguments,i=0,r=e.length;r>i;i++)for(var c=0;c<a.length&&(e[i]!==a[c]||(o&&n>=c&&(n--,s>=c&&s--),a.splice(c--,1),!t.unique));c++);return this},has:function(t){if(a)for(var e=0,o=a.length;o>e;e++)if(t===a[e])return!0;return!1},empty:function(){return a=[],this},disable:function(){return a=r=e=void 0,this},disabled:function(){return!a},lock:function(){return r=void 0,e&&e!==!0||h.disable(),this},locked:function(){return!r},fireWith:function(i,n){return r&&(o?t.once||r.push([i,n]):t.once&&e||l(i,n)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!e}};return h},gamecore.extend({Deferred:function(t){var e,o=gamecore.Callbacks("once memory"),i=gamecore.Callbacks("once memory"),n=gamecore.Callbacks("memory"),s="pending",a={resolve:o,reject:i,notify:n},r={done:o.add,fail:i.add,progress:n.add,state:function(){return s},isResolved:o.fired,isRejected:i.fired,then:function(t,e,o){return c.done(t).fail(e).progress(o),this},always:function(){return c.done.apply(c,arguments).fail.apply(c,arguments),this},pipe:function(t,e,o){return gamecore.Deferred(function(i){gamecore.each({done:[t,"resolve"],fail:[e,"reject"],progress:[o,"notify"]},function(t,e){var o,n=e[0],s=e[1];gamecore.isFunction(n)?c[t](function(){o=n.apply(this,arguments),o&&gamecore.isFunction(o.promise)?o.promise().then(i.resolve,i.reject,i.notify):i[s+"With"](this===c?i:this,[o])}):c[t](i[s])})}).promise()},promise:function(t){if(null==t)t=r;else for(var e in r)t[e]=r[e];return t}},c=r.promise({});for(e in a)c[e]=a[e].fire,c[e+"With"]=a[e].fireWith;return c.done(function(){s="resolved"},i.disable,n.lock).fail(function(){s="rejected"},o.disable,n.lock),t&&t.call(c,c),c},when:function(t){function e(t){return function(e){n[t]=arguments.length>1?i.call(arguments,0):e,--c||l.resolveWith(l,n)}}function o(t){return function(e){r[t]=arguments.length>1?i.call(arguments,0):e,l.notifyWith(h,r)}}var i=[].slice,n=i.call(arguments,0),s=0,a=n.length,r=new Array(a),c=a,l=1>=a&&t&&gamecore.isFunction(t.promise)?t:gamecore.Deferred(),h=l.promise();if(a>1){for(;a>s;s++)n[s]&&n[s].promise&&gamecore.isFunction(n[s].promise)?n[s].promise().then(e(s),l.reject,o(s)):--c;c||l.resolveWith(l,n)}else l!==t&&l.resolveWith(l,a?[t]:[]);return h}}),define("playcraft/ext/gamecore.js/src/gamecore",function(){}),function(t){var e={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},o=function(t,e,o){return t[e]||o&&(t[e]={})},i=function(t){var e=typeof t;return e&&("function"==e||"object"==e)},n=function(n,s,a){var r,c,l,h=n?n.split(e.dot):[],m=h.length,u=t.isArray(s)?s:[s||window],p=0;if(0==m)return u[0];for(;r=u[p++];){for(l=0;m-1>l&&i(r);l++)r=o(r,h[l],a);if(i(r)&&(c=o(r,h[l],a),void 0!==c))return a===!1&&delete r[h[l]],c}},s=t.String={getObject:n,capitalize:function(t){return t.charAt(0).toUpperCase()+t.substr(1)},camelize:function(t){return t=s.classize(t),t.charAt(0).toLowerCase()+t.substr(1)},classize:function(t,o){for(var i=t.split(e.undHash),n=0;n<i.length;n++)i[n]=s.capitalize(i[n]);return i.join(o||"")},niceName:function(t){return s.classize(t," ")},underscore:function(t){return t.replace(e.colons,"/").replace(e.words,"$1_$2").replace(e.lowUp,"$1_$2").replace(e.dash,"_").toLowerCase()},sub:function(t,o,i){var s=[];return s.push(t.replace(e.replacer,function(t,e){var a=n(e,o,"boolean"==typeof i?!i:i),r=typeof a;return"object"!==r&&"function"!==r||null===r?""+a:(s.push(a),"")})),s.length<=1?s[0]:s}}}(gamecore),function(t){var e=!1,o=t.makeArray,i=t.isFunction,n=t.isArray,s=t.extend,a=function(t){if(!t||"object"!=typeof t)return t;if(t instanceof Array){for(var e=[],o=0;o<t.length;o++)e[o]=a(t[o]);return e}var i={};for(var n in t)i[n]=a(t[n]);return i},r=function(t,e){return t.concat(o(e))},c=/xyz/.test(function(){})?/\b_super\b/:/.*/,l=function(t,e,o){o=o||t;for(var n in t)o[n]=i(t[n])&&i(e[n])&&c.test(t[n])?function(t,o){return function(){var i,n=this._super;return this._super=e[t],i=o.apply(this,arguments),this._super=n,i}}(n,t[n]):t[n]},h=t.Class=function(){return arguments.length?h.extend.apply(h,arguments):void 0};s(h,{callback:function(t){var e,i=o(arguments);return t=i.shift(),n(t)||(t=[t]),e=this,function(){for(var o,s,a=r(i,arguments),c=t.length,l=0;c>l;l++)s=t[l],s&&(o="string"==typeof s,o&&e._set_called&&(e.called=s),a=(o?e[s]:s).apply(e,a||[]),c-1>l&&(a=!n(a)||a._use_call?[a]:a));return a}},getObject:t.String.getObject,newInstance:function(){var t,e=this.rawInstance();e.setup&&(t=e.setup.apply(e,arguments));for(var o in e.__proto__)e[o]=a(e[o]);return e.init&&e.init.apply(e,n(t)?t:arguments),e},setup:function(t){return this.defaults=s(!0,{},t.defaults,this.defaults),void 0==this._types&&(this._types=[]),this._types.push(this.fullName),void 0==this._fullTypeName&&(this._fullTypeName="|"),this._fullTypeName+=this.fullName+"|",arguments},rawInstance:function(){e=!0;var t=new this;return e=!1,t},extend:function(t,o,i){function n(){return e?void 0:this.constructor!==n&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}"string"!=typeof t&&(i=o,o=t,t=null),i||(i=o,o=null),i=i||{};var c,m,u,p,y=this,d=this.prototype;this.isA=function(t){return-1!=this._fullTypeName.indexOf("|"+t+"|")},e=!0,p=new this,e=!1,l(i,d,p);for(c in this)this.hasOwnProperty(c)&&(n[c]=a(this[c]));if(l(o,this,n),t){var f=t.split(/\./),m=f.pop();f.length>0&&(current=h.getObject(f.join("."),window,!0),u=current),current[m]=n}s(n,{prototype:p,namespace:u,shortName:m,constructor:n,fullName:t}),n.prototype.Class=n.prototype.constructor=n;var x=n.setup.apply(n,r([y],arguments));return n.init&&n.init.apply(n,x||[]),n}}),h.prototype.callback=h.callback}(gamecore),define("playcraft/ext/gamecore.js/src/class",function(){}),gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(t,e,o){var i="";t&&(i=":"+t),console.log(this.fullName+i+" ["+e+"] "+o)},warn:function(t){this.log(null,this.WARN,t)},debug:function(t){this.log(null,this.DEBUG,t)},error:function(t){this.log(null,this.ERROR,t)},info:function(t){this.log(null,this.INFO,t)},assert:function(t,e){if(!e)throw t}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++,this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(t){this.Class.log(this.objectId,this.Class.WARN,t)},debug:function(t){this.Class.log(this.objectId,this.Class.DEBUG,t)},error:function(t){this.Class.log(this.objectId,this.Class.ERROR,t)},info:function(t){this.Class.log(this.objectId,this.Class.INFO,t)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}}),define("playcraft/ext/gamecore.js/src/base",function(){}),gamecore.Hashtable=function(){function t(e){var o;if("string"==typeof e)return e;if(typeof e.hashCode==h)return o=e.hashCode(),"string"==typeof o?o:t(o);if(typeof e.toString==h)return e.toString();try{return String(e)}catch(i){return Object.prototype.toString.call(e)}}function e(t,e){return t.equals(e)}function o(t,e){return typeof e.equals==h?e.equals(t):t===e}function i(t){return function(e){if(null===e)throw new Error("null is not a valid "+t);if("undefined"==typeof e)throw new Error(t+" must not be undefined")}}function n(t,e,o,i){this[0]=t,this.entries=[],this.addEntry(e,o),null!==i&&(this.getEqualityFunction=function(){return i})}function s(t){return function(e){for(var o,i=this.entries.length,n=this.getEqualityFunction(e);i--;)if(o=this.entries[i],n(e,o[0]))switch(t){case y:return!0;case d:return o;case f:return[i,o[1]]}return!1}}function a(t){return function(e){for(var o=e.length,i=0,n=this.entries.length;n>i;++i)e[o+i]=this.entries[i][t]}}function r(t,e){for(var o,i=t.length;i--;)if(o=t[i],e===o[0])return i;return null}function c(t,e){var o=t[e];return o&&o instanceof n?o:null}function l(e,o){var i=this,s=[],a={},y=typeof e==h?e:t,d=typeof o==h?o:null;this.put=function(t,e){u(t),p(e);var o,i,r=y(t),l=null;return o=c(a,r),o?(i=o.getEntryForKey(t),i?(l=i[1],i[1]=e):o.addEntry(t,e)):(o=new n(r,t,e,d),s[s.length]=o,a[r]=o),l},this.get=function(t){u(t);var e=y(t),o=c(a,e);if(o){var i=o.getEntryForKey(t);if(i)return i[1]}return null},this.containsKey=function(t){u(t);var e=y(t),o=c(a,e);return o?o.containsKey(t):!1},this.containsValue=function(t){p(t);for(var e=s.length;e--;)if(s[e].containsValue(t))return!0;return!1},this.clear=function(){s.length=0,a={}},this.isEmpty=function(){return!s.length};var f=function(t){return function(){for(var e=[],o=s.length;o--;)s[o][t](e);return e}};this.keys=f("keys"),this.values=f("values"),this.entries=f("getEntries"),this.remove=function(t){u(t);var e,o=y(t),i=null,n=c(a,o);return n&&(i=n.removeEntryForKey(t),null!==i&&(n.entries.length||(e=r(s,o),m(s,e),delete a[o]))),i},this.size=function(){for(var t=0,e=s.length;e--;)t+=s[e].entries.length;return t},this.each=function(t){for(var e,o=i.entries(),n=o.length;n--;)e=o[n],t(e[0],e[1])},this.putAll=function(t,e){for(var o,n,s,a,r=t.entries(),c=r.length,l=typeof e==h;c--;)o=r[c],n=o[0],s=o[1],l&&(a=i.get(n))&&(s=e(n,a,s)),i.put(n,s)},this.clone=function(){var t=new l(e,o);return t.putAll(i),t},this.toString=function(){for(var t="",e=this.keys(),o=0;o<e.length;o++){var i=this.get(e[o]);t+=e[o].toString()+" = "+i.toString()+"\n"}return t}}var h="function",m=typeof Array.prototype.splice==h?function(t,e){t.splice(e,1)}:function(t,e){var o,i,n;if(e===t.length-1)t.length=e;else for(o=t.slice(e+1),t.length=e,i=0,n=o.length;n>i;++i)t[e+i]=o[i]},u=i("key"),p=i("value"),y=0,d=1,f=2;return n.prototype={getEqualityFunction:function(t){return typeof t.equals==h?e:o},getEntryForKey:s(d),getEntryAndIndexForKey:s(f),removeEntryForKey:function(t){var e=this.getEntryAndIndexForKey(t);return e?(m(this.entries,e[0]),e[1]):null},addEntry:function(t,e){this.entries[this.entries.length]=[t,e]},keys:a(0),values:a(1),getEntries:function(t){for(var e=t.length,o=0,i=this.entries.length;i>o;++o)t[e+o]=this.entries[o].slice(0)},containsKey:s(y),containsValue:function(t){for(var e=this.entries.length;e--;)if(t===this.entries[e][1])return!0;return!1}},l}(),define("playcraft/ext/gamecore.js/src/jhashtable",function(){}),gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1,this.isiPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.isiPod=-1!=navigator.userAgent.toLowerCase().indexOf("ipod"),this.isiPhone4=2==this.pixelRatio&&this.isiPhone,this.isiPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),this.isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android"),this.isFirefox=-1!=navigator.userAgent.toLowerCase().indexOf("firefox"),this.isChrome=-1!=navigator.userAgent.toLowerCase().indexOf("chrome"),this.isOpera=-1!=navigator.userAgent.toLowerCase().indexOf("opera"),this.isTouch="ontouchstart"in document.documentElement,this.isiOS=this.isiPhone||this.iPad||this.isiPod,void 0!=window.performance&&(this.hasMemoryProfiling=window.performance.memory),/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var t=new Audio;t.canPlayType("audio/ogg")&&(this.canPlayOgg=!0),t.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0),t.canPlayType("audio/x-wav")&&(this.canPlayWav=!0),this.requestAnimFrame=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,16,Date.now())};return function(e,o){t.apply(window,[e,o])}}()},canPlay:function(t){return"mp3"===t.toLowerCase()&&this.canPlayMP3?!0:"ogg"===t.toLowerCase()&&this.canPlayOgg?!0:"wav"===t.toLowerCase()&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{}),define("playcraft/ext/gamecore.js/src/device",function(){}),gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(t){this.description=t,this.start(),this.Class.history.push(this)},start:function(){this.timeStart=Date.now(),this.memStart=gamecore.Device.getUsedHeap()},end:function(){return this.timeEnd=Date.now(),this.timeDelta=this.timeEnd-this.timeStart,this.memEnd=gamecore.Device.getUsedHeap(),this.memDelta=this.memEnd<this.memStart?0:this.memEnd-this.memStart,this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(0==this.memDelta?"unknown":this.memDelta)+" byte(s)"}}),define("playcraft/ext/gamecore.js/src/perf",function(){}),gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}}),gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super(),this.objToNodeMap=new gamecore.Hashtable},getNode:function(t){return this.objToNodeMap.get(t.getUniqueId())},addNode:function(t){var e=new gamecore.LinkedNode;return e.obj=t,e.prevLinked=null,e.nextLinked=null,e.free=!1,this.objToNodeMap.put(t.getUniqueId(),e),e},add:function(t){var e=this.getNode(t);if(null==e)e=this.addNode(t);else{if(0==e.free)throw"Attempting to add object: "+t.getUniqueId()+" twice to list "+this.getUniqueId();e.obj=t,e.free=!1,e.nextLinked=null,e.prevLinked=null}if(null==this.first)this.first=e,this.last=e,e.nextLinked=null,e.prevLinked=null;else{if(null==this.last)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=e,e.prevLinked=this.last,this.last=e,e.nextLinked=null}this.count++,this.showDebug&&this.dump("after add")},has:function(t){var e=this.getNode(t);return!(null==e||1==e.free)},moveUp:function(t){this.dump("before move up");var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.prevLinked){var o=e.prevLinked,i=o.prevLinked;e==this.last&&(this.last=o);var n=e.nextLinked;i&&(i.nextLinked=e),e.nextLinked=o,e.prevLinked=o.prevLinked,o.nextLinked=n,o.prevLinked=e,this.first==o&&(this.first=e)}},moveDown:function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.nextLinked){var o=e.nextLinked;this.moveUp(o.obj),this.last==o&&(this.last=e)}},sort:function(t){for(var e=[],o=this.first;o;)e.push(o.object()),o=o.next();this.clear(),e.sort(t);for(var i=0;i<e.length;i++)this.add(e[i])},remove:function(t){this.showDebug&&this.dump("before remove of "+t);var e=this.getNode(t);return null==e||1==e.free?!1:(null!=e.prevLinked&&(e.prevLinked.nextLinked=e.nextLinked),null!=e.nextLinked&&(e.nextLinked.prevLinked=e.prevLinked),null==e.prevLinked&&(this.first=e.nextLinked),null==e.nextLinked&&(this.last=e.prevLinked),e.free=!0,e.prevLinked=null,e.nextLinked=null,this.count--,this.showDebug&&this.dump("after remove"),!0)},clear:function(){for(var t=this.first;null!=t;)t.free=!0,t=t.nextLinked;this.first=null,this.count=0},length:function(){return this.count},dump:function(t){this.debug("===================="+t+"=====================");for(var e=this.first;null!=e;)this.debug("{"+e.obj.toString()+"} previous="+(e.prevLinked?e.prevLinked.obj:"NULL")),e=e.next();this.debug("==================================="),this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} "+"First: {"+(this.first?this.first.obj:"NULL")+"}")}}),define("playcraft/ext/gamecore.js/src/linkedlist",function(){}),gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(t,e){var o=this.hashtable.get(t);null==o&&(o=new pc.LinkedList,this.hashtable.put(t,o)),o.add(e)},remove:function(t,e){var o=this.hashtable.get(t);if(null==o)throw"No list for a key in hashlist when removing";o.remove(e)},get:function(t){return this.hashtable.get(t)}}),define("playcraft/ext/gamecore.js/src/hashlist",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(t,e){return t=t||this.createException(),e=e||this.mode(t),"other"===e?this.other(arguments.callee):this[e](t)},createException:function(){try{this.undef()}catch(t){return t}},mode:function(t){return t.arguments&&t.stack?"chrome":"string"==typeof t.message&&"undefined"!=typeof window&&window.opera?t.stacktrace?t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?"opera9":t.stack?t.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":t.stack?"firefox":"other"},instrumentFunction:function(t,e,o){t=t||window;var i=t[e];t[e]=function(){return o.call(this,printStackTrace().slice(4)),t[e]._instrumented.apply(this,arguments)},t[e]._instrumented=i},deinstrumentFunction:function(t,e){t[e].constructor===Function&&t[e]._instrumented&&t[e]._instrumented.constructor===Function&&(t[e]=t[e]._instrumented)},chrome:function(t){var e=(t.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return e.pop(),e},firefox:function(t){return t.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(t){for(var e="{anonymous}",o=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,i=t.stacktrace.split("\n"),n=[],s=0,a=i.length;a>s;s+=2){var r=o.exec(i[s]);if(r){var c=r[4]+":"+r[1]+":"+r[2],l=r[3]||"global code";l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,e),n.push(l+"@"+c+" -- "+i[s+1].replace(/^\s+/,""))}}return n},opera10b:function(t){for(var e=/^(.*)@(.+):(\d+)$/,o=t.stacktrace.split("\n"),i=[],n=0,s=o.length;s>n;n++){var a=e.exec(o[n]);if(a){var r=a[1]?a[1]+"()":"global code";i.push(r+"@"+a[2]+":"+a[3])}}return i},opera10a:function(t){for(var e="{anonymous}",o=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=t.stacktrace.split("\n"),n=[],s=0,a=i.length;a>s;s+=2){var r=o.exec(i[s]);if(r){var c=r[3]||e;n.push(c+"()@"+r[2]+":"+r[1]+" -- "+i[s+1].replace(/^\s+/,""))}}return n},opera9:function(t){for(var e="{anonymous}",o=/Line (\d+).*script (?:in )?(\S+)/i,i=t.message.split("\n"),n=[],s=2,a=i.length;a>s;s+=2){var r=o.exec(i[s]);r&&n.push(e+"()@"+r[2]+":"+r[1]+" -- "+i[s+1].replace(/^\s+/,""))}return n},other:function(t){for(var e,o,i="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,s=[],a=10;t&&t.arguments&&s.length<a;)e=n.test(t.toString())?RegExp.$1||i:i,o=Array.prototype.slice.call(t.arguments||[]),s[s.length]=e+"("+this.stringifyArguments(o)+")",t=t.caller;return s},stringifyArguments:function(t){for(var e=[],o=Array.prototype.slice,i=0;i<t.length;++i){var n=t[i];void 0===n?e[i]="undefined":null===n?e[i]="null":n.constructor&&(n.constructor===Array?e[i]=n.length<3?"["+this.stringifyArguments(n)+"]":"["+this.stringifyArguments(o.call(n,0,1))+"..."+this.stringifyArguments(o.call(n,-1))+"]":n.constructor===Object?e[i]="#object":n.constructor===Function?e[i]="#function":n.constructor===String?e[i]='"'+n+'"':n.constructor===Number&&(e[i]=n))}return e.join(",")},sourceCache:{},ajax:function(t){var e=this.createXMLHTTPObject();if(e)try{return e.open("GET",t,!1),e.send(null),e.responseText}catch(o){}return""},createXMLHTTPObject:function(){for(var t,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],o=0;o<e.length;o++)try{return t=e[o](),this.createXMLHTTPObject=e[o],t}catch(i){}},isSameDomain:function(t){return"undefined"!=typeof location&&-1!==t.indexOf(location.hostname)},getSource:function(t){return t in this.sourceCache||(this.sourceCache[t]=this.ajax(t).split("\n")),this.sourceCache[t]},guessAnonymousFunctions:function(t){for(var e=0;e<t.length;++e){var o=/\{anonymous\}\(.*\)@(.*)/,i=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,n=t[e],s=o.exec(n);if(s){var a=i.exec(s[1]);if(a){var r=a[1],c=a[2],l=a[3]||0;if(r&&this.isSameDomain(r)&&c){var h=this.guessAnonymousFunction(r,c,l);t[e]=n.replace("{anonymous}",h)}}}}return t},guessAnonymousFunction:function(t,e){var o;try{o=this.findFunctionName(this.getSource(t),e)}catch(i){o="getSource failed with url: "+t+", exception: "+i.toString()}return o},findFunctionName:function(t,e){for(var o,i,n,s=/function\s+([^(]*?)\s*\(([^)]*)\)/,a=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,c="",l=Math.min(e,20),h=0;l>h;++h)if(o=t[e-h-1],n=o.indexOf("//"),n>=0&&(o=o.substr(0,n)),o){if(c=o+c,i=a.exec(c),i&&i[1])return i[1];if(i=s.exec(c),i&&i[1])return i[1];if(i=r.exec(c),i&&i[1])return i[1]}return"(?)"}},define("playcraft/ext/gamecore.js/src/stacktrace",function(){}),gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(t){var e=this.getPool(t);return(void 0==e||null==e)&&(e=new gamecore.Pool(t,this.INITIAL_POOL_SIZE),this.pools.put(t.fullName,e)),e.acquire()},release:function(t){var e=this.pools.get(t.Class.fullName);if(void 0==e)throw"Oops, trying to release an object of type "+t.Class.fullName+" but no pool exists. Did you new an object instead of using create.";e.release(t)},getPool:function(t){return this.pools.get(t.fullName)},getStats:function(){for(var t="",e=this.pools.keys(),o=0;o<e.length;o++){var i=e[o],n=this.pools.get(i);t+=i+": "+n.getStats()+"\n"}return t}},{freeList:null,expansion:1,traces:null,init:function(t,e){this._super(),this.classType=t,this.freeList=[],this.expand(e)},startTracing:function(){this.tracing||(this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable)},stopTracing:function(){this.tracing=!1},expand:function(t){gamecore.Pool.totalPooled+=t,this.debug("expanding "+this.classType.fullName+" by "+t+" total="+gamecore.Pool.totalPooled);for(var e=0;t>e;e++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){if(this.freeList.length<=0&&(this.expansion=Math.round(1.2*this.expansion)+1,this.expand(this.expansion)),this.tracing){for(var t=printStackTrace(),e=t.length-1;0==t[e].indexOf("Class.addTo")&&e>0;)e--;var o=this.traces.get(t[e]);null==o?this.traces.put(t[e],{value:1}):o.value++}return this.freeList.pop()},release:function(t){this.freeList.push(t)},getStats:function(){var t=this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){t+="TRACING\n";var e=this.traces.keys();for(var o in e)t+=e[o]+" ("+this.traces.get(e[o]).value+")\n"}return t},dump:function(t){this.info("================== "+t+" ==================="),this.info("FREE"),this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}}),gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(t){var e=this.getPool(t);return(void 0==e||null==e)&&(e=new gamecore.DualPool(t,this.INITIAL_POOL_SIZE),this.pools.put(t.fullName,e)),e.acquire()},getStats:function(){for(var t="",e=this.pools.keys(),o=0;o<e.length;o++){var i=e[o],n=this.pools.get(i);t+=i+" (free: "+n.freeList.length()+" used: "+n.usedList.length()+")\n"}return t}},{freeList:null,usedList:null,init:function(t,e){this.classType=t,this.usedList=new gamecore.LinkedList,this.freeList=new gamecore.LinkedList,this.expand(e)},expand:function(t){gamecore.Pool.totalPooled+=t;for(var e=0;t>e;e++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){if(null==this.freeList.first&&this.expand(Math.round(this.size()/5)+1),this.returnObj=this.freeList.first.obj,this.freeList.remove(this.returnObj),this.returnObj.destroyed=!1,this.usedList.add(this.returnObj),this.tracing){for(var t=printStackTrace(),e=t.length-1;0==t[e].indexOf("Class.addTo")&&e>0;)e--;var o=this.traces.get(t[e]);null==o?this.traces.put(t[e],{value:1}):o.value++}return this.returnObj},release:function(t){this.freeList.add(t),this.usedList.remove(t)},dump:function(t){this.info("================== "+t+" ==================="),this.info("FREE"),this.freeList.dump(),this.info("USED"),this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}}),gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.Pool.release(this)},onRelease:function(){}}),gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.DualPool.release(this)},onRelease:function(){}}),define("playcraft/ext/gamecore.js/src/pooled",function(){}),goog={inherits:function(t,e){function o(){}o.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new o,t.prototype.constructor=t}},goog.debug={},goog.debug.Error=function(t){this.stack=Error().stack||"",t&&(this.message=""+t)},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.string={},goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},goog.string.endsWith=function(t,e){var o=t.length-e.length;return o>=0&&t.indexOf(e,o)==o},goog.string.caseInsensitiveStartsWith=function(t,e){return 0==goog.string.caseInsensitiveCompare(e,t.substr(0,e.length))},goog.string.caseInsensitiveEndsWith=function(t,e){return 0==goog.string.caseInsensitiveCompare(e,t.substr(t.length-e.length,e.length))},goog.string.subs=function(t){for(var e=1;e<arguments.length;e++)var o=(""+arguments[e]).replace(/\$/g,"$$$$"),t=t.replace(/\%s/,o);return t},goog.string.collapseWhitespace=function(t){return t.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")
},goog.string.isEmpty=function(t){return/^[\s\xa0]*$/.test(t)},goog.string.isEmptySafe=function(t){return goog.string.isEmpty(goog.string.makeSafe(t))},goog.string.isBreakingWhitespace=function(t){return!/[^\t\n\r ]/.test(t)},goog.string.isAlpha=function(t){return!/[^a-zA-Z]/.test(t)},goog.string.isNumeric=function(t){return!/[^0-9]/.test(t)},goog.string.isAlphaNumeric=function(t){return!/[^a-zA-Z0-9]/.test(t)},goog.string.isSpace=function(t){return" "==t},goog.string.isUnicodeChar=function(t){return 1==t.length&&t>=" "&&"~">=t||t>=""&&"�">=t},goog.string.stripNewlines=function(t){return t.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(t){return t.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(t){return t.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(t){return t.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(t){return t.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(t){return t.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(t){return t.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(t){return t.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(t,e){var o=(""+t).toLowerCase(),i=(""+e).toLowerCase();return i>o?-1:o==i?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(t,e){if(t==e)return 0;if(!t)return-1;if(!e)return 1;for(var o=t.toLowerCase().match(goog.string.numerateCompareRegExp_),i=e.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(o.length,i.length),s=0;n>s;s++){var a=o[s],r=i[s];if(a!=r)return o=parseInt(a,10),!isNaN(o)&&(i=parseInt(r,10),!isNaN(i)&&o-i)?o-i:r>a?-1:1}return o.length!=i.length?o.length-i.length:e>t?-1:1},goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/,goog.string.urlEncode=function(t){return t=""+t,goog.string.encodeUriRegExp_.test(t)?t:encodeURIComponent(t)},goog.string.urlDecode=function(t){return decodeURIComponent(t.replace(/\+/g," "))},goog.string.newLineToBr=function(t,e){return t.replace(/(\r\n|\r|\n)/g,e?"<br />":"<br>")},goog.string.htmlEscape=function(t,e){return e?t.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;"):goog.string.allRe_.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(goog.string.amperRe_,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(goog.string.ltRe_,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(goog.string.gtRe_,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(goog.string.quotRe_,"&quot;")),t):t},goog.string.amperRe_=/&/g,goog.string.ltRe_=/</g,goog.string.gtRe_=/>/g,goog.string.quotRe_=/\"/g,goog.string.allRe_=/[&<>\"]/,goog.string.unescapeEntities=function(t){return goog.string.contains(t,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(t):goog.string.unescapePureXmlEntities_(t):t},goog.string.unescapeEntitiesUsingDom_=function(t){var e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},o=document.createElement("div");return t.replace(goog.string.HTML_ENTITY_PATTERN_,function(t,i){var n=e[t];if(n)return n;if("#"==i.charAt(0)){var s=Number("0"+i.substr(1));isNaN(s)||(n=String.fromCharCode(s))}return n||(o.innerHTML=t+" ",n=o.firstChild.nodeValue.slice(0,-1)),e[t]=n})},goog.string.unescapePureXmlEntities_=function(t){return t.replace(/&([^;]+);/g,function(t,e){switch(e){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==e.charAt(0)){var o=Number("0"+e.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return t}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(t,e){return goog.string.newLineToBr(t.replace(/  /g," &#160;"),e)},goog.string.stripQuotes=function(t,e){for(var o=e.length,i=0;o>i;i++){var n=1==o?e:e.charAt(i);if(t.charAt(0)==n&&t.charAt(t.length-1)==n)return t.substring(1,t.length-1)}return t},goog.string.truncate=function(t,e,o){return o&&(t=goog.string.unescapeEntities(t)),t.length>e&&(t=t.substring(0,e-3)+"..."),o&&(t=goog.string.htmlEscape(t)),t},goog.string.truncateMiddle=function(t,e,o,i){if(o&&(t=goog.string.unescapeEntities(t)),i&&t.length>e){i>e&&(i=e);var n=t.length-i,t=t.substring(0,e-i)+"..."+t.substring(n)}else t.length>e&&(i=Math.floor(e/2),n=t.length-i,t=t.substring(0,i+e%2)+"..."+t.substring(n));return o&&(t=goog.string.htmlEscape(t)),t},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(t){if(t=""+t,t.quote)return t.quote();for(var e=['"'],o=0;o<t.length;o++){var i=t.charAt(o),n=i.charCodeAt(0);e[o+1]=goog.string.specialEscapeChars_[i]||(n>31&&127>n?i:goog.string.escapeChar(i))}return e.push('"'),e.join("")},goog.string.escapeString=function(t){for(var e=[],o=0;o<t.length;o++)e[o]=goog.string.escapeChar(t.charAt(o));return e.join("")},goog.string.escapeChar=function(t){if(t in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[t];if(t in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[t]=goog.string.specialEscapeChars_[t];var e=t,o=t.charCodeAt(0);return o>31&&127>o?e=t:(256>o?(e="\\x",(16>o||o>256)&&(e+="0")):(e="\\u",4096>o&&(e+="0")),e+=o.toString(16).toUpperCase()),goog.string.jsEscapeCache_[t]=e},goog.string.toMap=function(t){for(var e={},o=0;o<t.length;o++)e[t.charAt(o)]=!0;return e},goog.string.contains=function(t,e){return-1!=t.indexOf(e)},goog.string.removeAt=function(t,e,o){var i=t;return e>=0&&e<t.length&&o>0&&(i=t.substr(0,e)+t.substr(e+o,t.length-e-o)),i},goog.string.remove=function(t,e){var o=RegExp(goog.string.regExpEscape(e),"");return t.replace(o,"")},goog.string.removeAll=function(t,e){var o=RegExp(goog.string.regExpEscape(e),"g");return t.replace(o,"")},goog.string.regExpEscape=function(t){return(""+t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(t,e){return Array(e+1).join(t)},goog.string.padNumber=function(t,e,o){return t=goog.isDef(o)?t.toFixed(o):""+t,o=t.indexOf("."),-1==o&&(o=t.length),goog.string.repeat("0",Math.max(0,e-o))+t},goog.string.makeSafe=function(t){return null==t?"":""+t},goog.string.buildString=function(){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(t,e){for(var o=0,i=goog.string.trim(""+t).split("."),n=goog.string.trim(""+e).split("."),s=Math.max(i.length,n.length),a=0;0==o&&s>a;a++){var r=i[a]||"",c=n[a]||"",l=RegExp("(\\d*)(\\D*)","g"),h=RegExp("(\\d*)(\\D*)","g");do{var m=l.exec(r)||["","",""],u=h.exec(c)||["","",""];if(0==m[0].length&&0==u[0].length)break;var o=0==m[1].length?0:parseInt(m[1],10),p=0==u[1].length?0:parseInt(u[1],10),o=goog.string.compareElements_(o,p)||goog.string.compareElements_(0==m[2].length,0==u[2].length)||goog.string.compareElements_(m[2],u[2])}while(0==o)}return o},goog.string.compareElements_=function(t,e){return e>t?-1:t>e?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(t){for(var e=0,o=0;o<t.length;++o)e=31*e+t.charCodeAt(o),e%=goog.string.HASHCODE_MAX_;return e},goog.string.uniqueStringCounter_=0|2147483648*Math.random(),goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(t){var e=Number(t);return 0==e&&goog.string.isEmpty(t)?0/0:e},goog.string.toCamelCaseCache_={},goog.string.toCamelCase=function(t){return goog.string.toCamelCaseCache_[t]||(goog.string.toCamelCaseCache_[t]=(""+t).replace(/\-([a-z])/g,function(t,e){return e.toUpperCase()}))},goog.string.toSelectorCaseCache_={},goog.string.toSelectorCase=function(t){return goog.string.toSelectorCaseCache_[t]||(goog.string.toSelectorCaseCache_[t]=(""+t).replace(/([A-Z])/g,"-$1").toLowerCase())},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=!0,goog.array.peek=function(t){return t[t.length-1]},goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(t,e,o)}:function(t,e,o){if(o=null==o?0:0>o?Math.max(0,t.length+o):o,goog.isString(t))return goog.isString(e)&&1==e.length?t.indexOf(e,o):-1;for(;o<t.length;o++)if(o in t&&t[o]===e)return o;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(t,e,null==o?t.length-1:o)}:function(t,e,o){if(o=null==o?t.length-1:o,0>o&&(o=Math.max(0,t.length+o)),goog.isString(t))return goog.isString(e)&&1==e.length?t.lastIndexOf(e,o):-1;for(;o>=0;o--)if(o in t&&t[o]===e)return o;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(t,e,o){goog.array.ARRAY_PROTOTYPE_.forEach.call(t,e,o)}:function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,s=0;i>s;s++)s in n&&e.call(o,n[s],s,t)},goog.array.forEachRight=function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,i=i-1;i>=0;--i)i in n&&e.call(o,n[i],i,t)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.filter.call(t,e,o)}:function(t,e,o){for(var i=t.length,n=[],s=0,a=goog.isString(t)?t.split(""):t,r=0;i>r;r++)if(r in a){var c=a[r];e.call(o,c,r,t)&&(n[s++]=c)}return n},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.map.call(t,e,o)}:function(t,e,o){for(var i=t.length,n=Array(i),s=goog.isString(t)?t.split(""):t,a=0;i>a;a++)a in s&&(n[a]=e.call(o,s[a],a,t));return n},goog.array.reduce=function(t,e,o,i){if(t.reduce)return i?t.reduce(goog.bind(e,i),o):t.reduce(e,o);var n=o;return goog.array.forEach(t,function(o,s){n=e.call(i,n,o,s,t)}),n},goog.array.reduceRight=function(t,e,o,i){if(t.reduceRight)return i?t.reduceRight(goog.bind(e,i),o):t.reduceRight(e,o);var n=o;return goog.array.forEachRight(t,function(o,s){n=e.call(i,n,o,s,t)}),n},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.some.call(t,e,o)}:function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,s=0;i>s;s++)if(s in n&&e.call(o,n[s],s,t))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(t,e,o){return goog.array.ARRAY_PROTOTYPE_.every.call(t,e,o)}:function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,s=0;i>s;s++)if(s in n&&!e.call(o,n[s],s,t))return!1;return!0},goog.array.find=function(t,e,o){return e=goog.array.findIndex(t,e,o),0>e?null:goog.isString(t)?t.charAt(e):t[e]},goog.array.findIndex=function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,s=0;i>s;s++)if(s in n&&e.call(o,n[s],s,t))return s;return-1},goog.array.findRight=function(t,e,o){return e=goog.array.findIndexRight(t,e,o),0>e?null:goog.isString(t)?t.charAt(e):t[e]},goog.array.findIndexRight=function(t,e,o){for(var i=t.length,n=goog.isString(t)?t.split(""):t,i=i-1;i>=0;i--)if(i in n&&e.call(o,n[i],i,t))return i;return-1},goog.array.contains=function(t,e){return 0<=goog.array.indexOf(t,e)},goog.array.isEmpty=function(t){return 0==t.length},goog.array.clear=function(t){if(!goog.isArray(t))for(var e=t.length-1;e>=0;e--)delete t[e];t.length=0},goog.array.insert=function(t,e){goog.array.contains(t,e)||t.push(e)},goog.array.insertAt=function(t,e,o){goog.array.splice(t,o,0,e)},goog.array.insertArrayAt=function(t,e,o){goog.partial(goog.array.splice,t,o,0).apply(null,e)},goog.array.insertBefore=function(t,e,o){var i;2==arguments.length||0>(i=goog.array.indexOf(t,o))?t.push(e):goog.array.insertAt(t,e,i)},goog.array.remove=function(t,e){var o,i=goog.array.indexOf(t,e);return(o=i>=0)&&goog.array.removeAt(t,i),o},goog.array.removeAt=function(t,e){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(t,e,1).length},goog.array.removeIf=function(t,e,o){return e=goog.array.findIndex(t,e,o),e>=0?(goog.array.removeAt(t,e),!0):!1},goog.array.concat=function(){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.clone=function(t){if(goog.isArray(t))return goog.array.concat(t);for(var e=[],o=0,i=t.length;i>o;o++)e[o]=t[o];return e},goog.array.toArray=function(t){return goog.isArray(t)?goog.array.concat(t):goog.array.clone(t)},goog.array.extend=function(t){for(var e=1;e<arguments.length;e++){var o,i=arguments[e];if(goog.isArray(i)||(o=goog.isArrayLike(i))&&i.hasOwnProperty("callee"))t.push.apply(t,i);else if(o)for(var n=t.length,s=i.length,a=0;s>a;a++)t[n+a]=i[a];else t.push(i)}},goog.array.splice=function(t){return goog.array.ARRAY_PROTOTYPE_.splice.apply(t,goog.array.slice(arguments,1))},goog.array.slice=function(t,e,o){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(t,e):goog.array.ARRAY_PROTOTYPE_.slice.call(t,e,o)},goog.array.removeDuplicates=function(t,e){for(var o=e||t,i={},n=0,s=0;s<t.length;){var a=t[s++],r=goog.isObject(a)?"o"+goog.getUid(a):(typeof a).charAt(0)+a;Object.prototype.hasOwnProperty.call(i,r)||(i[r]=!0,o[n++]=a)}o.length=n},goog.array.binarySearch=function(t,e,o){return goog.array.binarySearch_(t,o||goog.array.defaultCompare,!1,e)},goog.array.binarySelect=function(t,e,o){return goog.array.binarySearch_(t,e,!0,void 0,o)},goog.array.binarySearch_=function(t,e,o,i,n){for(var s,a=0,r=t.length;r>a;){var c,l=a+r>>1;c=o?e.call(n,t[l],l,t):e(i,t[l]),c>0?a=l+1:(r=l,s=!c)}return s?a:~a},goog.array.sort=function(t,e){goog.array.ARRAY_PROTOTYPE_.sort.call(t,e||goog.array.defaultCompare)},goog.array.stableSort=function(t,e){for(var o=0;o<t.length;o++)t[o]={index:o,value:t[o]};var i=e||goog.array.defaultCompare;for(goog.array.sort(t,function(t,e){return i(t.value,e.value)||t.index-e.index}),o=0;o<t.length;o++)t[o]=t[o].value},goog.array.sortObjectsByKey=function(t,e,o){var i=o||goog.array.defaultCompare;goog.array.sort(t,function(t,o){return i(t[e],o[e])})},goog.array.isSorted=function(t,e,o){for(var e=e||goog.array.defaultCompare,i=1;i<t.length;i++){var n=e(t[i-1],t[i]);if(n>0||0==n&&o)return!1}return!0},goog.array.equals=function(t,e,o){if(!goog.isArrayLike(t)||!goog.isArrayLike(e)||t.length!=e.length)return!1;for(var i=t.length,o=o||goog.array.defaultCompareEquality,n=0;i>n;n++)if(!o(t[n],e[n]))return!1;return!0},goog.array.compare=function(t,e,o){return goog.array.equals(t,e,o)},goog.array.compare3=function(t,e,o){for(var o=o||goog.array.defaultCompare,i=Math.min(t.length,e.length),n=0;i>n;n++){var s=o(t[n],e[n]);if(0!=s)return s}return goog.array.defaultCompare(t.length,e.length)},goog.array.defaultCompare=function(t,e){return t>e?1:e>t?-1:0},goog.array.defaultCompareEquality=function(t,e){return t===e},goog.array.binaryInsert=function(t,e,o){return o=goog.array.binarySearch(t,e,o),0>o?(goog.array.insertAt(t,e,-(o+1)),!0):!1},goog.array.binaryRemove=function(t,e,o){return e=goog.array.binarySearch(t,e,o),e>=0?goog.array.removeAt(t,e):!1},goog.array.bucket=function(t,e){for(var o={},i=0;i<t.length;i++){var n=t[i],s=e(n,i,t);goog.isDef(s)&&(o[s]||(o[s]=[])).push(n)}return o},goog.array.repeat=function(t,e){for(var o=[],i=0;e>i;i++)o[i]=t;return o},goog.array.flatten=function(){for(var t=[],e=0;e<arguments.length;e++){var o=arguments[e];goog.isArray(o)?t.push.apply(t,goog.array.flatten.apply(null,o)):t.push(o)}return t},goog.array.rotate=function(t,e){return t.length&&(e%=t.length,e>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(t,t.splice(-e,e)):0>e&&goog.array.ARRAY_PROTOTYPE_.push.apply(t,t.splice(0,-e))),t},goog.array.zip=function(){if(!arguments.length)return[];for(var t=[],e=0;;e++){for(var o=[],i=0;i<arguments.length;i++){var n=arguments[i];if(e>=n.length)return t;o.push(n[e])}t.push(o)}},goog.array.shuffle=function(t,e){for(var o=e||Math.random,i=t.length-1;i>0;i--){var n=Math.floor(o()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}},goog.structs={},goog.structs.Queue=function(){this.elements_=[]},goog.structs.Queue.prototype.head_=0,goog.structs.Queue.prototype.tail_=0,goog.structs.Queue.prototype.enqueue=function(t){this.elements_[this.tail_++]=t},goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var t=this.elements_[this.head_];return delete this.elements_[this.head_],this.head_++,t}},goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]},goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_},goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_},goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0},goog.structs.Queue.prototype.contains=function(t){return goog.array.contains(this.elements_,t)},goog.structs.Queue.prototype.remove=function(t){return t=goog.array.indexOf(this.elements_,t),0>t?!1:(t==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,t),this.tail_--),!0)},goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};var Box2D={Common:{}};Box2D.Common.Math={},Box2D.Common.Math.b2Vec2=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(t,e){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var o=Box2D.Common.Math.b2Vec2._freeCache.pop();return o.Set(t,e),o}return new Box2D.Common.Math.b2Vec2(t,e)},Box2D.Common.Math.b2Vec2.Free=function(t){null!=t&&Box2D.Common.Math.b2Vec2._freeCache.push(t)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.y=this.x=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(t,e){this.x=t,this.y=e},Box2D.Common.Math.b2Vec2.prototype.SetV=function(t){this.x=t.x,this.y=t.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(t){this.x+=t.x,this.y+=t.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(t){this.x*=t,this.y*=t},Box2D.Common.Math.b2Vec2.prototype.MulM=function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(t){var e=this.x*t.col1.x+this.y*t.col1.y;this.y=this.x*t.col2.x+this.y*t.col2.y,this.x=e},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(t){var e=this.x;this.x=t*this.y,this.y=-t*e},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(t){var e=this.x;this.x=-t*this.y,this.y=t*e},Box2D.Common.Math.b2Vec2.prototype.MinV=function(t){this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(t){this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var t=this.Length();if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.b2Settings={},Box2D.Common.b2Settings.b2MixFriction=function(t,e){return Math.sqrt(t*e)},Box2D.Common.b2Settings.b2MixRestitution=function(t,e){return t>e?t:e},Box2D.Common.b2Settings.b2Assert=function(t){if(!t)throw"Assertion Failed"},Box2D.Common.b2Settings.VERSION="2.1a-playcraft",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22._freeCache=[],Box2D.Common.Math.b2Mat22.Get=function(){if(0<Box2D.Common.Math.b2Mat22._freeCache.length){var t=Box2D.Common.Math.b2Mat22._freeCache.pop();return t.SetZero(),t}return new Box2D.Common.Math.b2Mat22},Box2D.Common.Math.b2Mat22.Free=function(t){null!=t&&Box2D.Common.Math.b2Mat22._freeCache.push(t)},Box2D.Common.Math.b2Mat22.FromAngle=function(t){var e=Box2D.Common.Math.b2Mat22.Get();return e.Set(t),e},Box2D.Common.Math.b2Mat22.FromVV=function(t,e){var o=Box2D.Common.Math.b2Mat22.Get();return o.SetVV(t,e),o},Box2D.Common.Math.b2Mat22.prototype.Set=function(t){var e=Math.cos(t),t=Math.sin(t);this.col1.Set(e,t),this.col2.Set(-t,e)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(t,e){this.col1.SetV(t),this.col2.SetV(e)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var t=Box2D.Common.Math.b2Mat22.Get();return t.SetM(this),t},Box2D.Common.Math.b2Mat22.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(t){this.col1.Add(t.col1),this.col2.Add(t.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(t){var e=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==e&&(e=1/e),t.col1.x=e*this.col2.y,t.col2.x=-e*this.col2.x,t.col1.y=-e*this.col1.y,t.col2.y=e*this.col1.x,t},Box2D.Common.Math.b2Mat22.prototype.Solve=function(t,e,o){var i=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==i&&(i=1/i),t.x=i*(this.col2.y*e-this.col2.x*o),t.y=i*(this.col1.x*o-this.col1.y*e),t},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Math={},Box2D.Common.Math.b2Math.Dot=function(t,e){return t.x*e.x+t.y*e.y},Box2D.Common.Math.b2Math.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},Box2D.Common.Math.b2Math.CrossVF=function(t,e){return Box2D.Common.Math.b2Vec2.Get(e*t.y,-e*t.x)},Box2D.Common.Math.b2Math.CrossFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(-t*e.y,t*e.x)},Box2D.Common.Math.b2Math.MulMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},Box2D.Common.Math.b2Math.MulTMV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(e,t.col1),Box2D.Common.Math.b2Math.Dot(e,t.col2))},Box2D.Common.Math.b2Math.MulX=function(t,e){var o=Box2D.Common.Math.b2Math.MulMV(t.R,e);return o.x+=t.position.x,o.y+=t.position.y,o},Box2D.Common.Math.b2Math.MulXT=function(t,e){var o=Box2D.Common.Math.b2Math.SubtractVV(e,t.position),i=o.x*t.R.col1.x+o.y*t.R.col1.y;return o.y=o.x*t.R.col2.x+o.y*t.R.col2.y,o.x=i,o},Box2D.Common.Math.b2Math.AddVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x+e.x,t.y+e.y)},Box2D.Common.Math.b2Math.SubtractVV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t.x-e.x,t.y-e.y)},Box2D.Common.Math.b2Math.Distance=function(t,e){return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(t,e))},Box2D.Common.Math.b2Math.DistanceSquared=function(t,e){var o=t.x-e.x,i=t.y-e.y;return o*o+i*i},Box2D.Common.Math.b2Math.MulFV=function(t,e){return Box2D.Common.Math.b2Vec2.Get(t*e.x,t*e.y)},Box2D.Common.Math.b2Math.AddMM=function(t,e){var o=Box2D.Common.Math.b2Math.AddVV(t.col1,e.col1),i=Box2D.Common.Math.b2Math.AddVV(t.col2,e.col2),n=Box2D.Common.Math.b2Mat22.FromVV(o,i);return Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(i),n},Box2D.Common.Math.b2Math.MulMM=function(t,e){var o=Box2D.Common.Math.b2Math.MulMV(t,e.col1),i=Box2D.Common.Math.b2Math.MulMV(t,e.col2),n=Box2D.Common.Math.b2Mat22.FromVV(o,i);return Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(i),n},Box2D.Common.Math.b2Math.MulTMM=function(t,e){var o=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col1),Box2D.Common.Math.b2Math.Dot(t.col2,e.col1)),i=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t.col1,e.col2),Box2D.Common.Math.b2Math.Dot(t.col2,e.col2)),n=Box2D.Common.Math.b2Mat22.FromVV(o,i);return Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(i),n},Box2D.Common.Math.b2Math.AbsV=function(t){return Box2D.Common.Math.b2Vec2.Get(Math.abs(t.x),Math.abs(t.y))},Box2D.Common.Math.b2Math.AbsM=function(t){var e=Box2D.Common.Math.b2Math.AbsV(t.col1),t=Box2D.Common.Math.b2Math.AbsV(t.col2),o=Box2D.Common.Math.b2Mat22.FromVV(e,t);return Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(t),o},Box2D.Common.Math.b2Math.Clamp=function(t,e,o){return e>t?e:t>o?o:t},Box2D.Common.Math.b2Math.ClampV=function(t,e,o){var i=Box2D.Common.Math.b2Math.Clamp(t.x,e.x,o.x),t=Box2D.Common.Math.b2Math.Clamp(t.y,e.y,o.y);return Box2D.Common.Math.b2Vec2.Get(i,t)},Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2Joint=function(t){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Common.b2Settings.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_next=this.m_prev=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(t){return t.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(){return!1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2LineJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),i=e.GetWorldPoint(this.m_localAnchor2),e=i.x-o.x,o=i.y-o.y,t=t.GetWorldVector(this.m_localXAxis1);return t.x*e+t.y*o},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,o=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*i+t.col2.x*n,n=t.col1.y*i+t.col2.y*n,i=s;t=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,r=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=s;t=o.m_sweep.c.x+a-(e.m_sweep.c.x+i);var s=o.m_sweep.c.y+r-(e.m_sweep.c.y+n),c=e.GetWorldVector(this.m_localXAxis1),l=e.m_linearVelocity,h=o.m_linearVelocity,e=e.m_angularVelocity,o=o.m_angularVelocity;return t*-e*c.y+s*e*c.x+(c.x*(h.x+-o*r-l.x- -e*n)+c.y*(h.y+o*a-l.y-e*i))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation
},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(t){var e,o=this.m_bodyA,i=this.m_bodyB,n=0;this.m_localCenterA.SetV(o.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var s=o.GetTransform();i.GetTransform(),e=o.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,r=this.m_localAnchor1.y-this.m_localCenterA.y,n=e.col1.x*a+e.col2.x*r,r=e.col1.y*a+e.col2.y*r,a=n;e=i.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,n=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,c=n;e=i.m_sweep.c.x+c-o.m_sweep.c.x-a,n=i.m_sweep.c.y+l-o.m_sweep.c.y-r,this.m_invMassA=o.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=o.m_invI,this.m_invIB=i.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(e+a)*this.m_axis.y-(n+r)*this.m_axis.x,this.m_a2=c*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(e+a)*this.m_perp.y-(n+r)*this.m_perp.x,this.m_s2=c*this.m_perp.y-l*this.m_perp.x,s=this.m_invMassA,a=this.m_invMassB,r=this.m_invIA,c=this.m_invIB,this.m_K.col1.x=s+a+r*this.m_s1*this.m_s1+c*this.m_s2*this.m_s2,this.m_K.col1.y=r*this.m_s1*this.m_a1+c*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+a+r*this.m_a1*this.m_a1+c*this.m_a2*this.m_a2,this.m_enableLimit?(e=this.m_axis.x*e+this.m_axis.y*n,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:e<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):e>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,n=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,s=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,o.m_linearVelocity.x-=this.m_invMassA*t,o.m_linearVelocity.y-=this.m_invMassA*e,o.m_angularVelocity-=this.m_invIA*n,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*e,i.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,o=this.m_bodyB,i=e.m_linearVelocity,n=e.m_angularVelocity,s=o.m_linearVelocity,a=o.m_angularVelocity,r=0,c=0,l=0,h=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(h=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-i.x)+this.m_axis.y*(s.y-i.y)+this.m_a2*a-this.m_a1*n)),r=this.m_motorImpulse,t=t.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+h,-t,t),h=this.m_motorImpulse-r,r=h*this.m_axis.x,c=h*this.m_axis.y,l=h*this.m_a1,h*=this.m_a2,i.x-=this.m_invMassA*r,i.y-=this.m_invMassA*c,n-=this.m_invIA*l,s.x+=this.m_invMassB*r,s.y+=this.m_invMassB*c,a+=this.m_invIB*h),c=this.m_perp.x*(s.x-i.x)+this.m_perp.y*(s.y-i.y)+this.m_s2*a-this.m_s1*n,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(t=this.m_axis.x*(s.x-i.x)+this.m_axis.y*(s.y-i.y)+this.m_a2*a-this.m_a1*n,r=this.m_impulse.Copy(),l=Box2D.Common.Math.b2Vec2.Get(0,0),t=this.m_K.Solve(l,-c,-t),Box2D.Common.Math.b2Vec2.Free(l),this.m_impulse.Add(t),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),c=-c-(this.m_impulse.y-r.y)*this.m_K.col2.x,l=0,l=0!=this.m_K.col1.x?c/this.m_K.col1.x+r.x:r.x,this.m_impulse.x=l,t.x=this.m_impulse.x-r.x,t.y=this.m_impulse.y-r.y,Box2D.Common.Math.b2Vec2.Free(r),r=t.x*this.m_perp.x+t.y*this.m_axis.x,c=t.x*this.m_perp.y+t.y*this.m_axis.y,l=t.x*this.m_s1+t.y*this.m_a1,h=t.x*this.m_s2+t.y*this.m_a2):(t=0,t=0!=this.m_K.col1.x?-c/this.m_K.col1.x:0,this.m_impulse.x+=t,r=t*this.m_perp.x,c=t*this.m_perp.y,l=t*this.m_s1,h=t*this.m_s2),i.x-=this.m_invMassA*r,i.y-=this.m_invMassA*c,n-=this.m_invIA*l,s.x+=this.m_invMassB*r,s.y+=this.m_invMassB*c,a+=this.m_invIB*h,e.m_linearVelocity.SetV(i),e.m_angularVelocity=n,o.m_linearVelocity.SetV(s),o.m_angularVelocity=a},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(){var t,e=this.m_bodyA,o=this.m_bodyB,i=e.m_sweep.c,n=e.m_sweep.a,s=o.m_sweep.c,a=o.m_sweep.a,r=0,c=0,l=0,h=0,m=t=0,u=0,c=!1,p=0,y=Box2D.Common.Math.b2Mat22.FromAngle(n),l=Box2D.Common.Math.b2Mat22.FromAngle(a);t=y;var u=this.m_localAnchor1.x-this.m_localCenterA.x,d=this.m_localAnchor1.y-this.m_localCenterA.y,r=t.col1.x*u+t.col2.x*d,d=t.col1.y*u+t.col2.y*d,u=r;if(t=l,l=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y,r=t.col1.x*l+t.col2.x*h,h=t.col1.y*l+t.col2.y*h,l=r,t=s.x+l-i.x-u,r=s.y+h-i.y-d,this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(y,this.m_localXAxis1),this.m_a1=(t+u)*this.m_axis.y-(r+d)*this.m_axis.x,this.m_a2=l*this.m_axis.y-h*this.m_axis.x;var f=this.m_axis.x*t+this.m_axis.y*r;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(p=Box2D.Common.Math.b2Math.Clamp(f,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),m=Math.abs(f),c=!0):f<=this.m_lowerTranslation?(p=Box2D.Common.Math.b2Math.Clamp(f-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),m=this.m_lowerTranslation-f,c=!0):f>=this.m_upperTranslation&&(p=Box2D.Common.Math.b2Math.Clamp(f-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),m=f-this.m_upperTranslation,c=!0)}return this.m_perp=Box2D.Common.Math.b2Math.MulMV(y,this.m_localYAxis1),this.m_s1=(t+u)*this.m_perp.y-(r+d)*this.m_perp.x,this.m_s2=l*this.m_perp.y-h*this.m_perp.x,y=Box2D.Common.Math.b2Vec2.Get(0,0),d=this.m_perp.x*t+this.m_perp.y*r,m=Math.max(m,Math.abs(d)),u=0,c?(c=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,t=this.m_invIB,this.m_K.col1.x=c+l+h*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,this.m_K.col1.y=h*this.m_s1*this.m_a1+t*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+l+h*this.m_a1*this.m_a1+t*this.m_a2*this.m_a2,this.m_K.Solve(y,-d,-p)):(c=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,t=this.m_invIB,p=c+l+h*this.m_s1*this.m_s1+t*this.m_s2*this.m_s2,y.x=0!=p?-d/p:0,y.y=0),p=y.x*this.m_perp.x+y.y*this.m_axis.x,c=y.x*this.m_perp.y+y.y*this.m_axis.y,d=y.x*this.m_s1+y.y*this.m_a1,y=y.x*this.m_s2+y.y*this.m_a2,i.x-=this.m_invMassA*p,i.y-=this.m_invMassA*c,n-=this.m_invIA*d,s.x+=this.m_invMassB*p,s.y+=this.m_invMassB*c,a+=this.m_invIB*y,e.m_sweep.a=n,o.m_sweep.a=a,e.SynchronizeTransform(),o.SynchronizeTransform(),m<=Box2D.Common.b2Settings.b2_linearSlop&&u<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyB=this.bodyA=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(t,e,o,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(i)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Collision={},Box2D.Collision.b2DistanceProxy=function(){this.m_radius=this.m_count=0,this.m_vertices=[]},Box2D.Collision.b2DistanceProxy.prototype.SetValues=function(t,e,o){this.m_count=t,this.m_radius=e,this.m_vertices=o},Box2D.Collision.b2DistanceProxy.prototype.Set=function(t){t.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(t){for(var e=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_count;i++){var n=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;n>o&&(e=i,o=n)}return e},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(t){return this.m_vertices[this.GetSupport(t)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(t){return void 0===t&&(t=0),Box2D.Common.b2Settings.b2Assert(t>=0&&t<this.m_count),this.m_vertices[t]},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0),this.t0=this.a=this.a0=null},Box2D.Common.Math.b2Sweep.prototype.Set=function(t){this.localCenter.SetV(t.localCenter),this.c0.SetV(t.c0),this.c.SetV(t.c),this.a0=t.a0,this.a=t.a,this.t0=t.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var t=new Box2D.Common.Math.b2Sweep;return t.localCenter.SetV(this.localCenter),t.c0.SetV(this.c0),t.c.SetV(this.c),t.a0=this.a0,t.a=this.a,t.t0=this.t0,t},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(t,e){void 0===e&&(e=0),t.position.x=(1-e)*this.c0.x+e*this.c.x,t.position.y=(1-e)*this.c0.y+e*this.c.y,t.R.Set((1-e)*this.a0+e*this.a);var o=t.R;t.position.x-=o.col1.x*this.localCenter.x+o.col2.x*this.localCenter.y,t.position.y-=o.col1.y*this.localCenter.x+o.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(t){if(void 0===t&&(t=0),this.t0<t&&1-this.t0>Number.MIN_VALUE){var e=(t-this.t0)/(1-this.t0);this.c0.x=(1-e)*this.c0.x+e*this.c.x,this.c0.y=(1-e)*this.c0.y+e*this.c.y,this.a0=(1-e)*this.a0+e*this.a,this.t0=t}},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Common.Math.b2Vec3=function(t,e,o){this.x=t,this.y=e,this.z=o},Box2D.Common.Math.b2Vec3._freeCache=[],Box2D.Common.Math.b2Vec3.Get=function(t,e,o){if(0<Box2D.Common.Math.b2Vec3._freeCache.length){var i=Box2D.Common.Math.b2Vec3._freeCache.pop();return i.Set(t,e,o),i}return new Box2D.Common.Math.b2Vec3(t,e,o)},Box2D.Common.Math.b2Vec3.Free=function(t){null!=t&&Box2D.Common.Math.b2Vec3._freeCache.push(t)},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.z=this.y=this.x=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(t,e,o){this.x=t,this.y=e,this.z=o},Box2D.Common.Math.b2Vec3.prototype.SetV=function(t){this.x=t.x,this.y=t.y,this.z=t.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec3.Get(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return Box2D.Common.Math.b2Vec3.Get(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(t){this.x*=t,this.y*=t,this.z*=t},Box2D.Common.Math.b2Mat33=function(t,e,o){this.col1=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col2=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col3=Box2D.Common.Math.b2Vec3.Get(0,0,0),t&&this.col1.SetV(t),e&&this.col2.SetV(e),o&&this.col3.SetV(o)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(t,e,o){this.col1.SetV(t),this.col2.SetV(e),this.col3.SetV(o)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2),this.col3.SetV(t.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col1.z+=t.col1.z,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y,this.col2.z+=t.col2.z,this.col3.x+=t.col3.x,this.col3.y+=t.col3.y,this.col3.z+=t.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(t,e,o){var i=this.col1.x,n=this.col2.x,s=this.col1.y,a=this.col2.y,r=i*a-n*s;return 0!=r&&(r=1/r),t.x=r*(a*e-n*o),t.y=r*(i*o-s*e),t},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(t,e,o,i){var n=this.col1.x,s=this.col1.y,a=this.col1.z,r=this.col2.x,c=this.col2.y,l=this.col2.z,h=this.col3.x,m=this.col3.y,u=this.col3.z,p=n*(c*u-l*m)+s*(l*h-r*u)+a*(r*m-c*h);return 0!=p&&(p=1/p),t.x=p*(e*(c*u-l*m)+o*(l*h-r*u)+i*(r*m-c*h)),t.y=p*(n*(o*u-i*m)+s*(i*h-e*u)+a*(e*m-o*h)),t.z=p*(n*(c*i-l*o)+s*(l*e-r*i)+a*(r*o-c*e)),t},Box2D.Dynamics.Joints.b2PrismaticJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_localXAxis1.SetV(t.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,o=t.GetWorldPoint(this.m_localAnchor1),i=e.GetWorldPoint(this.m_localAnchor2),e=i.x-o.x,n=i.y-o.y;return Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(i),t=t.GetWorldVector(this.m_localXAxis1),o=t.x*e+t.y*n,Box2D.Common.Math.b2Vec2.Free(t),o},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var t,e=this.m_bodyA,o=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*i+t.col2.x*n,n=t.col1.y*i+t.col2.y*n,i=s;t=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,r=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=s,s=o.m_sweep.c.x+a-(e.m_sweep.c.x+i),c=o.m_sweep.c.y+r-(e.m_sweep.c.y+n);t=e.GetWorldVector(this.m_localXAxis1);var l=e.m_linearVelocity,h=o.m_linearVelocity,e=e.m_angularVelocity,o=o.m_angularVelocity,i=s*-e*t.y+c*e*t.x+(t.x*(h.x+-o*r-l.x- -e*n)+t.y*(h.y+o*a-l.y-e*i));return Box2D.Common.Math.b2Vec2.Free(t),i},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(t){var e,o=this.m_bodyA,i=this.m_bodyB,n=0;this.m_localCenterA.SetV(o.GetLocalCenter()),this.m_localCenterB.SetV(i.GetLocalCenter());var s=o.GetTransform();e=o.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,r=this.m_localAnchor1.y-this.m_localCenterA.y,n=e.col1.x*a+e.col2.x*r,r=e.col1.y*a+e.col2.y*r,a=n;e=i.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,n=e.col1.x*c+e.col2.x*l,l=e.col1.y*c+e.col2.y*l,c=n;e=i.m_sweep.c.x+c-o.m_sweep.c.x-a,n=i.m_sweep.c.y+l-o.m_sweep.c.y-r,this.m_invMassA=o.m_invMass,this.m_invMassB=i.m_invMass,this.m_invIA=o.m_invI,this.m_invIB=i.m_invI;var h=Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localXAxis1);this.m_axis.SetV(h),Box2D.Common.Math.b2Vec2.Free(h),this.m_a1=(e+a)*this.m_axis.y-(n+r)*this.m_axis.x,this.m_a2=c*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),s=Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localYAxis1),this.m_perp.SetV(s),Box2D.Common.Math.b2Vec2.Free(s),this.m_s1=(e+a)*this.m_perp.y-(n+r)*this.m_perp.x,this.m_s2=c*this.m_perp.y-l*this.m_perp.x,a=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=a+r+c*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+l*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+l,this.m_K.col2.z=c*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=a+r+c*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(e=this.m_axis.x*e+this.m_axis.y*n,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:e<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):e>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,n=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,a=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,o.m_linearVelocity.x-=this.m_invMassA*t,o.m_linearVelocity.y-=this.m_invMassA*e,o.m_angularVelocity-=this.m_invIA*n,i.m_linearVelocity.x+=this.m_invMassB*t,i.m_linearVelocity.y+=this.m_invMassB*e,i.m_angularVelocity+=this.m_invIB*a):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,o=this.m_bodyB,i=e.m_linearVelocity,n=e.m_angularVelocity,s=o.m_linearVelocity,a=o.m_angularVelocity,r=0,c=0,l=0,h=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(h=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-i.x)+this.m_axis.y*(s.y-i.y)+this.m_a2*a-this.m_a1*n)),r=this.m_motorImpulse,t=t.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+h,-t,t),h=this.m_motorImpulse-r,r=h*this.m_axis.x,c=h*this.m_axis.y,l=h*this.m_a1,h*=this.m_a2,i.x-=this.m_invMassA*r,i.y-=this.m_invMassA*c,n-=this.m_invIA*l,s.x+=this.m_invMassB*r,s.y+=this.m_invMassB*c,a+=this.m_invIB*h),l=this.m_perp.x*(s.x-i.x)+this.m_perp.y*(s.y-i.y)+this.m_s2*a-this.m_s1*n,c=a-n,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(h=this.m_axis.x*(s.x-i.x)+this.m_axis.y*(s.y-i.y)+this.m_a2*a-this.m_a1*n,r=this.m_impulse.Copy(),t=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_K.Solve33(t,-l,-c,-h),this.m_impulse.Add(t),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),l=-l-(this.m_impulse.z-r.z)*this.m_K.col3.x,c=-c-(this.m_impulse.z-r.z)*this.m_K.col3.y,h=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(h,l,c),h.x+=r.x,h.y+=r.y,this.m_impulse.x=h.x,this.m_impulse.y=h.y,Box2D.Common.Math.b2Vec2.Free(h),t.x=this.m_impulse.x-r.x,t.y=this.m_impulse.y-r.y,t.z=this.m_impulse.z-r.z,r=t.x*this.m_perp.x+t.z*this.m_axis.x,c=t.x*this.m_perp.y+t.z*this.m_axis.y,l=t.x*this.m_s1+t.y+t.z*this.m_a1,h=t.x*this.m_s2+t.y+t.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(t)):(t=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(t,-l,-c),this.m_impulse.x+=t.x,this.m_impulse.y+=t.y,r=t.x*this.m_perp.x,c=t.x*this.m_perp.y,l=t.x*this.m_s1+t.y,h=t.x*this.m_s2+t.y,Box2D.Common.Math.b2Vec2.Free(t)),i.x-=this.m_invMassA*r,i.y-=this.m_invMassA*c,n-=this.m_invIA*l,s.x+=this.m_invMassB*r,s.y+=this.m_invMassB*c,a+=this.m_invIB*h,e.m_linearVelocity.SetV(i),e.m_angularVelocity=n,o.m_linearVelocity.SetV(s),o.m_angularVelocity=a},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,o=t.m_sweep.c,i=t.m_sweep.a,n=e.m_sweep.c,s=e.m_sweep.a,a=0,r=0,c=0,l=a=0,h=0,m=0,r=!1,u=0,p=Box2D.Common.Math.b2Mat22.FromAngle(i),m=this.m_localAnchor1.x-this.m_localCenterA.x,y=this.m_localAnchor1.y-this.m_localCenterA.y,a=p.col1.x*m+p.col2.x*y,y=p.col1.y*m+p.col2.y*y;Box2D.Common.Math.b2Mat22.Free(p);var m=a,l=Box2D.Common.Math.b2Mat22.FromAngle(s),d=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y,a=l.col1.x*d+l.col2.x*c,c=l.col1.y*d+l.col2.y*c;if(Box2D.Common.Math.b2Mat22.Free(l),d=a,a=n.x+d-o.x-m,l=n.y+c-o.y-y,this.m_enableLimit){Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.MulMV(p,this.m_localXAxis1),this.m_a1=(a+m)*this.m_axis.y-(l+y)*this.m_axis.x,this.m_a2=d*this.m_axis.y-c*this.m_axis.x;var f=this.m_axis.x*a+this.m_axis.y*l;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(u=Box2D.Common.Math.b2Math.Clamp(f,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),h=Math.abs(f),r=!0):f<=this.m_lowerTranslation?(u=Box2D.Common.Math.b2Math.Clamp(f-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),h=this.m_lowerTranslation-f,r=!0):f>=this.m_upperTranslation&&(u=Box2D.Common.Math.b2Math.Clamp(f-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),h=f-this.m_upperTranslation,r=!0)}return Box2D.Common.Math.b2Vec2.Free(this.m_perp),this.m_perp=Box2D.Common.Math.b2Math.MulMV(p,this.m_localYAxis1),this.m_s1=(a+m)*this.m_perp.y-(l+y)*this.m_perp.x,this.m_s2=d*this.m_perp.y-c*this.m_perp.x,p=Box2D.Common.Math.b2Vec3.Get(0,0,0),y=this.m_perp.x*a+this.m_perp.y*l,d=s-i-this.m_refAngle,h=Math.max(h,Math.abs(y)),m=Math.abs(d),r?(r=this.m_invMassA,c=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=r+c+a*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=a*this.m_s1+l*this.m_s2,this.m_K.col1.z=a*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+l,this.m_K.col2.z=a*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=r+c+a*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve33(p,-y,-d,-u)):(r=this.m_invMassA,c=this.m_invMassB,a=this.m_invIA,l=this.m_invIB,u=a*this.m_s1+l*this.m_s2,f=a+l,this.m_K.col1.Set(r+c+a*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,u,0),this.m_K.col2.Set(u,f,0),u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(u,-y,-d),p.x=u.x,p.y=u.y,Box2D.Common.Math.b2Vec2.Free(u),p.z=0),u=p.x*this.m_perp.x+p.z*this.m_axis.x,r=p.x*this.m_perp.y+p.z*this.m_axis.y,y=p.x*this.m_s1+p.y+p.z*this.m_a1,d=p.x*this.m_s2+p.y+p.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(p),o.x-=this.m_invMassA*u,o.y-=this.m_invMassA*r,i-=this.m_invIA*y,n.x+=this.m_invMassB*u,n.y+=this.m_invMassB*r,s+=this.m_invIB*d,t.m_sweep.a=i,e.m_sweep.a=s,t.SynchronizeTransform(),e.SynchronizeTransform(),h<=Box2D.Common.b2Settings.b2_linearSlop&&m<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(t,e,o,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.localAxisA=this.bodyA.GetLocalVector(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle},goog.inherits(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(t){return t*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(t){var e,o=0,i=this.m_bodyA,n=this.m_bodyB;e=i.m_xf.R;var s=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=o;e=n.m_xf.R;var r=this.m_localAnchorB.x-n.m_sweep.localCenter.x,c=this.m_localAnchorB.y-n.m_sweep.localCenter.y,o=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=o;e=i.m_invMass;var o=n.m_invMass,l=i.m_invI,h=n.m_invI;this.m_mass.col1.x=e+o+a*a*l+c*c*h,this.m_mass.col2.x=-a*s*l-c*r*h,this.m_mass.col3.x=-a*l-c*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+o+s*s*l+r*r*h,this.m_mass.col3.y=s*l+r*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+h,t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_impulse.z*=t.dtRatio,i.m_linearVelocity.x-=e*this.m_impulse.x,i.m_linearVelocity.y-=e*this.m_impulse.y,i.m_angularVelocity-=l*(s*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z),n.m_linearVelocity.x+=o*this.m_impulse.x,n.m_linearVelocity.y+=o*this.m_impulse.y,n.m_angularVelocity+=h*(r*this.m_impulse.y-c*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(){var t,e=0,o=this.m_bodyA,i=this.m_bodyB,n=o.m_linearVelocity,s=o.m_angularVelocity,a=i.m_linearVelocity,r=i.m_angularVelocity,c=o.m_invMass,l=i.m_invMass,h=o.m_invI,m=i.m_invI;t=o.m_xf.R;var u=this.m_localAnchorA.x-o.m_sweep.localCenter.x,p=this.m_localAnchorA.y-o.m_sweep.localCenter.y,e=t.col1.x*u+t.col2.x*p,p=t.col1.y*u+t.col2.y*p,u=e;
t=i.m_xf.R;var y=this.m_localAnchorB.x-i.m_sweep.localCenter.x,d=this.m_localAnchorB.y-i.m_sweep.localCenter.y,e=t.col1.x*y+t.col2.x*d,d=t.col1.y*y+t.col2.y*d,y=e;t=a.x-r*d-n.x+s*p;var e=a.y+r*y-n.y-s*u,f=r-s,x=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(x,-t,-e,-f),this.m_impulse.Add(x),n.x-=c*x.x,n.y-=c*x.y,s-=h*(u*x.y-p*x.x+x.z),a.x+=l*x.x,a.y+=l*x.y,r+=m*(y*x.y-d*x.x+x.z),Box2D.Common.Math.b2Vec3.Free(x),o.m_angularVelocity=s,i.m_angularVelocity=r},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(){var t,e=0,o=this.m_bodyA,i=this.m_bodyB;t=o.m_xf.R;var n=this.m_localAnchorA.x-o.m_sweep.localCenter.x,s=this.m_localAnchorA.y-o.m_sweep.localCenter.y,e=t.col1.x*n+t.col2.x*s,s=t.col1.y*n+t.col2.y*s,n=e;t=i.m_xf.R;var a=this.m_localAnchorB.x-i.m_sweep.localCenter.x,r=this.m_localAnchorB.y-i.m_sweep.localCenter.y,e=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=e;t=o.m_invMass;var e=i.m_invMass,c=o.m_invI,l=i.m_invI,h=i.m_sweep.c.x+a-o.m_sweep.c.x-n,m=i.m_sweep.c.y+r-o.m_sweep.c.y-s,u=i.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,p=10*Box2D.Common.b2Settings.b2_linearSlop,y=Math.sqrt(h*h+m*m),d=Math.abs(u);return y>p&&(c*=1,l*=1),this.m_mass.col1.x=t+e+s*s*c+r*r*l,this.m_mass.col2.x=-s*n*c-r*a*l,this.m_mass.col3.x=-s*c-r*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+e+n*n*c+a*a*l,this.m_mass.col3.y=n*c+a*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+l,p=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass.Solve33(p,-h,-m,-u),o.m_sweep.c.x-=t*p.x,o.m_sweep.c.y-=t*p.y,o.m_sweep.a-=c*(n*p.y-s*p.x+p.z),i.m_sweep.c.x+=e*p.x,i.m_sweep.c.y+=e*p.y,i.m_sweep.a+=l*(a*p.y-r*p.x+p.z),Box2D.Common.Math.b2Vec3.Free(p),o.SynchronizeTransform(),i.SynchronizeTransform(),y<=Box2D.Common.b2Settings.b2_linearSlop&&d<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},goog.inherits(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2SimplexVertex=function(){this.wA=Box2D.Common.Math.b2Vec2.Get(0,0),this.wB=Box2D.Common.Math.b2Vec2.Get(0,0),this.w=Box2D.Common.Math.b2Vec2.Get(0,0),this.indexB=this.indexA=this.a=0},Box2D.Collision.b2SimplexVertex.prototype.Set=function(t){this.wA.SetV(t.wA),this.wB.SetV(t.wB),this.w.SetV(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB},Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex._freeCache=[],Box2D.Collision.b2Simplex.Get=function(){if(0<Box2D.Collision.b2Simplex._freeCache.length){for(var t=Box2D.Collision.b2Simplex._freeCache.pop(),e=0;e<t.m_vertices.length;e++){var o=t.m_vertices[e];null!=o.wA&&o.wA.Set(0,0),null!=o.wB&&o.wB.Set(0,0),null!=o.w&&o.w.Set(0,0),o.indexA=0,o.indexB=0,o.a=0}return t}return new Box2D.Collision.b2Simplex},Box2D.Collision.b2Simplex.Free=function(t){null!=t&&Box2D.Collision.b2Simplex._freeCache.push(t)},Box2D.Collision.b2Simplex.prototype.ReadCache=function(t,e,o,i,n){Box2D.Common.b2Settings.b2Assert(0<=t.count&&3>=t.count);var s,a;this.m_count=t.count;for(var r=this.m_vertices,c=0;c<this.m_count;c++){var l=r[c];l.indexA=t.indexA[c],l.indexB=t.indexB[c],s=e.GetVertex(l.indexA),a=i.GetVertex(l.indexB),Box2D.Common.Math.b2Vec2.Free(l.wA),Box2D.Common.Math.b2Vec2.Free(l.wB),Box2D.Common.Math.b2Vec2.Free(l.w),l.wA=Box2D.Common.Math.b2Math.MulX(o,s),l.wB=Box2D.Common.Math.b2Math.MulX(n,a),l.w=Box2D.Common.Math.b2Math.SubtractVV(l.wB,l.wA),l.a=0}1<this.m_count&&(t=t.metric,s=this.GetMetric(),.5*t>s||s>2*t||s<Number.MIN_VALUE)&&(this.m_count=0),0==this.m_count&&(l=r[0],l.indexA=0,l.indexB=0,s=e.GetVertex(0),a=i.GetVertex(0),Box2D.Common.Math.b2Vec2.Free(l.wA),Box2D.Common.Math.b2Vec2.Free(l.wB),Box2D.Common.Math.b2Vec2.Free(l.w),l.wA=Box2D.Common.Math.b2Math.MulX(o,s),l.wB=Box2D.Common.Math.b2Math.MulX(n,a),l.w=Box2D.Common.Math.b2Math.SubtractVV(l.wB,l.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,o=0;o<this.m_count;o++)t.indexA[o]=e[o].indexA,t.indexB[o]=e[o].indexB},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count)return this.m_v1.w.GetNegative();if(2==this.m_count){var t=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),e=this.m_v1.w.GetNegative(),o=Box2D.Common.Math.b2Math.CrossVV(t,e);return Box2D.Common.Math.b2Vec2.Free(e),e=null,e=o>0?Box2D.Common.Math.b2Math.CrossFV(1,t):Box2D.Common.Math.b2Math.CrossVF(t,1),Box2D.Common.Math.b2Vec2.Free(t),e}return Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):(Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0))},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(t,e){1==this.m_count?(t.SetV(this.m_v1.wA),e.SetV(this.m_v1.wB)):2==this.m_count?(t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count?(e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y):Box2D.Common.b2Settings.b2Assert(!1)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){if(1==this.m_count)return 0;if(2==this.m_count){var t=Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w),e=t.Length();return Box2D.Common.Math.b2Vec2.Free(t),e}if(3==this.m_count){var t=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),o=Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w),e=Box2D.Common.Math.b2Math.CrossVV(t,o);return Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(o),e}return Box2D.Common.b2Settings.b2Assert(!1),0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,o=Box2D.Common.Math.b2Math.SubtractVV(e,t),t=-(t.x*o.x+t.y*o.y);0>=t?(Box2D.Common.Math.b2Vec2.Free(o),this.m_count=this.m_v1.a=1):(e=e.x*o.x+e.y*o.y,Box2D.Common.Math.b2Vec2.Free(o),0>=e?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(o=1/(e+t),this.m_v1.a=e*o,this.m_v2.a=t*o,this.m_count=2))},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,o=this.m_v3.w,i=Box2D.Common.Math.b2Math.SubtractVV(e,t),n=Box2D.Common.Math.b2Math.Dot(t,i),s=Box2D.Common.Math.b2Math.Dot(e,i),n=-n,a=Box2D.Common.Math.b2Math.SubtractVV(o,t),r=Box2D.Common.Math.b2Math.Dot(t,a),c=Box2D.Common.Math.b2Math.Dot(o,a),l=Box2D.Common.Math.b2Math.CrossVV(i,a);Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(a);var i=-r,r=Box2D.Common.Math.b2Math.SubtractVV(o,e),h=Box2D.Common.Math.b2Math.Dot(e,r),a=Box2D.Common.Math.b2Math.Dot(o,r);Box2D.Common.Math.b2Vec2.Free(r),r=-h,h=l*Box2D.Common.Math.b2Math.CrossVV(e,o),o=l*Box2D.Common.Math.b2Math.CrossVV(o,t),t=l*Box2D.Common.Math.b2Math.CrossVV(t,e),0>=n&&0>=i?this.m_count=this.m_v1.a=1:s>0&&n>0&&0>=t?(c=1/(s+n),this.m_v1.a=s*c,this.m_v2.a=n*c,this.m_count=2):c>0&&i>0&&0>=o?(s=1/(c+i),this.m_v1.a=c*s,this.m_v3.a=i*s,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=s&&0>=r?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=c&&0>=a?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):a>0&&r>0&&0>=h?(s=1/(a+r),this.m_v2.a=a*s,this.m_v3.a=r*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(h+o+t),this.m_v1.a=h*s,this.m_v2.a=o*s,this.m_v3.a=t*s,this.m_count=3)},Box2D.Collision.b2Distance={},Box2D.Collision.b2Distance.Distance=function(t,e,o){var i=Box2D.Collision.b2Simplex.Get();i.ReadCache(e,o.proxyA,o.transformA,o.proxyB,o.transformB),(1>i.m_count||3<i.m_count)&&Box2D.Common.b2Settings.b2Assert(!1);for(var n=0;20>n;){for(var s=[],a=0;a<i.m_count;a++)s[a]={},s[a].indexA=i.m_vertices[a].indexA,s[a].indexB=i.m_vertices[a].indexB;if(2==i.m_count?i.Solve2():3==i.m_count&&i.Solve3(),3==i.m_count)break;if(a=i.GetSearchDirection(),a.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED){Box2D.Common.Math.b2Vec2.Free(a);break}Box2D.Common.Math.b2Vec2.Free(i.m_vertices[i.m_count].wA),Box2D.Common.Math.b2Vec2.Free(i.m_vertices[i.m_count].wB),Box2D.Common.Math.b2Vec2.Free(i.m_vertices[i.m_count].w);var r=a.GetNegative(),c=Box2D.Common.Math.b2Math.MulTMV(o.transformA.R,r);for(Box2D.Common.Math.b2Vec2.Free(r),i.m_vertices[i.m_count].indexA=o.proxyA.GetSupport(c),Box2D.Common.Math.b2Vec2.Free(c),i.m_vertices[i.m_count].wA=Box2D.Common.Math.b2Math.MulX(o.transformA,o.proxyA.GetVertex(i.m_vertices[i.m_count].indexA)),r=Box2D.Common.Math.b2Math.MulTMV(o.transformB.R,a),Box2D.Common.Math.b2Vec2.Free(a),i.m_vertices[i.m_count].indexB=o.proxyB.GetSupport(r),Box2D.Common.Math.b2Vec2.Free(r),i.m_vertices[i.m_count].wB=Box2D.Common.Math.b2Math.MulX(o.transformB,o.proxyB.GetVertex(i.m_vertices[i.m_count].indexB)),i.m_vertices[i.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(i.m_vertices[i.m_count].wB,i.m_vertices[i.m_count].wA),n++,r=!1,a=0;a<s.length;a++)if(i.m_vertices[i.m_count].indexA==s[a].indexA&&i.m_vertices[i.m_count].indexB==s[a].indexB){r=!0;break}if(r)break;i.m_count++}i.GetWitnessPoints(t.pointA,t.pointB),n=Box2D.Common.Math.b2Math.SubtractVV(t.pointA,t.pointB),t.distance=n.Length(),Box2D.Common.Math.b2Vec2.Free(n),i.WriteCache(e),Box2D.Collision.b2Simplex.Free(i),o.useRadii&&(e=o.proxyA.m_radius,o=o.proxyB.m_radius,t.distance>e+o&&t.distance>Number.MIN_VALUE?(t.distance-=e+o,i=Box2D.Common.Math.b2Math.SubtractVV(t.pointB,t.pointA),i.Normalize(),t.pointA.x+=e*i.x,t.pointA.y+=e*i.y,t.pointB.x-=o*i.x,t.pointB.y-=o*i.y,Box2D.Common.Math.b2Vec2.Free(i)):(o=Box2D.Common.Math.b2Vec2.Get(0,0),o.x=.5*(t.pointA.x+t.pointB.x),o.y=.5*(t.pointA.y+t.pointB.y),t.pointA.x=t.pointB.x=o.x,t.pointA.y=t.pointB.y=o.y,t.distance=0,Box2D.Common.Math.b2Vec2.Free(o)))},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2DistanceInput=function(){this.useRadii=!1,this.transformB=this.transformA=this.proxyB=this.proxyA=null},Box2D.Collision.Shapes={},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(t){this.m_radius=t.m_radius},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(t,e,o,i){var n=new Box2D.Collision.b2DistanceInput;return n.proxyA=new Box2D.Collision.b2DistanceProxy,n.proxyA.Set(t),n.proxyB=new Box2D.Collision.b2DistanceProxy,n.proxyB.Set(o),n.transformA=e,n.transformB=i,n.useRadii=!0,t=new Box2D.Collision.b2SimplexCache,t.count=0,e=new Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2Distance.Distance(e,t,n),Box2D.Common.Math.b2Vec2.Free(e.pointA),Box2D.Common.Math.b2Vec2.Free(e.pointB),e.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(t){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=t,this.m_radiusSquared=t*t,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[this.m_p]},goog.inherits(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return t.Set(this),t},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(t){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(t.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(t,e){var o=e.x-(t.position.x+(t.R.col1.x*this.m_p.x+t.R.col2.x*this.m_p.y)),i=e.y-(t.position.y+(t.R.col1.y*this.m_p.x+t.R.col2.y*this.m_p.y));return o*o+i*i<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(t,e,o){var i=o.R,n=e.p1.x-(o.position.x+(i.col1.x*this.m_p.x+i.col2.x*this.m_p.y)),o=e.p1.y-(o.position.y+(i.col1.y*this.m_p.x+i.col2.y*this.m_p.y)),i=e.p2.x-e.p1.x,s=e.p2.y-e.p1.y,a=n*i+o*s,r=i*i+s*s,c=a*a-r*(n*n+o*o-this.m_radiusSquared);return 0>c||r<Number.MIN_VALUE?!1:(a=-(a+Math.sqrt(c)),a>=0&&a<=e.maxFraction*r?(a/=r,t.fraction=a,t.normal.x=n+a*i,t.normal.y=o+a*s,t.normal.Normalize(),!0):!1)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(t,e){var o=e.R,i=e.position.x+(o.col1.x*this.m_p.x+o.col2.x*this.m_p.y),o=e.position.y+(o.col1.y*this.m_p.x+o.col2.y*this.m_p.y);t.lowerBound.Set(i-this.m_radius,o-this.m_radius),t.upperBound.Set(i+this.m_radius,o+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(t,e){var o=e*Math.PI*this.m_radiusSquared;t.SetV(o,this.m_p,o*(.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y)))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(t,e,o,i){var o=Box2D.Common.Math.b2Math.MulX(o,this.m_p),n=-(Box2D.Common.Math.b2Math.Dot(t,o)-e);return n<-this.m_radius+Number.MIN_VALUE?(Box2D.Common.Math.b2Vec2.Free(o),0):n>this.m_radius?(Box2D.Common.Math.b2Vec2.Free(o),i.SetV(o),Math.PI*this.m_radiusSquared):(e=n*n,n=this.m_radiusSquared*(Math.asin(n/this.m_radius)+Math.PI/2)+n*Math.sqrt(this.m_radiusSquared-e),e=-2/3*Math.pow(this.m_radiusSquared-e,1.5)/n,i.x=o.x+t.x*e,i.y=o.y+t.y*e,Box2D.Common.Math.b2Vec2.Free(o),n)},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(t){t.SetValues(1,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(t){this.m_p.SetV(t)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(t){this.m_radius=t,this.m_radiusSquared=t*t},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Consts={},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Collision.b2AABB=function(){this.lowerBound=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var t=Box2D.Collision.b2AABB._freeCache.pop();return t.SetZero(),t}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(t){null!=t&&Box2D.Collision.b2AABB._freeCache.push(t)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound.Set(0,0),this.upperBound.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return 0>this.upperBound.x-this.lowerBound.x||0>this.upperBound.y-this.lowerBound.y?!1:this.lowerBound.IsValid()&&this.upperBound.IsValid()},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(t){var e=this.GetCenter();this.lowerBound.Subtract(e),this.upperBound.Subtract(e),this.lowerBound.Add(t),this.upperBound.Add(t),Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(t){var e;return e=(e=(e=(e=this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},Box2D.Collision.b2AABB.prototype.RayCast=function(t,e){var o=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=e.p2.x-e.p1.x;if(Math.abs(n)<Number.MIN_VALUE){if(e.p1.x<this.lowerBound.x||this.upperBound.x<e.p1.x)return!1}else{var s=1/n,n=(this.lowerBound.x-e.p1.x)*s,s=(this.upperBound.x-e.p1.x)*s,a=-1;if(n>s&&(a=n,n=s,s=a,a=1),n>o&&(t.normal.x=a,t.normal.y=0,o=n),i=Math.min(i,s),o>i)return!1}if(n=e.p2.y-e.p1.y,Math.abs(n)<Number.MIN_VALUE){if(e.p1.y<this.lowerBound.y||this.upperBound.y<e.p1.y)return!1}else if(s=1/n,n=(this.lowerBound.y-e.p1.y)*s,s*=this.upperBound.y-e.p1.y,a=-1,n>s&&(a=n,n=s,s=a,a=1),n>o&&(t.normal.y=a,t.normal.x=0,o=n),i=Math.min(i,s),o>i)return!1;return t.fraction=o,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(t){return 0<t.lowerBound.x-this.upperBound.x||0<t.lowerBound.y-this.upperBound.y||0<this.lowerBound.x-t.upperBound.x||0<this.lowerBound.y-t.upperBound.y?!1:!0},Box2D.Collision.b2AABB.Combine=function(t,e){var o=Box2D.Collision.b2AABB.Get();return o.Combine(t,e),o},Box2D.Collision.b2AABB.prototype.Combine=function(t,e){this.lowerBound.x=Math.min(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Math.min(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Math.max(t.upperBound.x,e.upperBound.x),this.upperBound.y=Math.max(t.upperBound.y,e.upperBound.y)},Box2D.Dynamics.b2FixtureListNode=function(t){this.fixture=t,this.previous=this.next=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Collision.b2ContactID=function(){this._incidentVertex=this._incidentEdge=this._referenceEdge=this._key=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(t){this._key=t,this._referenceEdge=255&this._key,this._incidentEdge=255&(65280&this._key)>>8,this._incidentVertex=255&(16711680&this._key)>>16,this._flip=255&(4278190080&this._key)>>24},Box2D.Collision.b2ContactID.prototype.Set=function(t){this.SetKey(t._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(t){this._referenceEdge=t,this._key=4294967040&this._key|255&this._referenceEdge},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(t){this._incidentEdge=t,this._key=4294902015&this._key|65280&this._incidentEdge<<8},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(t){this._incidentVertex=t,this._key=4278255615&this._key|16711680&this._incidentVertex<<16},Box2D.Collision.b2ContactID.prototype.SetFlip=function(t){this._flip=t,this._key=16777215&this._key|4278190080&this._flip<<24},Box2D.Collision.b2ContactID.prototype.Copy=function(){var t=new Box2D.Collision.b2ContactID;return t.Set(this),t},Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.m_tangentImpulse=this.m_normalImpulse=0},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(t){this.m_localPoint.SetV(t.m_localPoint),this.m_normalImpulse=t.m_normalImpulse,this.m_tangentImpulse=t.m_tangentImpulse,this.m_id.Set(t.m_id)},Box2D.Collision.b2DynamicTreeNode=function(t){this.aabb=Box2D.Collision.b2AABB.Get(),this.parent=this.child2=this.child1=null,this.fixture=t},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(t){if("undefined"==typeof t&&(t=null),0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var e=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return e.fixture=t,e.aabb.SetZero(),e}return new Box2D.Collision.b2DynamicTreeNode(t)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.fixture=this.parent=this.child2=this.child1=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2RayCastInput=function(t,e,o){this.p1=Box2D.Common.Math.b2Vec2.Get(t.x,t.y),this.p2=Box2D.Common.Math.b2Vec2.Get(e.x,e.y),this.maxFraction=o},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_insertionCount=this.m_path=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(t,e){var o=Box2D.Collision.b2DynamicTreeNode.Get(e),i=Box2D.Common.b2Settings.b2_aabbExtension,n=Box2D.Common.b2Settings.b2_aabbExtension;return o.aabb.lowerBound.x=t.lowerBound.x-i,o.aabb.lowerBound.y=t.lowerBound.y-n,o.aabb.upperBound.x=t.upperBound.x+i,o.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(o),o},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(t){this.RemoveLeaf(t),t.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(t,e,o){if(Box2D.Common.b2Settings.b2Assert(t.IsLeaf()),t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var i=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(o.x),o=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(o.y);return t.aabb.lowerBound.x=e.lowerBound.x-i,t.aabb.lowerBound.y=e.lowerBound.y-o,t.aabb.upperBound.x=e.upperBound.x+i,t.aabb.upperBound.y=e.upperBound.y+o,this.InsertLeaf(t),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(t){if(null!==this.m_root)for(var e=0;t>e;e++){for(var o=this.m_root,i=0;!o.IsLeaf();)o=1&this.m_path>>i?o.child2:o.child1,i=31&i+1;this.m_path++,this.RemoveLeaf(o),this.InsertLeaf(o)}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(t){return t.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(t,e,o){if(null!==this.m_root){var i=[];for(i.push(this.m_root);0<i.length;){var n=i.pop();if(n.aabb.TestOverlap(e))if(n.IsLeaf()){if(!t.call(o,n.fixture))break}else i.push(n.child1),i.push(n.child2)}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(t,e){if(null!==this.m_root){var o=Box2D.Common.Math.b2Math.SubtractVV(e.p1,e.p2);o.Normalize();var i=Box2D.Common.Math.b2Math.CrossFV(1,o);Box2D.Common.Math.b2Vec2.Free(o);var o=Box2D.Common.Math.b2Math.AbsV(i),n=e.maxFraction,s=e.p1.x+n*(e.p2.x-e.p1.x),n=e.p1.y+n*(e.p2.y-e.p1.y),a=Box2D.Collision.b2AABB.Get();a.lowerBound.x=Math.min(e.p1.x,s),a.lowerBound.y=Math.min(e.p1.y,n),a.upperBound.x=Math.max(e.p1.x,s),a.upperBound.y=Math.max(e.p1.y,n);var r=[];for(r.push(this.m_root);0<r.length;)if(s=r.pop(),s.aabb.TestOverlap(a)){var n=s.aabb.GetCenter(),c=s.aabb.GetExtents(),l=Math.abs(i.x*(e.p1.x-n.x)+i.y*(e.p1.y-n.y))-o.x*c.x-o.y*c.y;if(Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(c),!(l>0))if(s.IsLeaf()){if(new Box2D.Collision.b2RayCastInput(e.p1,e.p2,e.maxFraction),n=t(e,s.fixture),0==n)break;n>0&&(s=e.p1.x+n*(e.p2.x-e.p1.x),n=e.p1.y+n*(e.p2.y-e.p1.y),a.lowerBound.x=Math.min(e.p1.x,s),a.lowerBound.y=Math.min(e.p1.y,n),a.upperBound.x=Math.max(e.p1.x,s),a.upperBound.y=Math.max(e.p1.y,n))}else r.push(s.child1),r.push(s.child2)}Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(o),Box2D.Collision.b2AABB.Free(a)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(t){if(this.m_insertionCount++,null===this.m_root)this.m_root=t,this.m_root.parent=null;else{var e=this.GetBestSibling(t),o=e.parent,i=Box2D.Collision.b2DynamicTreeNode.Get();if(i.parent=o,i.aabb.Combine(t.aabb,e.aabb),o)for(e.parent.child1==e?o.child1=i:o.child2=i,i.child1=e,i.child2=t,e.parent=i,t.parent=i;o&&!o.aabb.Contains(i.aabb);)o.aabb.Combine(o.child1.aabb,o.child2.aabb),i=o,o=o.parent;else i.child1=e,i.child2=t,e.parent=i,this.m_root=t.parent=i}},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(t){for(var t=t.aabb.GetCenter(),e=this.m_root;!e.IsLeaf();)var o=e.child1,e=e.child2,i=Math.abs((o.aabb.lowerBound.x+o.aabb.upperBound.x)/2-t.x)+Math.abs((o.aabb.lowerBound.y+o.aabb.upperBound.y)/2-t.y),n=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-t.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-t.y),e=n>i?o:e;return Box2D.Common.Math.b2Vec2.Free(t),e},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(t){if(t==this.m_root)this.m_root=null;else{var e=t.parent,o=e.parent,t=e.child1==t?e.child2:e.child1;if(o)for(o.child1==e?o.child1=t:o.child2=t,t.parent=o;o&&(t=o.aabb,o.aabb.Combine(o.child1.aabb,o.child2.aabb),!t.Contains(o.aabb));)o=o.parent;else this.m_root=t,t.parent=null;e.Destroy()}},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(t){this.v.SetV(t.v),this.id.Set(t.id)},Box2D.Collision.b2Manifold=function(){this.m_type=this.m_pointCount=0,this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=new Box2D.Collision.b2ManifoldPoint;this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},Box2D.Collision.b2Manifold.prototype.Set=function(t){this.m_pointCount=t.m_pointCount;for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Set(t.m_points[e]);this.m_localPlaneNormal.SetV(t.m_localPlaneNormal),this.m_localPoint.SetV(t.m_localPoint),this.m_type=t.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var t=new Box2D.Collision.b2Manifold;return t.Set(this),t},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2Collision={},Box2D.Collision.b2Collision.ClipSegmentToLine=function(t,e,o,i){var n=0,s=e[0].v,a=e[1].v,r=o.x*s.x+o.y*s.y-i,o=o.x*a.x+o.y*a.y-i;return 0>=r&&t[n++].Set(e[0]),0>=o&&t[n++].Set(e[1]),0>r*o&&(o=r/(r-o),i=t[n].v,i.x=s.x+o*(a.x-s.x),i.y=s.y+o*(a.y-s.y),t[n].id=r>0?e[0].id:e[1].id,n++),n},Box2D.Collision.b2Collision.EdgeSeparation=function(t,e,o,i,n){for(var s=e.R.col1.x*t.m_normals[o].x+e.R.col2.x*t.m_normals[o].y,a=e.R.col1.y*t.m_normals[o].x+e.R.col2.y*t.m_normals[o].y,r=n.R.col1.x*s+n.R.col1.y*a,c=n.R.col2.x*s+n.R.col2.y*a,l=0,h=Number.MAX_VALUE,m=0;m<i.m_vertexCount;m++){var u=i.m_vertices[m].x*r+i.m_vertices[m].y*c;h>u&&(h=u,l=m)}return(n.position.x+(n.R.col1.x*i.m_vertices[l].x+n.R.col2.x*i.m_vertices[l].y)-(e.position.x+(e.R.col1.x*t.m_vertices[o].x+e.R.col2.x*t.m_vertices[o].y)))*s+(n.position.y+(n.R.col1.y*i.m_vertices[l].x+n.R.col2.y*i.m_vertices[l].y)-(e.position.y+(e.R.col1.y*t.m_vertices[o].x+e.R.col2.y*t.m_vertices[o].y)))*a},Box2D.Collision.b2Collision.FindMaxSeparation=function(t,e,o,i){for(var n=i.position.x+(i.R.col1.x*o.m_centroid.x+i.R.col2.x*o.m_centroid.y),s=i.position.y+(i.R.col1.y*o.m_centroid.x+i.R.col2.y*o.m_centroid.y),n=n-(e.position.x+(e.R.col1.x*t.m_centroid.x+e.R.col2.x*t.m_centroid.y)),s=s-(e.position.y+(e.R.col1.y*t.m_centroid.x+e.R.col2.y*t.m_centroid.y)),a=n*e.R.col1.x+s*e.R.col1.y,s=n*e.R.col2.x+s*e.R.col2.y,n=0,r=-Number.MAX_VALUE,c=0;c<t.m_vertexCount;++c){var l=t.m_normals[c].x*a+t.m_normals[c].y*s;l>r&&(r=l,n=c)}a=Box2D.Collision.b2Collision.EdgeSeparation(t,e,n,o,i),s=n-1,0>s&&(s=t.m_vertexCount-1),r=Box2D.Collision.b2Collision.EdgeSeparation(t,e,s,o,i),c=n+1,c>=t.m_vertexCount&&(c=0);var l=Box2D.Collision.b2Collision.EdgeSeparation(t,e,c,o,i),h=0,m=0;if(r>a&&r>l)for(h=s,m=r;n=h-1,0>n&&(n=t.m_vertexCount-1),a=Box2D.Collision.b2Collision.EdgeSeparation(t,e,n,o,i),a>m;)h=n,m=a;else if(l>a)for(h=c,m=l;n=h+1,n>=t.m_vertexCount&&(n=0),a=Box2D.Collision.b2Collision.EdgeSeparation(t,e,n,o,i),a>m;)h=n,m=a;else h=n,m=a;return{bestEdge:h,separation:m}},Box2D.Collision.b2Collision.FindIncidentEdge=function(t,e,o,i,n,s){for(var a=o.R.col1.x*e.m_normals[i].x+o.R.col2.x*e.m_normals[i].y,e=o.R.col1.y*e.m_normals[i].x+o.R.col2.y*e.m_normals[i].y,o=s.R.col1.x*a+s.R.col1.y*e,e=s.R.col2.x*a+s.R.col2.y*e,a=o,o=0,r=Number.MAX_VALUE,c=0;c<n.m_vertexCount;c++){var l=a*n.m_normals[c].x+e*n.m_normals[c].y;r>l&&(r=l,o=c)}a=o+1,a>=n.m_vertexCount&&(a=0),t[0].v.x=s.position.x+(s.R.col1.x*n.m_vertices[o].x+s.R.col2.x*n.m_vertices[o].y),t[0].v.y=s.position.y+(s.R.col1.y*n.m_vertices[o].x+s.R.col2.y*n.m_vertices[o].y),t[0].id.SetReferenceEdge(i),t[0].id.SetIncidentEdge(o),t[0].id.SetIncidentVertex(0),t[1].v.x=s.position.x+(s.R.col1.x*n.m_vertices[a].x+s.R.col2.x*n.m_vertices[a].y),t[1].v.y=s.position.y+(s.R.col1.y*n.m_vertices[a].x+s.R.col2.y*n.m_vertices[a].y),t[1].id.SetReferenceEdge(i),t[1].id.SetIncidentEdge(a),t[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(t,e,o,i,n){t.m_pointCount=0;var s=e.m_radius+i.m_radius,a=Box2D.Collision.b2Collision.FindMaxSeparation(e,o,i,n);if(!(a.separation>s)){var r=Box2D.Collision.b2Collision.FindMaxSeparation(i,n,e,o);if(!(r.separation>s)){var c=e,l=i,h=o,m=n,u=0,p=a.bestEdge;if(t.m_type=Box2D.Collision.b2Manifold.e_faceA,r.separation>.98*a.separation+.001&&(c=i,l=e,h=n,m=o,p=r.bestEdge,t.m_type=Box2D.Collision.b2Manifold.e_faceB,u=1),e=Box2D.Collision.b2Collision.s_incidentEdge,Box2D.Collision.b2Collision.FindIncidentEdge(e,c,h,p,l,m),l=c.m_vertices[p],c=p+1<c.m_vertexCount?c.m_vertices[p+1]:c.m_vertices[0],Box2D.Collision.b2Collision.s_localTangent.Set(c.x-l.x,c.y-l.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(.5*(l.x+c.x),.5*(l.y+c.y)),Box2D.Collision.b2Collision.s_tangent.x=h.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+h.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=h.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+h.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=h.position.x+(h.R.col1.x*l.x+h.R.col2.x*l.y),Box2D.Collision.b2Collision.s_v11.y=h.position.y+(h.R.col1.y*l.x+h.R.col2.y*l.y),Box2D.Collision.b2Collision.s_v12.x=h.position.x+(h.R.col1.x*c.x+h.R.col2.x*c.y),Box2D.Collision.b2Collision.s_v12.y=h.position.y+(h.R.col1.y*c.x+h.R.col2.y*c.y),!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,e,Box2D.Collision.b2Collision.s_tangent2,-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+s)||2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+s))){for(t.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),t.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint),h=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y,p=c=0;p<Box2D.Common.b2Settings.b2_maxManifoldPoints;++p)Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[p].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-h<=s&&(l=Box2D.Collision.b2Collision.s_clipPoints2[p].v.x-m.position.x,e=Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-m.position.y,t.m_points[c].m_localPoint.x=l*m.R.col1.x+e*m.R.col1.y,t.m_points[c].m_localPoint.y=l*m.R.col2.x+e*m.R.col2.y,t.m_points[c].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[p].id),t.m_points[c].m_id.SetFlip(u),c++);
t.m_pointCount=c}}}},Box2D.Collision.b2Collision.CollideCircles=function(t,e,o,i,n){t.m_pointCount=0;var s=n.position.x+(n.R.col1.x*i.m_p.x+n.R.col2.x*i.m_p.y)-(o.position.x+(o.R.col1.x*e.m_p.x+o.R.col2.x*e.m_p.y)),o=n.position.y+(n.R.col1.y*i.m_p.x+n.R.col2.y*i.m_p.y)-(o.position.y+(o.R.col1.y*e.m_p.x+o.R.col2.y*e.m_p.y)),n=e.m_radius+i.m_radius;s*s+o*o>n*n||(t.m_type=Box2D.Collision.b2Manifold.e_circles,t.m_localPoint.SetV(e.m_p),t.m_localPlaneNormal.SetZero(),t.m_pointCount=1,t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(t,e,o,i,n){t.m_pointCount=0;for(var s=n.position.x+(n.R.col1.x*i.m_p.x+n.R.col2.x*i.m_p.y)-o.position.x,a=n.position.y+(n.R.col1.y*i.m_p.x+n.R.col2.y*i.m_p.y)-o.position.y,n=s*o.R.col1.x+a*o.R.col1.y,o=s*o.R.col2.x+a*o.R.col2.y,s=0,a=-Number.MAX_VALUE,r=e.m_radius+i.m_radius,c=0;c<e.m_vertexCount;++c){var l=e.m_normals[c].x*(n-e.m_vertices[c].x)+e.m_normals[c].y*(o-e.m_vertices[c].y);if(l>r)return;l>a&&(a=l,s=c)}l=s+1,l>=e.m_vertexCount&&(l=0);var c=e.m_vertices[s],h=e.m_vertices[l];a<Number.MIN_VALUE?(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.SetV(e.m_normals[s]),t.m_localPoint.x=.5*(c.x+h.x),t.m_localPoint.y=.5*(c.y+h.y),t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.SetKey(0)):0>=(n-c.x)*(h.x-c.x)+(o-c.y)*(h.y-c.y)?(n-c.x)*(n-c.x)+(o-c.y)*(o-c.y)>r*r||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=n-c.x,t.m_localPlaneNormal.y=o-c.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(c),t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.SetKey(0)):0>=(n-h.x)*(c.x-h.x)+(o-h.y)*(c.y-h.y)?(n-h.x)*(n-h.x)+(o-h.y)*(o-h.y)>r*r||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=n-h.x,t.m_localPlaneNormal.y=o-h.y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.SetV(h),t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.SetKey(0)):(l=.5*(c.x+h.x),c=.5*(c.y+h.y),a=(n-l)*e.m_normals[s].x+(o-c)*e.m_normals[s].y,a>r||(t.m_pointCount=1,t.m_type=Box2D.Collision.b2Manifold.e_faceA,t.m_localPlaneNormal.x=e.m_normals[s].x,t.m_localPlaneNormal.y=e.m_normals[s].y,t.m_localPlaneNormal.Normalize(),t.m_localPoint.Set(l,c),t.m_points[0].m_localPoint.SetV(i.m_p),t.m_points[0].m_id.SetKey(0)))},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_proxyB=this.m_proxyA=null},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(t,e,o,i,n){this.m_proxyA=e,this.m_proxyB=i;var s=t.count;Box2D.Common.b2Settings.b2Assert(s>0&&3>s);var a,r,c,l,h=r=a=0,m=0,i=e=0,h=0;1==s?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(t.indexA[0]),t=this.m_proxyB.GetVertex(t.indexB[0]),l=s,c=o.R,a=o.position.x+(c.col1.x*l.x+c.col2.x*l.y),r=o.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=t,c=n.R,h=n.position.x+(c.col1.x*l.x+c.col2.x*l.y),m=n.position.y+(c.col1.y*l.x+c.col2.y*l.y),this.m_axis.x=h-a,this.m_axis.y=m-r,this.m_axis.Normalize()):t.indexB[0]==t.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyA.GetVertex(t.indexA[1]),t=this.m_proxyB.GetVertex(t.indexB[0]),this.m_localPoint.x=.5*(e.x+i.x),this.m_localPoint.y=.5*(e.y+i.y),m=Box2D.Common.Math.b2Math.SubtractVV(i,e),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),l=this.m_axis,c=o.R,e=c.col1.x*l.x+c.col2.x*l.y,i=c.col1.y*l.x+c.col2.y*l.y,l=this.m_localPoint,c=o.R,a=o.position.x+(c.col1.x*l.x+c.col2.x*l.y),r=o.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=t,c=n.R,h=n.position.x+(c.col1.x*l.x+c.col2.x*l.y),m=n.position.y+(c.col1.y*l.x+c.col2.y*l.y),0>(h-a)*e+(m-r)*i&&this.m_axis.NegativeSelf()):t.indexA[0]==t.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,a=this.m_proxyB.GetVertex(t.indexB[0]),r=this.m_proxyB.GetVertex(t.indexB[1]),s=this.m_proxyA.GetVertex(t.indexA[0]),this.m_localPoint.x=.5*(a.x+r.x),this.m_localPoint.y=.5*(a.y+r.y),m=Box2D.Common.Math.b2Math.SubtractVV(r,a),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),l=this.m_axis,c=n.R,e=c.col1.x*l.x+c.col2.x*l.y,i=c.col1.y*l.x+c.col2.y*l.y,l=this.m_localPoint,c=n.R,h=n.position.x+(c.col1.x*l.x+c.col2.x*l.y),m=n.position.y+(c.col1.y*l.x+c.col2.y*l.y),l=s,c=o.R,a=o.position.x+(c.col1.x*l.x+c.col2.x*l.y),r=o.position.y+(c.col1.y*l.x+c.col2.y*l.y),0>(a-h)*e+(r-m)*i&&this.m_axis.NegativeSelf()):(e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyA.GetVertex(t.indexA[1]),a=this.m_proxyB.GetVertex(t.indexB[0]),r=this.m_proxyB.GetVertex(t.indexB[1]),m=Box2D.Common.Math.b2Math.SubtractVV(i,e),h=Box2D.Common.Math.b2Math.MulMV(o.R,m),Box2D.Common.Math.b2Vec2.Free(m),m=Box2D.Common.Math.b2Math.SubtractVV(r,a),c=Box2D.Common.Math.b2Math.MulMV(n.R,m),Box2D.Common.Math.b2Vec2.Free(m),n=h.x*h.x+h.y*h.y,o=c.x*c.x+c.y*c.y,m=Box2D.Common.Math.b2Math.SubtractVV(c,h),t=h.x*m.x+h.y*m.y,s=c.x*m.x+c.y*m.y,Box2D.Common.Math.b2Vec2.Free(m),m=h.x*c.x+h.y*c.y,c=n*o-m*m,h=0,0!=c&&(h=Box2D.Common.Math.b2Math.Clamp((m*s-t*o)/c,0,1)),0>(m*h+s)/o&&(h=Box2D.Common.Math.b2Math.Clamp((m-t)/n,0,1)),s=Box2D.Common.Math.b2Vec2.Get(0,0),s.x=e.x+h*(i.x-e.x),s.y=e.y+h*(i.y-e.y),t=Box2D.Common.Math.b2Vec2.Get(0,0),t.x=a.x+h*(r.x-a.x),t.y=a.y+h*(r.y-a.y),0==h||1==h?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,m=Box2D.Common.Math.b2Math.SubtractVV(r,a),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_axis.Normalize(),this.m_localPoint=t):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,m=Box2D.Common.Math.b2Math.SubtractVV(i,e),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(m,1),Box2D.Common.Math.b2Vec2.Free(m),this.m_localPoint=s),0>h&&this.m_axis.NegativeSelf(),Box2D.Common.Math.b2Vec2.Free(s),Box2D.Common.Math.b2Vec2.Free(t))},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(t,e){var o=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:var o=Box2D.Common.Math.b2Math.MulTMV(t.R,this.m_axis),i=this.m_axis.GetNegative(),n=Box2D.Common.Math.b2Math.MulTMV(e.R,i);Box2D.Common.Math.b2Vec2.Free(i);var s=this.m_proxyA.GetSupportVertex(o);Box2D.Common.Math.b2Vec2.Free(o),o=this.m_proxyB.GetSupportVertex(n),Box2D.Common.Math.b2Vec2.Free(n),n=Box2D.Common.Math.b2Math.MulX(t,s),s=Box2D.Common.Math.b2Math.MulX(e,o),o=(s.x-n.x)*this.m_axis.x+(s.y-n.y)*this.m_axis.y,Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(s);break;case Box2D.Collision.b2SeparationFunction.e_faceA:i=Box2D.Common.Math.b2Math.MulMV(t.R,this.m_axis),s=i.GetNegative(),n=Box2D.Common.Math.b2Math.MulTMV(e.R,s),Box2D.Common.Math.b2Vec2.Free(s),o=this.m_proxyB.GetSupportVertex(n),Box2D.Common.Math.b2Vec2.Free(n),n=Box2D.Common.Math.b2Math.MulX(t,this.m_localPoint),s=Box2D.Common.Math.b2Math.MulX(e,o),o=(s.x-n.x)*i.x+(s.y-n.y)*i.y,Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(s);break;case Box2D.Collision.b2SeparationFunction.e_faceB:i=Box2D.Common.Math.b2Math.MulMV(e.R,this.m_axis),s=i.GetNegative(),o=Box2D.Common.Math.b2Math.MulTMV(t.R,s),Box2D.Common.Math.b2Vec2.Free(s),s=this.m_proxyA.GetSupportVertex(o),Box2D.Common.Math.b2Vec2.Free(o),n=Box2D.Common.Math.b2Math.MulX(t,s),s=Box2D.Common.Math.b2Math.MulX(e,this.m_localPoint),o=(n.x-s.x)*i.x+(n.y-s.y)*i.y,Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(s);break;default:Box2D.Common.b2Settings.b2Assert(!1)}return o},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Common.Math.b2Transform=function(t,e){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,t&&this.position.SetV(t),e&&this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(t,e){this.position.SetV(t),this.R.SetM(e)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(t){this.position.SetV(t.position),this.R.SetM(t.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(t){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var e=t.proxyA,o=t.proxyB,i=t.sweepA,n=t.sweepB;Box2D.Common.b2Settings.b2Assert(i.t0==n.t0),Box2D.Common.b2Settings.b2Assert(1-i.t0>Number.MIN_VALUE);var s=e.m_radius+o.m_radius,t=t.tolerance,a=0,r=0,c=0;for(Box2D.Collision.b2TimeOfImpact.s_cache.count=0,Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){if(i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,a),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,a),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=e,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=o,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput),0>=Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance){a=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,e,Box2D.Collision.b2TimeOfImpact.s_xfA,o,Box2D.Collision.b2TimeOfImpact.s_xfB);var l=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(0>=l){a=1;break}if(0==r&&(c=l>s?Math.max(s-t,.75*s):Math.max(l-t,.02*s)),.5*t>l-c){if(0==r){a=1;break}break}var h=a,m=a,u=1;i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,u),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,u);var p=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(p>=c){a=1;break}for(var y=0;;){var d=0,d=1&y?m+(c-l)*(u-m)/(p-l):.5*(m+u);i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,d),n.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,d);var f=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(f-c)<.025*t){h=d;break}if(f>c?(m=d,l=f):(u=d,p=f),y++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++,50==y)break}if(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,y),h<(1+100*Number.MIN_VALUE)*a)break;if(a=h,r++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++,1e3==r)break}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,r),a},Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.Contacts={},Box2D.Dynamics.Contacts.b2Contact=function(t,e){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var o=t.GetBody(),i=e.GetBody();this.continuous=o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet()||i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=o.GetContactList(),this.bodyBList=i.GetContactList(),this.worldList=i.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(t,e){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var o=t.GetBody(),i=e.GetBody();this.continuous=o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||o.IsBullet()||i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet(),this.sensor=t.IsSensor()||e.IsSensor(),this.filtering=!1,this.m_fixtureA=t,this.m_fixtureB=e,this.enabled=!0,this.bodyAList=o.GetContactList(),this.bodyBList=i.GetContactList(),this.worldList=i.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var t=!1,e=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(t=!0),this.IsContinuous()&&(e=!0)),this.bodyAList.UpdateContact(this,t,e),this.bodyBList.UpdateContact(this,t,e),this.worldList.UpdateContact(this,t,e)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),o=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),i.m_radius,o.GetTransform(),n.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(t){this.sensor=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(t){this.enabled=t,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(t){var e=this.m_fixtureA.GetBody();return e!=t?e:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.enabled=!0;var e=!1,o=this.IsTouching(),i=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor)s&&(e=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),i.GetTransform(),this.m_fixtureB.GetShape(),n.GetTransform())),this.m_manifold.m_pointCount=0;else{if(this.continuous=i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()||n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()?!0:!1,s)for(this.Evaluate(),e=0<this.m_manifold.m_pointCount,s=0;s<this.m_manifold.m_pointCount;s++){var a=this.m_manifold.m_points[s];a.m_normalImpulse=0;for(var r=a.m_tangentImpulse=0;r<this.m_oldManifold.m_pointCount;r++){var c=this.m_oldManifold.m_points[r];if(c.m_id.GetKey()==a.m_id.GetKey()){a.m_normalImpulse=c.m_normalImpulse,a.m_tangentImpulse=c.m_tangentImpulse;break}}}else this.m_manifold.m_pointCount=0;e!=o&&(i.SetAwake(!0),n.SetAwake(!0))}this.touching=e,e!=o&&this.UpdateLists(),!o&&e&&t.BeginContact(this),o&&!e&&t.EndContact(this),this.sensor||t.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(t,e){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=t,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=e,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2MassData._freeCache=[],Box2D.Collision.Shapes.b2MassData.Get=function(){if(0<Box2D.Collision.Shapes.b2MassData._freeCache.length){var t=Box2D.Collision.Shapes.b2MassData._freeCache.pop();return t.mass=0,t.center.SetZero(),t.I=0,t}return new Box2D.Collision.Shapes.b2MassData},Box2D.Collision.Shapes.b2MassData.Free=function(t){null!=t&&Box2D.Collision.Shapes.b2MassData._freeCache.push(t)},Box2D.Collision.Shapes.b2MassData.prototype.SetV=function(t,e,o){this.mass=t,this.center.SetV(e),this.I=o},Box2D.Collision.Shapes.b2MassData.prototype.Set=function(t,e,o,i){this.mass=t,this.center.Set(e,o),this.I=i},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},goog.inherits(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var t=new Box2D.Collision.Shapes.b2PolygonShape;return t.Set(this),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(t){if(Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,t),t instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t.m_vertices[e]),this.m_normals[e].SetV(t.m_normals[e])}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(t){this.SetAsVector(t)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsArray(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(t){var e=t.length;for(Box2D.Common.b2Settings.b2Assert(e>=2),this.m_vertexCount=e,this.Reserve(e),e=e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(t[e]);for(e=0;e<this.m_vertexCount;++e){t=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[e+1<this.m_vertexCount?e+1:0],this.m_vertices[e]),Box2D.Common.b2Settings.b2Assert(t.LengthSquared()>Number.MIN_VALUE);var o=Box2D.Common.Math.b2Math.CrossVF(t,1);Box2D.Common.Math.b2Vec2.Free(t),this.m_normals[e].SetV(o),Box2D.Common.Math.b2Vec2.Free(o),this.m_normals[e].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(t){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.SetAsVector(t),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(t,e){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(t,e){var o=new Box2D.Collision.Shapes.b2PolygonShape;return o.SetAsBox(t,e),o},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(t,e,o,i){for(this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=o,t=new Box2D.Common.Math.b2Mat22,t.Set(i),o=new Box2D.Common.Math.b2Transform(o,t),i=0;i<this.m_vertexCount;++i)this.m_vertices[i]=Box2D.Common.Math.b2Math.MulX(o,this.m_vertices[i]),this.m_normals[i]=Box2D.Common.Math.b2Math.MulMV(o.R,this.m_normals[i])},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(t,e,o,i){var n=new Box2D.Collision.Shapes.b2PolygonShape;return n.SetAsOrientedBox(t,e,o,i),n},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(t,e){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(t),this.m_vertices[1].SetV(e),this.m_centroid.x=.5*(t.x+e.x),this.m_centroid.y=.5*(t.y+e.y);var o=Box2D.Common.Math.b2Math.SubtractVV(e,t),i=Box2D.Common.Math.b2Math.CrossVF(o,1);Box2D.Common.Math.b2Vec2.Free(o),this.m_normals[0]=i,Box2D.Common.Math.b2Vec2.Free(i),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(t,e){var o=new Box2D.Collision.Shapes.b2PolygonShape;return o.SetAsEdge(t,e),o},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(t,e){var o;o=t.R;for(var i=e.x-t.position.x,n=e.y-t.position.y,s=i*o.col1.x+n*o.col1.y,a=i*o.col2.x+n*o.col2.y,r=0;r<this.m_vertexCount;++r)if(o=this.m_vertices[r],i=s-o.x,n=a-o.y,o=this.m_normals[r],0<o.x*i+o.y*n)return!1;return!0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(t,e,o){var i,n,s=0,a=e.maxFraction,r=0,c=0,r=e.p1.x-o.position.x,c=e.p1.y-o.position.y;i=o.R;var l=r*i.col1.x+c*i.col1.y,h=r*i.col2.x+c*i.col2.y,r=e.p2.x-o.position.x,c=e.p2.y-o.position.y;i=o.R,e=r*i.col1.x+c*i.col1.y-l,i=r*i.col2.x+c*i.col2.y-h;for(var m=-1,u=0;u<this.m_vertexCount;++u){if(n=this.m_vertices[u],r=n.x-l,c=n.y-h,n=this.m_normals[u],r=n.x*r+n.y*c,c=n.x*e+n.y*i,0==c){if(0>r)return!1}else 0>c&&s*c>r?(s=r/c,m=u):c>0&&a*c>r&&(a=r/c);if(a<s-Number.MIN_VALUE)return!1}return m>=0?(t.fraction=s,i=o.R,n=this.m_normals[m],t.normal.x=i.col1.x*n.x+i.col2.x*n.y,t.normal.y=i.col1.y*n.x+i.col2.y*n.y,!0):!1},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(t,e){for(var o=e.R,i=this.m_vertices[0],n=e.position.x+(o.col1.x*i.x+o.col2.x*i.y),s=e.position.y+(o.col1.y*i.x+o.col2.y*i.y),a=n,r=s,c=1;c<this.m_vertexCount;++c)var i=this.m_vertices[c],l=e.position.x+(o.col1.x*i.x+o.col2.x*i.y),i=e.position.y+(o.col1.y*i.x+o.col2.y*i.y),n=l>n?n:l,s=i>s?s:i,a=a>l?a:l,r=r>i?r:i;t.lowerBound.x=n-this.m_radius,t.lowerBound.y=s-this.m_radius,t.upperBound.x=a+this.m_radius,t.upperBound.y=r+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(t,e){if(2==this.m_vertexCount)t.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),t.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),t.mass=0,t.I=0;else{for(var o=0,i=0,n=0,s=0,a=1/3,r=0;r<this.m_vertexCount;++r)var c=this.m_vertices[r],l=r+1<this.m_vertexCount?this.m_vertices[r+1]:this.m_vertices[0],h=c.x-0,m=c.y-0,u=l.x-0,p=l.y-0,y=h*p-m*u,d=.5*y,n=n+d,o=o+d*a*(0+c.x+l.x),i=i+d*a*(0+c.y+l.y),c=h,s=s+y*(a*(.25*(c*c+u*c+u*u)+(0*c+0*u))+0+(a*(.25*(m*m+p*m+p*p)+(0*m+0*p))+0));t.Set(e*n,o*(1/n),i*(1/n),e*s)}},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(t,e,o,i){for(var n=Box2D.Common.Math.b2Math.MulTMV(o.R,t),s=e-Box2D.Common.Math.b2Math.Dot(t,o.position),a=[],r=0,c=-1,e=-1,l=!1,t=t=0;t<this.m_vertexCount;++t){a[t]=Box2D.Common.Math.b2Math.Dot(n,this.m_vertices[t])-s;var h=a[t]<-Number.MIN_VALUE;t>0&&(h?l||(c=t-1,r++):l&&(e=t-1,r++)),l=h}switch(Box2D.Common.Math.b2Vec2.Free(n),r){case 0:return l?(t=Box2D.Collision.Shapes.b2MassData.Get(),this.ComputeMass(t,1),o=Box2D.Common.Math.b2Math.MulX(o,t.center),i.SetV(o),Box2D.Common.Math.b2Vec2.Free(o),i=t.mass,Box2D.Collision.Shapes.b2MassData.Free(t),i):0;case 1:-1==c?c=this.m_vertexCount-1:e=this.m_vertexCount-1}for(t=(c+1)%this.m_vertexCount,n=(e+1)%this.m_vertexCount,s=(0-a[c])/(a[t]-a[c]),a=(0-a[e])/(a[n]-a[e]),c=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[c].x*(1-s)+this.m_vertices[t].x*s,this.m_vertices[c].y*(1-s)+this.m_vertices[t].y*s),s=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[e].x*(1-a)+this.m_vertices[n].x*a,this.m_vertices[e].y*(1-a)+this.m_vertices[n].y*a),e=0,a=Box2D.Common.Math.b2Vec2.Get(0,0),r=this.m_vertices[t];t!=n;)t=(t+1)%this.m_vertexCount,l=t==n?s:this.m_vertices[t],h=.5*((r.x-c.x)*(l.y-c.y)-(r.y-c.y)*(l.x-c.x)),e+=h,a.x+=h*(c.x+r.x+l.x)/3,a.y+=h*(c.y+r.y+l.y)/3,r=l;return Box2D.Common.Math.b2Vec2.Free(c),Box2D.Common.Math.b2Vec2.Free(s),a.Multiply(1/e),o=Box2D.Common.Math.b2Math.MulX(o,a),Box2D.Common.Math.b2Vec2.Free(a),i.SetV(o),Box2D.Common.Math.b2Vec2.Free(o),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(t){t.SetValues(this.m_vertexCount,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(t){for(var e=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_vertexCount;++i){var n=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;n>o&&(e=i,o=n)}return e},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(t){for(var e=0,o=this.m_vertices[0].x*t.x+this.m_vertices[0].y*t.y,i=1;i<this.m_vertexCount;++i){var n=this.m_vertices[i].x*t.x+this.m_vertices[i].y*t.y;n>o&&(e=i,o=n)}return this.m_vertices[e]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(t){for(var e=0;e<this.m_vertices.length;e++)Box2D.Common.Math.b2Vec2.Free(this.m_vertices[e]),Box2D.Common.Math.b2Vec2.Free(this.m_normals[e]);for(this.m_vertices=[],this.m_normals=[],e=0;t>e;e++)this.m_vertices[e]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[e]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(t,e){for(var o=Box2D.Common.Math.b2Vec2.Get(0,0),i=0,n=1/3,s=0;e>s;++s){var a=t[s],r=e>s+1?t[s+1]:t[0],c=.5*((a.x-0)*(r.y-0)-(a.y-0)*(r.x-0)),i=i+c;o.x+=c*n*(0+a.x+r.x),o.y+=c*n*(0+a.y+r.y)}return o.x*=1/i,o.y*=1/i,o},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.Shapes.b2EdgeShape=function(t,e){Box2D.Collision.Shapes.b2Shape.call(this),this.m_nextEdge=this.m_prevEdge=null,this.m_v1=t,this.m_v2=e,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex2=this.m_cornerConvex1=!1},goog.inherits(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(){return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(t,e,o){var i=e.p2.x-e.p1.x,n=e.p2.y-e.p1.y,s=o.R,a=o.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),r=o.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),c=o.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-r,o=-(o.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-a),s=100*Number.MIN_VALUE,l=-(i*c+n*o);if(l>s){var a=e.p1.x-a,h=e.p1.y-r,r=a*c+h*o;if(r>=0&&r<=e.maxFraction*l&&(e=-i*h+n*a,e>=-s*l&&l*(1+s)>=e))return t.fraction=r/l,e=Math.sqrt(c*c+o*o),t.normal.x=c/e,t.normal.y=o/e,!0}return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(t,e){var o=e.R,i=e.position.x+(o.col1.x*this.m_v1.x+o.col2.x*this.m_v1.y),n=e.position.y+(o.col1.y*this.m_v1.x+o.col2.y*this.m_v1.y),s=e.position.x+(o.col1.x*this.m_v2.x+o.col2.x*this.m_v2.y),o=e.position.y+(o.col1.y*this.m_v2.x+o.col2.y*this.m_v2.y);s>i?(t.lowerBound.x=i,t.upperBound.x=s):(t.lowerBound.x=s,t.upperBound.x=i),o>n?(t.lowerBound.y=n,t.upperBound.y=o):(t.lowerBound.y=o,t.upperBound.y=n)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(t){t.mass=0,t.center.SetV(this.m_v1),t.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(t,e,o,i){void 0===e&&(e=0);var n=Box2D.Common.Math.b2Vec2.Get(t.x*e,t.y*e),s=Box2D.Common.Math.b2Math.MulX(o,this.m_v1),o=Box2D.Common.Math.b2Math.MulX(o,this.m_v2),a=Box2D.Common.Math.b2Math.Dot(t,s)-e,t=Box2D.Common.Math.b2Math.Dot(t,o)-e;if(a>0){if(t>0)return 0;s.x=-t/(a-t)*s.x+a/(a-t)*o.x,s.y=-t/(a-t)*s.y+a/(a-t)*o.y}else t>0&&(o.x=-t/(a-t)*s.x+a/(a-t)*o.x,o.y=-t/(a-t)*s.y+a/(a-t)*o.y);return i.x=(n.x+s.x+o.x)/3,i.y=(n.y+s.y+o.y)/3,.5*((s.x-n.x)*(o.y-n.y)-(s.y-n.y)*(o.x-n.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal
},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(t){var e=t.R;return Box2D.Common.Math.b2Vec2.Get(t.position.x+(e.col1.x*this.m_coreV1.x+e.col2.x*this.m_coreV1.y),t.position.y+(e.col1.y*this.m_coreV1.x+e.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(t,e,o){var i=t.R,n=t.position.x+(i.col1.x*this.m_coreV1.x+i.col2.x*this.m_coreV1.y),s=t.position.y+(i.col1.y*this.m_coreV1.x+i.col2.y*this.m_coreV1.y),a=t.position.x+(i.col1.x*this.m_coreV2.x+i.col2.x*this.m_coreV2.y),t=t.position.y+(i.col1.y*this.m_coreV2.x+i.col2.y*this.m_coreV2.y);return n*e+s*o>a*e+t*o?Box2D.Common.Math.b2Vec2.Get(n,s):Box2D.Common.Math.b2Vec2.Get(a,t)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(t,e,o,i){this.m_prevEdge=t,this.m_coreV1=e,this.m_cornerDir1=o,this.m_cornerConvex1=i},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(t,e,o,i){this.m_nextEdge=t,this.m_coreV2=e,this.m_cornerDir2=o,this.m_cornerConvex2=i},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(t,e){Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(t,e){Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},Box2D.Dynamics.b2TimeStep=function(t,e,o,i,n){this.Reset(t,e,o,i,n)},Box2D.Dynamics.b2TimeStep.prototype.Reset=function(t,e,o,i,n){this.dt=t;var s=0;t>0&&(s=1/t),this.inv_dt=s,this.dtRatio=e,this.positionIterations=o,this.velocityIterations=i,this.warmStarting=n},Box2D.Dynamics.Joints.b2FrictionJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(t.localAnchorA),this.m_localAnchorB.SetV(t.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),new Box2D.Common.Math.b2Vec2.Get(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(t){void 0===t&&(t=0),this.m_maxTorque=t},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(t){var e,o=0,i=this.m_bodyA,n=this.m_bodyB;e=i.m_xf.R;var s=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=o;e=n.m_xf.R;var r=this.m_localAnchorB.x-n.m_sweep.localCenter.x,c=this.m_localAnchorB.y-n.m_sweep.localCenter.y,o=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=o;e=i.m_invMass;var o=n.m_invMass,l=i.m_invI,h=n.m_invI,m=new b2Mat22;m.col1.x=e+o,m.col2.x=0,m.col1.y=0,m.col2.y=e+o,m.col1.x+=l*a*a,m.col2.x+=-l*s*a,m.col1.y+=-l*s*a,m.col2.y+=l*s*s,m.col1.x+=h*c*c,m.col2.x+=-h*r*c,m.col1.y+=-h*r*c,m.col2.y+=h*r*r,m.GetInverse(this.m_linearMass),this.m_angularMass=l+h,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting?(this.m_linearImpulse.x*=t.dtRatio,this.m_linearImpulse.y*=t.dtRatio,this.m_angularImpulse*=t.dtRatio,t=this.m_linearImpulse,i.m_linearVelocity.x-=e*t.x,i.m_linearVelocity.y-=e*t.y,i.m_angularVelocity-=l*(s*t.y-a*t.x+this.m_angularImpulse),n.m_linearVelocity.x+=o*t.x,n.m_linearVelocity.y+=o*t.y,n.m_angularVelocity+=h*(r*t.y-c*t.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(t){var e,o=0,i=this.m_bodyA,n=this.m_bodyB,s=i.m_linearVelocity,a=i.m_angularVelocity,r=n.m_linearVelocity,c=n.m_angularVelocity,l=i.m_invMass,h=n.m_invMass,m=i.m_invI,u=n.m_invI;e=i.m_xf.R;var p=this.m_localAnchorA.x-i.m_sweep.localCenter.x,y=this.m_localAnchorA.y-i.m_sweep.localCenter.y,o=e.col1.x*p+e.col2.x*y,y=e.col1.y*p+e.col2.y*y,p=o;e=n.m_xf.R;var d=this.m_localAnchorB.x-n.m_sweep.localCenter.x,f=this.m_localAnchorB.y-n.m_sweep.localCenter.y,o=e.col1.x*d+e.col2.x*f,f=e.col1.y*d+e.col2.y*f,d=o;e=0;var o=-this.m_angularMass*(c-a),x=this.m_angularImpulse;e=t.dt*this.m_maxTorque,this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+o,-e,e),o=this.m_angularImpulse-x,a-=m*o,c+=u*o,e=Box2D.Common.Math.b2Vec2.Get(-(r.x-c*f-s.x+a*y),-(r.y+c*d-s.y-a*p)),e.MulM(this.m_linearMass),o=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(e),Box2D.Common.Math.b2Vec2.Free(e),e=t.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>e*e&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(e)),e=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,o),Box2D.Common.Math.b2Vec2.Free(o),s.x-=l*e.x,s.y-=l*e.y,a-=m*(p*e.y-y*e.x),r.x+=h*e.x,r.y+=h*e.y,c+=u*(d*e.y-f*e.x),Box2D.Common.Math.b2Vec2.Free(e),i.m_angularVelocity=a,n.m_angularVelocity=c},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var t=new Box2D.Dynamics.b2FilterData;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},Box2D.Dynamics.b2Fixture=function(t,e,o){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=o.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_aabb_temp=Box2D.Collision.b2AABB.Get(),this.m_body=t,this.m_shape=o.shape.Copy(),this.m_density=o.density,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_isSensor=o.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(t){if(this.m_isSensor!=t&&(this.m_isSensor=t,null!=this.m_body))for(t=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode()){var e=t.contact.GetFixtureA(),o=t.contact.GetFixtureB();(e==this||o==this)&&t.contact.SetSensor(e.IsSensor()||o.IsSensor())}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(t){if(this.m_filter=t.Copy(),null!=this.m_body)for(t=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())(t.contact.GetFixtureA()==this||t.contact.GetFixtureB()==this)&&t.contact.FlagForFiltering()},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(t,e){return this.m_shape.RayCast(t,e,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(t){return t||(t=Box2D.Collision.Shapes.b2MassData.Get()),this.m_shape.ComputeMass(t,this.m_density),t},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(t){this.m_density=t},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(t){this.m_friction=t},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(t){this.m_restitution=t},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(t,e){this.m_shape.ComputeAABB(this.m_aabb,e),this.m_proxy=t.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(t){null!=this.m_proxy&&(t.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(t,e,o){this.m_proxy&&(this.m_shape.ComputeAABB(this.m_aabb,e),this.m_shape.ComputeAABB(this.m_aabb_temp,o),this.m_aabb.Combine(this.m_aabb,this.m_aabb_temp),e=Box2D.Common.Math.b2Math.SubtractVV(o.position,e.position),t.MoveProxy(this.m_proxy,this.m_aabb,e),Box2D.Common.Math.b2Vec2.Free(e))},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.iContactListener=function(){},Box2D.Dynamics.iContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.iContactListener.prototype.EndContact=function(){},Box2D.Dynamics.iContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.iContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.Contacts.b2CircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},goog.inherits(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){var t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,t,this.m_fixtureA.GetBody().m_xf,e,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},goog.inherits(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody(),this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(o))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_motorMass=0},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(t){return void 0===t&&(t=0),t*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(t){this.m_enableLimit=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.m_lowerAngle=t,this.m_upperAngle=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(t){this.m_enableMotor=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(t){void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(t){void 0===t&&(t=0),this.m_maxMotorTorque=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(t){var e,o=this.m_bodyA,i=this.m_bodyB,n=0;e=o.m_xf.R;var s=this.m_localAnchor1.x-o.m_sweep.localCenter.x,a=this.m_localAnchor1.y-o.m_sweep.localCenter.y;n=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=n,e=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,c=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=n;var l=o.m_invMass,h=i.m_invMass,m=o.m_invI,u=i.m_invI;if(this.m_mass.col1.x=l+h+a*a*m+c*c*u,this.m_mass.col2.x=-a*s*m-c*r*u,this.m_mass.col3.x=-a*m-c*u,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+h+s*s*m+r*r*u,this.m_mass.col3.y=s*m+r*u,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=m+u,this.m_motorMass=0==m+u?0:.01,this.m_enableMotor||(this.m_motorImpulse=0),this.m_enableLimit){var p=i.m_sweep.a-o.m_sweep.a-this.m_referenceAngle;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(t.warmStarting){this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var y=this.m_impulse.x,d=this.m_impulse.y;o.m_linearVelocity.x-=l*y,o.m_linearVelocity.y-=l*d,o.m_angularVelocity-=m*(s*d-a*y+this.m_motorImpulse+this.m_impulse.z),i.m_linearVelocity.x+=h*y,i.m_linearVelocity.y+=h*d,i.m_angularVelocity+=u*(r*d-c*y+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(t){var e=this.m_bodyA,o=this.m_bodyB,i=0,n=i=0,s=0,a=0,r=0,c=e.m_linearVelocity,l=e.m_angularVelocity,h=o.m_linearVelocity,m=o.m_angularVelocity,u=e.m_invMass,p=o.m_invMass,y=e.m_invI,d=o.m_invI;if(this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(n=this.m_motorMass*-(m-l-this.m_motorSpeed),s=this.m_motorImpulse,a=t.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+n,-a,a),n=this.m_motorImpulse-s,l-=y*n,m+=d*n),this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var t=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*s,s=t.col1.y*n+t.col2.y*s,n=i,t=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,r=this.m_localAnchor2.y-o.m_sweep.localCenter.y,i=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=i,t=h.x+-m*r-c.x- -l*s,f=h.y+m*a-c.y-l*n;this.m_mass.Solve33(this.impulse3,-t,-f,-(m-l)),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(i=this.m_impulse.z+this.impulse3.z,0>i&&(this.m_mass.Solve22(this.reduced,-t,-f),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(i=this.m_impulse.z+this.impulse3.z,i>0&&(this.m_mass.Solve22(this.reduced,-t,-f),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),c.x-=u*this.impulse3.x,c.y-=u*this.impulse3.y,l-=y*(n*this.impulse3.y-s*this.impulse3.x+this.impulse3.z),h.x+=p*this.impulse3.x,h.y+=p*this.impulse3.y,m+=d*(a*this.impulse3.y-r*this.impulse3.x+this.impulse3.z)}else t=e.m_xf.R,n=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*s,s=t.col1.y*n+t.col2.y*s,n=i,t=o.m_xf.R,a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,r=this.m_localAnchor2.y-o.m_sweep.localCenter.y,i=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=i,this.m_mass.Solve22(this.impulse2,-(h.x+-m*r-c.x- -l*s),-(h.y+m*a-c.y-l*n)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=u*this.impulse2.x,c.y-=u*this.impulse2.y,l-=y*(n*this.impulse2.y-s*this.impulse2.x),h.x+=p*this.impulse2.x,h.y+=p*this.impulse2.y,m+=d*(a*this.impulse2.y-r*this.impulse2.x);e.m_linearVelocity.SetV(c),e.m_angularVelocity=l,o.m_linearVelocity.SetV(h),o.m_angularVelocity=m},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var t,e=0,o=this.m_bodyA,i=this.m_bodyB,n=0,s=t=0,a=0,r=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var e=i.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,c=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(e=Box2D.Common.Math.b2Math.Clamp(e-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),c=-this.m_motorMass*e,n=Math.abs(e)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(e-=this.m_lowerAngle,n=-e,e=Box2D.Common.Math.b2Math.Clamp(e+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),c=-this.m_motorMass*e):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e-=this.m_upperAngle,e=Box2D.Common.Math.b2Math.Clamp(e-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),c=-this.m_motorMass*e),o.m_sweep.a-=o.m_invI*c,i.m_sweep.a+=i.m_invI*c,o.SynchronizeTransform(),i.SynchronizeTransform()}t=o.m_xf.R,c=this.m_localAnchor1.x-o.m_sweep.localCenter.x,e=this.m_localAnchor1.y-o.m_sweep.localCenter.y,s=t.col1.x*c+t.col2.x*e,e=t.col1.y*c+t.col2.y*e,c=s,t=i.m_xf.R;var l=this.m_localAnchor2.x-i.m_sweep.localCenter.x,h=this.m_localAnchor2.y-i.m_sweep.localCenter.y,s=t.col1.x*l+t.col2.x*h,h=t.col1.y*l+t.col2.y*h,l=s,a=i.m_sweep.c.x+l-o.m_sweep.c.x-c,r=i.m_sweep.c.y+h-o.m_sweep.c.y-e,m=a*a+r*r;t=Math.sqrt(m);var s=o.m_invMass,u=i.m_invMass,p=o.m_invI,y=i.m_invI,d=10*Box2D.Common.b2Settings.b2_linearSlop;return m>d*d&&(m=1/(s+u),a=m*-a,r=m*-r,o.m_sweep.c.x-=.5*s*a,o.m_sweep.c.y-=.5*s*r,i.m_sweep.c.x+=.5*u*a,i.m_sweep.c.y+=.5*u*r,a=i.m_sweep.c.x+l-o.m_sweep.c.x-c,r=i.m_sweep.c.y+h-o.m_sweep.c.y-e),this.K1.col1.x=s+u,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=s+u,this.K2.col1.x=p*e*e,this.K2.col2.x=-p*c*e,this.K2.col1.y=-p*c*e,this.K2.col2.y=p*c*c,this.K3.col1.x=y*h*h,this.K3.col2.x=-y*l*h,this.K3.col1.y=-y*l*h,this.K3.col2.y=y*l*l,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-a,-r),a=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,r=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,o.m_sweep.c.x-=o.m_invMass*a,o.m_sweep.c.y-=o.m_invMass*r,o.m_sweep.a-=o.m_invI*(c*r-e*a),i.m_sweep.c.x+=i.m_invMass*a,i.m_sweep.c.y+=i.m_invMass*r,i.m_sweep.a+=i.m_invI*(l*r-h*a),o.SynchronizeTransform(),i.SynchronizeTransform(),t<=Box2D.Common.b2Settings.b2_linearSlop&&n<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(t,e,o){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(o),this.localAnchorB=this.bodyB.GetLocalPoint(o),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(t){switch(Box2D.Common.b2Settings.b2Assert(0<t.pointCount),t.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(t);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(t);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(t)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(t){var e=t.bodyA.m_xf.R,o=t.localPoint,i=t.bodyA.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),n=t.bodyA.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),e=t.bodyB.m_xf.R,o=t.points[0].localPoint,s=t.bodyB.m_xf.position.x+(e.col1.x*o.x+e.col2.x*o.y),e=t.bodyB.m_xf.position.y+(e.col1.y*o.x+e.col2.y*o.y),o=s-i,a=e-n,r=o*o+a*a;r>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(r=Math.sqrt(r),this.m_normal.x=o/r,this.m_normal.y=a/r):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(i+s),this.m_points[0].y=.5*(n+e),this.m_separations[0]=o*this.m_normal.x+a*this.m_normal.y-t.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(t){this.m_normal.x=t.bodyA.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyA.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyA.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.localPoint.x+t.bodyA.m_xf.R.col2.x*t.localPoint.y),o=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.localPoint.x+t.bodyA.m_xf.R.col2.y*t.localPoint.y),i=0;i<t.pointCount;i++){var n=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.points[i].localPoint.x+t.bodyB.m_xf.R.col2.x*t.points[i].localPoint.y),s=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.points[i].localPoint.x+t.bodyB.m_xf.R.col2.y*t.points[i].localPoint.y);this.m_separations[i]=(n-e)*this.m_normal.x+(s-o)*this.m_normal.y-t.radius,this.m_points[i].x=n,this.m_points[i].y=s}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(t){this.m_normal.x=t.bodyB.m_xf.R.col1.x*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.x*t.localPlaneNormal.y,this.m_normal.y=t.bodyB.m_xf.R.col1.y*t.localPlaneNormal.x+t.bodyB.m_xf.R.col2.y*t.localPlaneNormal.y;for(var e=t.bodyB.m_xf.position.x+(t.bodyB.m_xf.R.col1.x*t.localPoint.x+t.bodyB.m_xf.R.col2.x*t.localPoint.y),o=t.bodyB.m_xf.position.y+(t.bodyB.m_xf.R.col1.y*t.localPoint.x+t.bodyB.m_xf.R.col2.y*t.localPoint.y),i=0;i<t.pointCount;i++){var n=t.bodyA.m_xf.position.x+(t.bodyA.m_xf.R.col1.x*t.points[i].localPoint.x+t.bodyA.m_xf.R.col2.x*t.points[i].localPoint.y),s=t.bodyA.m_xf.position.y+(t.bodyA.m_xf.R.col1.y*t.points[i].localPoint.x+t.bodyA.m_xf.R.col2.y*t.points[i].localPoint.y);this.m_separations[i]=(n-e)*this.m_normal.x+(s-o)*this.m_normal.y-t.radius,this.m_points[i].Set(n,s)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(t,e){Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(t,e){Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){var t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,t,this.m_fixtureA.GetBody().m_xf,e,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint},Box2D.Dynamics.b2FixtureList=function(){this.fixtureLastNode=this.fixtureFirstNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(t){var e=t.ID;if(null==this.fixtureNodeLookup[e]){var t=new Box2D.Dynamics.b2FixtureListNode(t),o=this.fixtureLastNode;null!=o?o.SetNextNode(t):this.fixtureFirstNode=t,t.SetPreviousNode(o),this.fixtureLastNode=t,this.fixtureNodeLookup[e]=t,this.fixtureCount++}},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(t){var t=t.ID,e=this.fixtureNodeLookup[t];if(null!=e){var o=e.GetPreviousNode(),e=e.GetNextNode();null==o?this.fixtureFirstNode=e:o.SetNextNode(e),null==e?this.fixtureLastNode=o:e.SetPreviousNode(o),delete this.fixtureNodeLookup[t],this.fixtureCount--}},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(t,e,o,i){void 0===e&&(e=0),void 0===i&&(i=0),this.linearA.SetV(t),this.angularA=e,this.linearB.SetV(o),this.angularB=i},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(t,e,o,i){return void 0===e&&(e=0),void 0===i&&(i=0),this.linearA.x*t.x+this.linearA.y*t.y+this.angularA*e+(this.linearB.x*o.x+this.linearB.y*o.y)+this.angularB*i},Box2D.Dynamics.Joints.b2GearJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var e=t.joint1.m_type,o=t.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var i=0,n=0;
this.m_ground1=t.joint1.GetBodyA(),this.m_bodyA=t.joint1.GetBodyB(),e==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),i=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),i=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.GetBodyA(),this.m_bodyB=t.joint2.GetBodyB(),o==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=i+this.m_ratio*n,this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_J.linearB.x,t*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(t){void 0===t&&(t=0);var e=this.m_bodyB.m_xf.R,o=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,i=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,n=e.col1.x*o+e.col2.x*i,i=e.col1.y*o+e.col2.y*i;return t*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+i*this.m_impulse*this.m_J.linearB.x)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(t){void 0===t&&(t=0),this.m_ratio=t},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_ground1,o=this.m_ground2,i=this.m_bodyA,n=this.m_bodyB,s=0,a=0,r=0,c=0,l=r=0,h=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,h+=i.m_invI):(e=e.m_xf.R,a=this.m_prismatic1.m_localXAxis1,s=e.col1.x*a.x+e.col2.x*a.y,a=e.col1.y*a.x+e.col2.y*a.y,e=i.m_xf.R,r=this.m_localAnchor1.x-i.m_sweep.localCenter.x,c=this.m_localAnchor1.y-i.m_sweep.localCenter.y,l=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=l*a-c*s,this.m_J.linearA.Set(-s,-a),this.m_J.angularA=-r,h+=i.m_invMass+i.m_invI*r*r),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,h+=this.m_ratio*this.m_ratio*n.m_invI):(e=o.m_xf.R,a=this.m_prismatic2.m_localXAxis1,s=e.col1.x*a.x+e.col2.x*a.y,a=e.col1.y*a.x+e.col2.y*a.y,e=n.m_xf.R,r=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,l=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=l*a-c*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*a),this.m_J.angularB=-this.m_ratio*r,h+=this.m_ratio*this.m_ratio*(n.m_invMass+n.m_invI*r*r)),this.m_mass=h>0?1/h:0,t.warmStarting?(i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearA.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearA.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularA,n.m_linearVelocity.x+=n.m_invMass*this.m_impulse*this.m_J.linearB.x,n.m_linearVelocity.y+=n.m_invMass*this.m_impulse*this.m_J.linearB.y,n.m_angularVelocity+=n.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,o=-this.m_mass*this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,e.m_linearVelocity,e.m_angularVelocity);this.m_impulse+=o,t.m_linearVelocity.x+=t.m_invMass*o*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*o*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*o*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*o*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*o*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*o*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,e=this.m_bodyB,o=0,i=0,o=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),i=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),o=-this.m_mass*(this.m_constant-(o+this.m_ratio*i));return t.m_sweep.c.x+=t.m_invMass*o*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*o*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*o*this.m_J.angularA,e.m_sweep.c.x+=e.m_invMass*o*this.m_J.linearB.x,e.m_sweep.c.y+=e.m_invMass*o*this.m_J.linearB.y,e.m_sweep.a+=e.m_invI*o*this.m_J.angularB,t.SynchronizeTransform(),e.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},goog.inherits(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(t,e,o){this.joint1=t,this.bodyA=t.GetBodyA(),this.joint2=e,this.bodyB=e.GetBodyA(),this.ratio=o},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=t.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=t.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=t.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_maxLength1=Math.min(t.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(t.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u2.x,t*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor1),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var t=this.m_ground.m_xf.position.Copy();return t.Add(this.m_groundAnchor2),t},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(e*e+t*t)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),e=t.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),t=t.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(e*e+t*t)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(t){var e,o=this.m_bodyA,i=this.m_bodyB;e=o.m_xf.R;var n=this.m_localAnchor1.x-o.m_sweep.localCenter.x,s=this.m_localAnchor1.y-o.m_sweep.localCenter.y,a=e.col1.x*n+e.col2.x*s,s=e.col1.y*n+e.col2.y*s,n=a;e=i.m_xf.R;var r=this.m_localAnchor2.x-i.m_sweep.localCenter.x,c=this.m_localAnchor2.y-i.m_sweep.localCenter.y,a=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=a;e=i.m_sweep.c.x+r;var a=i.m_sweep.c.y+c,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(o.m_sweep.c.x+n-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),o.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(e-l,a-h),e=this.m_u1.Length(),a=this.m_u2.Length(),e>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),a>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/a):this.m_u2.SetZero(),0<this.m_constant-e-this.m_ratio*a?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,e<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,a<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,e=n*this.m_u1.y-s*this.m_u1.x,a=r*this.m_u2.y-c*this.m_u2.x,this.m_limitMass1=o.m_invMass+o.m_invI*e*e,this.m_limitMass2=i.m_invMass+i.m_invI*a*a,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,t=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,a=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*t,o.m_linearVelocity.y+=o.m_invMass*e,o.m_angularVelocity+=o.m_invI*(n*e-s*t),i.m_linearVelocity.x+=i.m_invMass*a,i.m_linearVelocity.y+=i.m_invMass*l,i.m_angularVelocity+=i.m_invI*(r*l-c*a)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var t,e=this.m_bodyA,o=this.m_bodyB;t=e.m_xf.R;var i=this.m_localAnchor1.x-e.m_sweep.localCenter.x,n=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=t.col1.x*i+t.col2.x*n,n=t.col1.y*i+t.col2.y*n,i=s;t=o.m_xf.R;var a=this.m_localAnchor2.x-o.m_sweep.localCenter.x,r=this.m_localAnchor2.y-o.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*r,r=t.col1.y*a+t.col2.y*r,a=s,c=s=t=0,l=0;t=l=t=l=c=s=t=0,this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(t=e.m_linearVelocity.x+-e.m_angularVelocity*n,s=e.m_linearVelocity.y+e.m_angularVelocity*i,c=o.m_linearVelocity.x+-o.m_angularVelocity*r,l=o.m_linearVelocity.y+o.m_angularVelocity*a,t=-(this.m_u1.x*t+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*c+this.m_u2.y*l),l=this.m_pulleyMass*-t,t=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+l),l=this.m_impulse-t,t=-l*this.m_u1.x,s=-l*this.m_u1.y,c=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*t,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(i*s-n*t),o.m_linearVelocity.x+=o.m_invMass*c,o.m_linearVelocity.y+=o.m_invMass*l,o.m_angularVelocity+=o.m_invI*(a*l-r*c)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(t=e.m_linearVelocity.x+-e.m_angularVelocity*n,s=e.m_linearVelocity.y+e.m_angularVelocity*i,t=-(this.m_u1.x*t+this.m_u1.y*s),l=-this.m_limitMass1*t,t=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-t,t=-l*this.m_u1.x,s=-l*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*t,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(i*s-n*t)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(c=o.m_linearVelocity.x+-o.m_angularVelocity*r,l=o.m_linearVelocity.y+o.m_angularVelocity*a,t=-(this.m_u2.x*c+this.m_u2.y*l),l=-this.m_limitMass2*t,t=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-t,c=-l*this.m_u2.x,l=-l*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*c,o.m_linearVelocity.y+=o.m_invMass*l,o.m_angularVelocity+=o.m_invI*(a*l-r*c))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(){var t,e=this.m_bodyA,o=this.m_bodyB,i=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,r=0,c=0,l=0,h=0,m=t=0,u=0,p=0,y=m=p=t=m=t=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(t=e.m_xf.R,r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,c=this.m_localAnchor1.y-e.m_sweep.localCenter.y,m=t.col1.x*r+t.col2.x*c,c=t.col1.y*r+t.col2.y*c,r=m,t=o.m_xf.R,l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y,m=t.col1.x*l+t.col2.x*h,h=t.col1.y*l+t.col2.y*h,l=m,t=e.m_sweep.c.x+r,m=e.m_sweep.c.y+c,u=o.m_sweep.c.x+l,p=o.m_sweep.c.y+h,this.m_u1.Set(t-i,m-n),this.m_u2.Set(u-s,p-a),t=this.m_u1.Length(),m=this.m_u2.Length(),t>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/t):this.m_u1.SetZero(),m>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/m):this.m_u2.SetZero(),t=this.m_constant-t-this.m_ratio*m,y=Math.max(y,-t),t=Box2D.Common.Math.b2Math.Clamp(t+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_pulleyMass*t,t=-p*this.m_u1.x,m=-p*this.m_u1.y,u=-this.m_ratio*p*this.m_u2.x,p=-this.m_ratio*p*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*t,e.m_sweep.c.y+=e.m_invMass*m,e.m_sweep.a+=e.m_invI*(r*m-c*t),o.m_sweep.c.x+=o.m_invMass*u,o.m_sweep.c.y+=o.m_invMass*p,o.m_sweep.a+=o.m_invI*(l*p-h*u),e.SynchronizeTransform(),o.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(t=e.m_xf.R,r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,c=this.m_localAnchor1.y-e.m_sweep.localCenter.y,m=t.col1.x*r+t.col2.x*c,c=t.col1.y*r+t.col2.y*c,r=m,t=e.m_sweep.c.x+r,m=e.m_sweep.c.y+c,this.m_u1.Set(t-i,m-n),t=this.m_u1.Length(),t>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/t,this.m_u1.y*=1/t):this.m_u1.SetZero(),t=this.m_maxLength1-t,y=Math.max(y,-t),t=Box2D.Common.Math.b2Math.Clamp(t+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass1*t,t=-p*this.m_u1.x,m=-p*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*t,e.m_sweep.c.y+=e.m_invMass*m,e.m_sweep.a+=e.m_invI*(r*m-c*t),e.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(t=o.m_xf.R,l=this.m_localAnchor2.x-o.m_sweep.localCenter.x,h=this.m_localAnchor2.y-o.m_sweep.localCenter.y,m=t.col1.x*l+t.col2.x*h,h=t.col1.y*l+t.col2.y*h,l=m,u=o.m_sweep.c.x+l,p=o.m_sweep.c.y+h,this.m_u2.Set(u-s,p-a),m=this.m_u2.Length(),m>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/m,this.m_u2.y*=1/m):this.m_u2.SetZero(),t=this.m_maxLength2-m,y=Math.max(y,-t),t=Box2D.Common.Math.b2Math.Clamp(t+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass2*t,u=-p*this.m_u2.x,p=-p*this.m_u2.y,o.m_sweep.c.x+=o.m_invMass*u,o.m_sweep.c.y+=o.m_invMass*p,o.m_sweep.a+=o.m_invI*(l*p-h*u),o.SynchronizeTransform()),y<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactImpulse.prototype.Reset=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.Contacts.b2ContactListNode=function(t){this.contact=t,this.previous=this.next=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(t){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var e=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return e.next=null,e.previous=null,e.contact=t,e}return new Box2D.Dynamics.Contacts.b2ContactListNode(t)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(t){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(t)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactFirstNodes[t]=null;for(this.contactLastNodes=[],t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.contactLastNodes[t]=null;this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(t){return this.contactFirstNodes[t]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(t){var e=t.ID;if(null==this.contactNodeLookup[e]){this.contactNodeLookup[e]=[];for(var o=0;o<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;o++)this.contactNodeLookup[e][o]=null;this.CreateNode(t,e,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(t,e,o){e?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),o?this.CreateNode(t,t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(t.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(t){if(t=t.ID,null!=this.contactNodeLookup[t]){for(var e=0;e<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;e++)this.RemoveNode(t,e);delete this.contactNodeLookup[t],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(t,e){var o=this.contactNodeLookup[t];if(null!=o){var i=o[e];if(null!=i){o[e]=null;var o=i.GetPreviousNode(),n=i.GetNextNode();null==o?this.contactFirstNodes[e]=n:o.SetNextNode(n),null==n?this.contactLastNodes[e]=o:n.SetPreviousNode(o),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(i)}}},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(t,e,o){e=this.contactNodeLookup[e],null==e[o]&&(e[o]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(t),t=this.contactLastNodes[o],null!=t?(t.SetNextNode(e[o]),e[o].SetPreviousNode(t)):this.contactFirstNodes[o]=e[o],this.contactLastNodes[o]=e[o])},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(t,e,o,i){var n=o.p1,s=o.p2.x-n.x,a=o.p2.y-n.y,o=this.p2.y-this.p1.y,r=-(this.p2.x-this.p1.x),c=100*Number.MIN_VALUE,l=-(s*o+a*r);if(l>c){var h=n.x-this.p1.x,m=n.y-this.p1.y,n=h*o+m*r;if(n>=0&&i*l>=n&&(i=-s*m+a*h,i>=-c*l&&l*(1+c)>=i))return n/=l,i=Math.sqrt(o*o+r*r),t[0]=n,e.Set(o/i,r/i),!0}return!1},Box2D.Collision.b2Segment.prototype.Extend=function(t){this.ExtendForward(t),this.ExtendBackward(t)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(t){var e=this.p2.x-this.p1.x,o=this.p2.y-this.p1.y,t=Math.min(e>0?(t.upperBound.x-this.p1.x)/e:0>e?(t.lowerBound.x-this.p1.x)/e:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p1.y)/o:0>o?(t.lowerBound.y-this.p1.y)/o:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+e*t,this.p2.y=this.p1.y+o*t},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(t){var e=-this.p2.x+this.p1.x,o=-this.p2.y+this.p1.y,t=Math.min(e>0?(t.upperBound.x-this.p2.x)/e:0>e?(t.lowerBound.x-this.p2.x)/e:Number.POSITIVE_INFINITY,o>0?(t.upperBound.y-this.p2.y)/o:0>o?(t.lowerBound.y-this.p2.y)/o:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+e*t,this.p1.y=this.p2.y+o*t},Box2D.Dynamics.Joints.b2MouseJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.m_localAnchor=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_mass=new Box2D.Common.Math.b2Mat22,this.m_C=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target.SetV(t.target);var e=this.m_target.x-this.m_bodyB.m_xf.position.x,o=this.m_target.y-this.m_bodyB.m_xf.position.y,i=this.m_bodyB.m_xf.R;this.m_localAnchor.x=e*i.col1.x+o*i.col1.y,this.m_localAnchor.y=e*i.col2.x+o*i.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_gamma=this.m_beta=0},goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA=function(){return Box2D.Common.Math.b2Vec2.Get(this.m_target.x,this.m_target.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce=function(t){return void 0===t&&(t=0),Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse.x,t*this.m_impulse.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget=function(){return this.m_target},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget=function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=t},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce=function(t){void 0===t&&(t=0),this.m_maxForce=t},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency=function(t){void 0===t&&(t=0),this.m_frequencyHz=t},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio=function(t){void 0===t&&(t=0),this.m_dampingRatio=t},Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints=function(t){var e=this.m_bodyB,o=e.GetMass(),i=2*Math.PI*this.m_frequencyHz,n=o*i*i;this.m_gamma=t.dt*(2*o*this.m_dampingRatio*i+t.dt*n),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=t.dt*n*this.m_gamma;var n=e.m_xf.R,o=this.m_localAnchor.x-e.m_sweep.localCenter.x,i=this.m_localAnchor.y-e.m_sweep.localCenter.y,s=n.col1.x*o+n.col2.x*i,i=n.col1.y*o+n.col2.y*i,o=s,n=e.m_invMass,s=e.m_invI;this.K1.col1.x=n,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=n,this.K2.col1.x=s*i*i,this.K2.col2.x=-s*o*i,this.K2.col1.y=-s*o*i,this.K2.col2.y=s*o*o,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=e.m_sweep.c.x+o-this.m_target.x,this.m_C.y=e.m_sweep.c.y+i-this.m_target.y,e.m_angularVelocity*=.98,this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,e.m_linearVelocity.x+=n*this.m_impulse.x,e.m_linearVelocity.y+=n*this.m_impulse.y,e.m_angularVelocity+=s*(o*this.m_impulse.y-i*this.m_impulse.x)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints=function(t){var e,o=this.m_bodyB,i=0,n=0;e=o.m_xf.R;var s=this.m_localAnchor.x-o.m_sweep.localCenter.x,a=this.m_localAnchor.y-o.m_sweep.localCenter.y,i=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=i,i=o.m_linearVelocity.x+-o.m_angularVelocity*a,r=o.m_linearVelocity.y+o.m_angularVelocity*s;e=this.m_mass,i=i+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,n=r+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,r=-(e.col1.x*i+e.col2.x*n),n=-(e.col1.y*i+e.col2.y*n),e=this.m_impulse.x,i=this.m_impulse.y,this.m_impulse.x+=r,this.m_impulse.y+=n,t=t.dt*this.m_maxForce,this.m_impulse.LengthSquared()>t*t&&this.m_impulse.Multiply(t/this.m_impulse.Length()),r=this.m_impulse.x-e,n=this.m_impulse.y-i,o.m_linearVelocity.x+=o.m_invMass*r,o.m_linearVelocity.y+=o.m_invMass*n,o.m_angularVelocity+=o.m_invI*(s*n-a*r)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2BodyListNode=function(t){this.body=t,this.previous=this.next=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Common.b2Color=function(t,e,o){this._r=255*Box2D.Common.Math.b2Math.Clamp(t,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(e,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(o,0,1)},Box2D.Common.b2Color.prototype.Set=function(t,e,o){this._r=255*Box2D.Common.Math.b2Math.Clamp(t,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(e,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(o,0,1)},Box2D.Common.b2Color.prototype.GetColor=function(){return this._r<<16|this._g<<8|this._b},Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyFirstNodes[t]=null;for(this.bodyLastNodes=[],t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.bodyLastNodes[t]=null;this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(t){return this.bodyFirstNodes[t]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(t){var e=t.ID;null==this.bodyNodeLookup[e]&&(this.CreateNode(t,e,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(t),t.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(t){var e=t.GetType(),o=t.ID,i=t.IsAwake(),n=t.IsActive();e==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(t,o,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(o,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(t,o,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(o,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),e!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&n&&i?this.CreateNode(t,o,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(o,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),i?this.CreateNode(t,o,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(o,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),n?this.CreateNode(t,o,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(o,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(t){var e=t.ID;if(null!=this.bodyNodeLookup[e]){for(goog.array.remove(t.m_lists,this),t=0;t<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;t++)this.RemoveNode(e,t);delete this.bodyNodeLookup[e],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(t,e){var o=this.bodyNodeLookup[t];if(null!=o){var i=o[e];null!=i&&(o[e]=null,o=i.GetPreviousNode(),i=i.GetNextNode(),null==o?this.bodyFirstNodes[e]=i:o.SetNextNode(i),null==i?this.bodyLastNodes[e]=o:i.SetPreviousNode(o))}},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(t,e,o){var i=this.bodyNodeLookup[e];if(null==i){for(var i=[],n=0;n<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;n++)i[n]=null;this.bodyNodeLookup[e]=i}null==i[o]&&(i[o]=new Box2D.Dynamics.b2BodyListNode(t),t=this.bodyLastNodes[o],null!=t?t.SetNextNode(i[o]):this.bodyFirstNodes[o]=i[o],i[o].SetPreviousNode(t),this.bodyLastNodes[o]=i[o])},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.Controllers={},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.Draw=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(t){this.bodyList.AddBody(t),t.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(t){this.bodyList.RemoveBody(t),t.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);t;t=t.GetNextNode())this.RemoveBody(t.body)},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(t){for(var t=Box2D.Common.Math.b2Vec2.Get(this.A.x*t.dt,this.A.y*t.dt),e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var o=e.body,i=o.GetLinearVelocity(),i=Box2D.Common.Math.b2Vec2.Get(i.x+t.x,i.y+t.y);o.SetLinearVelocity(i),Box2D.Common.Math.b2Vec2.Free(i)}Box2D.Common.Math.b2Vec2.Free(t)},Box2D.Dynamics.Contacts.b2PolygonContact=function(t,e){Box2D.Dynamics.Contacts.b2Contact.call(this,t,e)},goog.inherits(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(t,e){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,t,e)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){var t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,t,this.m_fixtureA.GetBody().m_xf,e,this.m_fixtureB.GetBody().m_xf)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Dynamics.b2Island=function(t,e){this.m_listener=t,this.m_contactSolver=e,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[],this.impulse=new Box2D.Dynamics.b2ContactImpulse},Box2D.Dynamics.b2Island.prototype.Reset=function(t,e){this.m_listener=t,this.m_contactSolver=e},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(t,e,o){this._InitializeVelocities(t,e),this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(t),this._SolveBodies(t),this._SolvePositionConstraints(t),this.Report(this.m_contactSolver.m_constraints),o&&this._SleepIfTired(t)
},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(t,e){for(var o=0;o<this.m_dynamicBodies.length;o++){var i=this.m_dynamicBodies[o],n=e.x,s=e.y;void 0!=i._pc_gravityX&&(n=i._pc_gravityX),void 0!=i._pc_gravityY&&(s=i._pc_gravityY),i.m_linearVelocity.x+=t.dt*(n+i.m_invMass*i.m_force.x),i.m_linearVelocity.y+=t.dt*(s+i.m_invMass*i.m_force.y),i.m_angularVelocity+=t.dt*i.m_invI*i.m_torque,i.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-t.dt*i.m_linearDamping,0,1)),i.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-t.dt*i.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(t){this.m_contactSolver.InitVelocityConstraints(t);for(var e=0;e<this.m_joints.length;e++)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;e++){for(var o=0;o<this.m_joints.length;o++)this.m_joints[o].SolveVelocityConstraints(t);this.m_contactSolver.SolveVelocityConstraints()}for(t=0;t<this.m_joints.length;t++)this.m_joints[t].FinalizeVelocityConstraints();this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(t){for(var e=0;e<this.m_nonStaticBodies.length;++e){var o=this.m_nonStaticBodies[e],i=t.dt*o.m_linearVelocity.x,n=t.dt*o.m_linearVelocity.y;i*i+n*n>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,o.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt),i=t.dt*o.m_angularVelocity,i*i>Box2D.Common.b2Settings.b2_maxRotationSquared&&(o.m_angularVelocity=0>o.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y,o.m_sweep.a+=t.dt*o.m_angularVelocity,o.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(t){for(var e=0;e<t.positionIterations;e++){for(var o=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),i=!0,n=0;n<this.m_joints.length;n++)var s=this.m_joints[n].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),i=i&&s;if(o&&i)break}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(t){for(var e=Number.MAX_VALUE,o=0;o<this.m_nonStaticBodies.length;o++){var i=this.m_nonStaticBodies[o];!i.m_allowSleep||Math.abs(i.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(i.m_linearVelocity,i.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?e=i.m_sleepTime=0:(i.m_sleepTime+=t.dt,e=Math.min(e,i.m_sleepTime))}if(e>=Box2D.Common.b2Settings.b2_timeToSleep)for(t=0;t<this.m_bodies.length;t++)this.m_bodies[t].SetAwake(!1)},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(t){var e=0,o=0;this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contacts.length);for(var i=this.m_contactSolver,e=0;e<this.m_joints.length;++e)this.m_joints[e].InitVelocityConstraints(t);for(e=0;e<t.velocityIterations;++e)for(i.SolveVelocityConstraints(),o=0;o<this.m_joints.length;++o)this.m_joints[o].SolveVelocityConstraints(t);for(e=0;e<this.m_nonStaticBodies.length;++e){var o=this.m_nonStaticBodies[e],n=t.dt*o.m_linearVelocity.x,s=t.dt*o.m_linearVelocity.y;n*n+s*s>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt,o.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*t.inv_dt),n=t.dt*o.m_angularVelocity,n*n>Box2D.Common.b2Settings.b2_maxRotationSquared&&(o.m_angularVelocity=0>o.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*t.inv_dt),o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=t.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=t.dt*o.m_linearVelocity.y,o.m_sweep.a+=t.dt*o.m_angularVelocity,o.SynchronizeTransform()}for(e=0;e<t.positionIterations;++e){for(n=i.SolvePositionConstraints(.75),s=!0,o=0;o<this.m_joints.length;++o)var a=this.m_joints[o].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),s=s&&a;if(n&&s)break}this.Report(i.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contacts.length;++e){var o=this.m_contacts[e],i=t[e];this.impulse.Reset();for(var n=0;n<i.pointCount;++n)this.impulse.normalImpulses[n]=i.points[n].normalImpulse,this.impulse.tangentImpulses[n]=i.points[n].tangentImpulse;this.m_listener.PostSolve(o,this.impulse)}},Box2D.Dynamics.b2Island.prototype.AddBody=function(t){this.m_bodies.push(t),t.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(t),t.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(t))},Box2D.Dynamics.b2Island.prototype.AddContact=function(t){this.m_contacts.push(t)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(t){this.m_joints.push(t)},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Collision.b2DynamicTreePair=function(t,e){this.fixtureA=t,this.fixtureB=e},Box2D.Collision.b2DynamicTreePair._freeCache=[],Box2D.Collision.b2DynamicTreePair.Get=function(t,e){if(0<Box2D.Collision.b2DynamicTreePair._freeCache.length){var o=Box2D.Collision.b2DynamicTreePair._freeCache.pop();return o.fixtureA=t,o.fixtureB=e,o}return new Box2D.Collision.b2DynamicTreePair(t,e)},Box2D.Collision.b2DynamicTreePair.Free=function(t){null!=t&&Box2D.Collision.b2DynamicTreePair._freeCache.push(t)},Box2D.Dynamics.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1,this.m_drawFlags=0,this.m_originX=0,this.m_originY=0,this.m_ctx=null},Box2D.Dynamics.b2DebugDraw.prototype.SetOrigin=function(t,e){this.m_originX=t,this.m_originY=e},Box2D.Dynamics.b2DebugDraw.prototype.Clear=function(){},Box2D.Dynamics.b2DebugDraw.prototype._color=function(t,e){return"rgba("+((16711680&t)>>16)+","+((65280&t)>>8)+","+(255&t)+","+e+")"},Box2D.Dynamics.b2DebugDraw.prototype.SetFlags=function(t){this.m_drawFlags=t},Box2D.Dynamics.b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},Box2D.Dynamics.b2DebugDraw.prototype.AppendFlags=function(t){this.m_drawFlags|=t},Box2D.Dynamics.b2DebugDraw.prototype.ClearFlags=function(t){this.m_drawFlags&=~t},Box2D.Dynamics.b2DebugDraw.prototype.SetSprite=function(t){this.m_ctx=t},Box2D.Dynamics.b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx},Box2D.Dynamics.b2DebugDraw.prototype.SetDrawScale=function(t){this.m_drawScale=t},Box2D.Dynamics.b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},Box2D.Dynamics.b2DebugDraw.prototype.SetLineThickness=function(t){this.m_lineThickness=t,this.m_ctx.strokeWidth=t},Box2D.Dynamics.b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},Box2D.Dynamics.b2DebugDraw.prototype.SetAlpha=function(t){this.m_alpha=t},Box2D.Dynamics.b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},Box2D.Dynamics.b2DebugDraw.prototype.SetFillAlpha=function(t){this.m_fillAlpha=t},Box2D.Dynamics.b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},Box2D.Dynamics.b2DebugDraw.prototype.SetXFormScale=function(t){this.m_xformScale=t},Box2D.Dynamics.b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},function(t){t.prototype.DrawPolygon=function(t,e,o){if(e){var i=this.m_ctx,n=this.m_drawScale;for(i.beginPath(),i.strokeStyle=this._color(o.GetColor(),this.m_alpha),i.moveTo(t[0].x*n-this.m_originX,t[0].y*n-this.m_originY),o=1;e>o;o++)i.lineTo(t[o].x*n-this.m_originX,t[o].y*n-this.m_originY);i.lineTo(t[0].x*n-this.m_originX,t[0].y*n-this.m_originY),i.closePath(),i.stroke()}},t.prototype.DrawSolidPolygon=function(t,e,o){if(e){var i=this.m_ctx,n=this.m_drawScale;for(i.beginPath(),i.strokeStyle=this._color(o.GetColor(),this.m_alpha),i.fillStyle=this._color(o.GetColor(),this.m_fillAlpha),i.moveTo(t[0].x*n-this.m_originX,t[0].y*n-this.m_originY),o=1;e>o;o++)i.lineTo(t[o].x*n-this.m_originX,t[o].y*n-this.m_originY);i.lineTo(t[0].x*n-this.m_originX,t[0].y*n-this.m_originY),i.closePath(),i.fill(),i.stroke()}},t.prototype.DrawCircle=function(t,e,o){if(e){var i=this.m_ctx,n=this.m_drawScale;i.beginPath(),i.strokeStyle=this._color(o.GetColor(),this.m_alpha),i.arc(t.x*n-this.m_originX,t.y*n-this.m_originY,e*n,0,2*Math.PI,!0),i.closePath(),i.stroke()}},t.prototype.DrawSolidCircle=function(t,e,o,i){if(e){var n=this.m_ctx,s=this.m_drawScale,a=t.x*s-this.m_originX,r=t.y*s-this.m_originY;n.moveTo(0,0),n.beginPath(),n.strokeStyle=this._color(i.GetColor(),this.m_alpha),n.fillStyle=this._color(i.GetColor(),this.m_fillAlpha),n.arc(a,r,e*s,0,2*Math.PI,!0),n.moveTo(a,r),n.lineTo((t.x+o.x*e)*s-this.m_originX,(t.y+o.y*e)*s-this.m_originY),n.closePath(),n.fill(),n.stroke()}},t.prototype.DrawSegment=function(t,e,o){var i=this.m_ctx,n=this.m_drawScale;i.strokeStyle=this._color(o.GetColor(),this.m_alpha),i.beginPath(),i.moveTo(t.x*n-this.m_originX,t.y*n-this.m_originY),i.lineTo(e.x*n-this.m_originX,e.y*n-this.m_originY),i.closePath(),i.stroke()},t.prototype.DrawTransform=function(t){var e=this.m_ctx,o=this.m_drawScale;e.beginPath(),e.strokeStyle=this._color(16711680,this.m_alpha),e.moveTo(t.position.x*o-this.m_originX,t.position.y*o-this.m_originY),e.lineTo((t.position.x+this.m_xformScale*t.R.col1.x)*o-this.m_originX,(t.position.y+this.m_xformScale*t.R.col1.y)*o-this.m_originY),e.strokeStyle=this._color(65280,this.m_alpha),e.moveTo(t.position.x*o-this.m_originX,t.position.y*o-this.m_originY),e.lineTo((t.position.x+this.m_xformScale*t.R.col2.x)*o-this.m_originX,(t.position.y+this.m_xformScale*t.R.col2.y)*o-this.m_originY),e.closePath(),e.stroke()}}(Box2D.Dynamics.b2DebugDraw),Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32,Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.iContactFilter=function(){},Box2D.Dynamics.iContactFilter.prototype.ShouldCollide=function(){},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(t,e){var o=t.GetFilterData(),i=e.GetFilterData();return o.groupIndex==i.groupIndex&&0!=o.groupIndex?0<o.groupIndex:0!=(o.maskBits&i.categoryBits)&&0!=(o.categoryBits&i.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.Joints.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.target=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},goog.inherits(Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2MouseJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2MouseJoint(this)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(t,e,o){this.m_freeContacts[e]=this.m_freeContacts[e]||{},this.m_freeContacts[e][o]=this.m_freeContacts[e][o]||[],this.m_registers[e]=this.m_registers[e]||{},this.m_registers[e][o]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[e][o].ctor=t,this.m_registers[e][o].primary=!0,e!=o&&(this.m_registers[o]=this.m_registers[o]||{},this.m_registers[o][e]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[o][e].ctor=t,this.m_registers[o][e].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(t,e){var o=t.GetShape().GetTypeName(),i=e.GetShape().GetTypeName(),n=this.m_registers[o][i],s=n.ctor;return null!=s?n.primary?0<this.m_freeContacts[o][i].length?(o=this.m_freeContacts[o][i].pop(),o.Reset(t,e),o):new s(t,e):0<this.m_freeContacts[i][o].length?(o=this.m_freeContacts[i][o].pop(),o.Reset(e,t),o):new s(e,t):null},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(t){var e=t.GetFixtureA().GetShape().GetTypeName(),o=t.GetFixtureB().GetShape().GetTypeName();this.m_freeContacts[e][o].push(t)},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[],this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(t,e){var o=this.m_tree.CreateProxy(t,e);return this.BufferMove(o),o},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(t){this.UnBufferMove(t),this.m_tree.DestroyProxy(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(t,e,o){this.m_tree.MoveProxy(t,e,o)&&this.BufferMove(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(t,e){var o=this.m_tree.GetFatAABB(t),i=this.m_tree.GetFatAABB(e);return o.TestOverlap(i)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(t){return this.m_tree.GetFatAABB(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(t){for(this.lastQueryFixtureB=this.lastQueryFixtureA=null,this.updatePairsCallback=t;0<this.m_moveBuffer.length;)this.queryProxy=this.m_moveBuffer.pop(),this.m_tree.Query(this.QueryCallback,this.m_tree.GetFatAABB(this.queryProxy),this);this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.QueryCallback=function(t){return t!=this.queryProxy.fixture&&!(this.queryProxy.fixture==this.lastQueryFixtureA&&t==this.lastQueryFixtureB)&&!(this.queryProxy.fixture==this.lastQueryFixtureB&&t==this.lastQueryFixtureA)&&(this.updatePairsCallback(this.queryProxy.fixture,t),this.lastQueryFixtureA=this.queryProxy.fixture,this.lastQueryFixtureB=t),!0},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(t,e){this.m_tree.Query(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(t,e){this.m_tree.RayCast(t,e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(t){this.m_tree.Rebalance(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(t){this.m_moveBuffer.push(t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(t){goog.array.remove(this.m_moveBuffer,t)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Dynamics.b2ContactManager=function(t){this.m_world=t,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(t,e){var o=t.GetBody(),i=e.GetBody();if(o!=i&&i.ShouldCollide(o)&&this.m_contactFilter.ShouldCollide(t,e)){for(o=i.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);o;o=o.GetNextNode())if(i=o.contact.GetFixtureA(),i==t){if(i=o.contact.GetFixtureB(),i==e)return}else if(i==e&&(i=o.contact.GetFixtureB(),i==t))return;this.m_contactFactory.Create(t,e)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var t=this;this.m_broadPhase.UpdatePairs(function(e,o){t.AddPair(e,o)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(t){var e=t.GetFixtureA(),o=t.GetFixtureB(),e=e.GetBody(),o=o.GetBody();t.IsTouching()&&this.m_contactListener.EndContact(t),0<t.m_manifold.m_pointCount&&(e.SetAwake(!0),o.SetAwake(!0)),t.RemoveFromLists(),this.m_contactFactory.Destroy(t)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var t=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode()){var e=t.contact,o=e.GetFixtureA(),i=e.GetFixtureB(),n=o.GetBody(),s=i.GetBody();if(n.IsAwake()||s.IsAwake()){if(e.IsFiltering()){if(!s.ShouldCollide(n)){this.Destroy(e);continue}if(!this.m_contactFilter.ShouldCollide(o,i)){this.Destroy(e);continue}e.ClearFiltering()}this.m_broadPhase.TestOverlap(o.m_proxy,i.m_proxy)?e.Update(this.m_contactListener):this.Destroy(e)}}},Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.Joints.b2DistanceJoint=function(t){Box2D.Dynamics.Joints.b2Joint.call(this,t),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(t.localAnchorA),this.m_localAnchor2.SetV(t.localAnchorB),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(t){return Box2D.Common.Math.b2Vec2.Get(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(t){this.m_length=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(t){this.m_frequencyHz=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(t){this.m_dampingRatio=t},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(t){var e,o=0,i=this.m_bodyA,n=this.m_bodyB;e=i.m_xf.R;var s=this.m_localAnchor1.x-i.m_sweep.localCenter.x,a=this.m_localAnchor1.y-i.m_sweep.localCenter.y,o=e.col1.x*s+e.col2.x*a,a=e.col1.y*s+e.col2.y*a,s=o;e=n.m_xf.R;var r=this.m_localAnchor2.x-n.m_sweep.localCenter.x,c=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=e.col1.x*r+e.col2.x*c,c=e.col1.y*r+e.col2.y*c,r=o;this.m_u.x=n.m_sweep.c.x+r-i.m_sweep.c.x-s,this.m_u.y=n.m_sweep.c.y+c-i.m_sweep.c.y-a,o=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),o>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/o):this.m_u.SetZero(),e=s*this.m_u.y-a*this.m_u.x;var l=r*this.m_u.y-c*this.m_u.x;if(e=i.m_invMass+i.m_invI*e*e+n.m_invMass+n.m_invI*l*l,this.m_mass=0!=e?1/e:0,0<this.m_frequencyHz){var o=o-this.m_length,l=2*Math.PI*this.m_frequencyHz,h=this.m_mass*l*l;this.m_gamma=t.dt*(2*this.m_mass*this.m_dampingRatio*l+t.dt*h),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=o*t.dt*h*this.m_gamma,this.m_mass=e+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}t.warmStarting?(this.m_impulse*=t.dtRatio,t=this.m_impulse*this.m_u.x,e=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*e,i.m_angularVelocity-=i.m_invI*(s*e-a*t),n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*e,n.m_angularVelocity+=n.m_invI*(r*e-c*t)):this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var t=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*t+this.m_bodyA.m_xf.R.col2.x*e,e=this.m_bodyA.m_xf.R.col1.y*t+this.m_bodyA.m_xf.R.col2.y*e,t=o,i=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,o=this.m_bodyB.m_xf.R.col1.x*i+this.m_bodyB.m_xf.R.col2.x*n,n=this.m_bodyB.m_xf.R.col1.y*i+this.m_bodyB.m_xf.R.col2.y*n,i=o,s=-this.m_mass*(this.m_u.x*(this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*n-(this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*e))+this.m_u.y*(this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*i-(this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*t))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=s,o=s*this.m_u.x,s*=this.m_u.y,this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*o,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*s,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(t*s-e*o),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*o,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*s,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(i*s-n*o)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(){if(0<this.m_frequencyHz)return!0;var t=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,o=this.m_bodyA.m_xf.R.col1.x*t+this.m_bodyA.m_xf.R.col2.x*e,e=this.m_bodyA.m_xf.R.col1.y*t+this.m_bodyA.m_xf.R.col2.y*e,t=o,i=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,n=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,o=this.m_bodyB.m_xf.R.col1.x*i+this.m_bodyB.m_xf.R.col2.x*n,n=this.m_bodyB.m_xf.R.col1.y*i+this.m_bodyB.m_xf.R.col2.y*n,i=o,s=this.m_bodyB.m_sweep.c.x+i-this.m_bodyA.m_sweep.c.x-t,a=this.m_bodyB.m_sweep.c.y+n-this.m_bodyA.m_sweep.c.y-e,o=Math.sqrt(s*s+a*a),s=s/o,a=a/o,o=Box2D.Common.Math.b2Math.Clamp(o-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),r=-this.m_mass*o;return this.m_u.Set(s,a),s=r*this.m_u.x,a=r*this.m_u.y,this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*s,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*a,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(t*a-e*s),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*s,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*a,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(i*a-n*s),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(o)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(t,e,o,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(o)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(i)),t=i.x-o.x,o=i.y-o.y,this.length=Math.sqrt(t*t+o*o),this.dampingRatio=this.frequencyHz=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.density=this.offset=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},goog.inherits(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity());for(var t=Box2D.Common.Math.b2Vec2.Get(0,0),e=Box2D.Common.Math.b2Vec2.Get(0,0),o=Box2D.Common.Math.b2Vec2.Get(0,0),i=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);i;i=i.GetNextNode()){e.Set(0,0),t.Set(0,0);for(var n=i.body,s=0,a=0,r=n.GetFixtureList().GetFirstNode();r;r=r.GetNextNode()){o.Set(0,0);var c=r.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,n.GetTransform(),o),s=s+c;t.x+=c*o.x,t.y+=c*o.y;var l=0,l=1,a=a+c*l;e.x+=c*o.x*l,e.y+=c*o.y*l}s<Number.MIN_VALUE||(t.x/=s,t.y/=s,e.x/=a,e.y/=a,a=this.gravity.GetNegative(),a.Multiply(this.density*s),n.ApplyForce(a,e),Box2D.Common.Math.b2Vec2.Free(a),a=n.GetLinearVelocityFromWorldPoint(t),a.Subtract(this.velocity),a.Multiply(-this.linearDrag*s),n.ApplyForce(a,t),Box2D.Common.Math.b2Vec2.Free(a),n.ApplyTorque(-n.GetInertia()/n.GetMass()*s*n.GetAngularVelocity()*this.angularDrag))}Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(t)},Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Draw=function(t){var e=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset+1e3*this.normal.y,this.normal.y*this.offset-1e3*this.normal.x),o=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset-1e3*this.normal.y,this.normal.y*this.offset+1e3*this.normal.x);t.DrawSegment(e,o,Box2D.Dynamics.Controllers.b2BuoyancyController.color),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(o)},Box2D.Dynamics.Controllers.b2BuoyancyController.color=new Box2D.Common.b2Color(0,0,1),Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},goog.inherits(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(){var t=null,e=null,o=0,i=null,n=null,s=0,a=0,r=0,s=null;if(this.invSqr)for(var c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())for(var t=c.body,e=t.GetWorldCenter(),o=t.GetMass(),l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode())i=l.body,(t.IsAwake()||i.IsAwake())&&(n=i.GetWorldCenter(),s=n.x-e.x,a=n.y-e.y,r=s*s+a*a,r<Number.MIN_VALUE||(s=Box2D.Common.Math.b2Vec2.Get(s,a),s.Multiply(this.G/r/Math.sqrt(r)*o*i.GetMass()),t.IsAwake()&&t.ApplyForce(s,e),s.Multiply(-1),i.IsAwake()&&i.ApplyForce(s,n),Box2D.Common.Math.b2Vec2.Free(s)));else for(c=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);c;c=c.GetNextNode())for(t=bodyNode.body,e=t.GetWorldCenter(),o=t.GetMass(),l=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);l;l=l.GetNextNode())i=bodyNode.body,(t.IsAwake()||i.IsAwake())&&(n=i.GetWorldCenter(),s=n.x-e.x,a=n.y-e.y,r=s*s+a*a,r<Number.MIN_VALUE||(s=Box2D.Common.Math.b2Vec2.Get(s,a),s.Multiply(this.G/r*o*i.GetMass()),t.IsAwake()&&t.ApplyForce(s,e),s.Multiply(-1),i.IsAwake()&&i.ApplyForce(s,n),Box2D.Common.Math.b2Vec2.Free(s)))},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[];for(var t=this.m_pointCount=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(t,e,o,i,n){if(0!=t.m_pointCount){var s,a,r=0,c=0,l=0,h=0,m=0,u=0;switch(s=0,t.m_type){case Box2D.Collision.b2Manifold.e_circles:a=e.R,s=t.m_localPoint,r=e.position.x+a.col1.x*s.x+a.col2.x*s.y,e=e.position.y+a.col1.y*s.x+a.col2.y*s.y,a=i.R,s=t.m_points[0].m_localPoint,t=i.position.x+a.col1.x*s.x+a.col2.x*s.y,i=i.position.y+a.col1.y*s.x+a.col2.y*s.y,s=t-r,a=i-e,c=s*s+a*a,c>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(c=Math.sqrt(c),this.m_normal.x=s/c,this.m_normal.y=a/c):(this.m_normal.x=1,this.m_normal.y=0),s=e+o*this.m_normal.y,i-=n*this.m_normal.y,this.m_points[0].x=.5*(r+o*this.m_normal.x+(t-n*this.m_normal.x)),this.m_points[0].y=.5*(s+i);break;case Box2D.Collision.b2Manifold.e_faceA:for(a=e.R,s=t.m_localPlaneNormal,c=a.col1.x*s.x+a.col2.x*s.y,l=a.col1.y*s.x+a.col2.y*s.y,a=e.R,s=t.m_localPoint,h=e.position.x+a.col1.x*s.x+a.col2.x*s.y,m=e.position.y+a.col1.y*s.x+a.col2.y*s.y,this.m_normal.x=c,this.m_normal.y=l,r=0;r<t.m_pointCount;r++)a=i.R,s=t.m_points[r].m_localPoint,u=i.position.x+a.col1.x*s.x+a.col2.x*s.y,s=i.position.y+a.col1.y*s.x+a.col2.y*s.y,this.m_points[r].x=u+.5*(o-(u-h)*c-(s-m)*l-n)*c,this.m_points[r].y=s+.5*(o-(u-h)*c-(s-m)*l-n)*l;break;case Box2D.Collision.b2Manifold.e_faceB:for(a=i.R,s=t.m_localPlaneNormal,c=a.col1.x*s.x+a.col2.x*s.y,l=a.col1.y*s.x+a.col2.y*s.y,a=i.R,s=t.m_localPoint,h=i.position.x+a.col1.x*s.x+a.col2.x*s.y,m=i.position.y+a.col1.y*s.x+a.col2.y*s.y,this.m_normal.x=-c,this.m_normal.y=-l,r=0;r<t.m_pointCount;r++)a=e.R,s=t.m_points[r].m_localPoint,u=e.position.x+a.col1.x*s.x+a.col2.x*s.y,s=e.position.y+a.col1.y*s.x+a.col2.y*s.y,this.m_points[r].x=u+.5*(n-(u-h)*c-(s-m)*l-o)*c,this.m_points[r].y=s+.5*(n-(u-h)*c-(s-m)*l-o)*l}}},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(t,e,o){for(this.m_constraintCount=o;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint;for(t=0;o>t;t++){var i=e[t],n=i.m_fixtureA,s=i.m_fixtureB,a=n.m_shape.m_radius,r=s.m_shape.m_radius,c=n.GetBody(),l=s.GetBody(),h=i.GetManifold(),m=Box2D.Common.b2Settings.b2MixFriction(n.GetFriction(),s.GetFriction()),u=Box2D.Common.b2Settings.b2MixRestitution(n.GetRestitution(),s.GetRestitution()),p=c.m_linearVelocity.x,y=c.m_linearVelocity.y,d=l.m_linearVelocity.x,f=l.m_linearVelocity.y,x=c.m_angularVelocity,_=l.m_angularVelocity;for(Box2D.Common.b2Settings.b2Assert(0<h.m_pointCount),Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(h,c.m_xf,a,l.m_xf,r),s=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,i=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,n=this.m_constraints[t],n.bodyA=c,n.bodyB=l,n.manifold=h,n.normal.x=s,n.normal.y=i,n.pointCount=h.m_pointCount,n.friction=m,n.restitution=u,n.localPlaneNormal.x=h.m_localPlaneNormal.x,n.localPlaneNormal.y=h.m_localPlaneNormal.y,n.localPoint.x=h.m_localPoint.x,n.localPoint.y=h.m_localPoint.y,n.radius=a+r,n.type=h.m_type,a=0;a<n.pointCount;++a){m=h.m_points[a],r=n.points[a],r.normalImpulse=m.m_normalImpulse,r.tangentImpulse=m.m_tangentImpulse,r.localPoint.SetV(m.m_localPoint);var m=r.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[a].x-c.m_sweep.c.x,u=r.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[a].y-c.m_sweep.c.y,g=r.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[a].x-l.m_sweep.c.x,b=r.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[a].y-l.m_sweep.c.y,D=m*i-u*s,C=g*i-b*s,D=D*D,C=C*C;
r.normalMass=1/(c.m_invMass+l.m_invMass+c.m_invI*D+l.m_invI*C);var B=c.m_mass*c.m_invMass+l.m_mass*l.m_invMass,B=B+(c.m_mass*c.m_invI*D+l.m_mass*l.m_invI*C);r.equalizedMass=1/B,C=i,B=-s,D=m*B-u*C,C=g*B-b*C,D*=D,C*=C,r.tangentMass=1/(c.m_invMass+l.m_invMass+c.m_invI*D+l.m_invI*C),r.velocityBias=0,m=n.normal.x*(d+-_*b-p- -x*u)+n.normal.y*(f+_*g-y-x*m),m<-Box2D.Common.b2Settings.b2_velocityThreshold&&(r.velocityBias+=-n.restitution*m)}2==n.pointCount&&(f=n.points[0],d=n.points[1],h=c.m_invMass,c=c.m_invI,p=l.m_invMass,l=l.m_invI,y=f.rA.x*i-f.rA.y*s,f=f.rB.x*i-f.rB.y*s,x=d.rA.x*i-d.rA.y*s,d=d.rB.x*i-d.rB.y*s,s=h+p+c*y*y+l*f*f,i=h+p+c*x*x+l*d*d,l=h+p+c*y*x+l*f*d,100*(s*i-l*l)>s*s?(n.K.col1.Set(s,l),n.K.col2.Set(l,i),n.K.GetInverse(n.normalMass)):n.pointCount=1)}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(t){for(var e=0;e<this.m_constraintCount;++e){var o=this.m_constraints[e],i=o.bodyA,n=o.bodyB,s=i.m_invMass,a=i.m_invI,r=n.m_invMass,c=n.m_invI,l=o.normal.x,h=o.normal.y,m=h,u=-l,p=0,y=0;if(t.warmStarting)for(y=o.pointCount,p=0;y>p;++p){var d=o.points[p];d.normalImpulse*=t.dtRatio,d.tangentImpulse*=t.dtRatio;var f=d.normalImpulse*l+d.tangentImpulse*m,x=d.normalImpulse*h+d.tangentImpulse*u;i.m_angularVelocity-=a*(d.rA.x*x-d.rA.y*f),i.m_linearVelocity.x-=s*f,i.m_linearVelocity.y-=s*x,n.m_angularVelocity+=c*(d.rB.x*x-d.rB.y*f),n.m_linearVelocity.x+=r*f,n.m_linearVelocity.y+=r*x}else for(y=o.pointCount,p=0;y>p;++p)i=o.points[p],i.normalImpulse=0,i.tangentImpulse=0}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;t++)this.SolveVelocityConstraints_Constraint(this.m_constraints[t])},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(t){for(var e=t.normal.x,o=t.normal.y,i=0;i<t.pointCount;i++)Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(t,t.points[i]);if(1==t.pointCount){var i=t.points[0],n=i.normalImpulse-i.normalMass*((t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*i.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*i.rA.y)*e+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*i.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*i.rA.x)*o-i.velocityBias),n=n>0?n:0,s=n-i.normalImpulse,a=s*e,o=s*o;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*a,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*o,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(i.rA.x*o-i.rA.y*a),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*a,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*o,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(i.rB.x*o-i.rB.y*a),i.normalImpulse=n}else for(var i=t.points[0],n=t.points[1],s=i.normalImpulse,a=n.normalImpulse,r=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*i.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*i.rA.y)*e+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*i.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*i.rA.x)*o-i.velocityBias,o=(t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*n.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*n.rA.y)*e+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*n.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*n.rA.x)*o-n.velocityBias,r=r-(t.K.col1.x*s+t.K.col2.x*a),o=o-(t.K.col1.y*s+t.K.col2.y*a);;){if(e=-(t.normalMass.col1.x*r+t.normalMass.col2.x*o),e>=0){var c=-(t.normalMass.col1.y*r+t.normalMass.col2.y*o);if(c>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,i,n,e-s,c-a),i.normalImpulse=e,n.normalImpulse=c;break}}if(e=-i.normalMass*r,e>=0&&0<=t.K.col1.y*e+o){this.SolveVelocityConstraints_ConstraintPointUpdate(t,i,n,e-s,-a),i.normalImpulse=e,n.normalImpulse=0;break}if(e=-n.normalMass*o,e>=0&&0<=t.K.col2.x*e+r){this.SolveVelocityConstraints_ConstraintPointUpdate(t,i,n,-s,e-a),i.normalImpulse=0,n.normalImpulse=e;break}if(r>=0&&o>=0){this.SolveVelocityConstraints_ConstraintPointUpdate(t,i,n,-s,-a),i.normalImpulse=0,n.normalImpulse=0;break}break}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(t,e){var o=t.normal.y,i=-t.normal.x,n=t.friction*e.normalImpulse,n=Box2D.Common.Math.b2Math.Clamp(e.tangentImpulse-e.tangentMass*((t.bodyB.m_linearVelocity.x-t.bodyB.m_angularVelocity*e.rB.y-t.bodyA.m_linearVelocity.x+t.bodyA.m_angularVelocity*e.rA.y)*o+(t.bodyB.m_linearVelocity.y+t.bodyB.m_angularVelocity*e.rB.x-t.bodyA.m_linearVelocity.y-t.bodyA.m_angularVelocity*e.rA.x)*i),-n,n),s=n-e.tangentImpulse,o=s*o,i=s*i;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*o,t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*i,t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*i-e.rA.y*o),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*o,t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*i,t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*i-e.rB.y*o),e.tangentImpulse=n},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(t,e,o,i,n){var s=i*t.normal.x,i=i*t.normal.y,a=n*t.normal.x,n=n*t.normal.y;t.bodyA.m_linearVelocity.x-=t.bodyA.m_invMass*(s+a),t.bodyA.m_linearVelocity.y-=t.bodyA.m_invMass*(i+n),t.bodyA.m_angularVelocity-=t.bodyA.m_invI*(e.rA.x*i-e.rA.y*s+o.rA.x*n-o.rA.y*a),t.bodyB.m_linearVelocity.x+=t.bodyB.m_invMass*(s+a),t.bodyB.m_linearVelocity.y+=t.bodyB.m_invMass*(i+n),t.bodyB.m_angularVelocity+=t.bodyB.m_invI*(e.rB.x*i-e.rB.y*s+o.rB.x*n-o.rB.y*a),e.normalImpulse=0,o.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],o=e.manifold,i=0;i<e.pointCount;++i){var n=o.m_points[i],s=e.points[i];n.m_normalImpulse=s.normalImpulse,n.m_tangentImpulse=s.tangentImpulse}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(t){void 0===t&&(t=0);for(var e=0,o=0;o<this.m_constraintCount;o++){var i=this.m_constraints[o],n=i.bodyA,s=i.bodyB,a=n.m_mass*n.m_invMass,r=n.m_mass*n.m_invI,c=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(i);for(var h=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<i.pointCount;m++){var u=i.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],d=p.x-n.m_sweep.c.x,f=p.y-n.m_sweep.c.y,x=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y,e=y>e?e:y,y=Box2D.Common.Math.b2Math.Clamp(t*(y+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),y=-u.equalizedMass*y,u=y*h.x,y=y*h.y;n.m_sweep.c.x-=a*u,n.m_sweep.c.y-=a*y,n.m_sweep.a-=r*(d*y-f*u),n.SynchronizeTransform(),s.m_sweep.c.x+=c*u,s.m_sweep.c.y+=c*y,s.m_sweep.a+=l*(x*y-p*u),s.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(t){void 0===t&&(t=0);for(var e=0,o=0;o<this.m_constraintCount;o++){var i=this.m_constraints[o],n=i.bodyA,s=i.bodyB,a=n.m_mass*n.m_invMass,r=n.m_mass*n.m_invI,c=s.m_mass*s.m_invMass,l=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(i);for(var h=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,m=0;m<i.pointCount;m++){var u=i.points[m],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[m],y=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[m],d=p.x-n.m_sweep.c.x,f=p.y-n.m_sweep.c.y,x=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y;e>y&&(e=y),0!=t&&Box2D.Common.Math.b2Math.Clamp(t*(y+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),y=0*-u.equalizedMass,u=y*h.x,y*=h.y,n.m_sweep.c.x-=a*u,n.m_sweep.c.y-=a*y,n.m_sweep.a-=r*(d*y-f*u),n.SynchronizeTransform(),s.m_sweep.c.x+=c*u,s.m_sweep.c.y+=c*y,s.m_sweep.a+=l*(x*y-p*u),s.SynchronizeTransform()}}return e>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2ControllerListNode=function(t){this.controller=t,this.previous=this.next=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(t){this.next=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(t){this.previous=t},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerLastNode=this.controllerFirstNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(t){var e=t.ID;if(null==this.controllerNodeLookup[e]){var t=new Box2D.Dynamics.Controllers.b2ControllerListNode(t),o=this.controllerLastNode;null!=o?o.SetNextNode(t):this.controllerFirstNode=t,t.SetPreviousNode(o),this.controllerLastNode=t,this.controllerNodeLookup[e]=t,this.controllerCount++}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(t){var t=t.ID,e=this.controllerNodeLookup[t];if(null!=e){var o=e.GetPreviousNode(),e=e.GetNextNode();null==o?this.controllerFirstNode=e:o.SetNextNode(e),null==e?this.controllerLastNode=o:e.SetPreviousNode(o),delete this.controllerNodeLookup[t],this.controllerCount--}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=.2,this.density=this.restitution=0,this.isSensor=!1},Box2D.Dynamics.b2Body=function(t,e){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(t.position),this.m_xf.R.Set(t.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=t.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=t.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=t.bullet,this.m_fixedRotation=t.fixedRotation,this.m_allowSleep=t.allowSleep,this.m_awake=t.awake,this.m_active=t.active,this.m_world=e,this.m_userData=null,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_sleepTime=this.m_torque=0,this.m_type=t.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=t.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(t){return Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),t=new Box2D.Dynamics.b2Fixture(this,this.m_xf,t),this.m_active&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),this.fixtureList.AddFixture(t),t.m_body=this,0<t.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,t},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(t,e){var o=new Box2D.Dynamics.b2FixtureDef;return o.shape=t,o.density=e,this.CreateFixture(o)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(t){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.fixtureList.RemoveFixture(t);for(var e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())(t==e.contact.GetFixtureA()||t==e.contact.GetFixtureB())&&this.m_world.m_contactManager.Destroy(e.contact);this.m_active&&t.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),t.Destroy(),this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(t,e){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_xf.R.Set(e),this.m_xf.position.SetV(t);var o=this.m_xf.R,i=this.m_sweep.localCenter;for(this.m_sweep.c.x=o.col1.x*i.x+o.col2.x*i.y,this.m_sweep.c.y=o.col1.y*i.x+o.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=e,o=this.m_world.m_contactManager.m_broadPhase,i=this.fixtureList.GetFirstNode();i;i=i.GetNextNode())i.fixture.Synchronize(o,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(t){this.SetPositionAndAngle(t.position,t.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(t){this.SetPositionAndAngle(t,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(t){this.SetPositionAndAngle(this.GetPosition(),t)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetUserData=function(){return this.m_userData},Box2D.Dynamics.b2Body.prototype.SetUserData=function(t){this.m_userData=t},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(t){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(t){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=t)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var t=new Box2D.Dynamics.b2BodyDef;return t.type=this.GetType(),t.allowSleep=this.m_allowSleep,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotation,t.bullet=this.m_bullet,t.active=this.m_active,t.awake=this.m_awake,t.linearDamping=this.m_linearDamping,t.linearVelocity.SetV(this.GetLinearVelocity()),t.position.SetV(this.GetPosition()),t},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(t){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=t)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(t,e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))},Box2D.Dynamics.b2Body.prototype.Split=function(t){for(var e=this.GetLinearVelocity().Copy(),o=this.GetAngularVelocity(),i=this.GetWorldCenter(),n=this.m_world.CreateBody(this.GetDefinition()),s=this.fixtureList.GetFirstNode();s;s=s.GetNextNode()){var a=s.fixture;t(a)&&(this.fixtureList.RemoveFixture(a),n.fixtureList.AddFixture(a))}return this.ResetMassData(),n.ResetMassData(),s=this.GetWorldCenter(),t=n.GetWorldCenter(),a=Box2D.Common.Math.b2Math.SubtractVV(s,i),s=Box2D.Common.Math.b2Math.CrossFV(o,a),Box2D.Common.Math.b2Vec2.Free(a),a=Box2D.Common.Math.b2Math.AddVV(e,s),Box2D.Common.Math.b2Vec2.Free(s),this.SetLinearVelocity(a),Box2D.Common.Math.b2Vec2.Free(a),t=Box2D.Common.Math.b2Math.SubtractVV(t,i),i=Box2D.Common.Math.b2Math.CrossFV(o,t),Box2D.Common.Math.b2Vec2.Free(t),t=Box2D.Common.Math.b2Math.AddVV(e,i),Box2D.Common.Math.b2Vec2.Free(i),n.SetLinearVelocity(t),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(e),this.SetAngularVelocity(o),n.SetAngularVelocity(o),this.SynchronizeFixtures(),n.SynchronizeFixtures(),n},Box2D.Dynamics.b2Body.prototype.Merge=function(t){for(var e=t.fixtureList.GetFirstNode();e;e=e.GetNextNode())this.fixtureList.AddFixture(e.fixture),t.fixtureList.RemoveFixture(e.fixture);t.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(t){return t||(t=Box2D.Collision.Shapes.b2MassData.Get()),t.mass=this.m_mass,t.I=this.m_I,t.center.SetV(this.m_sweep.localCenter),t},Box2D.Dynamics.b2Body.prototype.SetMassData=function(t){if(Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=t.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&!this.m_fixedRotation&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x),Box2D.Common.Math.b2Vec2.Free(e)}},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){if(this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero(),this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var t=Box2D.Common.Math.b2Vec2.Get(0,0),e=this.fixtureList.GetFirstNode();e;e=e.GetNextNode()){var o=e.fixture;0!=o.m_density&&(o=o.GetMassData(),this.m_mass+=o.mass,t.x+=o.center.x*o.mass,t.y+=o.center.y*o.mass,this.m_I+=o.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):this.m_invMass=this.m_mass=1,0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,Box2D.Common.b2Settings.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,e=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(e)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(t){var e=this.m_xf.R,t=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,t},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(t){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(t){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,t)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(t){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,t)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(t){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(t){var e=this.m_xf.R,t=Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return t.x+=this.m_xf.position.x,t.y+=this.m_xf.position.y,e=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(t.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(t.x-this.m_sweep.c.x)),Box2D.Common.Math.b2Vec2.Free(t),e},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(t){this.m_linearDamping=t},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(t){this.m_angularDamping=t},Box2D.Dynamics.b2Body.prototype.SetType=function(t){if(this.m_type!=t){for(this.m_type=t,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0,t=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())t.contact.FlagForFiltering();for(t=0;t<this.m_lists.length;t++)this.m_lists[t].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(t){this.m_bullet=t},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(t){(this.m_allowSleep=t)||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(t){if(this.m_awake!=t)for(this.m_awake=t,this.m_sleepTime=0,t||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0),t=0;t<this.m_lists.length;t++)this.m_lists[t].UpdateBody(this)},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(t){this.m_fixedRotation=t,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(t){if(t!=this.m_active){if(t){this.m_active=!0;for(var t=this.m_world.m_contactManager.m_broadPhase,e=this.fixtureList.GetFirstNode();e;e=e.GetNextNode())e.fixture.CreateProxy(t,this.m_xf)}else{for(this.m_active=!1,t=this.m_world.m_contactManager.m_broadPhase,e=this.fixtureList.GetFirstNode();e;e=e.GetNextNode())e.fixture.DestroyProxy(t);for(t=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())this.m_world.m_contactManager.Destroy(t.contact)}for(t=0;t<this.m_lists.length;t++)this.m_lists[t].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(t){this.controllerList.AddController(t)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(t){this.controllerList.RemoveController(t)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var t=Box2D.Dynamics.b2Body.s_xf1;t.R.Set(this.m_sweep.a0);var e=t.R,o=this.m_sweep.localCenter;for(t.position.x=this.m_sweep.c0.x-(e.col1.x*o.x+e.col2.x*o.y),t.position.y=this.m_sweep.c0.y-(e.col1.y*o.x+e.col2.y*o.y),e=this.m_world.m_contactManager.m_broadPhase,o=this.fixtureList.GetFirstNode();o;o=o.GetNextNode())o.fixture.Synchronize(e,t,this.m_xf)},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var t=this.m_xf.R,e=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(t.col1.x*e.x+t.col2.x*e.y),this.m_xf.position.y=this.m_sweep.c.y-(t.col1.y*e.x+t.col2.y*e.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(t){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&t.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},Box2D.Dynamics.b2Body.prototype.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World=function(t,e){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_newFixture=this.m_isLocked=!1,this.m_debugDraw=this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_continuousPhysics=this.m_warmStarting=!0,this.m_allowSleep=e,this.m_gravity=t,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef),this.mainTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.islandTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.island=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(t){this.m_destructionListener=t},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},Box2D.Dynamics.b2World.prototype.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},Box2D.Dynamics.b2World.prototype.SetDebugDraw=function(t){this.m_debugDraw=t},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(t){var e=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=t;for(var o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())for(var i=o.body.GetFixtureList().GetFirstNode();i;i=i.GetNextNode()){var n=i.fixture;n.m_proxy=t.CreateProxy(e.GetFatAABB(n.m_proxy),n)}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(t){return Box2D.Common.b2Settings.b2Assert(!this.IsLocked()),t=new Box2D.Dynamics.b2Body(t,this),this.bodyList.AddBody(t),t},Box2D.Dynamics.b2World.prototype.DestroyBody=function(t){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());for(var e=t.m_jointList;e;){var o=e,e=e.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(o.joint),this.DestroyJoint(o.joint)}for(e=t.GetControllerList().GetFirstNode();e;e=e.GetNextNode())e.controller.RemoveBody(t);for(e=t.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())this.m_contactManager.Destroy(e.contact);for(e=t.GetFixtureList().GetFirstNode();e;e=e.GetNextNode())this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(e.fixture),t.DestroyFixture(e.fixture);t.Destroy(),this.bodyList.RemoveBody(t)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(t){var e=Box2D.Dynamics.Joints.b2Joint.Create(t);e.m_prev=null,(e.m_next=this.m_jointList)&&(this.m_jointList.m_prev=e),this.m_jointList=e,this.m_jointCount++,e.m_edgeA.joint=e,e.m_edgeA.other=e.m_bodyB,e.m_edgeA.prev=null,(e.m_edgeA.next=e.m_bodyA.m_jointList)&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.joint=e,e.m_edgeB.other=e.m_bodyA,e.m_edgeB.prev=null,(e.m_edgeB.next=e.m_bodyB.m_jointList)&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;var o=t.bodyA,i=t.bodyB;if(!t.collideConnected)for(t=i.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())t.contact.GetOther(i)==o&&t.contact.FlagForFiltering();return e},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var o=t.m_bodyA,i=t.m_bodyB;if(o.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==o.m_jointList&&(o.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,this.m_jointCount--,!e)for(t=i.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())t.contact.GetOther(i)==o&&t.contact.FlagForFiltering()},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(t){if(null!==t.m_world&&t.m_world!=this)throw Error("Controller can only be a member of one world");return this.controllerList.AddController(t),t.m_world=this,t},Box2D.Dynamics.b2World.prototype.RemoveController=function(t){this.controllerList.RemoveController(t),t.m_world=null,t.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(t){return this.AddController(t)},Box2D.Dynamics.b2World.prototype.DestroyController=function(t){this.RemoveController(t)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(t){this.m_warmStarting=t},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(t){this.m_gravity=t},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(t,e,o){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0,this.mainTimeStep.Reset(t,this.m_inv_dt0*t,e,o,this.m_warmStarting),this.m_contactManager.Collide(),0<this.mainTimeStep.dt&&(this.Solve(this.mainTimeStep),this.m_continuousPhysics&&this.SolveTOI(this.mainTimeStep),this.m_inv_dt0=this.mainTimeStep.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);t;t=t.GetNextNode())t.body.m_force.SetZero(),t.body.m_torque=0},Box2D.Dynamics.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){this.m_debugDraw.Clear();var t=this.m_debugDraw.GetFlags();if(t&Box2D.Dynamics.b2DebugDraw.e_shapeBit)for(var e=Box2D.Dynamics.b2World.s_color_inactive,o=Box2D.Dynamics.b2World.s_color_static,i=Box2D.Dynamics.b2World.s_color_kinematic,n=Box2D.Dynamics.b2World.s_color_dynamic_sleeping,s=Box2D.Dynamics.b2World.s_color_dynamic_awake,a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode())for(var r=a.body,c=r.GetFixtureList().GetFirstNode();c;c=c.GetNextNode()){var l=c.fixture,l=l.GetShape();r.IsActive()?r.GetType()==Box2D.Dynamics.b2BodyDef.b2_staticBody?this.DrawShape(l,r.m_xf,o):r.GetType()==Box2D.Dynamics.b2BodyDef.b2_kinematicBody?this.DrawShape(l,r.m_xf,i):r.IsAwake()?this.DrawShape(l,r.m_xf,s):this.DrawShape(l,r.m_xf,n):this.DrawShape(l,r.m_xf,e)
}if(t&Box2D.Dynamics.b2DebugDraw.e_jointBit)for(a=this.m_jointList;a;a=a.m_next)this.DrawJoint(a);if(t&Box2D.Dynamics.b2DebugDraw.e_controllerBit)for(a=this.controllerList.GetFirstNode();a;a=a.GetNextNode())a.controller.Draw(this.m_debugDraw);if(t&Box2D.Dynamics.b2DebugDraw.e_pairBit)for(a=Box2D.Dynamics.b2World.s_pairColor,c=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);c;c=c.GetNextNode())e=c.contact.GetFixtureA(),r=c.contact.GetFixtureB(),e=e.GetAABB().GetCenter(),r=r.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(e,r,a),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(r);if(t&Box2D.Dynamics.b2DebugDraw.e_aabbBit)for(e=Box2D.Dynamics.b2World.s_aabbColor,a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.activeBodies);a;a=a.GetNextNode())for(r=a.body,c=r.GetFixtureList().GetFirstNode();c;c=c.GetNextNode())l=c.fixture,r=this.m_contactManager.m_broadPhase.GetFatAABB(l.m_proxy),r=[Box2D.Common.Math.b2Vec2.Get(r.lowerBound.x,r.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(r.upperBound.x,r.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(r.upperBound.x,r.upperBound.y),Box2D.Common.Math.b2Vec2.Get(r.lowerBound.x,r.upperBound.y)],this.m_debugDraw.DrawPolygon(r,4,e),Box2D.Common.Math.b2Vec2.Free(r[0]),Box2D.Common.Math.b2Vec2.Free(r[1]),Box2D.Common.Math.b2Vec2.Free(r[2]),Box2D.Common.Math.b2Vec2.Free(r[3]);if(t&Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit)for(a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode())r=a.body,Box2D.Dynamics.b2World.s_xf.R=r.m_xf.R,Box2D.Dynamics.b2World.s_xf.position=r.GetWorldCenter(),this.m_debugDraw.DrawTransform(Box2D.Dynamics.b2World.s_xf)}},Box2D.Dynamics.b2World.prototype.QueryAABB=function(t,e){this.m_contactManager.m_broadPhase.Query(t,e)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(t,e){var o=Box2D.Collision.b2AABB.Get();o.lowerBound.Set(e.x-Box2D.Common.b2Settings.b2_linearSlop,e.y-Box2D.Common.b2Settings.b2_linearSlop),o.upperBound.Set(e.x+Box2D.Common.b2Settings.b2_linearSlop,e.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(o){return o.TestPoint(e)?t(o):!0},o),Box2D.Collision.b2AABB.Free(o)},Box2D.Dynamics.b2World.prototype.RayCast=function(t,e,o){var i=this.m_contactManager.m_broadPhase,n=new Box2D.Collision.b2RayCastOutput,s=new Box2D.Collision.b2RayCastInput(e,o,1);i.RayCast(function(i,s){if(s.RayCast(n,i)){var a=1-n.fraction,a=Box2D.Common.Math.b2Vec2.Get(a*e.x+n.fraction*o.x,a*e.y+n.fraction*o.y),r=t(s,a,n.normal,n.fraction);return Box2D.Common.Math.b2Vec2.Free(a),r}return i.maxFraction},s)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(t,e){var o=null;return this.RayCast(function(t,e,i,n){return o=t,n},t,e),o},Box2D.Dynamics.b2World.prototype.RayCastAll=function(t,e){var o=[];return this.RayCast(function(t){return o.push(t),1},t,e),o},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked},Box2D.Dynamics.b2World.prototype.Solve=function(t){for(var e=this.controllerList.GetFirstNode();e;e=e.GetNextNode())e.controller.Step(t);e=this.island,e.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())o.body.m_islandFlag=!1;for(var i=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);i;i=i.GetNextNode())i.contact.m_islandFlag=!1;for(o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode())if(i=o.body,!i.m_islandFlag){e.Clear();var n=[];for(n.push(i),i.m_islandFlag=!0;0<n.length;){var s=n.pop();if(e.AddBody(s),s.IsAwake()||s.SetAwake(!0),s.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(i=s.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);i;i=i.GetNextNode()){var a=i.contact;a.m_islandFlag||(e.AddContact(a),a.m_islandFlag=!0,a=a.GetOther(s),a.m_islandFlag||(n.push(a),a.m_islandFlag=!0))}for(i=s.m_jointList;i;i=i.next)!i.joint.m_islandFlag&&i.other.IsActive()&&(e.AddJoint(i.joint),i.joint.m_islandFlag=!0,i.other.m_islandFlag||(n.push(i.other),i.other.m_islandFlag=!0))}}e.Solve(t,this.m_gravity,this.m_allowSleep)}for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);o;o=o.GetNextNode())o.body.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(t){var e=this.island;e.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode()){var i=o.body;i.m_islandFlag=!1,i.m_sweep.t0=0}for(var n=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())n.contact.m_islandFlag=!1,n.contact.m_toi=null;for(o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(;;){var o=this._SolveTOI2(t),s=o.minContact,o=o.minTOI;if(null===s||Box2D.Dynamics.b2World.MAX_TOI<o)break;if(n=s.m_fixtureA.GetBody(),i=s.m_fixtureB.GetBody(),Box2D.Dynamics.b2World.s_backupA.Set(n.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(i.m_sweep),n.Advance(o),i.Advance(o),s.Update(this.m_contactManager.m_contactListener),s.m_toi=null,s.IsSensor()||!s.IsEnabled())n.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),i.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),n.SynchronizeTransform(),i.SynchronizeTransform();else if(s.IsTouching()){for(n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(n=i),e.Clear(),s=new goog.structs.Queue,s.enqueue(n),n.m_islandFlag=!0;0<s.size;)if(i=s.dequeue(),e.AddBody(i),i.IsAwake()||i.SetAwake(!0),i.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(n=i.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);n&&e.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;n=n.GetNextNode()){var a=n.contact;a.m_islandFlag||(e.AddContact(a),a.m_islandFlag=!0,a=a.GetOther(i),a.m_islandFlag||(a.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(a.Advance(o),a.SetAwake(!0),s.enqueue(a)),a.m_islandFlag=!0))}for(i=i.m_jointList;i;i=i.next)e.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!i.joint.m_islandFlag&&i.other.IsActive()&&(e.AddJoint(i.joint),i.joint.m_islandFlag=!0,i.other.m_islandFlag||(i.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(i.other.Advance(o),i.other.SetAwake(!0),s.enqueue(i.other)),i.other.m_islandFlag=!0))}for(this.islandTimeStep.Reset((1-o)*t.dt,0,t.velocityIterations,t.positionIterations,!1),e.SolveTOI(this.islandTimeStep),o=0;o<e.m_bodies.length;o++)if(e.m_bodies[o].m_islandFlag=!1,e.m_bodies[o].IsAwake()&&e.m_bodies[o].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody)for(e.m_bodies[o].SynchronizeFixtures(),n=e.m_bodies[o].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())n.contact.m_toi=null;for(o=0;o<e.m_contactCount;o++)e.m_contacts[o].m_islandFlag=!1,e.m_contacts[o].m_toi=null;for(o=0;o<e.m_jointCount;o++)e.m_joints[o].m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(t){for(var e=null,o=1,i=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);i;i=i.GetNextNode()){var n=i.contact;if(!this._SolveTOI2SkipContact(t,n)){var s=1;if(null!=n.m_toi)s=n.m_toi;else{if(n.IsTouching())s=1;else{var s=n.m_fixtureA.GetBody(),a=n.m_fixtureB.GetBody(),r=s.m_sweep.t0;s.m_sweep.t0<a.m_sweep.t0?(r=a.m_sweep.t0,s.m_sweep.Advance(r)):a.m_sweep.t0<s.m_sweep.t0&&(r=s.m_sweep.t0,a.m_sweep.Advance(r)),s=n.ComputeTOI(s.m_sweep,a.m_sweep),Box2D.Common.b2Settings.b2Assert(s>=0&&1>=s),s>0&&1>s&&(s=(1-s)*r+s)}n.m_toi=s}Number.MIN_VALUE<s&&o>s&&(e=n,o=s)}}return{minContact:e,minTOI:o}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(t,e){var o=e.m_fixtureA.GetBody(),i=e.m_fixtureB.GetBody();return o.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&o.IsAwake()||i.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&i.IsAwake()?!1:!0},Box2D.Dynamics.b2World.prototype.DrawJoint=function(t){if(t instanceof Box2D.Dynamics.Joints.b2DistanceJoint||t instanceof Box2D.Dynamics.Joints.b2MouseJoint){var e=t.GetAnchorA(),o=t.GetAnchorB();this.m_debugDraw.DrawSegment(e,o,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(o)}else if(t instanceof Box2D.Dynamics.Joints.b2PulleyJoint){var e=t.GetAnchorA(),o=t.GetAnchorB(),i=t.GetGroundAnchorA(),t=t.GetGroundAnchorB();this.m_debugDraw.DrawSegment(i,e,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(t,o,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(i,t,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(o),Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(t)}else e=t.GetAnchorA(),o=t.GetAnchorB(),t.GetBodyA()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(t.GetBodyA().m_xf.position,e,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(e,o,Box2D.Dynamics.b2World.s_jointColor),t.GetBodyB()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(t.GetBodyB().m_xf.position,o,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(o)},Box2D.Dynamics.b2World.prototype.DrawShape=function(t,e,o){if(t instanceof Box2D.Collision.Shapes.b2CircleShape){var i=Box2D.Common.Math.b2Math.MulX(e,t.m_p);this.m_debugDraw.DrawSolidCircle(i,t.m_radius,e.R.col1,o),Box2D.Common.Math.b2Vec2.Free(i)}else if(t instanceof Box2D.Collision.Shapes.b2PolygonShape){for(var i=0,n=t.GetVertexCount(),t=t.GetVertices(),s=[],i=0;n>i;i++)s[i]=Box2D.Common.Math.b2Math.MulX(e,t[i]);for(this.m_debugDraw.DrawSolidPolygon(s,n,o),i=0;n>i;i++)Box2D.Common.Math.b2Vec2.Free(s[i])}else t instanceof Box2D.Collision.Shapes.b2EdgeShape&&(i=Box2D.Common.Math.b2Math.MulX(e,t.GetVertex1()),e=Box2D.Common.Math.b2Math.MulX(e,t.GetVertex2()),this.m_debugDraw.DrawSegment(i,e,o),Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(e))},Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_jointColor=new Box2D.Common.b2Color(.5,.8,.8),Box2D.Dynamics.b2World.s_color_inactive=new Box2D.Common.b2Color(.5,.5,.3),Box2D.Dynamics.b2World.s_color_static=new Box2D.Common.b2Color(.3,.3,.3),Box2D.Dynamics.b2World.s_color_kinematic=new Box2D.Common.b2Color(.5,.5,.9),Box2D.Dynamics.b2World.s_color_dynamic_sleeping=new Box2D.Common.b2Color(.6,.6,.6),Box2D.Dynamics.b2World.s_color_dynamic_awake=new Box2D.Common.b2Color(.6,.9,.6),Box2D.Dynamics.b2World.s_pairColor=new Box2D.Common.b2Color(.3,.9,.9),Box2D.Dynamics.b2World.s_aabbColor=new Box2D.Common.b2Color(0,0,.8),Box2D.generateCallback=function(t,e){return function(){e.apply(t,arguments)}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},goog.inherits(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(t,e){this.T.col1.x=-t,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-e,this.maxTimestep=t>0||e>0?1/Math.max(t,e):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(t){if(t=t.dt,!(t<=Number.MIN_VALUE)){t>this.maxTimestep&&0<this.maxTimestep&&(t=this.maxTimestep);for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var o=e.body,i=o.GetLocalVector(o.GetLinearVelocity()),n=Box2D.Common.Math.b2Math.MulMV(this.T,i);Box2D.Common.Math.b2Vec2.Free(i),i=o.GetWorldVector(n),Box2D.Common.Math.b2Vec2.Free(n),n=Box2D.Common.Math.b2Vec2.Get(o.GetLinearVelocity().x+i.x*t,o.GetLinearVelocity().y+i.y*t),Box2D.Common.Math.b2Vec2.Free(i),o.SetLinearVelocity(n),Box2D.Common.Math.b2Vec2.Free(n)}}},Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(){for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);t;t=t.GetNextNode()){var e=t.body;e.ApplyForce(this.F,e.GetWorldCenter())}},Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(t,e,o,i,n,s,a){void 0===a&&(a=0),this.bodyA=t,this.bodyB=e,this.groundAnchorA.SetV(o),this.groundAnchorB.SetV(i),this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(s),t=n.x-o.x,o=n.y-o.y,this.lengthA=Math.sqrt(t*t+o*o),o=s.x-i.x,i=s.y-i.y,this.lengthB=Math.sqrt(o*o+i*i),this.ratio=a,a=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=a-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(a-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},define("playcraft/ext/box2dweb.2.1a-pc",function(){}),pc.Hashtable=gamecore.Hashtable,pc.Base=gamecore.Base("pc.Base",{},{}),pc.Pool=gamecore.Pool.extend("pc.Pool",{},{}),pc.Pooled=gamecore.Pooled.extend("pc.Pooled",{},{}),pc.LinkedList=gamecore.LinkedList.extend("pc.LinkedList",{},{}),pc.LinkedListNode=gamecore.LinkedListNode.extend("pc.LinkedListNode",{},{}),pc.HashList=gamecore.HashList.extend("pc.HashList",{},{}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable");var e=Array.prototype.slice.call(arguments,1),o=this,i=function(){},n=function(){return o.apply(this instanceof i?this:t||window,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,n.prototype=new i,n}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),o=e.length>>>0;if(0===o)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!=i?i=0:0!=i&&1/0!=i&&i!=-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=o)return-1;for(var n=i>=0?i:Math.max(o-Math.abs(i),0);o>n;n++)if(n in e&&e[n]===t)return n;return-1}),define("playcraft/boot",function(){}),pc.Input=pc.Base("pc.Input",{_eventPos:null,getEventPosition:function(t,e){null==this._eventPos&&(this._eventPos=pc.Point.create(0,0));var o=e;return pc.Tools.isValid(e)||(o=this._eventPos),t.pageX||t.pageY?(o.x=t.pageX,o.y=t.pageY):(o.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),pc.Tools.isValid(t.alpha)&&(o.x=t.alpha,o.y=t.gamma),o}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:!1,mouseRightButtonDown:!1,deviceOrientation:null,init:function(){this._super(),this.stateBindings=new pc.Hashtable,this.states=new pc.Hashtable,this.actionBindings=new pc.Hashtable,this.mousePos=pc.Point.create(0,0),this.deviceOrientation=pc.Point.create(0,0)},bindState:function(t,e,o,i){if(null==t.uniqueId)throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function";if(!pc.InputType.getCode(o))throw"Unknown input code "+o+" - see pc.InputType for a list of input names";o=o.toUpperCase();var n={stateName:e,object:t,input:o,state:{on:!1,event:null},uiTarget:i},s=this.stateBindings.get(o);null==s?this.stateBindings.put(o,[n]):s.push(n),this.states.put(t.uniqueId+"\\\\"+e,{on:!1,event:null}),pc.InputType.isPositional(pc.InputType.getCode(o))&&this._positionals.push(n)},clearStates:function(t){for(var e=this.stateBindings.entries(),o=0;o<e.length;o++)for(var i=e[o],n=0;n<i.length;n++){var s=i[n];if(s.object==t){var a=this.states.get(next.object.uniqueId+"\\\\"+next.stateName);a.on=!1,a.event=null,pc.InputType.isPositional(s.input)&&pc.tools.arrayRemove(this._positionals,s)}}},isInputState:function(t,e){var o=this.states.get(t.uniqueId+"\\\\"+e);if(null==o)throw"Ooops, unknown state "+e;return o.on},getInputState:function(t,e){return this.states.get(t.uniqueId+"\\\\"+e)},bindAction:function(t,e,o,i){o=o.toUpperCase();var n=this.actionBindings.get(o);null==n?this.actionBindings.put(o,[{actionName:e,object:t,input:o,uiTarget:i}]):n.push({actionName:e,input:o,object:t,uiTarget:i})},fireAction:function(t,e){var o=this.actionBindings.get(pc.InputType.getName(t));if(null==o)return!1;for(var i=0;i<o.length;i++){var n=o[i],s=o[i].object;if(!s.isActive||s.isActive())if(pc.InputType.isPositional(t)){var a=this.Class.getEventPosition(e);if(pc.InputType.isDeviceOrientation(t))return s.onAction(n.actionName,e,a,n.uiTarget),!0;var r=null;if(r=pc.valid(n.uiTarget)?n.uiTarget.getScreenRect():s.getScreenRect?s.getScreenRect():null,r&&r.containsPoint(a)){var c=s.onAction(n.actionName,e,a,n.uiTarget);if(pc.valid(c)&&!c)break}}else{var l=s.onAction(n.actionName);if(pc.valid(l)&&!l)break}}return!0},_onReady:function(){pc.device.canvas.addEventListener("touchstart",this._touchStart.bind(this),!0),pc.device.canvas.addEventListener("touchend",this._touchEnd.bind(this),!0),pc.device.canvas.addEventListener("touchmove",this._touchMove.bind(this),!0),pc.device.canvas.addEventListener("mouseup",this._mouseUp.bind(this),!0),pc.device.canvas.addEventListener("mousedown",this._mouseDown.bind(this),!0),pc.device.canvas.addEventListener("mousemove",this._mouseMove.bind(this),!0),pc.device.canvas.addEventListener("mousewheel",this._mouseWheel.bind(this),!0),pc.device.canvas.addEventListener("contextmenu",this._contextMenu.bind(this),!0),window.addEventListener("keydown",this._keyDown.bind(this),!0),window.addEventListener("keyup",this._keyUp.bind(this),!0),window.addEventListener("deviceorientation",this._deviceOrientation.bind(this),!0)},_positionals:[],_checkPositional:function(t){for(var e=0;e<this._positionals.length;e++){var o=this._positionals[e];if(!("mousemove"==t.type&&pc.InputType.isTouch(pc.InputType.getCode(o.input))||"touchmove"==t.type&&!pc.InputType.isTouch(pc.InputType.getCode(o.input))||pc.InputType.getCode(o.input)==pc.InputType.MOUSE_BUTTON_LEFT_UP||pc.InputType.getCode(o.input)==pc.InputType.MOUSE_BUTTON_LEFT_DOWN||pc.InputType.getCode(o.input)==pc.InputType.MOUSE_BUTTON_RIGHT_UP||pc.InputType.getCode(o.input)==pc.InputType.MOUSE_BUTTON_RIGHT_DOWN)){var i=null;if(i=pc.valid(o.uiTarget)?o.uiTarget.getScreenRect():o.object.getScreenRect?o.object.getScreenRect():null)if(i.containsPoint(this.Class.getEventPosition(t))){var n=this.states.get(o.object.uniqueId+"\\\\"+o.stateName);n.on=!0,n.event=t}else{var s=this.states.get(o.object.uniqueId+"\\\\"+o.stateName);s.on=!1,s.event=t}}}},_changeState:function(t,e,o){var i=pc.InputType.getName(t);if(null==i)return this.log("Unknown keycode = "+t),!1;var n=this.stateBindings.get(i);if(null==n)return!1;for(var s=0;s<n.length;s++){var a=n[s];if(!a.object.isActive||a.object.isActive())if(pc.InputType.isPositional(t)){var r=this.Class.getEventPosition(o),c=null;if(c=pc.valid(a.uiTarget)?a.uiTarget.getScreenRect():a.object.getScreenRect?a.object.getScreenRect():null){if(c.containsPoint(r)){var l=this.states.get(a.object.uniqueId+"\\\\"+a.stateName);l.on=e,l.event=o}}else l=this.states.get(a.object.uniqueId+"\\\\"+a.stateName),l.on=e,l.event=o}else l=this.states.get(a.object.uniqueId+"\\\\"+a.stateName),l.on=e,l.event=o}return!0},_lastMouseMove:null,_lastDeviceOrientation:null,process:function(){this._lastMouseMove&&(this._checkPositional(this._lastMouseMove),this.fireAction(pc.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null),this._lastDeviceOrientation&&(this._changeState(pc.InputType.DEVICE_ORIENTATION,!0,this._lastDeviceOrientation),this.fireAction(pc.InputType.DEVICE_ORIENTATION,this._lastDeviceOrientation),this.Class.getEventPosition(this._lastDeviceOrientation,this.deviceOrientation),this._lastDeviceOrientation=null)},_keyDown:function(t){this._changeState(t.keyCode,!0,t)&&t.preventDefault(),this.fireAction(t.keyCode,t)&&t.preventDefault()},_keyUp:function(t){this._changeState(t.keyCode,!1,t)&&t.preventDefault()},_deviceOrientation:function(t){this._lastDeviceOrientation=t,t.preventDefault()},_touchStart:function(t){for(var e=0,o=t.touches.length;o>e;e++)this._changeState(pc.InputType.TOUCH,!0,t.touches[e]),this.fireAction(pc.InputType.TOUCH,t.touches[e]);t.preventDefault()},_touchEnd:function(t){for(var e=0,o=t.changedTouches.length;o>e;e++)this._checkPositional(t.touches[e]),this._changeState(pc.InputType.TOUCH_END,!1,t.changedTouches[e]),this.fireAction(pc.InputType.TOUCH_END,t.changedTouches[e]);t.preventDefault()},_touchMove:function(t){for(var e=0,o=t.touches.length;o>e;e++)this._checkPositional(t.touches[e]),this._changeState(pc.InputType.TOUCH_MOVE,!1,t.changedTouches[e]),this.fireAction(pc.InputType.TOUCH_MOVE,t.touches[e]);t.preventDefault()},_mouseUp:function(t){0==t.button||1==t.button?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!1,t),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!0,t),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_UP,t),this.mouseLeftButtonDown=!1):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!1,t),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,t),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,t),this.mouseRightButtonDown=!1),t.preventDefault()},_mouseDown:function(t){0==t.button||1==t.button?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!0,t),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!1,t),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,t),this.mouseLeftButtonDown=!0):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!0,t),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!1,t),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,t),this.mouseRightButtonDown=!0),t.preventDefault()},_mouseMove:function(t){this._lastMouseMove=t,t.preventDefault()},_contextMenu:function(t){this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,t),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,t)},_mouseWheel:function(t){t.wheel>0?this.fireAction(pc.InputType.MOUSE_WHEEL_UP,t):this.fireAction(pc.InputType.MOUSE_WHEEL_DOWN,t),t.preventDefault()}}),pc.InputType=pc.Base.extend("pc.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1e3,MOUSE_MOVE:1100,MOUSE_BUTTON_LEFT_UP:1110,MOUSE_BUTTON_LEFT_DOWN:1111,MOUSE_BUTTON_RIGHT_UP:1120,MOUSE_BUTTON_RIGHT_DOWN:1121,MOUSE_WHEEL_UP:1130,MOUSE_WHEEL_DOWN:1131,TOUCH:1e3,TOUCH_MOVE:1001,TOUCH_END:1002,DEVICE_ORIENTATION:1020,init:function(){this.nameToCode=new pc.Hashtable,this.codeToName=new pc.Hashtable,this.addInput(8,"BACKSPACE"),this.addInput(9,"TAB"),this.addInput(13,"ENTER"),this.addInput(16,"SHIFT"),this.addInput(17,"CTRL"),this.addInput(18,"ALT"),this.addInput(19,"PAUSE"),this.addInput(20,"CAPS"),this.addInput(27,"ESC"),this.addInput(32,"SPACE"),this.addInput(33,"PAGE_UP"),this.addInput(34,"PAGE_DOWN"),this.addInput(35,"END"),this.addInput(36,"HOME"),this.addInput(37,"LEFT"),this.addInput(38,"UP"),this.addInput(39,"RIGHT"),this.addInput(40,"DOWN"),this.addInput(45,"INSERT"),this.addInput(46,"DELETE");for(var t=48;91>t;t++){var e=String.fromCharCode(t);this.addInput(t,e)}this.addInput(91,"WINDOW_LEFT"),this.addInput(92,"WINDOW_RIGHT"),this.addInput(93,"SELECT"),this.addInput(96,"NUM_0"),this.addInput(97,"NUM_1"),this.addInput(98,"NUM_2"),this.addInput(99,"NUM_3"),this.addInput(100,"NUM_4"),this.addInput(101,"NUM_5"),this.addInput(102,"NUM_6"),this.addInput(103,"NUM_7"),this.addInput(104,"NUM_8"),this.addInput(105,"NUM_9"),this.addInput(106,"*"),this.addInput(107,"+"),this.addInput(109,"-"),this.addInput(110,"."),this.addInput(111,"/"),this.addInput(112,"F1"),this.addInput(113,"F2"),this.addInput(114,"F3"),this.addInput(115,"F4"),this.addInput(116,"F5"),this.addInput(117,"F6"),this.addInput(118,"F7"),this.addInput(119,"F8"),this.addInput(120,"F9"),this.addInput(121,"F10"),this.addInput(122,"F11"),this.addInput(123,"F12"),this.addInput(144,"NUM_LOCK"),this.addInput(145,"SCROLL_LOCK"),this.addInput(186,";"),this.addInput(187,"="),this.addInput(188,","),this.addInput(189,"-"),this.addInput(190,"."),this.addInput(191,"/"),this.addInput(192,"`"),this.addInput(219,"["),this.addInput(220,"\\"),this.addInput(221,"]"),this.addInput(222,"'"),this.addInput(this.DEVICE_ORIENTATION,"DEVICE_ORIENTATION"),this.addInput(this.TOUCH,"TOUCH"),this.addInput(this.TOUCH_MOVE,"TOUCH_MOVE"),this.addInput(this.TOUCH_END,"TOUCH_END"),this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN"),this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP"),this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN"),this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP"),this.nameToCode.put("MOUSE_LEFT_BUTTON",this.MOUSE_BUTTON_LEFT_UP),this.nameToCode.put("MOUSE_RIGHT_BUTTON",this.MOUSE_BUTTON_RIGHT_UP),this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP"),this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN"),this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE")},isDeviceOrientation:function(t){return t==this.DEVICE_ORIENTATION},isTouch:function(t){return t==this.TOUCH},isPositional:function(t){return t>=this.POSITIONAL_EVENT_START},addInput:function(t,e){this.codeToName.put(t,e),this.nameToCode.put(e,t)},getName:function(t){return this.codeToName.get(t)},getCode:function(t){return this.nameToCode.get(t)}},{}),define("playcraft/input",function(){}),pc.Hashmap=pc.Base.extend("pc.Hashmap",{},{init:function(){this._super(),this.items={}},length:0,items:{},put:function(t,e){if(!pc.valid(t))throw"invaid key";this.items[t]=e,this.length++},get:function(t){return this.items[t]},hasKey:function(t){return this.items.hasOwnProperty(t)},remove:function(t){this.hasKey(t)&&(this.length--,delete this.items[t])},keys:function(){var t=[];for(var e in this.items)t.push(e);return t},values:function(){var t=[];for(var e in this.items)t.push(this.items[e]);return t},clear:function(){this.items={},this.length=0}}),define("playcraft/hashmap",function(){}),pc.Tools=pc.Base.extend("pc.Tools",{checked:function(t,e){return pc.valid(t)?t:e},isValid:function(t){return!(null==t||"undefined"==typeof t)},assert:function(t,e){if(!t)throw e},arrayRemove:function(t,e){for(var o=t.length-1;o>=0;o--)t[o]==e&&t.splice(o,1)},arrayExclusiveAdd:function(t,e){-1==t.indexOf(e)&&t.push(e)},xmlToJson:function(t,e){var o={toObj:function(t){var e={};if(1==t.nodeType){if(t.attributes.length)for(var i=0;i<t.attributes.length;i++)e[t.attributes[i].nodeName]=(t.attributes[i].nodeValue||"").toString();if(t.firstChild){for(var n=0,s=0,a=!1,r=t.firstChild;r;r=r.nextSibling)1==r.nodeType?a=!0:3==r.nodeType&&r.nodeValue.match(/[^ \f\n\r\t\v]/)?n++:4==r.nodeType&&s++;if(a)if(2>n&&2>s){o.removeWhite(t);for(var r=t.firstChild;r;r=r.nextSibling)3==r.nodeType?e["#text"]=o.escape(r.nodeValue):4==r.nodeType?e["#cdata"]=o.escape(r.nodeValue):e[r.nodeName]?e[r.nodeName]instanceof Array?e[r.nodeName][e[r.nodeName].length]=o.toObj(r):e[r.nodeName]=[e[r.nodeName],o.toObj(r)]:e[r.nodeName]=o.toObj(r)}else t.attributes.length?e["#text"]=o.escape(o.innerXml(t)):e=o.escape(o.innerXml(t));else if(n)t.attributes.length?e["#text"]=o.escape(o.innerXml(t)):e=o.escape(o.innerXml(t));else if(s)if(s>1)e=o.escape(o.innerXml(t));else for(var r=t.firstChild;r;r=r.nextSibling)e["#cdata"]=o.escape(r.nodeValue)}t.attributes.length||t.firstChild||(e=null)}else 9==t.nodeType?e=o.toObj(t.documentElement):alert("unhandled node type: "+t.nodeType);return e},toJson:function(t,e,i){var n=e?'"'+e+'"':"";if(t instanceof Array){for(var s=0,a=t.length;a>s;s++)t[s]=o.toJson(t[s],"",i+"	");n+=(e?":[":"[")+(t.length>1?"\n"+i+"	"+t.join(",\n"+i+"	")+"\n"+i:t.join(""))+"]"}else if(null==t)n+=(e&&":")+"null";else if("object"==typeof t){var r=[];for(var c in t)r[r.length]=o.toJson(t[c],c,i+"	");n+=(e?":{":"{")+(r.length>1?"\n"+i+"	"+r.join(",\n"+i+"	")+"\n"+i:r.join(""))+"}"}else n+="string"==typeof t?(e&&":")+'"'+t.toString()+'"':(e&&":")+t.toString();return n},innerXml:function(t){var e="";if("innerHTML"in t)e=t.innerHTML;else for(var o=function(t){var e="";if(1==t.nodeType){e+="<"+t.nodeName;for(var i=0;i<t.attributes.length;i++)e+=" "+t.attributes[i].nodeName+'="'+(t.attributes[i].nodeValue||"").toString()+'"';if(t.firstChild){e+=">";for(var n=t.firstChild;n;n=n.nextSibling)e+=o(n);e+="</"+t.nodeName+">"}else e+="/>"}else 3==t.nodeType?e+=t.nodeValue:4==t.nodeType&&(e+="<![CDATA["+t.nodeValue+"]]>");return e},i=t.firstChild;i;i=i.nextSibling)e+=o(i);return e},escape:function(t){return t.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(t){t.normalize();for(var e=t.firstChild;e;)if(3==e.nodeType)if(e.nodeValue.match(/[^ \f\n\r\t\v]/))e=e.nextSibling;else{var i=e.nextSibling;t.removeChild(e),e=i}else 1==e.nodeType?(o.removeWhite(e),e=e.nextSibling):e=e.nextSibling;return t}};9==t.nodeType&&(t=t.documentElement);var i=o.toJson(o.toObj(o.removeWhite(t)),t.nodeName,"	");return"{\n"+e+(e?i.replace(/\t/g,e):i.replace(/\t|\n/g,""))+"\n}"}},{}),pc.tools=new pc.Tools,pc.valid=pc.Tools.isValid,pc.checked=pc.Tools.checked,pc.assert=pc.Tools.assert,pc.Base64=pc.Base.extend("pc.Base64",{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,o,i,n,s,a,r,c="",l=0;for(t=pc.Base64._utf8_encode(t);l<t.length;)e=t.charCodeAt(l++),o=t.charCodeAt(l++),i=t.charCodeAt(l++),n=e>>2,s=(3&e)<<4|o>>4,a=(15&o)<<2|i>>6,r=63&i,isNaN(o)?a=r=64:isNaN(i)&&(r=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(r);return c},decode:function(t){var e,o,i,n,s,a,r,c=[],l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)n=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),r=this._keyStr.indexOf(t.charAt(l++)),e=n<<2|s>>4,o=(15&s)<<4|a>>2,i=(3&a)<<6|r,c.push(String.fromCharCode(e)),64!=a&&c.push(String.fromCharCode(o)),64!=r&&c.push(String.fromCharCode(i));return c.join("")},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var i=t.charCodeAt(o);128>i?e+=String.fromCharCode(i):i>127&&2048>i?(e+=String.fromCharCode(192|i>>6),e+=String.fromCharCode(128|63&i)):(e+=String.fromCharCode(224|i>>12),e+=String.fromCharCode(128|63&i>>6),e+=String.fromCharCode(128|63&i))}return e},_utf8_decode:function(t){for(var e="",o=0,i=c1=c2=0;o<t.length;)i=t.charCodeAt(o),128>i?(e+=String.fromCharCode(i),o++):i>191&&224>i?(c2=t.charCodeAt(o+1),e+=String.fromCharCode((31&i)<<6|63&c2),o+=2):(c2=t.charCodeAt(o+1),c3=t.charCodeAt(o+2),e+=String.fromCharCode((15&i)<<12|(63&c2)<<6|63&c3),o+=3);
return e}},{}),window.btoa||(window.btoa=pc.Base64.encode),window.atob||(window.atob=pc.Base64.decode),define("playcraft/tools",function(){}),pc.Color=pc.Pooled.extend("pc.Color",{create:function(t){var e=this._super();return e.config(t),e}},{rgb:[],color:null,init:function(t){void 0!=t&&this.config(t)},config:function(t){if(Array.isArray(t))this.rgb=t;else{if("#"!==t.charAt(0))throw"Invalid color: use either array [r,g,b] or '#RRGGBB'";this.rgb[0]=parseInt(t.substring(1,3),16),this.rgb[1]=parseInt(t.substring(3,5),16),this.rgb[2]=parseInt(t.substring(5,7),16)}this._updateColorCache()},set:function(t){this.config(t)},setRed:function(t){this.rgb[0]=pc.Math.limit(t,0,255),this._updateColorCache()},addRed:function(t){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],t,0,255),this._updateColorCache()},subRed:function(t){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],-t,0,255),this._updateColorCache()},setGreen:function(t){this.rgb[1]=pc.Math.limit(t,0,255),this._updateColorCache()},addGreen:function(t){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],t,0,255),this._updateColorCache()},subGreen:function(t){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],-t,0,255),this._updateColorCache()},setBlue:function(t){this.rgb[2]=pc.Math.limit(t,0,255),this._updateColorCache()},addBlue:function(t){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],t,0,255),this._updateColorCache()},subBlue:function(t){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],-t,0,255),this._updateColorCache()},darken:function(t){this.subRed(t),this.subGreen(t),this.subBlue(t)},lighten:function(t){this.addRed(t),this.addGreen(t),this.addBlue(t)},_updateColorCache:function(){this.color="rgb("+this.rgb[0]+","+this.rgb[1]+","+this.rgb[2]+")"}}),define("playcraft/color",function(){}),pc.DebugPanel=pc.Base("pc.DebugPanel",{},{x:0,y:0,panelHeight:0,panelWidth:0,canvas:null,ctx:null,statusText:null,active:!1,timeGraph:null,memGraph:null,entityGraph:null,poolGraph:null,currentMem:0,lastMem:0,init:function(){this._super()},onReady:function(){this.attach("pcDebug")},attach:function(t){if(this.canvas=document.getElementById(t),null==this.canvas)return this.warn('Showing debug requires a div with an id of "debug" to be added to your dom.'),pc.device.showDebug=!1,void 0;this.panelElement=this.canvas.parentNode,this.ctx=this.canvas.getContext("2d"),this.onResize();var e=4;this.timeGraph=new pc.CanvasLineGraph(this.ctx,"Performance","",10,[{name:"process (ms)",color:"#f55"},{name:"render (ms)",color:"#5f5"}],10,10,this.panelWidth/e-10,this.panelHeight-20),this.memGraph="undefined"==typeof console.memory||0==console.memory.totalJSHeapSize?new pc.CanvasLineGraph(this.ctx,"Memory","Memory profiling not available",0,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/e+10,10,this.panelWidth/e-10,this.panelHeight-20):new pc.CanvasLineGraph(this.ctx,"Memory","",1.2*(console.memory.totalJSHeapSize/1024/1024),[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/e+10,10,this.panelWidth/e-10,this.panelHeight-20),this.poolGraph=new pc.CanvasLineGraph(this.ctx,"Pool Size","",100,[{name:"pooled",color:"#5b1654"}],this.panelWidth-2*(this.panelWidth/e)+10,10,this.panelWidth/e-20,this.panelHeight-20),this.entityGraph=new pc.CanvasLineGraph(this.ctx,"Entities","",100,[{name:"drawn (total)",color:"#f9f007"}],this.panelWidth-this.panelWidth/e+10,10,this.panelWidth/e-20,this.panelHeight-20),this.active=!0},onResize:function(){if(null!=this.canvas){this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight,this.panelWidth=this.panelElement.offsetWidth,this.panelHeight=this.panelElement.offsetHeight,this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.panelWidth,this.panelHeight);var t=4;null!=this.timeGraph&&this.timeGraph.resize(10,10,this.panelWidth/t-10,this.panelHeight-20),null!=this.memGraph&&this.memGraph.resize(this.panelWidth/t+10,10,this.panelWidth/t-10,this.panelHeight-20),null!=this.poolGraph&&this.poolGraph.resize(this.panelWidth-2*(this.panelWidth/t)+20,10,this.panelWidth/t-20,this.panelHeight-20),null!=this.entityGraph&&this.entityGraph.resize(this.panelWidth-this.panelWidth/t+10,10,this.panelWidth/t-20,this.panelHeight-20)}},_timeSince:0,update:function(t){this.active&&(this._timeSince+=t,this._timeSince>30&&(this._timeSince=0,null!=this.timeGraph&&this.timeGraph.addLine2(pc.device.lastProcessMS,pc.device.lastDrawMS),null!=this.entityGraph&&this.entityGraph.addLine1(pc.device.elementsDrawn),null!=this.memGraph&&"undefined"!=typeof console.memory&&0!=console.memory.totalJSHeapSize&&this.memGraph.addLine1(window.performance.memory.usedJSHeapSize/1024/1024),null!=this.poolGraph&&this.poolGraph.addLine1(gamecore.Pool.totalPooled)))},draw:function(){this.active&&(null!=this.timeGraph&&this.timeGraph.draw(),null!=this.entityGraph&&this.entityGraph.draw(),null!=this.memGraph&&this.memGraph.draw(),null!=this.poolGraph&&this.poolGraph.draw())}}),pc.CanvasLineGraph=pc.Base.extend("pc.CanvasLineGraph",{height:0,width:0,ctx:null,data:null,maxY:0,x:0,y:0,labels:null,graphName:null,bgCanvas:null,graphCanvas:null,message:null,cursor:0,init:function(t,e,o,i,n,s,a,r,c){this._super(),this.ctx=t,this.message=o,this.graphName=e,this.maxY=i,this.x=s,this.y=a,this.width=r,this.height=c,this.labels=n,this.graphX=this.x+this.graphLeftMargin,this.graphY=this.y+20,this.cursor=0,this.graphCanvas=document.createElement("canvas"),this.bgCanvas=document.createElement("canvas"),this.resize(s,a,r,c)},resize:function(t,e,o,i){this.width>o&&(this.data=this.data.slice(this.width-o,o)),this.width=o,this.height=i,this.x=t,this.y=e,this.graphHeight=this.height-40,this.graphWidth=this.width-(this.graphLeftMargin+this.graphRightMargin),this.graphX=this.graphLeftMargin,this.graphY=20,this.bgCanvas.width=this.width,this.bgCanvas.height=this.height,this.graphCanvas.width=Math.max(this.graphWidth,1),this.graphCanvas.height=Math.max(this.graphHeight,1),this.resizeDataArray(this.graphWidth,this.labels.length),this.renderBackground()},resizeDataArray:function(t,e){var o=0;if(!(0>=t)){if(null==this.data)this.data=[];else{if(!(t>this.data.length))return this.data.splice(0,t-this.data.length),this.cursor>this.data.length-1&&(this.cursor=this.data.length-1),void 0;o=this.data.length-1}for(var i=o;t>i;i++)this.data.push(new Array(e))}},_totalAdded:0,linesSinceLastPeak:0,lastPeak:0,_total:0,addLine2:function(t,e){this.data&&(this._totalAdded++,this._total=t+e,this.checkMaxRange(this._total),this.data[this.cursor][0]=t,this.data[this.cursor][1]=e,this._updateGraph(this._total))},addLine1:function(t){this.data&&(this._totalAdded++,this._total=t,this.checkMaxRange(this._total),this.data[this.cursor][0]=t,this._updateGraph(t))},checkMaxRange:function(t){t>this.maxY&&(this.maxY=1.4*t,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.renderBackground(),this.renderGraph(!0))},_updateGraph:function(t){this.linesSinceLastPeak++,this.linesSinceLastPeak>1.5*this.width&&(this.linesSinceLastPeak++,this.maxY=1.4*t,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.lastPeak=1.4*t,this.renderBackground(),this.linesSinceLastPeak=0),t>this.lastPeak&&(this.lastPeak=1.4*t),this.cursor++,this.cursor>this.data.length-1&&(this.cursor=0)},margin:20,linePixelSize:0,yline:0,unit:0,gridY:0,i:0,n:0,graphLeftMargin:30,graphRightMargin:15,graphHeight:0,graphWidth:0,graphX:0,graphY:0,gridLineInc:15,renderBackground:function(){var t=this.bgCanvas.getContext("2d");t.fillStyle="#000",t.fillRect(0,0,this.width,this.height),t.fillStyle="#aaa",t.font="11px sans-serif",t.fillText(this.graphName,this.graphX,this.graphY-6),t.strokeStyle="#111",t.strokeRect(this.graphX+.5,this.graphY+.5,this.graphWidth,this.graphHeight),this.unit=this.graphHeight/this.maxY;var e=(this.graphHeight+this.gridLineInc)/this.gridLineInc,o=this.maxY/e,i=0,n=0;for(this.gridY=this.graphHeight+this.graphY;this.gridY>this.graphY+1;this.gridY-=this.gridLineInc){n++,t.textAlign="right",t.fillStyle=0==n%2?"#111":"#000";var s=this.gridLineInc;this.gridY-s<this.graphY?(s=this.gridY-this.graphY,t.fillRect(this.graphX+1,this.graphY+1,this.graphWidth-2,s-1)):t.fillRect(this.graphX+1,this.gridY-s-1,this.graphWidth-2,s),i=Math.round(o*n),t.fillStyle="#777",t.fillText(""+i,this.graphX-5,this.gridY)}t.globalAlpha=1,t.textAlign="left";var a=this.height-13,r=this.graphLeftMargin+3;for(this.n=0;this.n<this.labels.length;this.n++)t.fillStyle=this.labels[this.n].color,t.fillRect(r,a,5,5),t.fillStyle="#888",t.fillText(this.labels[this.n].name,r+8,a+6),r+=t.measureText(this.labels[this.n].name).width+18;this.renderGraph(!0)},renderGraph:function(t){if(this.data){var e=this.graphCanvas.getContext("2d");t?(e.fillStyle="#000",e.fillRect(0,0,this.graphWidth,this.graphHeight)):this._totalAdded>this.graphWidth&&e.drawImage(this.graphCanvas,-1,0);var o=0;if(t?(o=this.data.length-1,this.dx=1):(this.dx=this._totalAdded<this.graphWidth?this.cursor:this.graphWidth-1,o=this.dx+1),0!=o){var i=this.cursor-1;for(0>i&&(i=this.data.length-1);this.dx<o;this.dx++){for(i>this.data.length-1&&(i=0),e.fillStyle="#000",e.fillRect(this.dx,0,1,this.graphHeight),this.yline=this.graphHeight,this.i=0;this.i<this.data[i].length;this.i++){this.linePixelSize=this.data[i][this.i]*this.unit,e.strokeStyle=this.labels[this.i].color,e.beginPath(),e.moveTo(this.dx,this.yline);var n=this.yline-this.linePixelSize;0>n&&(n=0),e.lineTo(this.dx,n),e.closePath(),e.stroke(),this.yline-=this.linePixelSize}i++}}}},draw:function(){this.ctx.save(),this.ctx.drawImage(this.bgCanvas,this.x,this.y),this.renderGraph(!1),this.ctx.globalAlpha=.4,this.ctx.drawImage(this.graphCanvas,this.x+this.graphX,this.y+this.graphY),this.message&&(this.ctx.font="13px sans-serif",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2-9)),this.ctx.restore()}}),define("playcraft/debug",function(){}),pc.Device=pc.Base.extend("pc.Device",{},{canvasId:null,canvas:null,canvasWidth:0,canvasHeight:0,loader:null,timer:null,ctx:null,started:!1,fps:0,currentFPS:0,tick:0,running:!0,scale:1,xmlParser:null,debugPanel:null,showDebug:!0,devMode:!0,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,screen:null,pixelRatio:1,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isTouch:!1,isiOS:!1,isiPod:!1,requestAnimFrame:null,input:null,gameClass:null,game:null,elapsed:0,lastFrame:0,now:Date.now(),boot:function(t,e){this.devMode&&this.info("Playcraft Engine v"+pc.VERSION+" starting"),this.canvasId=t,this.gameClass=e,this.fps=60,this.tick=1e3/this.fps,this.debugPanel=new pc.DebugPanel,this.input=new pc.Input,this.loader=new pc.Loader,this.isAppMobi="undefined"!=typeof AppMobi,this.pixelRatio=gamecore.Device.pixelRatio,this.isiPhone=gamecore.Device.isiPhone,this.isiPhone4=gamecore.Device.isiPhone4,this.isiPad=gamecore.Device.isiPad,this.isAndroid=gamecore.Device.isAndroid,this.isTouch=gamecore.Device.isTouch,this.isiOS=this.isiPhone||this.isiPad,this.device=gamecore.Device,this.requestAnimFrame=gamecore.Device.requestAnimFrame,this.requestAnimFrame=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60,Date.now())};return function(e,o){t.apply(window,[e,o])}}(),window.onresize=this.onResize.bind(this),this.onReady()},canPlay:function(t){return gamecore.Device.canPlay(t)},_calcScreenSize:function(){this.isAppMobi?(null!=this.screen&&this.screen.release(),this.screen=pc.Dim.create(document.body.offsetWidth,document.body.offsetHeight),this.canvas.width=this.screen.x,this.canvas.height=this.screen.y,this.canvas.innerWidth=this.screen.x,this.canvas.innerHeight=this.screen.y,this.canvasWidth=this.screen.x,this.canvasHeight=this.screen.y):(this.isiPad||this.isiPhone?(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight):this.panelElement&&(this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.screen=pc.Dim.create(this.canvasWidth,this.canvasHeight))},onReady:function(){if(this.isiOS&&(this.showDebug=!1,this.soundEnabled=!1),!this.started){if(this.game=eval("new "+this.gameClass+"()"),!this.game)throw"Invalid game class";if(this.canvas=document.getElementById(this.canvasId),!this.canvas)throw"Abort! Could not attach to a canvas element using the id ["+this.canvasId+"]. "+'Add a canvas element to your HTML, such as <canvas id="pcGameCanvas"></canvas>';this.input._onReady(),this.ctx=this.canvas.getContext("2d"),this.panelElement=this.canvas.parentNode,this.onResize(),this.showDebug&&this.debugPanel.onReady(),this.lastFrame=Date.now(),this.game.onReady(),this.requestAnimFrame(this.cycle.bind(this)),this.started=!0}},startTime:0,cycle:function(){this.running!==!1&&(this.now=Date.now(),this.elapsed=this.now-this.lastFrame,this.lastDrawMS=0,this.currentFPS=Math.round(1e3/this.elapsed),this.elementsDrawn=0,this.startTime=Date.now(),this.elapsed<200&&(this.running=this.game.process()),this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,pc.device.input.process(),this.showDebug&&(this.debugPanel.update(this.elapsed),this.debugPanel.draw(this.ctx)),this.lastFrame=this.now,this.requestAnimFrame(this.cycle.bind(this)))},resize:function(t,e){this.canvas.width=t,this.canvas.height=e,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize(this.canvasWidth,this.canvasHeight)},onResize:function(){if(null!=this.canvas){this._calcScreenSize();var t=!1;"undefined"!=typeof window.orientation&&0!=window.orientation&&(t=!0),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize()}},isOnScreen:function(t,e,o,i){return pc.Math.isRectColliding(t,e,o,i,0,0,this.canvasWidth,this.canvasHeight)},parseXML:function(t){if(window.DOMParser)return this.xmlParser||(this.xmlParser=new DOMParser),this.xmlParser.parseFromString(t,"text/xml");var e=new ActiveXObject("Microsoft.XMLDOM");return e.loadXML(t),e}}),pc.device=new pc.Device,define("playcraft/device",function(){}),pc.Sound=pc.Base.extend("pc.Sound",{},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(t,e,o,i,n,s){this._super(),this.name=t,this.channels=i;for(var a=!1,r=0;r<o.length;r++)if(pc.device.canPlay(o[r])){this.src=pc.device.loader.makeUrl(e+"."+o[r]),a=!0;break}a?pc.device.loader.started&&this.load(n,s):this.errored=!0},pause:function(){if(this.canPlay())for(var t=0,e=this.sounds.length;e>t;t++)this.sounds[t].pause()},stop:function(){this.canPlay()&&this.pause()},setVolume:function(t){if(this.canPlay())for(var e=0,o=this.sounds.length;o>e;e++)this.sounds[e].volume=t},getDuration:function(){return this.canPlay()?this.sounds[0].duration:-1},setPlaybackRate:function(t){if(this.canPlay())for(var e=0,o=this.sounds.length;o>e;e++)this.sounds[e].playbackRate=t},setPlayPosition:function(t){if(this.canPlay())for(var e=0,o=this.sounds.length;o>e;e++)this.sounds[e].currentTime=t},load:function(t,e){if(this.onLoadCallback=t,this.onErrorCallback=e,this.loaded&&t)return this.onLoadCallback(this),void 0;for(var o=0;o<this.channels;o++){var i=new Audio;i.preload="auto",i.addEventListener("canplaythrough",this.onLoad.bind(this),!1),i.addEventListener("error",this.onError.bind(this),!1),i.onerror=this.onError.bind(this),i.onload=this.onLoad.bind(this),i.src=this.src,i.load(),this.sounds.push(i),pc.device.isAppMobi&&this.onLoad(null)}},reload:function(){this.loaded=!1,this.errored=!1,this.load()},onLoad:function(t){this.numLoaded++,pc.device.isAppMobi||t.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1),this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback&&this.onLoadCallback(this))},onError:function(){this.errored=!0,this.loaded=!1,this.onErrorCallback&&this.onErrorCallback(this)},play:function(t){if(!this.canPlay())return null;for(var e=0,o=this.sounds.length;o>e;e++)if(this.sounds[e].paused||this.sounds[e].ended)return t&&(this.sounds[e].loop=!0),this.sounds[e].play(),this.sounds[e];return this.warn(this.name+" - all channels are in use"),null},canPlay:function(){return this.loaded&&pc.device.soundEnabled&&!this.errored}}),define("playcraft/sound",function(){}),pc.Layer=pc.Base.extend("pc.Layer",{},{name:null,paused:!1,active:!1,scene:null,zIndex:0,originTrack:null,originTrackXRatio:1,originTrackYRatio:1,origin:null,init:function(t,e){this._super(),this.name=t,this.origin=pc.Point.create(0,0),this._worldPos=pc.Point.create(0,0),this._screenPos=pc.Point.create(0,0),this.zIndex=pc.checked(e,0),this.originTrack=null,this.originTrackXRatio=0,this.originTrackYRatio=0},toString:function(){return""+this.name+" (origin: "+this.origin+", zIndex: "+this.zIndex+")"},release:function(){this.origin.release()},isActive:function(){return null==this.scene||this.scene.active?this.active:!1},setActive:function(){this.scene.setLayerActive(this)},setInactive:function(){this.scene.setLayerInactive(this)},setZIndex:function(t){this.zIndex=t,this.scene&&this.scene.sortLayers()},_worldPos:null,worldPos:function(t){return this._worldPos.x=t.x+this.origin.x,this._worldPos.y=t.y+this.origin.y,this._worldPos},screenX:function(t){return t+this.scene.viewPort.x-this.origin.x},screenY:function(t){return t+this.scene.viewPort.y-this.origin.y},getScreenRect:function(){return this.scene.getScreenRect()},draw:function(){},setOriginTrack:function(t,e,o){this.originTrack=t,this.originTrackXRatio=pc.checked(e,1),this.originTrackYRatio=pc.checked(o,1)},setOrigin:function(t,e){return this.origin.x==Math.round(t)&&this.origin.y==Math.round(e)?!1:(this.origin.x=Math.round(t),this.origin.y=Math.round(e),!0)},process:function(){this.originTrack&&this.setOrigin(this.originTrack.origin.x*this.originTrackXRatio,this.originTrack.origin.y*this.originTrackYRatio)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onResize:function(){},onAddedToScene:function(){},onRemovedFromScene:function(){},onAction:function(){}}),define("playcraft/layer",function(){}),pc.EntityLayer=pc.Layer.extend("pc.EntityLayer",{loadFromTMX:function(t,e,o){var i=e.getAttribute("name"),n=new pc.EntityLayer(i);t.addLayer(n);for(var s=e.getElementsByTagName("object"),a=0;a<s.length;a++){var r=s[a],c=null,l=parseInt(r.getAttribute("x")),h=parseInt(r.getAttribute("y")),m=parseInt(r.getAttribute("width")),u=parseInt(r.getAttribute("height")),p=null,y=r.getElementsByTagName("polygon");if(y.length>0){for(var d=y[0].getAttribute("points"),f=[],x=d.split(" "),_=0;_<x.length;_++){var g=x[_].split(",");f.push([parseInt(g[0]),parseInt(g[1])])}p=pc.Poly.create(l,h,f)}else p=pc.Dim.create(m,u);var b={},D=r.getElementsByTagName("properties");if(D.length)for(var C=D[0].getElementsByTagName("property"),B=0;B<C.length;B++){var v=C[B].getAttribute("name"),S=C[B].getAttribute("value");b[v]=S,"entity"===v&&(c=S)}c?o.createEntity(n,c,l,h,0,p,b):this.warn('Entity loaded from map with no "entity" type property set. x='+l+" y="+h)}}},{worldSize:null,entityManager:null,systemManager:null,init:function(t,e,o,i){this._super(t),this.entityFactory=i,this.systemManager=new pc.SystemManager(this),this.entityManager=new pc.EntityManager(this),this.worldSize=pc.Dim.create(pc.checked(e,1e4),pc.checked(o,1e4))},setOrigin:function(t,e){var o=this._super(t,e);return o&&this.systemManager.onOriginChange(t,e),o},getEntityManager:function(){return this.entityManager},getSystemManager:function(){return this.systemManager},addSystem:function(t){this.systemManager.add(t,this.entityManager)},getSystemsByComponentType:function(t){return this.systemManager.getByComponentType(t)},removeSystem:function(t){this.systemManager.remove(t)},process:function(){this._super(),this.systemManager.processAll(),this.entityManager.cleanup()},onResize:function(t,e){this.systemManager.onResize(t,e)}}),define("playcraft/entitylayer",function(){}),pc.TileSet=pc.Base.extend("pc.TileSet",{},{tileSpriteSheet:null,props:null,init:function(t){this.tileSpriteSheet=t,this.props=new Array(t.totalFrames);for(var e=0;e<this.props.length;e++)this.props[e]=new pc.Hashmap},drawTile:function(t,e,o,i){this.tileSpriteSheet.drawFrame(t,e%this.tileSpriteSheet.framesWide,pc.Math.floor(e/this.tileSpriteSheet.framesWide),o,i)},addProperty:function(t,e,o){this.props[t].put(e,o)},hasProperty:function(t,e){return this.props[t].hasKey(e)},getProperties:function(t){return this.props[t]}}),define("playcraft/tileset",function(){}),pc.TileMap=pc.Base.extend("pc.TileMap",{EMPTY_TILE:-1},{tiles:null,tilesWide:0,tilesHigh:0,tileWidth:0,tileHeight:0,tileSet:null,init:function(t,e,o,i,n,s){this.tiles=s,this.tileWidth=pc.Math.round(i),this.tileHeight=pc.Math.round(n),this.tilesWide=pc.Math.round(e),this.tilesHigh=pc.Math.round(o),this.tileSet=t},tileHasProperty:function(t,e,o){var i=this.getTile(t,e);return i>=0?this.tileSet.hasProperty(i,o):!1},generate:function(t){this.tiles=new Array(this.tilesHigh);for(var e=pc.checked(t,this.Class.EMPTY_TILE),o=0;o<this.tilesHigh;o++){this.tiles[o]=new Array(this.tilesWide);for(var i=0;i<this.tilesWide;i++)this.tiles[o][i]=e}},paint:function(t,e,o,i,n){for(var s=e;e+i>s;s++)for(var a=t;t+o>a;a++)this.tiles[s][a]=n},isOnMap:function(t,e){return t>=0&&t<this.tilesWide&&e>=0&&e<this.tilesHigh},clear:function(t,e,o,i){this.paint(t,e,o,i,this.Class.EMPTY_TILE)},setTile:function(t,e,o){this.tiles[e][t]=o},getTile:function(t,e){return this.isOnMap(t,e)?this.tiles[e][t]:-1},loadFromTMX:function(t,e,o){this.tileWidth=e,this.tileHeight=o,this.tilesWide=parseInt(t.getAttribute("width")),this.tilesHigh=parseInt(t.getAttribute("height"));var i=t.getElementsByTagName("data")[0];if(i.getAttribute("compression"))return this.error("map: "+name+": TMX map compression not supported, use base64 encoding"),void 0;if("base64"==i.getAttribute("encoding")){for(var n="",s=0;s<i.childNodes.length;s++)n+=i.childNodes[s].nodeValue;n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var a=pc.Base64.decode(n),r=[],c=0;c<a.length/4;c++){r[c]=0;for(var l=3;l>=0;--l)r[c]+=a.charCodeAt(4*c+l)<<(l<<3)}}this.tiles=new Array(this.tilesHigh);for(var h=0;h<this.tilesHigh;h++){this.tiles[h]=new Array(this.tilesWide);for(var m=0;m<this.tilesWide;m++)this.tiles[h][m]=r[h*this.tilesWide+m]-1}}}),define("playcraft/tilemap",function(){}),pc.TileLayer=pc.Layer.extend("pc.TileLayer",{loadFromTMX:function(t,e,o,i,n){var s=e.getAttribute("name"),a=new pc.TileLayer(s,!0,null,n);a.tileMap.loadFromTMX(e,o,i),t.addLayer(a)}},{tileMap:null,debugShowGrid:!1,prerenders:null,usePrerendering:!0,prerenderSize:512,init:function(t,e,o,i){this._super(t),this.tileMap=pc.checked(o,new pc.TileMap(i)),this.usePrerendering=pc.checked(e,!0),this.tileMap&&this.tileMap.tileWidth>256&&(this.usePrerendering=!1)},setTileMap:function(t){this.tileMap=t,this.usePrerendering&&this.prerender()},prerender:function(){var t=this.tileMap.tilesWide*this.tileMap.tileWidth,e=this.tileMap.tilesHigh*this.tileMap.tileHeight,o=Math.ceil(t/this.prerenderSize),i=Math.ceil(e/this.prerenderSize);this.prerenders=[];for(var n=0;i>n;n++){this.prerenders[n]=[];for(var s=0;o>s;s++){var a=f==o-1?t-f*this.prerenderSize:this.prerenderSize,r=x==i-1?e-x*this.prerenderSize:this.prerenderSize,c=a/this.tileMap.tileWidth+1,l=r/this.tileMap.tileHeight+1,h=s*this.prerenderSize%this.tileMap.tileWidth,m=n*this.prerenderSize%this.tileMap.tileHeight,u=Math.floor(s*this.prerenderSize/this.tileMap.tileWidth),p=Math.floor(n*this.prerenderSize/this.tileMap.tileHeight),y=document.createElement("canvas");y.width=a,y.height=r;for(var d=y.getContext("2d"),f=0;c>f;f++)for(var x=0;l>x;x++)if(f+u<this.tileMap.tilesWide&&x+p<this.tileMap.tilesHigh){var _=this.tileMap.getTile(f+u,x+p);_>=0&&this.tileMap.tileSet.drawTile(d,_,f*this.tileMap.tileWidth-h,x*this.tileMap.tileHeight-m)}this.prerenders[n][s]=y}}},draw:function(){this._super(),this.tileMap&&this.tileMap.tilesWide&&(this.usePrerendering?this.drawPrerendered():this.drawTiled())},drawTiled:function(){var t=Math.floor(this.origin.x/this.tileMap.tileWidth);0>t&&(t=0);var e=Math.floor(this.origin.y/this.tileMap.tileHeight);0>e&&(e=0);var o=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-t+2;t+o>=this.tileMap.tilesWide-1&&(o=this.tileMap.tilesWide-1-t);var i=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-e+2;e+i>=this.tileMap.tilesHigh-1&&(i=this.tileMap.tilesHigh-1-e);for(var n=e,s=e+i;s+1>n;n++)for(var a=this.screenY(n*this.tileMap.tileHeight),r=t,c=t+o;c>r;r++){var l=this.tileMap.tiles[n][r];l>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,l,this.screenX(r*this.tileMap.tileWidth),a),this.debugShowGrid&&(pc.device.ctx.save(),pc.device.ctx.strokeStyle="#222222",pc.device.ctx.strokeRect(this.screenX(r*this.tileMap.tileWidth),this.screenY(n*this.tileMap.tileHeight),this.tileMap.tileWidth,this.tileMap.tileHeight),pc.device.ctx.restore())}},drawPrerendered:function(){this.prerenders||this.prerender();var t=-this.origin.x+this.scene.viewPort.x,e=-this.origin.y+this.scene.viewPort.y,o=Math.max(Math.floor(this.origin.x/this.prerenderSize),0),i=Math.max(Math.floor(this.origin.y/this.prerenderSize),0),n=o+Math.ceil((this.origin.x+this.scene.viewPort.w)/this.prerenderSize),s=i+Math.ceil((this.origin.y+this.scene.viewPort.h)/this.prerenderSize);n=Math.min(n,this.prerenders[0].length),s=Math.min(s,this.prerenders.length);for(var a=i;s>a;a++)for(var r=o;n>r;r++)pc.device.ctx.drawImage(this.prerenders[a%this.prerenders.length][r%this.prerenders[0].length],t+r*this.prerenderSize,e+a*this.prerenderSize)}}),define("playcraft/tilelayer",function(){}),pc.HexTileLayer=pc.TileLayer.extend("pc.HexTileLayer",{},{init:function(t,e,o){this._super(t),this.tileMap=pc.checked(e,new pc.TileMap(o)),this.usePrerendering=!1},drawTiled:function(){var t=Math.floor(this.origin.x/this.tileMap.tileWidth);0>t&&(t=0);var e=Math.floor(this.origin.y/this.tileMap.tileHeight);0>e&&(e=0);var o=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-t;t+o>=this.tileMap.tilesWide-1&&(o=this.tileMap.tilesWide-1-t);var i=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-e;e+i>=this.tileMap.tilesHigh-1&&(i=this.tileMap.tilesHigh-1-e);for(var n=e,s=i+e;s+1>n;n++)for(var a=n*this.tileMap.tileHeight,r=t,c=o+t;c>r;r++){var l=r*this.tileMap.tileWidth;n%2&&(l+=this.tileMap.tileWidth/2);var h=this.tileMap.tiles[n][r];h>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,h,this.screenX(l),this.screenY(a))}}}),define("playcraft/hextilelayer",function(){}),pc.Entity=pc.Pooled.extend("pc.Entity",{create:function(t){var e=this._super();if(!t)throw"Entity requires a valid layer to be placed on";if(!t.Class.isA)throw"Entity requires a valid layer to be placed on";if(!t.Class.isA("pc.EntityLayer"))throw"Entities can only be placed on pc.EntityLayer objects";return e.config(t),e}},{layer:null,tags:[],active:!0,_componentCache:null,init:function(t){this._super(),this.tags=[],this.layer=null,this.active=!0,this._componentCache=new pc.Hashmap,pc.valid(t)&&this.config(t)},config:function(t){this.layer=t,this.active=!0,t.entityManager.add(this)},release:function(){this.tags.length=0,this.active=!1,this._componentCache.clear(),this._super()},addTag:function(t){this.layer.entityManager.addTag(this,t)},hasTag:function(t){for(var e=0;e<this.tags.length;e++)if(this.tags[e].toLowerCase()===t.toLowerCase())return!0;return!1},removeTag:function(t){this.layer.entityManager.removeTag(this,t)},addComponent:function(t){return this.layer.entityManager.addComponent(this,t)},removeComponent:function(t){this.layer.entityManager.removeComponent(this,t)},removeComponentByType:function(t){this.removeComponent(this._componentCache.get(t))},getComponent:function(t){return this._componentCache.get(t)},getAllComponents:function(){return this._componentCache},getComponentTypes:function(){return this._componentCache.keys()},hasComponentOfType:function(t){return this._componentCache.hasKey(t)},remove:function(){this.layer.entityManager.remove(this)},_handleComponentRemoved:function(t){this._componentCache.remove(t.getType())},_handleComponentAdded:function(t){this._componentCache.put(t.getType(),t)}}),pc.EntityFactory=pc.Base.extend("pc.EntityFactory",{},{createEntity:function(){}}),define("playcraft/entity",function(){}),pc.Sprite=pc.Pooled.extend("pc.Sprite",{create:function(t){var e=this._super();return e.config(t),e}},{currentFrame:0,currentAnim:null,spriteSheet:null,animSpeedOffset:0,currentAnimName:null,alpha:1,scaleX:1,scaleY:1,active:!0,hold:!1,loopCount:0,compositeOperation:null,_acDelta:0,init:function(t){this._super(),this.config(t)},config:function(t){this.spriteSheet=pc.checked(t,null),this.spriteSheet&&this.reset()},reset:function(){this.currentFrame=0,this.alpha=1,this.loopCount=0,this.scaleX=1,this.scaleY=1,this.active=!0,this.hold=!1,this.spriteSheet.animations.size()>0?(this.currentAnim=this.spriteSheet.animations.get(this.spriteSheet.animations.keys()[0]),this.currentFrame=0):this.currentAnim=null},setSpriteSheet:function(t){this.spriteSheet=t,this.reset()},setScale:function(t,e){this.scaleX=t,this.scaleY=e},setCompositeOperation:function(t){this.compositeOperation=t},draw:function(t,e,o,i){1!=this.alpha&&(this.spriteSheet.alpha=this.alpha),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation(this.compositeOperation),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.spriteSheet.draw(t,this,e,o,i),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(1,1),1!=this.alpha&&(this.spriteSheet.alpha=1),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation("source-over")},drawFrame:function(t,e,o,i,n,s){1!=this.alpha&&(this.spriteSheet.alpha=this.alpha),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation(this.compositeOperation),this.spriteSheet.drawFrame(t,e,o,i,n,s),(1!=this.scaleX||1!=this.scaleY)&&this.spriteSheet.setScale(1,1),1!=this.alpha&&(this.spriteSheet.alpha=1),null!=this.compositeOperation&&this.spriteSheet.setCompositeOperation("source-over")},update:function(t){null!=this.currentAnim&&this.active&&!this.hold&&this.spriteSheet.update(this,t)},setAnimation:function(t,e,o){var i=pc.checked(o,!0);(i||this.currentAnim.name!==t)&&(this.currentAnim=this.spriteSheet.animations.get(t),this.currentFrame=0,this.loopCount=0,this.active=!0,this.held=!1,this.animSpeedOffset=pc.checked(e,0),this.currentAnimName=t)},setAnimationSpeedOffset:function(t){this.animSpeedOffset=t},setCurrentFrame:function(t){this.currentFrame=t},getAnimation:function(){return this.currentAnimName},setAlpha:function(t){this.alpha=t},addAlpha:function(t){this.alpha+=t,this.alpha>1&&(this.alpha=1)},subAlpha:function(t){this.alpha-=t,this.alpha<0&&(this.alpha=0)}}),define("playcraft/sprite",function(){}),pc.SpriteSheet=pc.Base.extend("pc.SpriteSheet",{},{image:null,frameWidth:0,frameHeight:0,framesWide:1,framesHigh:1,scaleX:1,scaleY:1,sourceX:0,sourceY:0,alpha:1,useRotation:!1,compositeOperation:null,totalFrames:0,animations:null,frameOffsetX:0,frameOffsetY:0,_frameXPos:null,_frameYPos:null,init:function(t){if(this._super(),!pc.checked(t.image))throw"No image supplied";if(this.image=t.image,!this.image.width||!this.image.height)throw"Invalid image (zero width or height)";this.frameWidth=pc.valid(t.frameWidth)?t.frameWidth:pc.valid(t.framesWide)&&t.framesWide>0?Math.floor(this.image.width/t.framesWide):this.image.width,this.frameHeight=pc.valid(t.frameHeight)?t.frameHeight:pc.valid(t.framesHigh)&&t.framesHigh>0?Math.floor(this.image.height/t.framesHigh):this.image.height,this.framesWide=Math.floor(pc.checked(t.framesWide,this.image.width/this.frameWidth)),this.framesHigh=Math.floor(pc.checked(t.framesHigh,this.image.height/this.frameHeight)),this.scaleX=pc.checked(t.scaleX,1),this.scaleY=pc.checked(t.scaleY,1),this.sourceX=pc.checked(t.sourceX,0),this.sourceY=pc.checked(t.sourceY,0),this.frameOffsetX=pc.checked(t.frameOffsetX,0),this.frameOffsetY=pc.checked(t.frameOffsetY,0),this.alpha=pc.checked(t.alpha,1),this.useRotation=pc.checked(t.useRotation,!0),this.totalFrames=this.framesWide*this.framesHigh,this.animations=new pc.Hashtable,this._frameXPos=[];
for(var e=0;e<this.framesWide;e++)this._frameXPos.push(e*this.frameWidth);this._frameYPos=[];for(var o=0;o<this.framesHigh;o++)this._frameYPos.push(o*this.frameHeight)},addAnimation:function(t){if(!pc.valid(t.name))throw"Animation requires a name for reference";if(t.frameX=pc.checked(t.frameX,0),t.frameY=pc.checked(t.frameY,0),t.directions=pc.checked(t.directions,1),t.time=pc.checked(t.time,1e3),t.loops=pc.checked(t.loops,0),t.holdOnEnd=pc.checked(t.holdOnEnd,!1),t.dirAcross=pc.checked(t.dirAcross,!1),t.scaleX=pc.checked(t.scaleX,1),t.scaleY=pc.checked(t.scaleY,1),t.offsetX=pc.checked(t.offsetX,0),t.offsetY=pc.checked(t.offsetY,0),t.framesWide=pc.checked(t.framesWide,this.framesWide),t.framesHigh=pc.checked(t.framesHigh,this.framesHigh),t.frameCount=pc.checked(t.frameCount,this.framesWide*this.framesHigh),0==t.frameCount&&(t.frameCount=pc.checked(t.frameCount,this.framesWide*this.framesHigh)),!pc.valid(t.frames)){var e=t.frameX+t.frameY*t.framesWide;t.frames=[];for(var o=e;o<e+t.frameCount;o++)t.frames.push([o%t.framesWide,Math.floor(o/t.framesWide)])}t.frameRate=t.time/t.frames.length,t.degreesPerDir=360/t.directions,this.animations.put(t.name,t)},setAnimation:function(t,e,o){t.currentAnim=this.animations.get(e),null==t.currentAnim&&this.warn("attempt to set unknown animation ["+e+"]"),t.currentFrame=0,t.held=!1,t.animSpeedOffset=pc.checked(o,0)},hasAnimation:function(t){return null!=this.animations.get(t)},setScale:function(t,e){this.scaleX=t,this.scaleY=e},setCompositeOperation:function(t){this.compositeOperation=t},dirTmp:0,draw:function(t,e,o,i,n){if(this.image.loaded&&null!=e&&e.active){if((1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),1!=e.alpha&&(this.image.alpha=e.alpha),null!=this.compositeOperation&&this.image.setCompositeOperation(this.compositeOperation),null==e.currentAnim)(1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),this.image.draw(t,this.sourceX,this.sourceY,Math.round(o+this.frameOffsetX),Math.round(i+this.frameOffsetY),this.frameWidth+this.frameOffsetX,this.frameHeight+this.frameOffsetY,this.useRotation?n:0);else{var s=0,a=0;(1!=e.currentAnim.scaleX||1!=e.currentAnim.scaleY||1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(e.currentAnim.scaleX*this.scaleX,e.currentAnim.scaleY*this.scaleY),this.useRotation?(s=e.currentAnim.frames[e.currentFrame][0],a=e.currentAnim.frames[e.currentFrame][1],this.image.draw(t,this.sourceX+this._frameXPos[s],this.sourceY+this._frameYPos[a],e.currentAnim.offsetX+pc.Math.round(o)+this.frameOffsetX,e.currentAnim.offsetY+pc.Math.round(i)+this.frameOffsetY,this.frameWidth,this.frameHeight,n)):(this.dirTmp=Math.round(n/e.currentAnim.degreesPerDir),this.dirTmp>e.currentAnim.directions-1&&(this.dirTmp=0),s=e.currentAnim.frames[e.currentFrame][1]+this.dirTmp,a=e.currentAnim.frames[e.currentFrame][0],1==e.currentAnim.directions&&(a=e.currentAnim.frames[e.currentFrame][1],s=e.currentAnim.frames[e.currentFrame][0]),this.image.draw(t,this.sourceX+this._frameXPos[s],this.sourceY+this._frameYPos[a],e.currentAnim.offsetX+pc.Math.round(o)+this.frameOffsetX,e.currentAnim.offsetY+pc.Math.round(i)+this.frameOffsetY,this.frameWidth,this.frameHeight),(1!=e.currentAnim.scaleX||1!=e.currentAnim.scaleY||1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(e.currentAnim.scaleX*this.scaleX,e.currentAnim.scaleY*this.scaleY))}(1!=this.image.scaleX||1!=this.image.scaleY)&&this.image.setScale(1,1),1!=e.alpha&&(this.image.alpha=1),null!=this.compositeOperation&&this.image.setCompositeOperation("source-over")}},drawFrame:function(t,e,o,i,n,s){this.image.loaded&&(this.alpha<1&&(t.globalAlpha=this.alpha),(1!=this.scaleX||1!=this.scaleY)&&this.image.setScale(this.scaleX,this.scaleY),null!=this.compositeOperation&&this.image.setCompositeOperation(this.compositeOperation),this.image.draw(t,this.sourceX+this._frameXPos[e],this.sourceY+this._frameYPos[o],pc.Math.round(i)+this.frameOffsetX,pc.Math.round(n)+this.frameOffsetY,this.frameWidth,this.frameHeight,s),(1!=this.image.scaleX||1!=this.image.scaleY)&&this.image.setScale(1,1),this.alpha<1&&(t.globalAlpha=1),null!=this.compositeOperation&&this.image.setCompositeOperation("source-over"))},drawAllFrames:function(t,e,o){for(var i=0;i<this.framesHigh;i++)for(var n=0;n<this.framesWide;n++)this.drawFrame(t,n,i,e+n*this.frameWidth,o+i*this.frameHeight)},update:function(t,e){null!=t.currentAnim&&t.active&&!t.held&&(t.currentAnim.frames.length<=1||(t._acDelta>t.currentAnim.frameRate+t.animSpeedOffset?(t.currentFrame++,t.currentFrame>=t.currentAnim.frames.length&&(t.loopCount++,t.currentAnim.loops&&t.loopCount>=t.currentAnim.loops&&(t.currentAnim.holdOnEnd?(t.held=!0,t.currentFrame&&t.currentFrame--):t.active=!1),t.held||(t.currentFrame=0)),t._acDelta-=t.currentAnim.frameRate):t._acDelta+=e))},reset:function(){this.image=null,this.animations=null}}),define("playcraft/spritesheet",function(){}),pc.Math=pc.Base("pc.Math",{RADIAN_TO_DEGREE:180/Math.PI,DEGREE_TO_RADIAN:Math.PI/180,PI:Math.PI,round:Math.round,random:Math.random,floor:Math.floor,sqr:function(t){return t*t},rand:function(t,e){return pc.Math.round(pc.Math.random()*(e-t)+t)},randFloat:function(t,e){return pc.Math.random()*(e-t)+t},rotate:function(t,e){for(var o=t+e;o>359;)o-=360;for(;0>o;)o=360+o;return o},angleDiff:function(t,e,o){if(o)return t>e&&(e+=360),e-t;var i=t-e;return 0>i&&(i+=360),i},isClockwise:function(t,e){return t>e?Math.abs(t-e)<e+(360-t):t+(360-e)<Math.abs(e-t)},isFacingRight:function(t){return t>270||90>t?!0:!1},radToDeg:function(t){return t*pc.Math.RADIAN_TO_DEGREE},degToRad:function(t){return t*pc.Math.DEGREE_TO_RADIAN},angleFromVector:function(t,e){var o=pc.Math.radToDeg(Math.atan2(e,t));return 0>o&&(o+=360),o},vectorFromAngle:function(t){var e=Math.cos(pc.Math.degToRad(t)),o=Math.sin(pc.Math.degToRad(t));return pc.Point.create(e,o)},isPointInRect:function(t,e,o,i,n,s){return t>=o&&o+n>=t&&e>=i&&i+s>=e},isRectInRect:function(t,e,o,i,n,s,a,r){return pc.Math.isPointInRect(t,e,n,s,a,r)?pc.Math.isPointInRect(t+o,e,n,s,a,r)?pc.Math.isPointInRect(t,e+i,n,s,a,r)?pc.Math.isPointInRect(t+o,e+i,n,s,a,r):!1:!1:!1},isRectColliding:function(t,e,o,i,n,s,a,r){return!(s>e+i||e>s+r||n>t+o||t>n+a)},limit:function(t,e,o){return e>t?e:t>o?o:t},limitAdd:function(t,e,o,i){return o>t+e?o:t+e>i?i:t+e}},{}),pc.Rect=pc.Pooled("pc.Rect",{create:function(t,e,o,i){var n=this._super();return n.x=t,n.y=e,n.w=o,n.h=i,n}},{x:0,y:0,w:0,h:0,containsRect:function(t,e,o,i,n,s,a,r){return pc.Math.isPointInRect(t,e,n,s,a,r)?pc.Math.isPointInRect(t+o,e,n,s,a,r)?pc.Math.isPointInRect(t,e+i,n,s,a,r)?pc.Math.isPointInRect(t+o,e+i,n,s,a,r):!1:!1:!1},containsPoint:function(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h},overlaps:function(t,e,o,i,n){var s=o,a=i;if(pc.valid(n)&&0!=n){var r=Math.sin(pc.Math.degToRad(n)),c=Math.cos(pc.Math.degToRad(n));0>r&&(r=-r),0>c&&(c=-c),s=i*r+o*c,a=i*c+o*r}return!(this.y+this.h<e||this.y>e+a||this.x+this.w<t||this.x>t+s)},toString:function(){return this.x+" x "+this.y+" by "+this.w+" x "+this.h}}),pc.Point=pc.Pooled("pc.Point",{create:function(t,e){var o=this._super();return o.x=t,o.y=e,o}},{x:0,y:0,match:function(t){this.x=t.x,this.y=t.y},set:function(t){this.match(t)},setXY:function(t,e){return this.x=t,this.y=e,this},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,this},dirTo:function(t){return 180*Math.atan2(t.y-this.y,t.x-this.x)/Math.PI},moveInDir:function(t,e){return this.x+=e*Math.cos(pc.Math.degToRad(t)),this.y+=e*Math.sin(pc.Math.degToRad(t)),this},moveTowards:function(t,e){this.moveInDir(this.dirTo(t),e)},distance:function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},toString:function(){return this.x+"x"+this.y}}),pc.Poly=pc.Pooled("pc.Poly",{create:function(t,e,o){var i=this._super();return i.x=t,i.y=e,i.points=o,i}},{x:0,y:0,points:null,_boundingRect:null,init:function(t,e,o){this.x=t,this.y=e,this.points=o,this._boundingRect=pc.Rect.create(0,0,0,0)},getBoundingRect:function(){}}),pc.Dim=pc.Point,pc.Vector=pc.Point,define("playcraft/math",function(){}),pc.Image=pc.Base.extend("pc.Image",{},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(t,e,o,i){this._super(),this.name=t,this.src=pc.device.loader.makeUrl(e),this.image=new Image,this.onLoadCallback=o,this.onErrorCallback=i,this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.scaleX=1,this.scaleY=1,this.alpha=1,pc.device.loader.started&&this.load()},setAlpha:function(t){this.alpha=t},setScale:function(t,e){this.scaleX=t,this.scaleY=e},setCompositeOperation:function(t){this.compositeOperation=t},load:function(t,e){this.onLoadCallback=t,this.onErrorCallback=e,this.loaded&&t&&this.onLoadCallback(this),this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.image.src=this.src},reload:function(){this.loaded=!1,this.load()},draw:function(t,e,o,i,n,s,a,r){if(null!=this.compositeOperation&&(t.globalCompositeOperation=this.compositeOperation),3==arguments.length)t.save(),1!=this.alpha&&(t.globalAlpha=this.alpha),t.translate(e+this.width/2,o+this.height/2),t.scale(this.scaleX,this.scaleY),t.drawImage(this.image,0,0,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height),t.restore();else if(pc.valid(r)){if(t.save(),1!=this.alpha&&(t.globalAlpha=this.alpha),this.scaleX<0||this.scaleY<0){var c=1==this.scaleY?0:this.scaleY,l=1==this.scaleX?0:this.scaleX;t.translate(i+s/2*l,n+a/2*c)}else t.translate(i+s/2,n+a/2);t.rotate(r*(Math.PI/180)),t.drawImage(this.image,e,o,s,a,-s/2,-a/2,s,a),t.restore()}else{if(t.save(),1!=this.alpha&&(t.globalAlpha=this.alpha),this.scaleX<0||this.scaleY<0){var h=1==this.scaleY?0:this.scaleY,m=1==this.scaleX?0:this.scaleX;t.translate(i+-(s/2)*m,n+-(a/2)*h)}else t.translate(i,n);t.scale(this.scaleX,this.scaleY),t.drawImage(this.image,e,o,s,a,0,0,s,a),t.restore()}null!=this.compositeOperation&&(t.globalCompositeOperation="source-over"),pc.device.elementsDrawn++},_onLoad:function(){this.loaded=!0,this.width=this.image.width,this.height=this.image.height,this.onLoadCallback&&this.onLoadCallback(this)},_onError:function(){this.onErrorCallback&&this.onErrorCallback(this)},expand:function(t,e){this.image.width=this.width+t,this.image.height=this.height+e,this.width=this.image.width,this.height=this.image.height},resize:function(t,e){var o=this.width*t,i=this.height*e,n=document.createElement("canvas");n.width=this.width,n.height=this.height;var s=document.createElement("canvas");s.width=o,s.height=i;var a=s.getContext("2d"),r=a.getImageData(0,0,o,i),c=n.getContext("2d");c.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);for(var l=c.getImageData(0,0,this.width,this.height),h=0;i>h;h++)for(var m=0;o>m;m++)for(var u=4*(Math.floor(h/e)*this.width+Math.floor(m/t)),p=4*(h*o+m),y=0;4>y;y++)r.data[p+y]=l.data[u+y];return a.putImageData(r,0,0),this.image=s,this}}),pc.CanvasImage=pc.Base.extend("pc.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(t){this.canvas=t,this.width=t.width,this.height=t.height},draw:function(t,e,o,i,n,s,a){void 0==s||void 0==a||0==s||0==a?t.drawImage(this.canvas,e,o):t.drawImage(this.canvas,e,o,s,a,i*this.scaleX,n*this.scaleY,s*this.scaleX,a*this.scaleY)},setScale:function(t,e){this.scaleX=t,this.scaleY=e}}),pc.ImageTools=pc.Base.extend("pc.ImageTools",{rotate:function(t,e,o,i){var n=document.createElement("canvas");n.width=e*i,n.height=o;for(var s=n.getContext("2d"),a=0;i>a;a++)s.save(),s.translate(a*e+e/2,o/2),s.rotate(360/i*a*(Math.PI/180)),s.drawImage(t,-(e/2),-(o/2)),s.restore();return new pc.CanvasImage(n)}},{}),define("playcraft/image",function(){}),pc.Scene=pc.Base.extend("pc.Scene",{},{name:null,layersByName:null,layers:null,activeLayers:null,paused:!1,active:!1,viewPort:null,viewPortCenter:null,init:function(t){this._super(),this.active=!1,this.name=t,this.layersByName=new pc.Hashtable,this.layers=new pc.LinkedList,this.activeLayers=new pc.LinkedList,this.viewPort=pc.Rect.create(0,0,0,0),this.viewPortCenter=pc.Point.create(0,0),this.setViewPort(0,0,pc.device.canvasWidth,pc.device.canvasHeight),pc.device.started&&this.onReady()},onReady:function(){for(var t=this.layers.first;t;)t.obj.onReady(),t=t.next()},onActivated:function(){},onDeactivated:function(){},onResize:function(t,e){this.setViewPort(this.viewPort.x,this.viewPort.y,t,e);for(var o=this.layers.first;o;)o.obj.onResize(t,e),o=o.next()},setViewPort:function(t,e,o,i){this.viewPort.x=t,this.viewPort.y=e,this.viewPort.w=o,this.viewPort.h=i,this.viewPortCenter.x=this.viewPort.w/2,this.viewPortCenter.y=this.viewPort.h/2},getScreenRect:function(){return this.viewPort},sortLayers:function(){this.activeLayers.sort(function(t,e){return t.zIndex-e.zIndex})},onAction:function(){},isActive:function(){return this.active},get:function(t){return this.layersByName.get(t)},addLayer:function(t){if(!pc.valid(t))throw"Error: invalid layer";if(!pc.valid(t.name))throw"Error: trying to add a layer that has no name (forget to call this._super in your layer init?)";return this.layersByName.put(t.name,t),this.layers.add(t),this.activeLayers.add(t),t.active=!0,t.scene=this,t.onAddedToScene(),this.sortLayers(),t},removeLayer:function(t){this.layersByName.remove(t.name),this.layers.remove(t),this.activeLayers.remove(t),t.active=!1,t.scene=null,t.onRemovedFromScene()},setLayerActive:function(t){this.activeLayers.add(t),this.sortLayers(),t.active=!0},setLayerInactive:function(t){this.activeLayers.remove(t),t.active=!1},toggleLayerActive:function(t){t.active?this.setLayerInactive(t):this.setLayerActive(t)},getFirstActiveLayer:function(){return this.activeLayers.first},getFirstLayer:function(){return this.layers.first},startTime:0,process:function(){for(var t=this.activeLayers.first;t;)t.obj.paused||(t.obj.process(),this.startTime=Date.now(),t.obj.draw(),pc.device.lastDrawMS+=Date.now()-this.startTime),t=t.next()},pause:function(){this.paused=!0;for(var t=this.activeLayers.first;t;)t.obj.pause(),t=t.next()},resume:function(){this.paused=!1;for(var t=this.activeLayers.first;t;)t.obj.resume(),t=t.next()},reset:function(){for(var t=this.layers.first;t;)t.obj.reset(),t=t.next();this.layers.clear(),this.activeLayers.clear()},entitiesUnderXY:function(t,e){for(var o=[],i=this.layers.first;i;)o.push(i.obj.entitiesUnderXY(t,e)),i=i.next()},loadFromTMX:function(t,e){var o=pc.device.parseXML(t.data),i=o.getElementsByTagName("map")[0],n=parseInt(i.getAttribute("tilewidth")),s=parseInt(i.getAttribute("tileheight")),a=o.getElementsByTagName("tileset")[0],r=a.getAttribute("name");a.getAttribute("width"),a.getAttribute("height");var c=pc.device.loader.get(r);pc.assert(c,"Unable to locate tile image resource: "+r+". It must match the tileset name in tiled.");for(var l=pc.device.loader.get(r).resource,h=new pc.SpriteSheet({image:l,frameWidth:n,frameHeight:s}),m=new pc.TileSet(h),u=o.getElementsByTagName("tile"),p=0;p<u.length;p++){var y=u[p],d=parseInt(y.getAttribute("id")),f=y.getElementsByTagName("properties");if(f.length){f=f[0];for(var x=f.getElementsByTagName("property"),_=0;_<x.length;_++){var g=x[_],b=g.getAttribute("name"),D=g.getAttribute("value");m.addProperty(d,b,D)}}}for(var C=o.getElementsByTagName("layer"),B=0;B<C.length;B++)switch(i.getAttribute("orientation")){case"isometric":pc.IsoTileLayer.loadFromTMX(this,C[B],n,s,m);break;default:pc.TileLayer.loadFromTMX(this,C[B],n,s,m)}for(var v=o.getElementsByTagName("objectgroup"),S=0;S<v.length;S++)pc.EntityLayer.loadFromTMX(this,v[S],e)}}),define("playcraft/scene",function(){}),pc.Game=pc.Base.extend("pc.Game",{},{scenes:null,activeScenes:null,paused:!1,init:function(){this._super(),this.scenes=new pc.LinkedList,this.activeScenes=new pc.LinkedList,pc.device.devMode&&(pc.device.input.bindAction(this,"physics debug","F9"),pc.device.input.bindAction(this,"pool dump","F10"),pc.device.input.bindAction(this,"toggle sound","F11"))},process:function(){if(this.paused)return!0;for(var t=this.getFirstActiveScene();t;)t.object().process(),t=t.next();return!0},stopAllSounds:function(){for(var t=pc.device.loader.getAllSounds(),e=0;e<t.length;e++)pc.device.soundEnabled&&t[e].stop()},onAction:function(t){if("toggle sound"===t&&(this.stopAllSounds(),pc.device.soundEnabled=!pc.device.soundEnabled),"pool dump"===t&&console.log(pc.Pool.getStats()),"physics debug"===t)for(var e=this.getFirstScene();e;){for(var o=e.object().getFirstActiveLayer();o;){var i=o.object();if(i.Class.isA("pc.EntityLayer"))for(var n=i.systemManager.systems.first;n;){var s=n.object();s.Class.isA("pc.systems.Physics")&&s.setDebug(!s.debug),n=n.next()}o=o.next()}e=e.next()}},addScene:function(t,e){this.scenes.add(t),this.onSceneAdded(t),pc.checked(e,!0)&&this.activateScene(t)},onSceneAdded:function(){},removeScene:function(t){this.scenes.remove(t),this.activeScenes.remove(t),this.onSceneRemoved(t)},onSceneRemoved:function(){},activateScene:function(t){t.active||(this.activeScenes.add(t),t.active=!0,this.onSceneActivated(t),t.onActivated())},onSceneActivated:function(){},deactivateScene:function(t){t.active&&(this.activeScenes.remove(t),t.active=!1,this.onSceneDeactivated(t),t.onDeactivated())},onSceneDeactivated:function(){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){this.paused=!0;for(var t=this.getFirstScene();t;)t.object().pause(),t=t.next()},isActive:function(){return!this.paused},resume:function(){this.paused=!1;for(var t=this.getFirstScene();t;)t.object().resume(),t=t.next()},togglePauseResume:function(){pc.device.game.paused?pc.device.game.resume():pc.device.game.pause()},reset:function(){for(var t=this.getFirstScene();t;)t.obj.reset(),t=t.next();this.scenes.clear(),this.activeScenes.clear(),this.onReady()},onReady:function(){},onResize:function(t,e){for(var o=this.getFirstActiveScene();o;)o.obj.onResize(t,e),o=o.next()},getScreenRect:function(){return pc.Rect.create(0,0,pc.device.canvasWidth,pc.device.canvasHeight)}}),define("playcraft/game",function(){}),pc.Loader=pc.Base.extend("pc.Loader",{},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},resources:new pc.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",started:!1,finished:!1,_noCacheString:"",init:function(){this._super()},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(t){this.baseUrl=t},setListener:function(t,e){this.loadingListener=t,this.loadedListener=e},add:function(t){t.name=t.name.toLowerCase(),this.resources.put(t.name.toLowerCase(),{resource:t,state:this.State.QUEUED}),this.info("Adding resource "+t.src+" to the queue.")},get:function(t){var e=this.resources.get(t.toLowerCase());if(!e)throw"Attempting to get a resource that hasn't been added: "+t;if(e.state<this.State.READY)throw"Attempting to get a resource that hasn't been loaded yet (calling before onLoaded?)";return e},getAllSounds:function(){for(var t=[],e=this.resources.keys(),o=0;o<e.length;o++){var i=this.resources.get(e[o]).resource;i.Class.isA("pc.Sound")&&t.push(i)}return t},getAllImages:function(){for(var t=[],e=this.resources.keys(),o=0;o<e.length;o++){var i=this.resources.get(e[o]);i.isA("pc.Image")&&t.push(i)}return t},start:function(t,e){this.setListener(t,e),this.progress=0,this.errored=0;for(var o=this.resources.keys(),i=0;i<o.length;i++){var n=this.resources.get(o[i]);n.state==this.State.QUEUED&&(n.resource.load(this._onLoad.bind(this),this._onError.bind(this)),n.state=this.State.LOADING,this.totalBeingLoaded++)}this.info("Started loading "+this.totalBeingLoaded+" resource(s)."),this._checkAllDone()},makeUrl:function(t){return this.baseUrl+t+this._noCacheString},_onLoad:function(t){var e=this.resources.get(t.name);null==e?this.error("Unable to get resource ["+t.name+"] - Please make sure you are using all lowercase."):(e.state=this.State.READY,this.progress++,null!=this.loadingListener&&this.loadingListener(Math.round(100*(this.progress/this.totalBeingLoaded))),this.info(t.name+" loaded ("+Math.round(100*(this.progress/this.totalBeingLoaded))+"% done)")),this._checkAllDone()},_onError:function(t){var e=this.resources.get(t.name);e.state=this.State.FAILED,this.progress++,this.errored++,null!=this.loadingListener&&this.loadingListener(this.progress/this.totalBeingLoaded),this.warn(t.name+" ("+t.src+") failed."),this._checkAllDone()},_checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.finished=!0,this.loadedListener(this.progress,this.errored),this.progress=0,this.errored=0,this.totalBeingLoaded=0)}}),define("playcraft/loader",function(){}),pc.DataResource=pc.Base.extend("pc.DataResource",{},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(t,e,o,i){this._super(),this.src=pc.device.loader.makeUrl(e),this.name=t,this.onLoadCallback=o,this.onErrorCallback=i,this.request=new XMLHttpRequest,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.onload=this.onReadyStateChange.bind(this),this.request.onloadend=this.onReadyStateChange.bind(this),this.load()},load:function(t,e){this.onLoadCallback=t,this.onErrorCallback=e,this.request.open("get",this.src),this.request.send(null)},reload:function(){this.loaded=!1,this.load()},onReadyStateChange:function(){this.loaded||4==this.request.readyState&&(200==this.request.status?(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback&&this.onLoadCallback(this)):404==this.request.status&&(this.warn("resource "+this.src+" error "+this.request.status),this.onErrorCallback&&this.onErrorCallback(this)))}}),define("playcraft/dataresource",function(){}),pc.components={},pc.components.Component=pc.Pooled.extend("pc.components.Component",{create:function(){return this._super()}},{_entity:null,_type:null,active:!0,init:function(t){this._super(),this._type=t,this.active=!0},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}}),define("playcraft/components/component",function(){}),pc.components.Physics=pc.components.Component.extend("pc.components.Physics",{create:function(t){var e=this._super();return e.config(t),e}},{maxSpeed:null,bounce:.5,faceVel:!1,density:0,mass:-1,friction:0,linearDamping:0,linearVelocity:null,angularDamping:0,fixedRotation:!1,bullet:!1,collisionGroup:0,collisionCategory:0,collisionMask:0,sensorOnly:!1,immovable:!1,centerOfMass:null,centered:!0,gravity:null,shapes:null,force:0,turn:0,torque:0,_body:null,_fixtures:null,_lastSpatialPos:null,_lastSpatialDim:null,_lastSpatialDir:0,init:function(t){this._super("physics"),this.centerOfMass=pc.Point.create(0,0),this.margin={x:0,y:0},this.linearVelocity=pc.Dim.create(0,0),pc.valid(t)&&this.config(t),this._velReturn=pc.Dim.create(0,0),this.gravity={}},config:function(t){this._body=null,this._fixtures?this._fixtures.length=0:this._fixtures=[],this.collisionGroup=pc.checked(t.collisionGroup,0),this.collisionCategory=pc.checked(t.collisionCategory,0),this.collisionMask=pc.checked(t.collisionMask,0),this.sensorOnly=pc.checked(t.sensorOnly,!1),this.centered=pc.checked(t.centered,!0),pc.valid(t.shapes)||Array.isArray(t.shapes)||(t.shapes=[{}],t.shapes[0].shape=pc.CollisionShape.RECT);for(var e=0;e<t.shapes.length;e++){var o=t.shapes[e];o.offset||(o.offset={}),o.offset.x=pc.checked(o.offset.x,0),o.offset.y=pc.checked(o.offset.y,0),o.offset.w=pc.checked(o.offset.w,0),o.offset.h=pc.checked(o.offset.h,0),o.type=pc.checked(o.type,0),o.shape=pc.checked(o.shape,pc.CollisionShape.RECT),o.sensorOnly=pc.checked(o.sensorOnly,this.sensorOnly),o.collisionGroup=pc.checked(o.collisionGroup,this.collisionGroup),o.collisionCategory=pc.checked(o.collisionCategory,this.collisionCategory),o.collisionMask=pc.checked(o.collisionMask,this.collisionMask)}this.shapes=t.shapes,t.linearVelocity?(this.linearVelocity.x=pc.checked(t.linearVelocity.x,0),this.linearVelocity.y=pc.checked(t.linearVelocity.y,0)):(this.linearVelocity.x=0,this.linearVelocity.y=0),this.maxSpeed||(this.maxSpeed={}),t.maxSpeed?(this.maxSpeed.x=pc.checked(t.maxSpeed.x,0),this.maxSpeed.y=pc.checked(t.maxSpeed.y,0)):(this.maxSpeed.x=0,this.maxSpeed.y=0),t.gravity?(this.gravity.x=t.gravity.x,this.gravity.y=t.gravity.y):(this.gravity.x=void 0,this.gravity.y=void 0),this.mass=pc.checked(t.mass,-1),this.fixedRotation=pc.checked(t.fixedRotation,!1),this.thrust=pc.checked(t.thrust,0),this.bounce=pc.checked(t.bounce,.5),this.faceVel=pc.checked(t.faceVel,0),this.shape=pc.checked(t.shape,pc.CollisionShape.RECT),this.immovable=pc.checked(t.immovable,!1),this.density=pc.checked(t.density,1),this.friction=pc.checked(t.friction,.2),this.linearDamping=pc.checked(t.linearDamping,0),this.angularDamping=pc.checked(t.angularDamping,0),this.bullet=pc.checked(t.bullet,!1),this.torque=pc.checked(t.torque,0),this.impulse=pc.checked(t.impulse,0),this.turn=pc.checked(t.turn,0),this.force=pc.checked(t.force,0),pc.valid(t.centerOfMass)&&(this.centerOfMass.x=pc.checked(t.centerOfMass.x),this.centerOfMass.y=pc.checked(t.centerOfMass.y))},applyTurn:function(t){this._body?(this._body.SetAngularVelocity(pc.Math.degToRad(t)),this._body.SetAwake(!0)):this._pendingDir=t},clearGravity:function(){this.setGravity()},setGravity:function(t,e){this.gravity.x=t,this.gravity.y=e,this._body&&((void 0!=this.gravity.x||void 0!=this._body._pc_gravityX)&&(this._body._pc_gravityX=this.gravity.x),(void 0!=this.gravity.y||void 0!=this._body._pc_gravityY)&&(this._body._pc_gravityY=this.gravity.y))},setDir:function(t){this._body?(this._body.SetAngle(pc.Math.degToRad(t)),this._body.SetAwake(!0)):this.dir=t},getDir:function(){return this._body?pc.Math.radToDeg(this._body.GetAngle()):0},applyForce:function(t,e){if(this._body){var o=this._body.GetAngle();pc.valid(e)&&(o=pc.Math.degToRad(e)),this._body.ApplyForce(Box2D.Common.Math.b2Vec2.Get(Math.cos(o)*t,Math.sin(o)*t),this._body.GetWorldCenter())}else this.force=t},applyImpulse:function(t,e){if(this._body){var o=this._body.GetAngle();pc.valid(e)&&(o=pc.Math.degToRad(e)),this._body.ApplyImpulse(Box2D.Common.Math.b2Vec2.Get(Math.cos(o)*t,Math.sin(o)*t),this._body.GetWorldCenter())}else this.impulse=t},applyTorque:function(t){this._body?this._body.ApplyTorque(pc.Math.degToRad(t)):this.torque=t},setCenterOfMass:function(t,e){if(this._body){var o=new Box2D.Collision.Shapes.b2MassData;o.center=Box2D.Common.Math.b2Vec2.Get(pc.systems.Physics.toP(t),pc.systems.Physics.toP(e)),this._body.SetMassData(o)}else this.centerOfMass.x=t,this.centerOfMass.y=e},getSpeed:function(){return this._body?this._body.GetLinearVelocity().Length()/pc.systems.Physics.SCALE:0},setLinearVelocity:function(t,e){this._body?(this._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(t*pc.systems.Physics.SCALE,e*pc.systems.Physics.SCALE)),this._body.SetAwake(!0)):(this.linearVelocity.x=t,this.linearVelocity.y=e)},_velReturn:null,getLinearVelocity:function(){if(this._body){var t=this._body.GetLinearVelocity();this._velReturn.setXY(pc.systems.Physics.fromP(t.x),pc.systems.Physics.fromP(t.y))}return this._velReturn},getVelocityAngle:function(){return pc.Math.angleFromVector(this._body.GetLinearVelocity().x,this._body.GetLinearVelocity().y)},setAngularVelocity:function(t){this._body&&(this._body.SetAngularVelocity(t),this._body.SetAwake(!0))},setLinearDamping:function(){this._body&&(this._body.SetLinearDamping(a),this._body.SetAwake(!0))},setFriction:function(t){this._body&&(this._body.SetFriction(t),this._body.SetAwake(!0))},setCollisionCategory:function(t){if(this._fixtures.length){this.collisionCategory=t;for(var e=0;e<this._fixtures.length;e++){var o=this._fixtures[e].GetFilterData();o.collisionCategory=t,this._fixtures[e].SetFilterData(o),this._fixtures[e].GetFilterData().categoryBits=t}}},setCollisionGroup:function(t){if(this._fixtures.length){this.collisionGroup=t;for(var e=0;e<this._fixtures.length;e++){var o=this._fixtures[e].GetFilterData();o.groupIndex=t,this._fixtures[e].SetFilterData(o)}}},setCollisionMask:function(t){if(this._fixtures.length){this.collisionMask=t;for(var e=0;e<this._fixtures.length;e++){var o=this._fixtures[e].GetFilterData();o.maskBits=t,this._fixtures[e].SetFilterData(o)}}},setIsSensor:function(t,e){this._fixtures.length&&(this._fixtures[e].isSensor=t)}}),define("playcraft/components/physics",function(){}),pc.components.Alpha=pc.components.Component.extend("pc.components.Alpha",{create:function(t){var e=this._super();return e.config(t),e}},{level:1,init:function(){this._super("alpha")},config:function(t){this.level=pc.checked(t.level,1)},setAlpha:function(t){this.level=t,this._fix(this.level)},addAlpha:function(t){this.level+=t,this._fix(this.level)},subAlpha:function(t){this.level-=t,this._fix(this.level)},_fix:function(t){t>1||0>t||(this.level=t)}}),define("playcraft/components/alpha",function(){}),pc.JointType={WELD:0,REVOLUTE:1,DISTANCE:2},pc.components.Joint=pc.components.Component.extend("pc.components.Joint",{create:function(t){var e=this._super();return e.config(t),e}},{attachTo:null,offset:null,attachmentOffset:null,distance:0,type:0,frequency:0,dampingRatio:0,angle:0,lowerAngleLimit:0,upperAngleLimit:0,enableLimit:!1,maxMotorTorque:0,enableMotor:0,motorSpeed:0,_joint:null,init:function(t){this._super("joint"),this.offset=pc.Point.create(0,0),this.attachmentOffset=pc.Point.create(0,0),pc.valid(t)&&this.config(t)},config:function(t){this.attachTo=pc.checked(t.attachedTo,null),t.offset&&this.offset.setXY(pc.checked(t.offset.x,0),pc.checked(t.offset.y,0)),t.attachmentOffset&&this.attachmentOffset.setXY(pc.checked(t.attachmentOffset.x,0),pc.checked(t.attachmentOffset.y,0)),this.distance=pc.checked(t.distance,0),this.type=pc.checked(t.type,pc.JointType.WELD),this.dampingRatio=pc.checked(t.dampingRatio,0),this.lowerAngleLimit=pc.checked(t.lowerAngleLimit,0),this.upperAngleLimit=pc.checked(t.upperAngleLimit,359),this.enableLimit=pc.checked(t.enableLimit,!1),this.maxMotorTorque=pc.checked(t.maxMotorTorque,100),this.enableMotor=pc.checked(t.enableMotor,!1),this.motorSpeed=pc.checked(t.motorSpeed,0),this.angle=pc.checked(t.angle,0),this._joint=null},getAngle:function(){return pc.Math.radToDeg(this._joint.GetJointAngle())},getSpeed:function(){return this._joint.GetJointSpeed()},setMotorSpeed:function(t){this.motorSpeed=t,this._joint.SetMotorSpeed(t)},getMotorTorque:function(){return this._joint.GetMotorTorque()},isLimitEnabled:function(){return this.enableLimit},isMotorEnabled:function(){return this.enableMotor},setMaxMotorTorque:function(t){this.maxMotorTorque=t,this._joint.SetMaxMotorTorque(t)},getMaxMotorTorque:function(){return this.maxMotorTorque}}),define("playcraft/components/joint",function(){}),pc.components.Expiry=pc.components.Component.extend("pc.components.Expiry",{create:function(t){var e=this._super();return e.config(t),e}},{lifetime:0,init:function(){this._super("expiry")},config:function(t){this.lifetime=pc.checked(t.lifetime,1e3)},decrease:function(t){this.lifetime-=t},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/expiry",function(){}),pc.components.OriginShifter=pc.components.Component.extend("pc.components.OriginShifter",{create:function(t){var e=this._super();return e.config(t),e}},{ratio:1,_offsetX:0,_offsetY:0,init:function(t){this._super("originshifter"),pc.valid(t)&&this.config(t)},config:function(t){this.ratio=pc.checked(t.ratio,1)}}),define("playcraft/components/originshifter",function(){}),pc.components.Spatial=pc.components.Component.extend("pc.components.Spatial",{create:function(t){var e=this._super();return e.config(t),e}},{lastMove:null,pos:null,dim:null,scaleX:0,scaleY:0,dir:0,_centerPos:null,_screenRect:null,init:function(t){this._super("spatial"),this.pos=pc.Point.create(0,0),this.dim=pc.Dim.create(0,0),this._screenRect=pc.Rect.create(0,0,0,0),this._centerPos=pc.Point.create(0,0),this._unscaledPos=pc.Point.create(0,0),this._unscaledDim=pc.Point.create(0,0),this.lastMove=pc.Dim.create(0,0),this.scaleX=1,this.scaleY=1,pc.valid(t)&&this.config(t)
},config:function(t){this.pos.x=pc.checked(t.x,0),this.pos.y=pc.checked(t.y,0),this.dim.x=pc.checked(t.w,0),this.dim.y=pc.checked(t.h,0),this.dir=pc.checked(t.dir,0),this.scaleX=pc.checked(t.scaleX,1),this.scaleY=pc.checked(t.scaleY,1),this._centerPos.x=0,this._centerPos.y=0,this._screenRect.x=0,this._screenRect.y=0,this._screenRect.w=0,this._screenRect.h=0,this.lastMove.x=0,this.lastMove.y=0},getPos:function(){return this.pos},getDim:function(){return this.dim},addScale:function(t,e){this.pos.x-=Math.abs((this.dim.x-this.dim.x*t)/2),this.pos.y-=Math.abs((this.dim.y-this.dim.y*e)/2),this.dim.x*=t,this.dim.y*=e,this.scaleX+=t,this.scaleY+=e},_unscaledPos:null,getUnscaledPos:function(){return this._unscaledPos.x=this.pos.x/this.scaleX,this._unscaledPos.y=this.pos.y/this.scaleY,this._unscaledPos},_unscaledDim:null,getUnscaledDim:function(){return this._unscaledDim.x=this.dim.x/this.scaleX,this._unscaledDim.y=this.dim.y/this.scaleY,this._unscaledDim},subtractScale:function(t,e){this.addScale(-t,-e)},setDir:function(t){this.dir=t},getDir:function(){return this.dir},getCenterPos:function(){return this._centerPos.x=this.pos.x+this.dim.x/2,this._centerPos.y=this.pos.y+this.dim.y/2,this._centerPos},getScreenRect:function(){return this._entity&&this._entity.layer?(this._screenRect.x=this._entity.layer.screenX(this.pos.x),this._screenRect.y=this._entity.layer.screenY(this.pos.y),this._screenRect.w=this.dim.x,this._screenRect.h=this.dim.y,this._screenRect):null},toString:function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z+" dir: "+this.dir}}),define("playcraft/components/spatial",function(){}),pc.components.Overlay=pc.components.Component.extend("pc.components.Overlay",{create:function(t){var e=this._super();return e.config(t),e}},{lifetime:0,sprite:null,init:function(t){this._super("overlay"),this.sprite=pc.Sprite.create(),pc.valid(t)&&this.config(t)},config:function(t){this.lifetime=pc.checked(t.lifetime,1e3);var e=pc.checked(t.spriteSheet,null);if(null==e)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(e);var o=pc.checked(t.animationStart,null),i=pc.checked(t.animationStartDelay,0);null!=o&&this.sprite.setAnimation(o,i)},decrease:function(t){this.lifetime-=t},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/overlay",function(){}),pc.components.Clip=pc.components.Component.extend("pc.components.Clip",{create:function(t){var e=this._super();return e.config(t),e}},{clipEntity:null,x:0,y:0,w:0,h:0,init:function(){this._super("clip")},config:function(t){this.clipEntity=pc.checked(t.clipEntity,null),this.x=pc.checked(t.x,0),this.y=pc.checked(t.y,0),this.w=pc.checked(t.w,0),this.h=pc.checked(t.h,0)}}),define("playcraft/components/clip",function(){}),pc.components.Activator=pc.components.Component.extend("pc.components.Activator",{create:function(t){var e=this._super();return e.config(t),e}},{tag:null,layer:null,range:0,stayActive:!1,_cacheLayer:null,init:function(){this._super("activator")},config:function(t){if(!t.tag)throw"Activator requires an entity to track against";this.tag=t.tag,this.layer=pc.checked(t.layer,null),this.range=pc.checked(t.range,300),this.stayActive=pc.checked(t.stayActive,!1)}}),define("playcraft/components/activator",function(){}),pc.components.Input=pc.components.Component.extend("pc.components.Input",{create:function(t){var e=this._super();return e.config(t),e}},{target:null,states:null,actions:null,_bound:!1,init:function(){this._super("input")},config:function(t){if(!t.states&&!t.actions)throw"Input requires at least an action or state set";this.states=t.states,this.actions=t.actions,this.target=t.target}}),define("playcraft/components/input",function(){}),pc.components.Fade=pc.components.Component.extend("pc.components.Fade",{create:function(t){var e=this._super();return e.config(t),e}},{startDelay:0,fadeInTime:0,fadeOutTime:0,holdTime:0,startTime:0,timeLimit:0,state:0,loops:1,loopsSoFar:0,init:function(){this._super("fade")},config:function(t){this.startDelay=pc.checked(t.startDelay,0),this.fadeInTime=pc.checked(t.fadeInTime,0),this.fadeOutTime=pc.checked(t.fadeOutTime,0),this.holdTime=pc.checked(t.holdTime,0),this.loops=pc.checked(t.loops,1),this.timeLimit=0,this.state=0,this.loopsSoFar=0}}),define("playcraft/components/fade",function(){}),pc.components.Spin=pc.components.Component.extend("pc.components.Spin",{create:function(t){var e=this._super();return e.config(t),e}},{rate:0,max:0,clockwise:!0,spinSoFar:0,spinning:!0,init:function(t){this._super("spin"),pc.valid(t)&&this.config(t)},config:function(t){this.rate=pc.checked(t.rate,15),this.max=pc.checked(t.max,0),this.clockwise=pc.checked(t.clockwise,!0),this.spinSoFar=0,this.spinning=!0}}),define("playcraft/components/spin",function(){}),pc.components.Scale=pc.components.Component.extend("pc.components.Scale",{create:function(t){var e=this._super();return e.config(t),e}},{x:1,y:1,growX:0,growY:0,maxX:0,maxY:0,scaledXSoFar:0,scaledYSoFar:0,scaling:!0,_bound:!1,init:function(t){this._super("scale"),pc.valid(t)&&this.config(t)},config:function(t){this.x=pc.checked(t.x,1),this.y=pc.checked(t.y,1),this.growX=pc.checked(t.growX,0),this.growY=pc.checked(t.growY,0),this.maxX=pc.checked(t.maxX,0),this.maxY=pc.checked(t.maxY,0),this.scaledXSoFar=0,this.scaledYSoFar=0}}),define("playcraft/components/scale",function(){}),pc.components.Rect=pc.components.Component.extend("pc.components.Rect",{create:function(t){var e=this._super();return e.config(t),e}},{color:null,lineColor:null,lineWidth:0,cornerRadius:0,init:function(t){this._super("rect"),this.color=pc.Color.create("#ffffff"),this.lineColor=pc.Color.create("#888888"),pc.valid(t)&&this.config(t)},config:function(t){t.color?this.color.set(pc.checked(t.color,"#ffffff")):this.color.set("#ffffff"),t.lineColor?this.lineColor.set(pc.checked(t.lineColor,"#888888")):this.lineColor.set("#ffffff"),this.lineWidth=pc.checked(t.lineWidth,0),this.cornerRadius=pc.checked(t.cornerRadius,0)}}),define("playcraft/components/rect",function(){}),pc.components.Poly=pc.components.Component.extend("pc.components.Poly",{create:function(t){var e=this._super();return e.config(t),e}},{color:null,lineColor:null,lineWidth:0,points:[],init:function(t){this._super("poly"),this.color=pc.Color.create("#ffffff"),this.lineColor=null,pc.valid(t)&&this.config(t)},config:function(t){if(t.color?this.color.set(pc.checked(t.color,"#ffffff")):this.color.set("#ffffff"),pc.valid(t.lineColor)&&(null==this.lineColor?this.lineColor=pc.Color.create(t.lineColor):this.lineColor.set(pc.checked(t.lineColor,"#888888"))),this.lineWidth=pc.checked(t.lineWidth,0),t.points.length<3)throw"Invalid polygon, requires at least 3 points";this.points=t.points}}),define("playcraft/components/poly",function(){}),pc.components.Circle=pc.components.Component.extend("pc.components.Circle",{create:function(t){var e=this._super();return e.config(t),e}},{color:null,lineColor:null,lineWidth:0,init:function(){this._super("circle")},config:function(t){t.color?null==this.color?this.color=pc.Color.create(t.color):this.color.set(t.color):this.color=null,t.lineColor?null==this.lineColor?this.lineColor=pc.Color.create(t.lineColor):this.lineColor.set(t.lineColor):this.lineColor=null,this.lineWidth=pc.checked(t.lineWidth,0)}}),define("playcraft/components/circle",function(){}),pc.components.Text=pc.components.Component.extend("pc.components.Text",{create:function(t){var e=this._super();return e.config(t),e}},{color:null,strokeColor:null,font:null,fontHeight:0,text:null,lineWidth:0,offset:null,_fontCache:null,init:function(t){this._super("text"),this.color=pc.Color.create("#ffffff"),this.strokeColor=pc.Color.create("#888888"),this.text=[],this.font="Calibri",this.fontHeight=20,this.offset=pc.Dim.create(0,0),this._fontCache="",pc.valid(t)&&this.config(t)},config:function(t){this.color.set(pc.checked(t.color,"#ffffff")),this.strokeColor.set(pc.checked(t.strokeColor,"#888888")),this.lineWidth=pc.checked(t.lineWidth,0),this.text=pc.checked(t.text,[""]),this.font=pc.checked(t.font,"Arial"),this.fontHeight=pc.checked(t.fontHeight,20),pc.valid(t.offset)&&(this.offset.x=pc.checked(t.offset.x),this.offset.y=pc.checked(t.offset.y)),this._updateFont()},setHeight:function(t){this.fontHeight=t,this._updateFont()},setFont:function(t){this.font=t,this._updateFont()},_updateFont:function(){this._fontCache=""+this.fontHeight+"px "+this.font}}),define("playcraft/components/text",function(){}),pc.components.Sprite=pc.components.Component.extend("pc.components.Sprite",{create:function(t){var e=this._super();return e.config(t),e}},{sprite:null,offset:null,init:function(t){this._super("sprite"),this.sprite=pc.Sprite.create(),this.offset=pc.Point.create(0,0),pc.valid(t)&&this.config(t)},config:function(t){var e=pc.checked(t.spriteSheet,null);if(null==e)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(e),pc.valid(t.offset)?(this.offset.x=pc.checked(t.offset.x,0),this.offset.y=pc.checked(t.offset.y,0)):(this.offset.x=0,this.offset.y=0);var o=pc.checked(t.animationStart,null),i=pc.checked(t.animationStartDelay,0);null!=o&&this.sprite.setAnimation(o,i),this.sprite.currentFrame=pc.checked(t.currentFrame,0)}}),define("playcraft/components/sprite",function(){}),pc.components.Layout=pc.components.Component.extend("pc.components.Layout",{create:function(t){var e=this._super();return e.config(t),e}},{vertical:null,horizontal:null,margin:null,init:function(){this._super("layout"),this.margin={}},config:function(t){pc.checked(t.margin)?(this.margin.left=pc.checked(t.margin.left,0),this.margin.right=pc.checked(t.margin.right,0),this.margin.top=pc.checked(t.margin.top,0),this.margin.bottom=pc.checked(t.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0),this.horizontal=pc.checked(t.horizontal,"left"),this.vertical=pc.checked(t.vertical,"top")}}),define("playcraft/components/layout",function(){}),pc.components.ParticleEmitter=pc.components.Component.extend("pc.components.ParticleEmitter",{create:function(t){var e=this._super();return e.config(t),e}},{active:!0,emitting:!0,growXMin:0,growXMax:0,growYMin:0,growYMax:0,scaleXMin:0,scaleXMax:0,scaleYMin:0,scaleYMax:0,fadeInTime:0,fadeOutTime:0,angleMin:0,angleMax:0,thrustMin:0,thrustMax:0,thrustTime:0,spinMin:0,spinMax:0,rangeX:1,rangeY:1,burst:1,delay:25,spriteSheet:null,lifeMin:0,lifeMax:0,rotateSprite:!1,offsetX:null,offsetY:null,compositeOperation:null,relativeAngle:!0,shots:0,alphaMin:1,alphaMax:1,alphaDelay:0,_particles:null,_lastEmitTime:0,_shotCount:0,init:function(t){this._super("emitter"),pc.valid(t)&&this.config(t)},reset:function(){this._shotCount=0,this._lastEmitTime=0},config:function(t){if(this._lastEmitTime=0,this._shotCount=0,this.active=pc.checked(t.active,!0),this.emitting=pc.checked(t.emitting,!0),this.growXMin=pc.checked(t.growXMin,0),this.growXMax=pc.checked(t.growXMax,this.growXMin),this.growYMin=pc.checked(t.growYMin,0),this.growYMax=pc.checked(t.growYMax,this.growYMin),this.scaleXMin=pc.checked(t.scaleXMin,1),this.scaleYMin=pc.checked(t.scaleYMin,1),this.scaleXMax=pc.checked(t.scaleXMax,1),this.scaleYMax=pc.checked(t.scaleYMax,1),this.compositeOperation=pc.checked(t.compositeOperation,null),this.alphaMin=pc.checked(t.alphaMin,1),this.alphaMax=pc.checked(t.alphaMax,this.alphaMin),this.alphaDelay=pc.checked(t.alphaDelay,50),this.shots=pc.checked(t.shots,0),this.relativeAngle=pc.checked(t.relativeAngle,!0),this.rangeX=pc.checked(t.rangeX,1),this.rangeY=pc.checked(t.rangeY,1),this.fadeInTime=pc.checked(t.fadeInTime,0),this.fadeOutTime=pc.checked(t.fadeOutTime,0),this.angleMin=pc.checked(t.angleMin,0),this.angleMax=pc.checked(t.angleMax,359),this.thrustMin=pc.checked(t.thrustMin,1),this.thrustMax=pc.checked(t.thrustMax,this.thrustMin),this.thrustTime=pc.checked(t.thrustTime,100),this.burst=pc.checked(t.burst,1),this.delay=pc.checked(t.delay,25),this.lifeMin=pc.checked(t.lifeMin,100),this.lifeMax=pc.checked(t.lifeMin,this.lifeMin),this.rotateSprite=pc.checked(t.rotateSprite,!1),this.spinMin=pc.checked(t.spinMin,0),this.spinMax=pc.checked(t.spinMax,this.spinMin),this.offsetX=pc.checked(t.offsetX,0),this.offsetY=pc.checked(t.offsetY,0),this.gravityX=pc.checked(t.gravityX,0),this.gravityY=pc.checked(t.gravityY,0),this.maxVelX=pc.checked(t.maxVelX,50),this.maxVelY=pc.checked(t.maxVelY,50),!pc.valid(t.spriteSheet))throw"A spritesheet is required for the emitter";this.spriteSheet=t.spriteSheet,Array.isArray(this._particles)?this._particles.clear():this._particles=new pc.LinkedList},onBeforeRemoved:function(){for(var t=this._particles.first;t;)t.obj.release(),t=t.next()}}),define("playcraft/components/particleemitter",function(){}),pc.systems={},pc.systems.System=pc.Base.extend("pc.System",{},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(t,e){if(this._super(),this.delay=pc.checked(e,0),!t instanceof Array)throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system.";this.componentTypes=t},processAll:function(){},onResize:function(){},onOriginChange:function(){},onAddedToLayer:function(){},onRemovedFromLayer:function(){}}),define("playcraft/systems/system",function(){}),pc.EntityManager=pc.Base.extend("pc.EntityManager",{},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(t){this.layer=t,this.entitiesByTag=new pc.HashList,this.entities=new pc.LinkedList,this.componentsByEntity=new pc.Hashmap,this.componentsByEntityPlusType=new pc.Hashmap,this.entitySuicides=new pc.LinkedList},cleanup:function(){for(var t=this.entitySuicides.first;t;)this._doRemoveEntity(t.object()),t=t.next();this.entitySuicides.clear()},add:function(t,e){this.entities.add(t),void 0!=e&&this.entitiesByTag.add(e,t);var o=t.getAllComponents();if(null!=o)for(var i=o.values(),n=0;n<i.length;n++)this._addToComponentMap(t,i[n]);this.layer.systemManager._handleEntityAdded(t)},remove:function(t){this.entitySuicides.has(t)||(this.entitySuicides.add(t),t.active=!1)},removeComponent:function(t,e){this._removeFromComponentMap(t,e),this.layer.systemManager._handleComponentRemoved(t,e),t._handleComponentRemoved(e),e._entity=null},addTag:function(t,e){-1==t.tags.indexOf(e.toLowerCase())&&(this.entitiesByTag.add(e.toLowerCase(),t),t.tags.push(e.toLowerCase()))},removeTag:function(t,e){this.entitiesByTag.remove(e.toLowerCase(),t),pc.Tools.arrayRemove(t.tags,e.toLowerCase())},getTagged:function(t){return this.entitiesByTag.get(t.toLowerCase())},activate:function(t){t.active||(this.layer.systemManager._handleEntityAdded(t),t.active=!0)},deactivate:function(t){t.active&&(this.layer.systemManager._handleEntityRemoved(t),t.active=!1)},_doRemoveEntity:function(t){this.entities.remove(t);var e=t.getAllComponents();if(null!=e)for(var o=e.values(),i=0;i<o.length;i++)this._removeFromComponentMap(t,o[i]);for(var n=0;n<t.tags.length;n++)this.entitiesByTag.remove(t.tags[n],t);this.layer.systemManager._handleEntityRemoved(t),t.release()},addComponent:function(t,e){return this._addToComponentMap(t,e),t._handleComponentAdded(e),this.layer.systemManager._handleComponentAdded(t,e),e._entity=t,e},getComponent:function(t,e){return this.componentsByEntityPlusType.get(t.objectId+":"+e)},getComponents:function(t){return this.componentsByEntity.get(t.objectId)},hasComponentOfType:function(t,e){return this.componentsByEntityPlusType.containsKey(t.objectId+":"+e)},_addToComponentMap:function(t,e){if(this.componentsByEntityPlusType.get(t.objectId+":"+e.getType()))throw"adding component "+e.getType()+" to entity "+t+" when it already has one of that type";this.componentsByEntityPlusType.put(t.objectId+":"+e.getType(),e),this.componentsByEntity.put(t.objectId,e)},_removeFromComponentMap:function(t,e){e.onBeforeRemoved(),this.componentsByEntityPlusType.remove(t.objectId+":"+e.getType()),this.componentsByEntity.remove(t.objectId),e.release()}}),define("playcraft/es/entitymanager",function(){}),pc.SystemManager=pc.Base.extend("pc.SystemManager",{},{systems:null,systemsByComponentType:null,layer:null,init:function(t){this.systems=new pc.LinkedList,this.systemsByComponentType=new pc.Hashtable,this.layer=t},add:function(t){if(t.layer=this.layer,t.systemManager=this,this.systems.add(t),!pc.valid(t.componentTypes))throw"Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)";for(var e=0;e<t.componentTypes.length;e++){var o=t.componentTypes[e].toLowerCase(),i=this.systemsByComponentType.get(o);null==i&&(i=new pc.LinkedList,this.systemsByComponentType.put(o,i)),i.has(t)||i.add(t)}for(var n=this.layer.entityManager.entities.first;n;)this._handleEntityAdded(n.object()),n=n.next();t.onAddedToLayer(this.layer)},remove:function(t){t.onRemovedFromLayer(t.layer),this.systems.remove(t);for(var e=0;e<t.componentTypes;e++){var o=this.systemsByComponentType.get(t.componentTypes[e].toLowerCase());assert(null!=o,"Oops, trying to remove a system and it's not in the by type list"),t.systemManager=null,o.remove(t)}},getByComponentType:function(t){return this.systemsByComponentType.get(t)},onOriginChange:function(t,e){for(var o=this.systems.first;o;)o.object().onOriginChange(t,e),o=o.next()},_handleEntityAdded:function(t){for(var e=t.getComponentTypes(),o=0;o<e.length;o++){var i=this.systemsByComponentType.get(e[o].toLowerCase());if(i)for(var n=i.first;n;)n.obj.add(t),n=n.next()}},_handleEntityRemoved:function(t){var e=t.getAllComponents();if(null!=e)for(var o=e.keys(),i=0;i<o.length;i++){var n=this.systemsByComponentType.get(o[i].toLowerCase());if(n)for(var s=n.first;s;)s.obj.remove(t),s=s.next()}},_handleComponentAdded:function(t,e){var o=this.systemsByComponentType.get(e.getType());if(null!=o)for(var i=o.first;i;)i.obj.add(t),i.obj.onComponentAdded(t,e),i=i.next()},_handleComponentRemoved:function(t,e){var o=this.systemsByComponentType.get(e.getType());if(null!=o)for(var i=o.first;i;)i.obj.removeIfNotMatched(t),i.obj.onComponentRemoved(t,e),i=i.next()},processAll:function(){for(var t=this.systems.first;t;)(0==t.obj.delay||pc.device.now-t.obj._lastRun>t.obj.delay)&&(t.obj.processAll(),0!=t.obj.delay&&(t.obj._lastRun=pc.device.now)),t=t.next()},onResize:function(t,e){for(var o=this.systems.first;o;)o.obj.onResize(t,e),o=o.next()}}),define("playcraft/es/systemmanager",function(){}),pc.systems.EntitySystem=pc.systems.System.extend("pc.systems.EntitySystem",{},{entities:null,suicides:null,init:function(t,e){this._super(t,e),this.entities=new pc.LinkedList,this.suicides=new pc.LinkedList},addIfMatched:function(t){for(var e=0;e<this.componentTypes.length;e++)if(t.hasComponentOfType(this.componentTypes[e]))return this.entities.add(t),this.onEntityAdded(t),void 0},add:function(t){this.entities.has(t)||(this.entities.add(t),this.onEntityAdded(t))},remove:function(t){this.entities.remove(t)&&this.onEntityRemoved(t)},removeIfNotMatched:function(t){for(var e=0;e<this.componentTypes.length;e++)if(t.hasComponentOfType(this.componentTypes[e]))return;this.remove(t)},processAll:function(){for(var t=this.entities.first;t;)this.process(t.obj),t=t.next();for(t=this.suicides.first;t;)this.remove(t.obj),t=t.next();this.suicides.clear()},process:function(){},suicide:function(t){this.suicides.add(t)},onEntityAdded:function(){},onEntityRemoved:function(){},onComponentAdded:function(){},onComponentRemoved:function(){}}),define("playcraft/systems/entitysystem",function(){}),pc.CollisionShape={RECT:0,CIRCLE:1,POLY:2},pc.BodyType={ENTITY:0,TILE:1},pc.systems.Physics=pc.systems.EntitySystem.extend("pc.systems.Physics",{SCALE:.1,toP:function(t){return t*this.SCALE},fromP:function(t){return t/this.SCALE}},{world:null,gravity:null,debug:!1,debugDraw:null,init:function(t){this._super(["physics"]),this.gravity=t&&t.gravity?pc.Point.create(pc.checked(t.gravity.x,0),pc.checked(t.gravity.y,0)):pc.Point.create(0,0);var e=new Box2D.Common.Math.b2Vec2(this.gravity.x*this.Class.SCALE,this.gravity.y*this.Class.SCALE);this.world=new Box2D.Dynamics.b2World(e,!0),t&&pc.valid(t.tileCollisionMap)&&(pc.assert(pc.valid(t.tileCollisionMap.tileMap),"A tileMap is required for a tileCollisionMap"),this.addTileCollisionMap(t.tileCollisionMap.tileMap,pc.checked(t.tileCollisionMap.collisionGroup,0),pc.checked(t.tileCollisionMap.collisionCategory,0),pc.checked(t.tileCollisionMap.collisionMask,0)));var o=new Box2D.Dynamics.b2ContactListener;o.BeginContact=this._beginContactListener.bind(this),o.EndContact=this._endContactListener.bind(this),o.PostSolve=this._postSolveListener.bind(this),this.world.SetContactListener(o);var i=Box2D.Dynamics.b2DebugDraw;this.debugDraw=new i,this.debugDraw.SetSprite(pc.device.ctx),this.debugDraw.SetDrawScale(100*this.Class.SCALE),this.debugDraw.SetFillAlpha(.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(i.e_shapeBit|i.e_jointBit|i.e_centerOfMassBit),t&&1==t.debug&&(this.debug=t.debug,this.setDebug(t.debug))},_beginContactListener:function(t){this.onCollisionStart(t.GetFixtureA().GetBody()._pc_bodyType,t.GetFixtureB().GetBody()._pc_bodyType,t.GetFixtureA().GetBody().GetUserData(),t.GetFixtureB().GetBody().GetUserData(),t.GetFixtureA()._pc_type,t.GetFixtureB()._pc_type,t)},_endContactListener:function(t){this.onCollisionEnd(t.GetFixtureA().GetBody()._pc_bodyType,t.GetFixtureB().GetBody()._pc_bodyType,t.GetFixtureA().GetBody().GetUserData(),t.GetFixtureB().GetBody().GetUserData(),t.GetFixtureA()._pc_type,t.GetFixtureB()._pc_type,t)},_postSolveListener:function(t,e){var o=e.normalImpulses[0];this.onCollision(t.GetFixtureA().GetBody()._pc_bodyType,t.GetFixtureB().GetBody()._pc_bodyType,t.GetFixtureA().GetBody().GetUserData(),t.GetFixtureB().GetBody().GetUserData(),o,t.GetFixtureA()._pc_type,t.GetFixtureB()._pc_type,t)},process:function(t){if(t.active){var e=t.getComponent("spatial"),o=t.getComponent("physics");if(o.active){var i=t.getComponent("joint");if(!o._body){var n=new Box2D.Dynamics.b2BodyDef;n.type=o.immovable?Box2D.Dynamics.b2BodyDef.b2_staticBody:n.type=Box2D.Dynamics.b2BodyDef.b2_dynamicBody,o.centered?(n.position.x=this.Class.toP(e.pos.x+e.dim.x/2),n.position.y=this.Class.toP(e.pos.y+e.dim.y/2)):(n.position.x=this.Class.toP(e.pos.x),n.position.y=this.Class.toP(e.pos.y)),n.linearDamping=o.linearDamping,n.angularDamping=o.angularDamping,n.isBullet=o.bullet,n.fixedRotation=o.fixedRotation,o._body=this.world.CreateBody(n),o._body.SetAngle(pc.Math.degToRad(e.dir)),o._body.SetUserData(t),o._body._pc_bodyType=pc.BodyType.ENTITY,o.linearVelocity&&o._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(o.linearVelocity.x*pc.systems.Physics.SCALE,o.linearVelocity.y*pc.systems.Physics.SCALE)),o.gravity&&o.setGravity(o.gravity.x,o.gravity.y),pc.assert(o.shapes.length,"You must specify at least one shape for a physics entity");for(var s=0;s<o.shapes.length;s++){var a=o.shapes[s],r=(e.dim.x+a.offset.w)*this.Class.SCALE,c=(e.dim.y+a.offset.h)*this.Class.SCALE,l=r/2,h=c/2,m=a.offset.x*this.Class.SCALE/2,u=a.offset.y*this.Class.SCALE/2;pc.assert(l>0&&h>0,"Physics requires a spatial size minimum of 1");var p=new Box2D.Dynamics.b2FixtureDef;switch(p.density=o.density,p.friction=o.friction,p.restitution=o.bounce,a.shape){case pc.CollisionShape.CIRCLE:p.shape=new Box2D.Collision.Shapes.b2CircleShape(r/2),p.shape.SetLocalPosition(Box2D.Common.Math.b2Vec2.Get(a.offset.x*this.Class.SCALE,a.offset.y*this.Class.SCALE));break;case pc.CollisionShape.POLY:p.shape=new Box2D.Collision.Shapes.b2PolygonShape;for(var y=[],d=0;d<a.points.length;d++)y.push(Box2D.Common.Math.b2Vec2.Get((a.offset.x+a.points[d][0])*this.Class.SCALE,(a.offset.y+a.points[d][1])*this.Class.SCALE));p.shape.SetAsArray(y,y.length);break;default:p.shape=new Box2D.Collision.Shapes.b2PolygonShape,y=[],y.push(Box2D.Common.Math.b2Vec2.Get(-l+m,-h+u)),y.push(Box2D.Common.Math.b2Vec2.Get(l,-h+u)),y.push(Box2D.Common.Math.b2Vec2.Get(l,h)),y.push(Box2D.Common.Math.b2Vec2.Get(-l+m,h)),p.shape.SetAsArray(y,y.length)}p.filter.groupIndex=a.collisionGroup,p.filter.categoryBits=a.collisionCategory,p.filter.maskBits=a.collisionMask,p.isSensor=a.sensorOnly;var f=o._body.CreateFixture(p);f._pc_type=a.type,o._fixtures.push(f)}if(0!=o.centerOfMass.x||0!=o.centerOfMass.y||-1!=o.mass){var x=new Box2D.Collision.Shapes.b2MassData;x.center=Box2D.Common.Math.b2Vec2.Get(o.centerOfMass.x*pc.systems.Physics.SCALE,o.centerOfMass.y*pc.systems.Physics.SCALE),-1!=o.mass&&(x.mass=o.mass),x.I=1,o._body.SetMassData(x)}else x=new Box2D.Collision.Shapes.b2MassData,x.mass=1,x.I=1,o._body.SetMassData(x);o.torque&&o.applyTorque(o.torque),o.turn&&o.applyTurn(o.turn),o.force&&o.applyForce(o.force),o.impulse&&o.applyImpulse(o.impulse),o._lastSpatialPos=pc.Point.create(e.pos.x,e.pos.y),o._lastSpatialDim=pc.Dim.create(e.dim.x,e.dim.y),o._lastSpatialDir=e.dir}if(i&&!i._joint){var _=i.attachTo.getComponent("physics");if(_._body){var g=null;switch(i.type){case pc.JointType.WELD:g=new Box2D.Dynamics.Joints.b2WeldJointDef,g.bodyA=_._body,g.bodyB=o._body,g.collideConnected=!1,g.localAnchorA.Set(i.offset.x*this.Class.SCALE,i.offset.y*this.Class.SCALE),g.localAnchorB.Set(i.attachmentOffset.x*this.Class.SCALE,i.attachmentOffset.y*this.Class.SCALE),_._body.SetAwake(!0);var b=_._body.GetPosition();o._body.SetPosition({x:b.x+i.offset.x*this.Class.SCALE,y:b.y+i.offset.y*this.Class.SCALE});break;case pc.JointType.DISTANCE:g=new Box2D.Dynamics.Joints.b2DistanceJointDef,g.bodyA=_._body,g.bodyB=o._body,g.frequency=i.frequency,g.dampingRatio=i.dampingRatio,g.collideConnected=!1,g.length=i.distance,g.localAnchorA.Set(i.offset.x*this.Class.SCALE,i.offset.y*this.Class.SCALE),g.localAnchorB.Set(i.attachmentOffset.x*this.Class.SCALE,i.attachmentOffset.y*this.Class.SCALE),_._body.SetAwake(!0),b=_._body.GetPosition(),o._body.SetPosition({x:b.x+i.offset.x*this.Class.SCALE,y:b.y+i.offset.y*this.Class.SCALE});break;case pc.JointType.REVOLUTE:g=new Box2D.Dynamics.Joints.b2RevoluteJointDef,g.bodyA=_._body,g.bodyB=o._body,g.collideConnected=!1,g.referenceAngle=i.angle,g.localAnchorA.Set(i.offset.x*this.Class.SCALE,i.offset.y*this.Class.SCALE),g.localAnchorB.Set(i.attachmentOffset.x*this.Class.SCALE,i.attachmentOffset.y*this.Class.SCALE),_._body.SetAwake(!0),i.enableLimit&&(g.enableLimit=i.enableLimit,g.lowerAngle=pc.Math.degToRad(i.lowerAngleLimit),g.upperAngle=pc.Math.degToRad(i.upperAngleLimit)),i.enableMotor&&(g.enableMotor=i.enableMotor,g.motorSpeed=pc.Math.degToRad(i.motorSpeed),g.maxMotorTorque=i.maxMotorTorque);var D=_._body.GetPosition();o._body.SetPosition({x:D.x+this.Class.toP(i.offset.x),y:D.y+this.Class.toP(i.offset.y)})}if(!g)throw"Invalid attachment config";i._joint=this.world.CreateJoint(g)}}var C=o._body.GetPosition(),B=Math.round(pc.Math.radToDeg(o._body.GetAngle()));if(o._lastSpatialPos.x!=e.pos.x||o._lastSpatialPos.y!=e.pos.y){var v=o._lastSpatialPos.x!=e.pos.x?this.Class.toP(e.pos.x+e.dim.x/2):C.x,S=o._lastSpatialPos.y!=e.pos.y?this.Class.toP(e.pos.y+e.dim.y/2):C.y;o._body.SetPosition(Box2D.Common.Math.b2Vec2.Get(v,S))}if(o._lastSpatialDir!=e.dir&&(o._body.SetAngle(pc.Math.degToRad(e.dir)),B=Math.round(pc.Math.radToDeg(o._body.GetAngle()))),e.pos.x=Math.round(this.Class.fromP(C.x)-e.dim.x/2),e.pos.y=Math.round(this.Class.fromP(C.y)-e.dim.y/2),e.dir=B,o._lastSpatialPos.x=e.pos.x,o._lastSpatialPos.y=e.pos.y,o._lastSpatialDir=B,o.maxSpeed.x>0||o.maxSpeed.y>0){var M=o._body.GetLinearVelocity();if(0!=M.x||0!=M.y){var A=this.Class.toP(o.maxSpeed.x);M.x>0&&M.x>A&&o._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(A,M.y)),M.x<0&&M.x<-A&&o._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(-A,M.y));var w=this.Class.toP(o.maxSpeed.y);M.y>0&&M.y>w&&o._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(M.x,w)),M.y<0&&M.y<-w&&o._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(M.x,-w))}}}}},onOriginChange:function(t,e){this.debugDraw.SetOrigin(t,e)},processAll:function(){this.world.Step(.08,10,10),this.world.DrawDebugData(),this.world.ClearForces(),this._super()},onAddedToLayer:function(t){var e=new Box2D.Collision.b2AABB;e.lowerBound.Set(0,0),e.upperBound.Set(this.Class.toP(t.worldSize.x),this.Class.toP(t.worldSize.y))},setDebug:function(t){t?this.world.SetDebugDraw(this.debugDraw):this.world.SetDebugDraw(null),this.debug=t},getEntitiesInArea:function(t){var e=new Box2D.Collision.b2AABB,o=[];return e.lowerBound.Set(t.x,t.y),e.upperBound.Set(t.w,t.h),this.world.QueryAABB(function(t){return o.push(t.GetBody().GetUserData()),!0},e),o},createStaticBody:function(t,e,o,i,n,s,a){var r=this.Class.toP(o/2),c=this.Class.toP(i/2),l=new Box2D.Dynamics.b2FixtureDef,h=new Box2D.Dynamics.b2BodyDef;h.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,l.shape=new Box2D.Collision.Shapes.b2PolygonShape;var m=[];m.push(Box2D.Common.Math.b2Vec2.Get(-r,-c)),m.push(Box2D.Common.Math.b2Vec2.Get(r,-c)),m.push(Box2D.Common.Math.b2Vec2.Get(r,c)),m.push(Box2D.Common.Math.b2Vec2.Get(-r,c)),l.shape.SetAsArray(m,m.length),l.filter.groupIndex=n,l.filter.categoryBits=s,l.filter.maskBits=a,h.position.x=this.Class.toP(t)+r,h.position.y=this.Class.toP(e)+c;var u=this.world.CreateBody(h);u._pc_bodyType=pc.BodyType.TILE,u.CreateFixture(l)},addTileCollisionMap:function(t,e,o,i){for(var n=0;n<t.tilesHigh;n++)for(var s=0,a=0,r=0;r<t.tilesWide;r++)t.tiles[n][r]>=0?a+=t.tileWidth:(a>0&&(this.createStaticBody(s,n*t.tileHeight,a,t.tileHeight,e,o,i),a=0),s=(r+1)*t.tileWidth)},onCollisionStart:function(){},onCollision:function(){},onCollisionEnd:function(){},onEntityAdded:function(){},onEntityRemoved:function(t){var e=t.getComponent("physics");if(e._body){this.world.DestroyBody(e._body);var o=t.getComponent("attachment");o&&this.world.DestroyJoint(o._joint)}}}),define("playcraft/systems/physics",function(){}),pc.systems.Effects=pc.systems.EntitySystem.extend("pc.systems.Effects",{FadeState:{NOT_STARTED:0,DELAYING:1,FADING_IN:2,HOLDING:3,FADING_OUT:4,DONE:5}},{init:function(){this._super(["fade","spin","scale"])},processAll:function(){for(var t=this.entities.first;t;){var e=t.obj;if(e.active){var o=e.getComponent("fade");if(o&&o.active){var i=e.getComponent("alpha");i||(i=e.addComponent(pc.components.Alpha.create({}))),o.state!=this.Class.FadeState.DONE&&(this._fade(i,o)||e.removeComponent(o))}var n=e.getComponent("spin");if(n&&n.spinning&&n.active){var s=e.getComponent("spatial"),a=n.rate/pc.device.elapsed;n.max>0&&n.spinSoFar+a>=n.max&&(n.spinning=!1,a=n.max-n.spinSoFar),n.spinSoFar+=a,s.setDir(pc.Math.rotate(s.getDir(),n.clockwise?a:-a))}var r=e.getComponent("scale");if(r&&r.scaling&&r.active){s=e.getComponent("spatial"),r._bound||1==r.x&&1==r.y||(s.addScale(r.x,r.y),r._bound=!0,0==r.growX&&0==r.growY&&(r.scaling=!1));var c=r.growX/pc.device.elapsed,l=r.growY/pc.device.elapsed;0!=r.maxX&&r.scaledXSoFar>0&&r.scaledXSoFar+c>=r.maxX&&(c=r.maxX-r.scaledXSoFar),0!=r.maxY&&r.scaledYSoFar>0&&r.scaledYSoFar+l>=r.maxY&&(l=r.maxY-r.scaledYSoFar),0!=c&&0!=l&&(r.scaledXSoFar+=c,r.scaledYSoFar+=l,s.addScale(c,l)),0!=r.maxX&&r.scaledXSoFar>=r.maxX&&0!=r.maxY&&r.scaledYSoFar>=r.maxY&&(r.scaling=!1),r._bound=!0}}t=t.next()}},_fade:function(t,e){var o=pc.device.now-e.startTime;switch(e.state){case this.Class.FadeState.NOT_STARTED:e.startTime=pc.device.now,e.startDelay>0?(e.state=this.Class.FadeState.DELAYING,e.timeLimit=e.startDelay,t.setAlpha(0)):e.fadeInTime>0?(e.state=this.Class.FadeState.FADING_IN,e.timeLimit=e.fadeInTime,t.setAlpha(0)):e.holdTime>0?(e.state=this.Class.FadeState.HOLDING,e.timeLimit=e.holdTime):e.fadeOutTime>0&&(e.state=this.Class.FadeState.FADING_OUT,e.timeLimit=e.fadeOutTime);break;case this.Class.FadeState.DELAYING:o>e.timeLimit&&(e.timeLimit=e.fadeInTime,e.startTime=pc.device.now,e.state=this.Class.FadeState.FADING_IN);break;case this.Class.FadeState.FADING_IN:t.addAlpha(pc.device.elapsed*(100/e.timeLimit)/100),o>e.timeLimit&&(e.timeLimit=e.holdTime,e.startTime=pc.device.now,e.state=this.Class.FadeState.HOLDING);break;case this.Class.FadeState.HOLDING:o>e.timeLimit&&(e.timeLimit=e.fadeOutTime,e.startTime=pc.device.now,e.state=this.Class.FadeState.FADING_OUT);break;case this.Class.FadeState.FADING_OUT:if(o>e.timeLimit){if(e.loopsSoFar++,(e.loops>1||0==e.loops)&&(e.startTime=pc.device.now,e.timeLimit=e.fadeInTime,e.state=this.Class.FadeState.FADING_IN,e.timeLimit>0&&t.setAlpha(0)),e.loopsSoFar>=e.loops&&e.loops)return e.state=this.Class.FadeState.DONE,e.timeLimit>0&&t.setAlpha(0),!1
}else t.subAlpha(pc.device.elapsed*(100/e.timeLimit)/100)}return!0}}),define("playcraft/systems/effects",function(){}),pc.systems.Particles=pc.systems.EntitySystem.extend("pc.systems.Particles",{},{init:function(){this._super(["emitter"])},_drawStartTime:0,process:function(t){if(t.active){var e=t.getComponent("emitter");if(e.active){var o=t.getComponent("spatial");if(o||(o=t.addComponent(new pc.components.Spatial({}))),e){if(!e.active)return;if(e.emitting&&Date.now()-e._lastEmitTime>e.delay&&(0==e.shots||e._shotCount<e.shots)){for(var i=0;i<e.burst;i++){var n=0;0==e.spriteSheet.animations.size()&&(n=pc.Math.rand(0,e.spriteSheet.framesHigh*e.spriteSheet.framesWide-1)),e._particles.add(pc._Particle.create(o.pos.x+e.offsetX+pc.Math.rand(-(e.rangeX/2),e.rangeX/2),o.pos.y+e.offsetY+pc.Math.rand(-(e.rangeY/2),e.rangeY/2),pc.Math.rotate(e.relativeAngle?o.dir:0,pc.Math.rand(e.angleMin,e.angleMax)),pc.Math.randFloat(e.thrustMin,e.thrustMax),pc.Math.randFloat(e.lifeMin,e.lifeMax),pc.Math.randFloat(e.spinMin,e.spinMax),pc.Math.randFloat(e.growXMin,e.growXMax),pc.Math.randFloat(e.growYMin,e.growYMax),pc.Math.randFloat(e.scaleXMin,e.scaleXMax),pc.Math.randFloat(e.scaleYMin,e.scaleYMax),e.fadeInTime,e.fadeOutTime,e.alphaMin,e.alphaMax,e.spriteSheet,e.compositeOperation,n))}e._lastEmitTime=Date.now(),e._shotCount++}for(var s=e._particles.first;s;){var a=s.obj;pc.device.now-a.start>e.thrustTime&&(a.thrust=0);var r=a.thrust*Math.cos(pc.Math.degToRad(a.dir)),c=a.thrust*Math.sin(pc.Math.degToRad(a.dir));if(a.velX+=r*(pc.device.elapsed/1e3)+e.gravityX,a.velY+=c*(pc.device.elapsed/1e3)+e.gravityY,a.velX=pc.Math.limit(a.velX,-e.maxVelX,e.maxVelX),a.velY=pc.Math.limit(a.velY,-e.maxVelY,e.maxVelY),a.x+=a.velX,a.y+=a.velY,a.spin&&(a.rotation=pc.Math.rotate(a.rotation,a.spin*(pc.device.elapsed/1e3))),(0!=a.growXRate||0!=a.growYRate)&&(a.scaleX+=a.growXRate*(pc.device.elapsed/1e3),a.scaleY+=a.growYRate*(pc.device.elapsed/1e3)),0==a.fadeState&&(a.sprite.addAlpha(pc.device.elapsed*(100/a.fadeInTime)/100),pc.device.now-a.fadeStateStart>a.fadeInTime&&(a.fadeState++,a.fadeStateStart=pc.device.now)),1==a.fadeState&&pc.device.now-a.fadeStateStart>a.holdTime&&(a.fadeState++,a.fadeStateStart=pc.device.now),2==a.fadeState&&a.fadeOutTime>0){var l=pc.device.elapsed*(100/a.fadeOutTime)/100;a.sprite.subAlpha(l)}(1!=a.alphaMin||1!=a.alphaMax)&&pc.device.now-a.lastAlpha>e.alphaDelay&&(a.sprite.setAlpha(pc.Math.rand(a.alphaMin,a.alphaMax)),a.lastAlpha=pc.device.now),this.drawStartTime=Date.now(),(1!=a.scaleX||1!=a.scaleY)&&e.spriteSheet.setScale(a.scaleX,a.scaleY),a.sprite.currentAnim?(a.sprite.draw(pc.device.ctx,a.x-t.layer.origin.x-t.layer.scene.viewPort.x,a.y-t.layer.origin.y-t.layer.scene.viewPort.y,a.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime,a.sprite.update(pc.device.elapsed)):(a.sprite.drawFrame(pc.device.ctx,a.frame%e.spriteSheet.framesWide,Math.floor(a.frame/e.spriteSheet.framesWide),a.x-t.layer.origin.x-t.layer.scene.viewPort.x,a.y-t.layer.origin.y-t.layer.scene.viewPort.y,e.rotateSprite?a.rotation:a.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime),(1!=a.scaleX||1!=a.scaleY)&&e.spriteSheet.setScale(1,1),s=s.next(),pc.device.now-a.start>a.lifetime&&(a.release(),e._particles.remove(a))}0!=e.shots&&null==e._particles.first&&e._shotCount>=e.shots&&(e.active=!1)}}}}}),pc._Particle=pc.Pooled.extend("pc._Particle",{create:function(t,e,o,i,n,s,a,r,c,l,h,m,u,p,y,d,f){var x=this._super();return x.x=t,x.y=e,x.dir=o,x.thrust=i,x.frame=f,x.lifetime=n,x.spin=s,x.growXRate=a,x.growYRate=r,x.scaleX=c,x.scaleY=l,null==x.sprite?x.sprite=pc.Sprite.create(y):x.sprite.setSpriteSheet(y),x.start=pc.device.now,x.fadeStart=0,x.velX=0,x.velY=0,x.rotation=0,x.alphaMin=u,x.alphaMax=p,x.lastAlpha=pc.device.now,x.fadeInTime=h,x.fadeOutTime=m,x.holdTime=x.lifetime-(x.fadeInTime+x.fadeOutTime),d?x.sprite.setCompositeOperation(d):x.sprite.setCompositeOperation("source-over"),x.fadeState=1,x.fadeStateStart=pc.device.now,x.fadeInTime>0?(x.fadeState=0,x.sprite.setAlpha(0)):x.sprite.setAlpha(1),x}},{x:0,y:0,dir:0,rotation:0,thrust:0,sprite:null,start:0,frame:0,fadeStart:0,velX:0,velY:0,spin:0,growXRate:0,growYRate:0,scaleX:1,scaleY:1,fadeInTime:0,fadeOutTime:0,fadeStateStart:0,holdTime:0,fadeState:1,alphaMin:1,alphaMax:1,lastAlpha:0}),define("playcraft/systems/particles",function(){}),pc.systems.Input=pc.systems.EntitySystem.extend("pc.systems.Input",{},{init:function(){this._super(["input"])},process:function(t){var e=t.getComponent("input");if(e.active&&!e._bound){var o=t.getComponent("spatial"),i=t;if(e.target&&(i=e.target),e.states)for(var n=0;n<e.states.length;n++)for(var s=e.states[n][1],a=0;a<s.length;a++){var r=o;pc.valid(e.states[n][2])&&0==e.states[n][2]&&(r=null),pc.device.input.bindState(i,e.states[n][0],s[a],r)}if(e.actions)for(i=this,n=0;n<e.actions.length;n++)for(s=e.actions[n][1],a=0;a<s.length;a++)r=o,pc.valid(e.actions[n][2])&&0==e.actions[n][2]&&(r=null),pc.device.input.bindAction(i,e.actions[n][0],s[a],r);e._bound=!0}},onAction:function(){},isInputState:function(t,e){return t.getComponent("input")._bound?pc.device.input.isInputState(t,e):!1}}),define("playcraft/systems/input",function(){}),pc.systems.Expiration=pc.systems.EntitySystem.extend("pc.systems.Expiration",{},{init:function(){this._super(["expiry"])},process:function(t){var e=t.getComponent("expiry");e.active&&(e.decrease(pc.device.elapsed),e.hasExpired()&&t.remove())}}),define("playcraft/systems/expiry",function(){}),pc.systems.Activation=pc.systems.EntitySystem.extend("pc.systems.Activation",{},{init:function(t){this._super(["activator"],t)},onEntityAdded:function(t){t.active=!1},process:function(t){var e=t.getComponent("activator");if(e.active&&(!t.active||!e.stayActive)){e._cacheLayer||(e._cacheLayer=e.layer?t.layer.scene.get(e.layer):t.layer);var o=e._cacheLayer.getEntityManager().getTagged(e.tag);if(o)for(var i=o.first;i;){var n=t.getComponent("spatial"),s=i.object().getComponent("spatial"),a=n.getCenterPos().distance(s.getCenterPos());t.active?a>=e.range&&(t.active=!1):a<e.range&&(t.active=!0),i=i.next()}}}}),define("playcraft/systems/activation",function(){}),pc.systems.Render=pc.systems.EntitySystem.extend("pc.systems.Render",{},{init:function(){this._super(["sprite","overlay","rect","text","poly","circle"])},processAll:function(){for(var t=Date.now(),e=this.entities.first;e;){var o=e.obj;if(o.active){var i=o.getComponent("spatial"),n=o.getComponent("alpha"),s=o.getComponent("clip"),a=o.layer.screenX(i.pos.x),r=o.layer.screenY(i.pos.y),c=i.getUnscaledPos(),l=i.getUnscaledDim(),h=pc.device.ctx;if(h.save(),(1!=i.scaleX||1!=i.scaleY)&&(a=o.layer.screenX(c.x),r=o.layer.screenY(c.y),h.scale(i.scaleX,i.scaleY)),o.layer.scene.viewPort.overlaps(a,r,i.dim.x,i.dim.y,0,i.dir)){if(s&&s.active){if(h.beginPath(),s.clipEntity){var m=s.clipEntity.getComponent("spatial");h.rect(o.layer.screenX(m.pos.x)+s.x,o.layer.screenY(m.pos.y)+s.y,m.dim.x+s.w,m.dim.y+s.h)}else h.rect(o.layer.screenX(i.pos.x)+s.x,o.layer.screenY(i.pos.y)+s.y,s.w,s.h);h.closePath(),h.clip()}var u=o.getComponent("originshifter");if(u&&u.active){var p=i.pos.x-u._offsetX,y=i.pos.y-u._offsetY;u._offsetX=this.layer.origin.x*u.ratio,u._offsetY=this.layer.origin.y*u.ratio,i.pos.x=p+u._offsetX,i.pos.y=y+u._offsetY}var d=o.getComponent("sprite");d&&d.active&&(d.sprite.update(pc.device.elapsed),n&&1!=n.level&&0!=n.level&&(d.sprite.alpha=n.level),(1!=i.scaleX||1!=i.scaleY)&&d.sprite.setScale(i.scaleX,i.scaleY),d.sprite.draw(h,a+d.offset.x,r+d.offset.y,i.dir),(1!=i.scaleX||1!=i.scaleY)&&d.sprite.setScale(1,1));var f=o.getComponent("overlay");f&&f.active&&(f.sprite.update(pc.device.elapsed),n&&(f.sprite.alpha=n.level),f.sprite.draw(h,a,r,i.dir),f.decrease(pc.device.elapsed),f.hasExpired()&&o.removeComponent(f));var x=e.obj.getComponent("rect");x&&x.active&&(h.save(),n&&(h.globalAlpha=n.level),h.translate(a+l.x/2,r+l.y/2),h.rotate(i.dir*(Math.PI/180)),x.cornerRadius>0?(-l.x/2,-l.y/2,h.beginPath(),h.moveTo(-l.x/2+x.cornerRadius,-l.y),h.lineTo(a+l.x-x.cornerRadius,r),h.quadraticCurveTo(a+l.x,r,a+l.x,r+x.cornerRadius),h.lineTo(a+l.x,r+l.y-x.cornerRadius),h.quadraticCurveTo(a+l.x,r+l.y,a+l.x-x.cornerRadius,r+l.y),h.lineTo(a+x.cornerRadius,r+l.y),h.quadraticCurveTo(a,r+l.y,a,r+l.y-x.cornerRadius),h.lineTo(a,r+x.cornerRadius),h.quadraticCurveTo(a,r,a+x.cornerRadius,r),h.closePath(),x.color&&(h.fillStyle=x.color.color,h.fill()),x.lineColor&&x.lineWidth&&(h.lineWidth=x.lineWidth,h.strokeStyle=x.lineColor.color,h.stroke())):(x.color&&(h.fillStyle=x.color.color,h.fillRect(-l.x/2,-l.y/2,l.x,l.y)),x.lineColor&&x.lineWidth&&(h.lineWidth=x.lineWidth,h.strokeStyle=x.lineColor.color,h.strokeRect(-l.x/2,-l.y/2,l.x,l.y))),n&&(h.globalAlpha=1),h.restore(),pc.device.elementsDrawn++);var _=e.obj.getComponent("circle");_&&_.active&&(h.save(),h.lineWidth=_.lineWidth,n&&(h.globalAlpha=n.level),h.translate(a+i.dim.x/2,r+i.dim.y/2),h.rotate(i.dir*(Math.PI/180)),h.beginPath(),h.arc(0,0,i.dim.x/2,0,2*pc.Math.PI,!0),h.closePath(),_.color&&(h.fillStyle=_.color.color,h.fill()),_.lineColor&&(h.lineWidth=_.lineWidth,h.strokeStyle=_.lineColor.color,h.stroke()),n&&(h.globalAlpha=1),h.restore(),pc.device.elementsDrawn++);var g=e.obj.getComponent("poly");if(g&&g.active){h.save(),n&&(h.globalAlpha=n.level);var b=i.dim.x/2,D=i.dim.y/2;h.translate(a+b,r+D),h.rotate(i.dir*(Math.PI/180)),h.beginPath(),h.moveTo(g.points[0][0]-b,g.points[0][1]-D);for(var C=1;C<g.points.length;C++)h.lineTo(g.points[C][0]-b,g.points[C][1]-D);h.closePath(),g.color&&(h.fillStyle=g.color.color,h.fill()),g.lineColor&&(h.lineWidth=g.lineWidth,h.strokeStyle=g.lineColor.color,h.stroke()),n&&(h.globalAlpha=1),h.restore(),pc.device.elementsDrawn++}var B=o.getComponent("text");if(B&&B.active){h.save();var v=0;n&&(h.globalAlpha=n.level),b=i.dim.x/2,D=i.dim.y/2,h.font=B._fontCache,h.lineWidth=B.lineWidth,h.translate(a+b,r+D),h.rotate(i.dir*(Math.PI/180));for(var S=0;S<B.text.length;S++)B.color&&(h.fillStyle=B.color.color,h.fillText(B.text[S],B.offset.x-b,v+i.dim.y+B.offset.y-D)),B.strokeColor&&B.lineWidth&&(h.strokeStyle=B.strokeColor.color,h.strokeText(B.text[S],B.offset.x-b,v+i.dim.y+B.offset.y-D)),v+=1.1*B.fontHeight;n&&(h.globalAlpha=1),pc.device.elementsDrawn++,h.restore()}h.restore()}}e=e.next()}pc.device.lastDrawMS+=Date.now()-t}}),define("playcraft/systems/render",function(){}),pc.systems.Layout=pc.systems.EntitySystem.extend("pc.systems.Layout",{},{margin:null,init:function(t){this._super(["layout"]),this.margin={},pc.checked(t)&&pc.checked(t.margin)?(this.margin.left=pc.checked(t.margin.left,0),this.margin.right=pc.checked(t.margin.right,0),this.margin.top=pc.checked(t.margin.top,0),this.margin.bottom=pc.checked(t.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0)},_getAnchorLocation:function(t,e){if("left"===t){if("top"===e)return"top-left";if("middle"===e)return"middle-left";if("bottom"===e)return"bottom-left"}if("center"===t){if("top"===e)return"top-center";if("middle"===e)return"middle-center";if("bottom"===e)return"bottom-center"}if("right"===t){if("top"===e)return"top-right";if("middle"===e)return"middle-right";if("bottom"===e)return"bottom-right"}return null},doLayout:function(){for(var t=new pc.HashList,e=this.entities.first;e;){var o=e.obj,i=o.getComponent("spatial");i||o.addComponent(pc.components.Spatial({}));var n=o.getComponent("layout"),s=this._getAnchorLocation(n.horizontal,n.vertical);t.add(s,e.obj),e=e.next()}for(var a=t.hashtable.keys(),r=0;r<a.length;r++){var c=a[r],l=t.get(a[r]),h=this._getEntityDimensions(l),m=this.margin.left,u=this.margin.top;switch(c){case"top-left":break;case"middle-left":u+=this.layer.getScreenRect().h/2-h.y/2;break;case"bottom-left":u=this.layer.getScreenRect().h-h.y-this.margin.bottom;break;case"top-center":m+=this.layer.getScreenRect().w/2-h.x/2;break;case"middle-center":m+=this.layer.getScreenRect().w/2-h.x/2,u+=this.layer.getScreenRect().h/2-h.y/2;break;case"bottom-center":m=this.layer.getScreenRect().w/2-h.x/2-this.margin.bottom,u+=this.layer.getScreenRect().h-h.y;break;case"top-right":m+=this.layer.getScreenRect().w-h.x;break;case"middle-right":m+=this.layer.getScreenRect().w-h.x,u+=this.layer.getScreenRect().h/2-h.y/2;break;case"bottom-right":m+=this.layer.getScreenRect().w-h.x,u=this.layer.getScreenRect().h-h.y-this.margin.bottom}for(var p=l.first;p;){switch(o=p.obj,i=o.getComponent("spatial"),n=o.getComponent("layout"),u+=n.margin.top,c){case"top-left":case"middle-left":case"bottom-left":m=n.margin.left+this.margin.left;break;case"top-center":case"middle-center":case"bottom-center":m=n.margin.left+this.layer.getScreenRect().w/2-i.dim.x/2;break;case"top-right":case"middle-right":case"bottom-right":m=this.layer.getScreenRect().w-i.dim.x-n.margin.right-this.margin.right}i.pos.x=m,i.pos.y=u,u+=i.dim.y+n.margin.bottom,p=p.next()}}},_entityDim:null,_getEntityDimensions:function(t){this._entityDim||(this._entityDim=new pc.Dim),this._entityDim.x=0,this._entityDim.y=0;for(var e=t.first;e;){var o=e.obj.getComponent("spatial"),i=e.obj.getComponent("layout");o&&(this._entityDim.x+=i.margin.left+o.dim.x+i.margin.right,this._entityDim.y+=i.margin.top+o.dim.y+i.margin.bottom),e=e.nextLinked}return this._entityDim},onResize:function(){this.doLayout()},onEntityAdded:function(){this._super(),this.doLayout()},onEntityRemoved:function(){this._super(),this.doLayout()},onComponentAdded:function(){this._super(),this.doLayout()}}),define("playcraft/systems/layout",function(){}),window.pc||(window.pc={},pc.VERSION="0.5.6"),define("pc",["playcraft/ext/gamecore.js/src/gamecore","playcraft/ext/gamecore.js/src/class","playcraft/ext/gamecore.js/src/base","playcraft/ext/gamecore.js/src/jhashtable","playcraft/ext/gamecore.js/src/device","playcraft/ext/gamecore.js/src/perf","playcraft/ext/gamecore.js/src/linkedlist","playcraft/ext/gamecore.js/src/hashlist","playcraft/ext/gamecore.js/src/stacktrace","playcraft/ext/gamecore.js/src/pooled","playcraft/ext/box2dweb.2.1a-pc","playcraft/boot","playcraft/input","playcraft/hashmap","playcraft/tools","playcraft/color","playcraft/debug","playcraft/device","playcraft/sound","playcraft/layer","playcraft/entitylayer","playcraft/tileset","playcraft/tilemap","playcraft/tilelayer","playcraft/hextilelayer","playcraft/entity","playcraft/sprite","playcraft/spritesheet","playcraft/math","playcraft/image","playcraft/scene","playcraft/game","playcraft/loader","playcraft/dataresource","playcraft/components/component","playcraft/components/physics","playcraft/components/alpha","playcraft/components/joint","playcraft/components/expiry","playcraft/components/originshifter","playcraft/components/spatial","playcraft/components/overlay","playcraft/components/clip","playcraft/components/activator","playcraft/components/input","playcraft/components/fade","playcraft/components/spin","playcraft/components/scale","playcraft/components/rect","playcraft/components/poly","playcraft/components/circle","playcraft/components/text","playcraft/components/sprite","playcraft/components/layout","playcraft/components/particleemitter","playcraft/systems/system","playcraft/es/entitymanager","playcraft/es/systemmanager","playcraft/systems/entitysystem","playcraft/systems/physics","playcraft/systems/effects","playcraft/systems/particles","playcraft/systems/input","playcraft/systems/expiry","playcraft/systems/activation","playcraft/systems/render","playcraft/systems/layout"],function(){return window.pc}),function(t){function e(t,e,o){for(var i=(o||0)-1,n=t.length;++i<n;)if(t[i]===e)return i;return-1}function o(t,o){var i=typeof o;if(t=t.cache,"boolean"==i||null==o)return t[o];"number"!=i&&"string"!=i&&(i="object");var n="number"==i?o:D+o;return t=t[i]||(t[i]={}),"object"==i?t[n]&&e(t[n],o)>-1?0:-1:t[n]?0:-1}function i(t){var e=this.cache,o=typeof t;if("boolean"==o||null==t)e[t]=!0;else{"number"!=o&&"string"!=o&&(o="object");var i="number"==o?t:D+t,n=e[o]||(e[o]={});"object"==o?(n[i]||(n[i]=[])).push(t)==this.array.length&&(e[o]=!1):n[i]=!0}}function n(t){return t.charCodeAt(0)}function s(t,e){var o=t.index,i=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||"undefined"==typeof t)return 1;if(e>t||"undefined"==typeof e)return-1}return i>o?-1:1}function a(t){var e=-1,o=t.length,n=l();n["false"]=n["null"]=n["true"]=n.undefined=!1;var s=l();for(s.array=t,s.cache=n,s.push=i;++e<o;)s.push(t[e]);return n.object===!1?(p(s),null):s}function r(t){return"\\"+Q[t]}function c(){return x.pop()||[]}function l(){return _.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,undefined:!1,useHas:!1,useKeys:!1,value:null}}function h(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function m(){}function u(t){t.length=0,x.length<B&&x.push(t)}function p(t){var e=t.cache;e&&p(e),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,_.length<B&&_.push(t)}function y(t,e,o){e||(e=0),"undefined"==typeof o&&(o=t?t.length:0);for(var i=-1,n=o-e||0,s=Array(0>n?0:n);++i<n;)s[i]=t[e+i];return s}function d(i){function x(t){return t&&"object"==typeof t&&!ji(t)&&fi.call(t,"__wrapped__")?t:new _(t)}function _(t){this.__wrapped__=t}function B(t,e,o,i){function n(){var i=arguments,l=a?this:e;if(s||(t=e[r]),o.length&&(i=i.length?(i=Pi.call(i),c?i.concat(o):o.concat(i)):o),this instanceof n){l=te(t.prototype);var h=t.apply(l,i);return Ce(h)?h:l}return t.apply(l,i)}var s=De(t),a=!o,r=e;if(a){var c=i;o=e}else if(!s){if(!i)throw new ii;e=t}return n}function Q(){var t=l();t.shadowedProps=F,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!Wi;for(var e,o=0;e=arguments[o];o++)for(var i in e)t[i]=e[i];var n=t.args;t.firstArg=/^[^,]+/.exec(n)[0];var s=$o("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+n+") {\n"+Ni(t)+"\n}");return p(t),s(X,si,fi,ce,ji,Ae,Wi,x,ai,Z,Ei,K,ri,Di)}function te(t){return Ce(t)?Bi(t):{}}function oe(t){return zi[t]}function ne(){var t=(t=x.indexOf)===so?e:t;return t}function se(t){return function(e,o,i,n){return"boolean"!=typeof o&&null!=o&&(n=i,i=n&&n[o]===e?f:o,o=!1),null!=i&&(i=x.createCallback(i,n)),t(e,o,i,n)}}function ae(t){var e,o;return!t||Di.call(t)!=q||(e=t.constructor,De(e)&&!(e instanceof e))||!Ri.argsClass&&ce(t)||!Ri.nodeClass&&h(t)?!1:Ri.ownLast?(Ki(t,function(t,e,i){return o=fi.call(i,e),!1}),o!==!1):(Ki(t,function(t,e){o=e}),o===f||fi.call(t,o))}function re(t){return Ui[t]}function ce(t){return Di.call(t)==O}function le(t,e,o,i,n,s){var a=t;if("boolean"!=typeof e&&null!=e&&(i=o,o=e,e=!1),"function"==typeof o){if(o="undefined"==typeof i?o:x.createCallback(o,i,1),a=o(a),"undefined"!=typeof a)return a;a=t}var r=Ce(a);if(r){var l=Di.call(a);if(!$[l]||!Ri.nodeClass&&h(a))return a;var m=ji(a)}if(!r||!e)return r?m?y(a):qi({},a):a;var p=ki[l];switch(l){case Y:case W:return new p(+a);case U:case K:return new p(a);case H:return p(a.source,T.exec(a))}var d=!n;n||(n=c()),s||(s=c());for(var _=n.length;_--;)if(n[_]==t)return s[_];return a=m?p(a.length):{},m&&(fi.call(t,"index")&&(a.index=t.index),fi.call(t,"input")&&(a.input=t.input)),n.push(t),s.push(a),(m?Xi:$i)(t,function(t,i){a[i]=le(t,e,o,f,n,s)}),d&&(u(n),u(s)),a}function he(t,e,o){return le(t,!0,e,o)}function me(t,e,o){var i;return e=x.createCallback(e,o),$i(t,function(t,o,n){return e(t,o,n)?(i=o,!1):void 0}),i}function ue(t){var e=[];return Ki(t,function(t,o){De(t)&&e.push(o)}),e.sort()}function pe(t,e){return t?fi.call(t,e):!1}function ye(t){for(var e=-1,o=Wi(t),i=o.length,n={};++e<i;){var s=o[e];n[t[s]]=s}return n}function de(t){return t===!0||t===!1||Di.call(t)==Y}function fe(t){return t?"object"==typeof t&&Di.call(t)==W:!1}function xe(t){return t?1===t.nodeType:!1}function _e(t){var e=!0;if(!t)return e;var o=Di.call(t),i=t.length;return o==j||o==K||(Ri.argsClass?o==O:ce(t))||o==q&&"number"==typeof i&&De(t.splice)?!i:($i(t,function(){return e=!1}),e)}function ge(t,e,o,i,n,s){var a=o===b;if("function"==typeof o&&!a){o=x.createCallback(o,i,2);var r=o(t,e);if("undefined"!=typeof r)return!!r}if(t===e)return 0!==t||1/t==1/e;var l=typeof t,m=typeof e;if(t===t&&(!t||"function"!=l&&"object"!=l)&&(!e||"function"!=m&&"object"!=m))return!1;if(null==t||null==e)return t===e;var p=Di.call(t),y=Di.call(e);if(p==O&&(p=q),y==O&&(y=q),p!=y)return!1;switch(p){case Y:case W:return+t==+e;case U:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case H:case K:return t==oi(e)}var d=p==j;if(!d){if(fi.call(t,"__wrapped__ ")||fi.call(e,"__wrapped__"))return ge(t.__wrapped__||t,e.__wrapped__||e,o,i,n,s);if(p!=q||!Ri.nodeClass&&(h(t)||h(e)))return!1;var f=!Ri.argsObject&&ce(t)?ti:t.constructor,_=!Ri.argsObject&&ce(e)?ti:e.constructor;if(f!=_&&!(De(f)&&f instanceof f&&De(_)&&_ instanceof _))return!1}var g=!n;n||(n=c()),s||(s=c());for(var D=n.length;D--;)if(n[D]==t)return s[D]==e;var C=0;if(r=!0,n.push(t),s.push(e),d){if(D=t.length,C=e.length,r=C==t.length,!r&&!a)return r;for(;C--;){var B=D,v=e[C];if(a)for(;B--&&!(r=ge(t[B],v,o,i,n,s)););else if(!(r=ge(t[C],v,o,i,n,s)))break}return r}return Ki(e,function(e,a,c){return fi.call(c,a)?(C++,r=fi.call(t,a)&&ge(t[a],e,o,i,n,s)):void 0}),r&&!a&&Ki(t,function(t,e,o){return fi.call(o,e)?r=--C>-1:void 0}),g&&(u(n),u(s)),r}function be(t){return Si(t)&&!Mi(parseFloat(t))}function De(t){return"function"==typeof t}function Ce(t){return!(!t||!Z[typeof t])}function Be(t){return Se(t)&&t!=+t}function ve(t){return null===t}function Se(t){return"number"==typeof t||Di.call(t)==U}function Me(t){return!(!t||!Z[typeof t])&&Di.call(t)==H}function Ae(t){return"string"==typeof t||Di.call(t)==K}function we(t){return"undefined"==typeof t}function Te(t,e,o){var i=arguments,n=0,s=2;if(!Ce(t))return t;if(o===b)var a=i[3],r=i[4],l=i[5];else{var h=!0;r=c(),l=c(),"number"!=typeof o&&(s=i.length),s>3&&"function"==typeof i[s-2]?a=x.createCallback(i[--s-1],i[s--],2):s>2&&"function"==typeof i[s-1]&&(a=i[--s])}for(;++n<s;)(ji(i[n])?Oe:$i)(i[n],function(e,o){var i,n,s=e,c=t[o];if(e&&((n=ji(e))||Zi(e))){for(var h=r.length;h--;)if(i=r[h]==e){c=l[h];break}if(!i){var m;a&&(s=a(c,e),(m="undefined"!=typeof s)&&(c=s)),m||(c=n?ji(c)?c:[]:Zi(c)?c:{}),r.push(e),l.push(c),m||(c=Te(c,e,b,a,r,l))}}else a&&(s=a(c,e),"undefined"==typeof s&&(s=e)),"undefined"!=typeof s&&(c=s);t[o]=c});return h&&(u(r),u(l)),t}function Ve(t,e,o){var i=ne(),n="function"==typeof e,s={};if(n)e=x.createCallback(e,o);else var a=ui.apply(ni,Pi.call(arguments,1));return Ki(t,function(t,o,r){(n?!e(t,o,r):i(a,o)<0)&&(s[o]=t)}),s}function Le(t){for(var e=-1,o=Wi(t),i=o.length,n=Uo(i);++e<i;){var s=o[e];n[e]=[s,t[s]]}return n}function Pe(t,e,o){var i={};if("function"!=typeof e)for(var n=-1,s=ui.apply(ni,Pi.call(arguments,1)),a=Ce(t)?s.length:0;++n<a;){var r=s[n];r in t&&(i[r]=t[r])}else e=x.createCallback(e,o),Ki(t,function(t,o,n){e(t,o,n)&&(i[o]=t)});return i}function Ie(t,e,o,i){var n=ji(t);if(e=x.createCallback(e,i,4),null==o)if(n)o=[];else{var s=t&&t.constructor,a=s&&s.prototype;o=te(a)}return(n?Xi:$i)(t,function(t,i,n){return e(o,t,i,n)}),o}function Ge(t){for(var e=-1,o=Wi(t),i=o.length,n=Uo(i);++e<i;)n[e]=t[o[e]];return n}function ke(t){var e=-1,o=ui.apply(ni,Pi.call(arguments,1)),i=o.length,n=Uo(i);for(Ri.unindexedChars&&Ae(t)&&(t=t.split(""));++e<i;)n[e]=t[o[e]];return n}function Ee(t,e,o){var i=-1,n=ne(),s=t?t.length:0,a=!1;return o=(0>o?wi(0,s+o):o)||0,s&&"number"==typeof s?a=(Ae(t)?t.indexOf(e,o):n(t,e,o))>-1:Xi(t,function(t){return++i>=o?!(a=t===e):void 0}),a}function Re(t,e,o){var i={};return e=x.createCallback(e,o),Oe(t,function(t,o,n){o=oi(e(t,o,n)),fi.call(i,o)?i[o]++:i[o]=1}),i}function Ne(t,e,o){var i=!0;if(e=x.createCallback(e,o),ji(t))for(var n=-1,s=t.length;++n<s&&(i=!!e(t[n],n,t)););else Xi(t,function(t,o,n){return i=!!e(t,o,n)});return i}function Fe(t,e,o){var i=[];if(e=x.createCallback(e,o),ji(t))for(var n=-1,s=t.length;++n<s;){var a=t[n];e(a,n,t)&&i.push(a)}else Xi(t,function(t,o,n){e(t,o,n)&&i.push(t)});return i}function Je(t,e,o){if(e=x.createCallback(e,o),!ji(t)){var i;return Xi(t,function(t,o,n){return e(t,o,n)?(i=t,!1):void 0}),i}for(var n=-1,s=t.length;++n<s;){var a=t[n];if(e(a,n,t))return a}}function Oe(t,e,o){if(e&&"undefined"==typeof o&&ji(t))for(var i=-1,n=t.length;++i<n&&e(t[i],i,t)!==!1;);else Xi(t,e,o);return t}function je(t,e,o){var i={};return e=x.createCallback(e,o),Oe(t,function(t,o,n){o=oi(e(t,o,n)),(fi.call(i,o)?i[o]:i[o]=[]).push(t)}),i}function Ye(t,e){var o=Pi.call(arguments,2),i=-1,n="function"==typeof e,s=t?t.length:0,a=Uo("number"==typeof s?s:0);return Oe(t,function(t){a[++i]=(n?e:t[e]).apply(t,o)}),a}function We(t,e,o){var i=-1,n=t?t.length:0,s=Uo("number"==typeof n?n:0);if(e=x.createCallback(e,o),ji(t))for(;++i<n;)s[i]=e(t[i],i,t);else Xi(t,function(t,o,n){s[++i]=e(t,o,n)});return s}function Xe(t,e,o){var i=-1/0,s=i;if(!e&&ji(t))for(var a=-1,r=t.length;++a<r;){var c=t[a];c>s&&(s=c)}else e=!e&&Ae(t)?n:x.createCallback(e,o),Xi(t,function(t,o,n){var a=e(t,o,n);a>i&&(i=a,s=t)});return s}function ze(t,e,o){var i=1/0,s=i;if(!e&&ji(t))for(var a=-1,r=t.length;++a<r;){var c=t[a];s>c&&(s=c)}else e=!e&&Ae(t)?n:x.createCallback(e,o),Xi(t,function(t,o,n){var a=e(t,o,n);i>a&&(i=a,s=t)});return s}function Ue(t,e,o,i){var n=arguments.length<3;if(e=x.createCallback(e,i,4),ji(t)){var s=-1,a=t.length;for(n&&(o=t[++s]);++s<a;)o=e(o,t[s],s,t)}else Xi(t,function(t,i,s){o=n?(n=!1,t):e(o,t,i,s)});return o}function qe(t,e,o,i){var n=t,s=t?t.length:0,a=arguments.length<3;if("number"!=typeof s){var r=Wi(t);s=r.length}else Ri.unindexedChars&&Ae(t)&&(n=t.split(""));return e=x.createCallback(e,i,4),Oe(t,function(t,i,c){i=r?r[--s]:--s,o=a?(a=!1,n[i]):e(o,n[i],i,c)}),o}function He(t,e,o){return e=x.createCallback(e,o),Fe(t,function(t,o,i){return!e(t,o,i)})}function Ke(t){var e=-1,o=t?t.length:0,i=Uo("number"==typeof o?o:0);return Oe(t,function(t){var o=pi(Li()*(++e+1));i[e]=i[o],i[o]=t}),i}function $e(t){var e=t?t.length:0;return"number"==typeof e?e:Wi(t).length}function Ze(t,e,o){var i;if(e=x.createCallback(e,o),ji(t))for(var n=-1,s=t.length;++n<s&&!(i=e(t[n],n,t)););else Xi(t,function(t,o,n){return!(i=e(t,o,n))});return!!i}function Qe(t,e,o){var i=-1,n=t?t.length:0,a=Uo("number"==typeof n?n:0);for(e=x.createCallback(e,o),Oe(t,function(t,o,n){var s=a[++i]=l();s.criteria=e(t,o,n),s.index=i,s.value=t}),n=a.length,a.sort(s);n--;){var r=a[n];a[n]=r.value,p(r)}return a}function to(t){return t&&"number"==typeof t.length?Ri.unindexedChars&&Ae(t)?t.split(""):y(t):Ge(t)}function eo(t){for(var e=-1,o=t?t.length:0,i=[];++e<o;){var n=t[e];n&&i.push(n)}return i}function oo(t){var i=-1,n=ne(),s=t?t.length:0,r=ui.apply(ni,Pi.call(arguments,1)),c=[],l=s>=C&&n===e;if(l){var h=a(r);h?(n=o,r=h):l=!1}for(;++i<s;){var m=t[i];n(r,m)<0&&c.push(m)}return l&&p(r),c}function io(t,e,o){var i=-1,n=t?t.length:0;for(e=x.createCallback(e,o);++i<n;)if(e(t[i],i,t))return i;return-1}function no(t,e,o){if(t){var i=0,n=t.length;if("number"!=typeof e&&null!=e){var s=-1;for(e=x.createCallback(e,o);++s<n&&e(t[s],s,t);)i++}else if(i=e,null==i||o)return t[0];return y(t,0,Ti(wi(0,i),n))}}function so(t,o,i){if("number"==typeof i){var n=t?t.length:0;i=0>i?wi(0,n+i):i||0}else if(i){var s=uo(t,o);return t[s]===o?s:-1}return t?e(t,o,i):-1}function ao(t,e,o){if(!t)return[];var i=0,n=t.length;if("number"!=typeof e&&null!=e){var s=n;for(e=x.createCallback(e,o);s--&&e(t[s],s,t);)i++}else i=null==e||o?1:e||i;return y(t,0,Ti(wi(0,n-i),n))}function ro(t){for(var i=arguments,n=i.length,s=-1,r=c(),l=-1,h=ne(),m=t?t.length:0,y=[],d=c();++s<n;){var f=i[s];r[s]=h===e&&(f?f.length:0)>=C&&a(s?i[s]:d)}t:for(;++l<m;){var x=r[0];if(f=t[l],(x?o(x,f):h(d,f))<0){for(s=n,(x||d).push(f);--s;)if(x=r[s],(x?o(x,f):h(i[s],f))<0)continue t;y.push(f)}}for(;n--;)x=r[n],x&&p(x);return u(r),u(d),y}function co(t,e,o){if(t){var i=0,n=t.length;if("number"!=typeof e&&null!=e){var s=n;for(e=x.createCallback(e,o);s--&&e(t[s],s,t);)i++}else if(i=e,null==i||o)return t[n-1];return y(t,wi(0,n-i))}}function lo(t,e,o){var i=t?t.length:0;for("number"==typeof o&&(i=(0>o?wi(0,i+o):Ti(o,i-1))+1);i--;)if(t[i]===e)return i;return-1}function ho(t,e,o){t=+t||0,o=+o||1,null==e&&(e=t,t=0);for(var i=-1,n=wi(0,hi((e-t)/o)),s=Uo(n);++i<n;)s[i]=t,t+=o;return s}function mo(t,e,o){if("number"!=typeof e&&null!=e){var i=0,n=-1,s=t?t.length:0;for(e=x.createCallback(e,o);++n<s&&e(t[n],n,t);)i++}else i=null==e||o?1:wi(0,e);return y(t,i)}function uo(t,e,o,i){var n=0,s=t?t.length:n;for(o=o?x.createCallback(o,i,1):ko,e=o(e);s>n;){var a=n+s>>>1;o(t[a])<e?n=a+1:s=a}return n}function po(t){return ji(t)||(arguments[0]=t?Pi.call(t):ni),on(ui.apply(ni,arguments))}function yo(t){for(var e=-1,o=t?Xe(Qi(t,"length")):0,i=Uo(0>o?0:o);++e<o;)i[e]=Qi(t,e);return i}function fo(t){return oo(t,Pi.call(arguments,1))}function xo(t){return t?yo(arguments):[]}function _o(t,e){for(var o=-1,i=t?t.length:0,n={};++o<i;){var s=t[o];e?n[s]=e[o]:n[s[0]]=s[1]}return n}function go(t,e){return 1>t?e():function(){return--t<1?e.apply(this,arguments):void 0}}function bo(t,e){return Ri.fastBind||Ci&&arguments.length>2?Ci.call.apply(Ci,arguments):B(t,e,Pi.call(arguments,2))}function Do(t){for(var e=arguments.length>1?ui.apply(ni,Pi.call(arguments,1)):ue(t),o=-1,i=e.length;++o<i;){var n=e[o];t[n]=bo(t[n],t)}return t}function Co(t,e){return B(t,e,Pi.call(arguments,2),b)}function Bo(){var t=arguments;return function(){for(var e=arguments,o=t.length;o--;)e=[t[o].apply(this,e)];return e[0]}}function vo(t,e,o){if(null==t)return ko;var i=typeof t;if("function"!=i){if("object"!=i)return function(e){return e[t]};var n=Wi(t);return function(e){for(var o=n.length,i=!1;o--&&(i=ge(e[n[o]],t[n[o]],b)););return i}}return"undefined"==typeof e||L&&!L.test(yi.call(t))?t:1===o?function(o){return t.call(e,o)}:2===o?function(o,i){return t.call(e,o,i)}:4===o?function(o,i,n,s){return t.call(e,o,i,n,s)}:function(o,i,n){return t.call(e,o,i,n)}}function So(t,e,o){function i(){mi(u),mi(p),l=0,u=p=null}function n(){var e=y&&(!d||l>1);i(),e&&(m!==!1&&(h=new Ho),r=t.apply(c,a))}function s(){i(),(y||m!==e)&&(h=new Ho,r=t.apply(c,a))}var a,r,c,l=0,h=0,m=!1,u=null,p=null,y=!0;if(e=wi(0,e||0),o===!0){var d=!0;y=!1}else Ce(o)&&(d=o.leading,m="maxWait"in o&&wi(e,o.maxWait||0),y="trailing"in o?o.trailing:y);return function(){if(a=arguments,c=this,l++,mi(p),m===!1)d&&2>l&&(r=t.apply(c,a));else{var o=new Ho;u||d||(h=o);var i=m-(o-h);0>=i?(mi(u),u=null,h=o,r=t.apply(c,a)):u||(u=bi(s,i))}return e!==m&&(p=bi(n,e)),r}}function Mo(t){var e=Pi.call(arguments,1);return bi(function(){t.apply(f,e)},1)}function Ao(t,e){var o=Pi.call(arguments,2);return bi(function(){t.apply(f,o)},e)}function wo(t,e){function o(){var i=o.cache,n=D+(e?e.apply(this,arguments):arguments[0]);return fi.call(i,n)?i[n]:i[n]=t.apply(this,arguments)}return o.cache={},o}function To(t){var e,o;return function(){return e?o:(e=!0,o=t.apply(this,arguments),t=null,o)}}function Vo(t){return B(t,Pi.call(arguments,1))}function Lo(t){return B(t,Pi.call(arguments,1),null,b)}function Po(t,e,o){var i=!0,n=!0;o===!1?i=!1:Ce(o)&&(i="leading"in o?o.leading:i,n="trailing"in o?o.trailing:n),o=l(),o.leading=i,o.maxWait=e,o.trailing=n;var s=So(t,e,o);return p(o),s}function Io(t,e){return function(){var o=[t];return xi.apply(o,arguments),e.apply(this,o)}}function Go(t){return null==t?"":oi(t).replace(E,oe)}function ko(t){return t}function Eo(t){Oe(ue(t),function(e){var o=x[e]=t[e];x.prototype[e]=function(){var t=this.__wrapped__,e=[t];xi.apply(e,arguments);var i=o.apply(x,e);return t&&"object"==typeof t&&t===i?this:new _(i)}})}function Ro(){return i._=ci,this}function No(t,e){null==t&&null==e&&(e=1),t=+t||0,null==e?(e=t,t=0):e=+e||0;var o=Li();return t%1||e%1?t+Ti(o*(e-t+parseFloat("1e-"+((o+"").length-1))),e):t+pi(o*(e-t+1))}function Fo(t,e){var o=t?t[e]:f;return De(o)?t[e]():o}function Jo(t,e,o){var i=x.templateSettings;t||(t=""),o=Hi({},o,i);var n,s=Hi({},o.imports,i.imports),a=Wi(s),c=Ge(s),l=0,h=o.interpolate||G,m="__p += '",u=ei((o.escape||G).source+"|"+h.source+"|"+(h===V?w:G).source+"|"+(o.evaluate||G).source+"|$","g");
t.replace(u,function(e,o,i,s,a,c){return i||(i=s),m+=t.slice(l,c).replace(R,r),o&&(m+="' +\n__e("+o+") +\n'"),a&&(n=!0,m+="';\n"+a+";\n__p += '"),i&&(m+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=c+e.length,e}),m+="';\n";var p=o.variable,y=p;y||(p="obj",m="with ("+p+") {\n"+m+"\n}\n"),m=(n?m.replace(v,""):m).replace(S,"$1").replace(M,"$1;"),m="function("+p+") {\n"+(y?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(n?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var d="\n/*\n//@ sourceURL="+(o.sourceURL||"/lodash/template/source["+J++ +"]")+"\n*/";try{var _=$o(a,"return "+m+d).apply(f,c)}catch(g){throw g.source=m,g}return e?_(e):(_.source=m,_)}function Oo(t,e,o){t=(t=+t)>-1?t:0;var i=-1,n=Uo(t);for(e=x.createCallback(e,o,1);++i<t;)n[i]=e(i);return n}function jo(t){return null==t?"":oi(t).replace(A,re)}function Yo(t){var e=++g;return oi(null==t?"":t)+e}function Wo(t,e){return e(t),t}function Xo(){return oi(this.__wrapped__)}function zo(){return this.__wrapped__}i=i?ie.defaults(t.Object(),i,ie.pick(t,N)):t;var Uo=i.Array,qo=i.Boolean,Ho=i.Date,Ko=i.Error,$o=i.Function,Zo=i.Math,Qo=i.Number,ti=i.Object,ei=i.RegExp,oi=i.String,ii=i.TypeError,ni=[],si=Ko.prototype,ai=ti.prototype,ri=oi.prototype,ci=i._,li=ei("^"+oi(ai.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),hi=Zo.ceil,mi=i.clearTimeout,ui=ni.concat,pi=Zo.floor,yi=$o.prototype.toString,di=li.test(di=ti.getPrototypeOf)&&di,fi=ai.hasOwnProperty,xi=ni.push,_i=ai.propertyIsEnumerable,gi=i.setImmediate,bi=i.setTimeout,Di=ai.toString,Ci=li.test(Ci=Di.bind)&&Ci,Bi=li.test(Bi=ti.create)&&Bi,vi=li.test(vi=Uo.isArray)&&vi,Si=i.isFinite,Mi=i.isNaN,Ai=li.test(Ai=ti.keys)&&Ai,wi=Zo.max,Ti=Zo.min,Vi=i.parseInt,Li=Zo.random,Pi=ni.slice,Ii=li.test(i.attachEvent),Gi=Ci&&!/\n|true/.test(Ci+Ii),ki={};ki[j]=Uo,ki[Y]=qo,ki[W]=Ho,ki[z]=$o,ki[q]=ti,ki[U]=Qo,ki[H]=ei,ki[K]=oi;var Ei={};Ei[j]=Ei[W]=Ei[U]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Ei[Y]=Ei[K]={constructor:!0,toString:!0,valueOf:!0},Ei[X]=Ei[z]=Ei[H]={constructor:!0,toString:!0},Ei[q]={constructor:!0},function(){for(var t=F.length;t--;){var e=F[t];for(var o in Ei)fi.call(Ei,o)&&!fi.call(Ei[o],e)&&(Ei[o][e]=!1)}}(),_.prototype=x.prototype;var Ri=x.support={};!function(){var t=function(){this.x=1},e={0:1,length:1},o=[];t.prototype={valueOf:1,y:1};for(var i in new t)o.push(i);for(i in arguments);Ri.argsObject=arguments.constructor==ti&&!(arguments instanceof Uo),Ri.argsClass=ce(arguments),Ri.enumErrorProps=_i.call(si,"message")||_i.call(si,"name"),Ri.enumPrototypes=_i.call(t,"prototype"),Ri.fastBind=Ci&&!Gi,Ri.ownLast="x"!=o[0],Ri.nonEnumArgs=0!=i,Ri.nonEnumShadows=!/valueOf/.test(o),Ri.spliceObjects=(ni.splice.call(e,0,1),!e[0]),Ri.unindexedChars="xx"!="x"[0]+ti("x")[0];try{Ri.nodeClass=!(Di.call(document)==q&&!({toString:0}+""))}catch(n){Ri.nodeClass=!0}}(1),x.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:V,variable:"",imports:{_:x}};var Ni=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",Ri.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):Ri.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),Ri.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),Ri.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var o=[];if(Ri.enumPrototypes&&o.push('!(skipProto && index == "prototype")'),Ri.enumErrorProps&&o.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",o.length&&(e+="    if ("+o.join(" && ")+") {\n  "),e+=t.loop+";    ",o.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&o.push("hasOwnProperty.call(iterable, index)"),o.length&&(e+="    if ("+o.join(" && ")+") {\n  "),e+=t.loop+";    ",o.length&&(e+="\n    }"),e+="\n  }    ",Ri.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||Ri.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},Fi={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Ji={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Oi={top:"if (!objectTypes[typeof iterable]) return result;\n"+Ji.top,array:!1};if(!Bi)var te=function(t){if(Ce(t)){m.prototype=t;var e=new m;m.prototype=null}return e||{}};Ri.argsClass||(ce=function(t){return t?fi.call(t,"callee"):!1});var ji=vi||function(t){return t?"object"==typeof t&&Di.call(t)==j:!1},Yi=Q({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Wi=Ai?function(t){return Ce(t)?Ri.enumPrototypes&&"function"==typeof t||Ri.nonEnumArgs&&t.length&&ce(t)?Yi(t):Ai(t):[]}:Yi,Xi=Q(Ji),zi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ui=ye(zi),qi=Q(Fi,{top:Fi.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Hi=Q(Fi),Ki=Q(Ji,Oi,{useHas:!1}),$i=Q(Ji,Oi);De(/x/)&&(De=function(t){return"function"==typeof t&&Di.call(t)==z});var Zi=di?function(t){if(!t||Di.call(t)!=q||!Ri.argsClass&&ce(t))return!1;var e=t.valueOf,o="function"==typeof e&&(o=di(e))&&di(o);return o?t==o||di(t)==o:ae(t)}:ae,Qi=We,tn=Fe,en=se(function sn(t,e,o){for(var i=-1,n=t?t.length:0,s=[];++i<n;){var a=t[i];o&&(a=o(a,i,t)),ji(a)?xi.apply(s,e?a:sn(a)):s.push(a)}return s}),on=se(function(t,i,n){var s=-1,r=ne(),l=t?t.length:0,h=[],m=!i&&l>=C&&r===e,y=n||m?c():h;if(m){var d=a(y);d?(r=o,y=d):(m=!1,y=n?y:(u(y),h))}for(;++s<l;){var f=t[s],x=n?n(f,s,t):f;(i?!s||y[y.length-1]!==x:r(y,x)<0)&&((n||m)&&y.push(x),h.push(f))}return m?(u(y.array),p(y)):n&&u(y),h});Gi&&ee&&"function"==typeof gi&&(Mo=bo(gi,i));var nn=8==Vi(P+"08")?Vi:function(t,e){return Vi(Ae(t)?t.replace(I,""):t,e||0)};return x.after=go,x.assign=qi,x.at=ke,x.bind=bo,x.bindAll=Do,x.bindKey=Co,x.compact=eo,x.compose=Bo,x.countBy=Re,x.createCallback=vo,x.debounce=So,x.defaults=Hi,x.defer=Mo,x.delay=Ao,x.difference=oo,x.filter=Fe,x.flatten=en,x.forEach=Oe,x.forIn=Ki,x.forOwn=$i,x.functions=ue,x.groupBy=je,x.initial=ao,x.intersection=ro,x.invert=ye,x.invoke=Ye,x.keys=Wi,x.map=We,x.max=Xe,x.memoize=wo,x.merge=Te,x.min=ze,x.omit=Ve,x.once=To,x.pairs=Le,x.partial=Vo,x.partialRight=Lo,x.pick=Pe,x.pluck=Qi,x.range=ho,x.reject=He,x.rest=mo,x.shuffle=Ke,x.sortBy=Qe,x.tap=Wo,x.throttle=Po,x.times=Oo,x.toArray=to,x.transform=Ie,x.union=po,x.uniq=on,x.unzip=yo,x.values=Ge,x.where=tn,x.without=fo,x.wrap=Io,x.zip=xo,x.zipObject=_o,x.collect=We,x.drop=mo,x.each=Oe,x.extend=qi,x.methods=ue,x.object=_o,x.select=Fe,x.tail=mo,x.unique=on,Eo(x),x.chain=x,x.prototype.chain=function(){return this},x.clone=le,x.cloneDeep=he,x.contains=Ee,x.escape=Go,x.every=Ne,x.find=Je,x.findIndex=io,x.findKey=me,x.has=pe,x.identity=ko,x.indexOf=so,x.isArguments=ce,x.isArray=ji,x.isBoolean=de,x.isDate=fe,x.isElement=xe,x.isEmpty=_e,x.isEqual=ge,x.isFinite=be,x.isFunction=De,x.isNaN=Be,x.isNull=ve,x.isNumber=Se,x.isObject=Ce,x.isPlainObject=Zi,x.isRegExp=Me,x.isString=Ae,x.isUndefined=we,x.lastIndexOf=lo,x.mixin=Eo,x.noConflict=Ro,x.parseInt=nn,x.random=No,x.reduce=Ue,x.reduceRight=qe,x.result=Fo,x.runInContext=d,x.size=$e,x.some=Ze,x.sortedIndex=uo,x.template=Jo,x.unescape=jo,x.uniqueId=Yo,x.all=Ne,x.any=Ze,x.detect=Je,x.findWhere=Je,x.foldl=Ue,x.foldr=qe,x.include=Ee,x.inject=Ue,$i(x,function(t,e){x.prototype[e]||(x.prototype[e]=function(){var e=[this.__wrapped__];return xi.apply(e,arguments),t.apply(x,e)})}),x.first=no,x.last=co,x.take=no,x.head=no,$i(x,function(t,e){x.prototype[e]||(x.prototype[e]=function(e,o){var i=t(this.__wrapped__,e,o);return null==e||o&&"function"!=typeof e?i:new _(i)})}),x.VERSION="1.3.1",x.prototype.toString=Xo,x.prototype.value=zo,x.prototype.valueOf=zo,Xi(["join","pop","shift"],function(t){var e=ni[t];x.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),Xi(["push","reverse","sort","unshift"],function(t){var e=ni[t];x.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Xi(["concat","slice","splice"],function(t){var e=ni[t];x.prototype[t]=function(){return new _(e.apply(this.__wrapped__,arguments))}}),Ri.spliceObjects||Xi(["pop","shift","splice"],function(t){var e=ni[t],o="splice"==t;x.prototype[t]=function(){var t=this.__wrapped__,i=e.apply(t,arguments);return 0===t.length&&delete t[0],o?new _(i):i}}),x}var f,x=[],_=[],g=0,b={},D=+new Date+"",C=75,B=40,v=/\b__p \+= '';/g,S=/\b(__p \+=) '' \+/g,M=/(__e\(.*?\)|\b__t\)) \+\n'';/g,A=/&(?:amp|lt|gt|quot|#39);/g,w=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,T=/\w*$/,V=/<%=([\s\S]+?)%>/g,L=(L=/\bthis\b/)&&L.test(d)&&L,P=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",I=RegExp("^["+P+"]*0+(?=.$)"),G=/($^)/,E=/[&<>"']/g,R=/['\n\r\t\u2028\u2029\\]/g,N=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],F=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],J=0,O="[object Arguments]",j="[object Array]",Y="[object Boolean]",W="[object Date]",X="[object Error]",z="[object Function]",U="[object Number]",q="[object Object]",H="[object RegExp]",K="[object String]",$={};$[z]=!1,$[O]=$[j]=$[Y]=$[W]=$[U]=$[q]=$[H]=$[K]=!0;var Z={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Q={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},te=Z[typeof exports]&&exports,ee=Z[typeof module]&&module&&module.exports==te&&module,oe=Z[typeof global]&&global;!oe||oe.global!==oe&&oe.window!==oe||(t=oe);var ie=d();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t._=ie,define("lodash",[],function(){return ie})):te&&!te.nodeType?ee?(ee.exports=ie)._=ie:te._=ie:t._=ie}(this),define("vent",["lodash"],function(t){var e=/\s+/,o=function(t,o,i,n){if(!i)return!0;if("object"==typeof i){for(var s in i)t[o].apply(t,[s,i[s]].concat(n));return!1}if(e.test(i)){for(var a=i.split(e),r=0,c=a.length;c>r;r++)t[o].apply(t,[a[r]].concat(n));return!1}return!0},i=function(t,e){var o,i=-1,n=t.length,s=e[0],a=e[1],r=e[2];switch(e.length){case 0:for(;++i<n;)(o=t[i]).callback.call(o.ctx);return;case 1:for(;++i<n;)(o=t[i]).callback.call(o.ctx,s);return;case 2:for(;++i<n;)(o=t[i]).callback.call(o.ctx,s,a);return;case 3:for(;++i<n;)(o=t[i]).callback.call(o.ctx,s,a,r);return;default:for(;++i<n;)(o=t[i]).callback.apply(o.ctx,e)}},n={on:function(t,e,i){if(!o(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(e,i,n){if(!o(this,"once",e,[i,n])||!i)return this;var s=this,a=t.once(function(){s.off(e,a),i.apply(this,arguments)});return a._callback=i,this.on(e,a,n)},off:function(e,i,n){var s,a,r,c,l,h,m,u;if(!this._events||!o(this,"off",e,[i,n]))return this;if(!e&&!i&&!n)return this._events={},this;for(c=e?[e]:t.keys(this._events),l=0,h=c.length;h>l;l++)if(e=c[l],r=this._events[e]){if(this._events[e]=s=[],i||n)for(m=0,u=r.length;u>m;m++)a=r[m],(i&&i!==a.callback&&i!==a.callback._callback||n&&n!==a.context)&&s.push(a);s.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var n=t.toArray(arguments).slice(1);if(!o(this,"trigger",e,n))return this;var s=this._events[e],a=this._events.all;return s&&i(s,n),a&&i(a,arguments),this},stopListening:function(t,e,o){var i=this._listeners;if(!i)return this;var n=!e&&!o;"object"==typeof e&&(o=this),t&&((i={})[t._listenerId]=t);for(var s in i)i[s].off(e,o,this),n&&delete this._listeners[s];return this}},s={};return t.extend(s,n)}),define("messaging/message",["lodash","messaging"],function(t){return Message=function(){},Message.from=function(e,o){var o=o||{},i=new this,n=function(i){if(i instanceof ArrayBuffer)for(var n,s,a,r,c=require("messaging"),l=new DataView(i),h=0,m=0;h<e.byteformat.length;)n=e.byteformat.charAt(h),a=c.format[n],s=c.extractValue(l["get"+a](m),n),r=o["hydrate"+e.format[h].charAt(0).toUpperCase()+e.format[h].substring(1)],r&&(s=r.call(o,s)),this[e.format[h]]=s,m+=c.getTypeByteLength(a),h++;else t.extend(this,i)};return i.toBuffer=function(){for(var t,i,n,s,a=require("messaging"),r=a.calcByteSize(e),c=new ArrayBuffer(r),l=new DataView(c),h=0,m=0;h<e.byteformat.length;)i=e.byteformat.charAt(h),t=a.format[i],s=o["dehydrate"+e.format[h].charAt(0).toUpperCase()+e.format[h].substring(1)],n=s?s.call(o,this[e.format[h]]):this[e.format[h]],l["set"+t](m,n),m+=a.getTypeByteLength(t),h++;return c},i.schema=e,n.prototype=i,n.prototype.constructor=n,n.extend=arguments.calee,n.schema=e,n},Message}),define("messaging/mixins/entity",[],function(){return{entityTypeLookup:{0:"unknown",1:"collidable",2:"archer",3:"arrow",4:"skeleton"},hydrateEntityType:function(t){return this.entityTypeLookup[t]}}}),define("messaging/mixins/state",[],function(){return{stateLookup:{0:"unknown",1:"standing",2:"walking",3:"shooting",4:"dying",5:"dead"},hydrateState:function(t){return this.stateLookup[t]}}}),define("messaging/mixins/direction",["lodash"],function(t){var e={0:"",1:"N",2:"S",3:"E",4:"W"},o=t.invert(e);return{directionLookup:e,directionRLookup:o,hydrateDirection:function(t){return this.directionLookup[t]},dehydrateDirection:function(t){return this.directionRLookup[t]}}}),define("messaging/frame",["lodash","messaging/message","messaging/mixins/entity","messaging/mixins/state","messaging/mixins/direction"],function(t,e,o,i,n){var s={id:1,format:["id","x","y","direction","state"],byteformat:"IIIBB"},a=e.from(s,t.extend({},i,n));return a}),define("messaging/update",["lodash","messaging/message","messaging/mixins/entity","messaging/mixins/state","messaging/mixins/direction"],function(t,e,o,i,n){var s={id:2,format:["id","entityType","width","height","x","y","direction","state","player"],byteformat:"IBIIIIBB?"},a=e.from(s,t.extend({},o,i,n));return a}),define("messaging/mixins/action",["lodash"],function(t){var e={1:"spawn",2:"stop",3:"move",4:"attack"},o=t.invert(e),i={actionLookup:e,actionRLookup:o,hydrateAction:function(t){return this.actionLookup[t]},dehydrateAction:function(t){return this.actionRLookup[t]}};return i}),define("messaging/useraction",["lodash","messaging/message","messaging/mixins/action","messaging/mixins/direction"],function(t,e,o,i){var n={id:3,format:["action","direction"],byteformat:"BB"},s=e.from(n,t.extend({},o,i));return s}),define("messaging/remove",["messaging/message"],function(t){var e={id:4,format:["id"],byteformat:"I"};return t.from(e)}),define("messaging",["require","lodash","messaging/frame","messaging/update","messaging/useraction","messaging/remove"],function(t,e,o,i,n,s){var a={format:{b:"Int8",B:"Uint8","?":"Uint8",h:"Int16",H:"Uint16",i:"Int32",I:"Uint32",f:"Float32",d:"Float64"},messages:{1:o,2:i,3:n,4:s},copyBytes:function(t,e,o,i,n){var s=new Uint8Array(e,i);s.set(new Uint8Array(t,o,n))},getTypeByteLength:function(t){return window[t+"Array"].BYTES_PER_ELEMENT},calcByteSize:function(t){for(var e,o=0,i=0;i<t.byteformat.length;)e=this.format[t.byteformat.charAt(i)],o+=this.getTypeByteLength(e),i++;return o},extractValue:function(t,e){return"?"===e&&(t=!!t),t},fromBuffer:function(t){for(var e,o=new DataView(t),i=this.messages[o.getUint8(0)],n=this.calcByteSize(i.schema),s=1,a=[];s<t.byteLength;)e=new i(t.slice(s,s+n)),a.push(e),s+=n;return a},toBuffer:function(t){var e,o,i,n,s,a=1,r=0;if(t.length){for(e=this.messages[t[0].constructor.schema.id],n=this.calcByteSize(t[0].constructor.schema),a+=t.length*n,o=new ArrayBuffer(a),i=new DataView(o),i.setUint8(0,t[0].constructor.schema.id),r=1;t.length;)s=t.shift(),this.copyBytes(s.toBuffer(),o,0,r,n),r+=n;return o}return new ArrayBuffer(0)}};return a}),define("networking",["lodash","vent","messaging","messaging/useraction"],function(t,e,o,i){return function(){var t=this;this.ws=new WebSocket("ws://"+window.location.hostname+":9000"),this.ws.binaryType="arraybuffer",this.oninput=function(e,n){var s=new i({action:e,direction:n});t.ws.send(o.toBuffer([s]))},this.onspawn=function(){var e=new i({action:"spawn",direction:"S"});t.ws.send(o.toBuffer([e]))},this.onUsernameChange=function(e){var o;e&&e.length&&(o={username:e},t.ws.send(JSON.stringify(o)))},this.onmessage=function(t){t.data instanceof ArrayBuffer?(messages=o.fromBuffer(t.data),2===messages[0].schema.id&&messages.forEach(function(t){e.trigger("update",t)}),1===messages[0].schema.id&&messages.forEach(function(t){e.trigger("frame",t)}),4===messages[0].schema.id&&messages.forEach(function(t){e.trigger("remove",t)})):(msg=JSON.parse(t.data),e.trigger("meta",msg))},this.ws.onopen=function(){t.ws.onmessage=t.onmessage,e.trigger("connected"),e.on("spawn",t.onspawn),e.on("input",t.oninput),e.on("username",t.onUsernameChange)},this.ws.onclose=function(t){e.trigger("disconnected",t)}}}),define("spritedef/archer",[],function(){return{spriteName:"archer",frameDefault:"standing S",frameWidth:64,frameHeight:64,frames:[{name:"standing N",frameX:0,frameY:8,frameCount:1,time:900},{name:"standing W",frameX:0,frameY:9,frameCount:1,time:900},{name:"standing S",frameX:0,frameY:10,frameCount:1,time:900},{name:"standing E",frameX:0,frameY:11,frameCount:1,time:900},{name:"casting N",frameX:0,frameY:0,frameCount:7,time:900},{name:"casting W",frameX:0,frameY:1,frameCount:7,time:900},{name:"casting S",frameX:0,frameY:2,frameCount:7,time:900},{name:"casting E",frameX:0,frameY:3,frameCount:7,time:900},{name:"piercing N",frameX:0,frameY:4,frameCount:8,time:900},{name:"piercing W",frameX:0,frameY:5,frameCount:8,time:900},{name:"piercing S",frameX:0,frameY:6,frameCount:8,time:900},{name:"piercing E",frameX:0,frameY:7,frameCount:8,time:900},{name:"walking N",frameX:0,frameY:8,frameCount:9,time:900},{name:"walking W",frameX:0,frameY:9,frameCount:9,time:900},{name:"walking S",frameX:0,frameY:10,frameCount:9,time:900},{name:"walking E",frameX:0,frameY:11,frameCount:9,time:900},{name:"slashing N",frameX:0,frameY:12,frameCount:6,time:900},{name:"slashing W",frameX:0,frameY:13,frameCount:6,time:900},{name:"slashing S",frameX:0,frameY:14,frameCount:6,time:900},{name:"slashing E",frameX:0,frameY:15,frameCount:6,time:900},{name:"shooting N",frameX:0,frameY:16,frameCount:13,time:900},{name:"shooting W",frameX:0,frameY:17,frameCount:13,time:900},{name:"shooting S",frameX:0,frameY:18,frameCount:13,time:900},{name:"shooting E",frameX:0,frameY:19,frameCount:13,time:900},{name:"dying",frameX:0,frameY:20,frameCount:6,time:900},{name:"dead",frameX:5,frameY:20,frameCount:1,time:900},{name:"unknown",frameX:19,frameY:20,frameCount:1,time:900}]}}),define("spritedef/arrow",[],function(){return{spriteName:"arrow",frameDefault:"shooting S",frameWidth:32,frameHeight:32,frames:[{name:"shooting N",frameX:1,frameY:0,frameCount:1,time:900},{name:"shooting W",frameX:3,frameY:0,frameCount:1,time:900},{name:"shooting S",frameX:2,frameY:0,frameCount:1,time:900},{name:"shooting E",frameX:0,frameY:0,frameCount:1,time:900}]}}),define("spritedef/skeleton",["lodash","spritedef/archer"],function(t,e){var o=t.clone(e);return o.spriteName="skeleton",o}),define("components/state",["pc"],function(t){return t.components.Component("State",{create:function(t,e){var o=this._super();return o.config(t,e),o}},{state:"unknown",direction:"S",init:function(){this._super(this.Class.shortName),this.config()},config:function(t,e){this.state=t||"unknown",this.direction=e||"S"},getStatedir:function(){return"unknown"===this.state?this.state:this.state+" "+this.direction},isAlive:function(){return"dead"===this.state||"unknown"===this.state?!1:!0},changeState:function(t,e,o,i){var n;if(this.state===e&&this.direction===o&&!i)return!1;if(this.state=e,this.direction=o,n=this.getStatedir(),t.sprite.spriteSheet.animations.containsKey(n))t.sprite.setAnimation(n);else{if(!t.sprite.spriteSheet.animations.containsKey(this.state))throw"Couldn't find animation for "+n;t.sprite.setAnimation(this.state)}return!0}})}),define("components/meta",["pc"],function(t){return t.components.Component("Meta",{create:function(){var t=this._super();return t.config(),t}},{username:"",init:function(){this._super(this.Class.shortName),this.config()},update:function(t){t.username&&(this.username=t.username)},config:function(){}})}),define("entityfactory",["pc","lodash","spritedef/archer","spritedef/arrow","spritedef/skeleton","components/state","components/meta"],function(t,e,o,i,n,s,a){var r=t.EntityFactory.extend("pc.archers.EntityFactory",{},{getSprite:function(o,i){var n=t.device.loader.get(o.spriteName).resource,s=new t.SpriteSheet({image:n,frameWidth:o.frameWidth,frameHeight:o.frameHeight});return i=i||o.frameDefault,e.each(o.frames,function(t){s.addAnimation(t)}),t.components.Sprite.create({spriteSheet:s,animationStart:i})},getSpatial:function(e,o,i,n){return t.components.Spatial.create({x:e,y:o,w:i,h:n})},getInput:function(){return t.components.Input.create({states:[["moving right",["D","RIGHT"]],["moving left",["A","LEFT"]],["moving up",["W","UP"]],["moving down",["S","DOWN"]],["attacking",["SPACE"]]]})},makeCollidable:function(e,o,i,n,s){var a=this.getSpatial(o,i,s.x,s.y),r=t.Entity.create(e);return r.addComponent(a),r},makeArcher:function(e,i,n,r,c,l){var h=this.getSpatial(i,n,64,64),m=s.create(l.state,r),u=a.create(),p=this.getSprite(o,m.getStatedir()),y=t.Entity.create(e);return y.addComponent(m),y.addComponent(u),y.addComponent(h),y.addComponent(p),l.player&&y.addTag("PLAYER"),y},makeSkeleton:function(e,o,i,r,c,l){var h=this.getSpatial(o,i,64,64),m=s.create(l.state,r),u=a.create(),p=this.getSprite(n,m.getStatedir()),y=t.Entity.create(e);return y.addComponent(m),y.addComponent(u),y.addComponent(h),y.addComponent(p),y},makeArrow:function(e,o,n,a,r,c){var l=this.getSpatial(o,n,32,32),h=s.create(c.state,a),m=this.getSprite(i,h.getStatedir()),u=t.Entity.create(e);return u.addComponent(l),u.addComponent(m),u},createEntity:function(t,e,o,i,n,s,a){var r,c="make"+e.charAt(0).toUpperCase()+e.slice(1);return this[c]?(r=this[c].call(this,t,o,i,n,s,a),r.addTag(e),r):null}});return r}),function(t,e){function o(t){var e=t.length,o=X.type(t);return X.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===o||"function"!==o&&(0===e||"number"==typeof e&&e>0&&e-1 in t)}function i(t){var e=ie[t]={};return X.each(t.match(U)||[],function(t,o){e[o]=!0}),e}function n(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=X.expando+Math.random()}function s(t,o,i){var n;if(i===e&&1===t.nodeType)if(n="data-"+o.replace(re,"-$1").toLowerCase(),i=t.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:ae.test(i)?JSON.parse(i):i}catch(s){}ne.set(t,o,i)}else i=e;return i}function a(){return!0}function r(){return!1}function c(){try{return L.activeElement}catch(t){}}function l(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function h(t,e,o){if(X.isFunction(e))return X.grep(t,function(t,i){return!!e.call(t,i,t)!==o});if(e.nodeType)return X.grep(t,function(t){return t===e!==o});if("string"==typeof e){if(xe.test(e))return X.filter(e,t,o);e=X.filter(e,t)}return X.grep(t,function(t){return O.call(e,t)>=0!==o})}function m(t,e){return X.nodeName(t,"table")&&X.nodeName(1===e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function u(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function p(t){var e=we.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function y(t,e){for(var o=t.length,i=0;o>i;i++)se.set(t[i],"globalEval",!e||se.get(e[i],"globalEval"))}function d(t,e){var o,i,n,s,a,r,c,l;if(1===e.nodeType){if(se.hasData(t)&&(s=se.access(t),a=se.set(e,s),l=s.events)){delete a.handle,a.events={};for(n in l)for(o=0,i=l[n].length;i>o;o++)X.event.add(e,n,l[n][o])}ne.hasData(t)&&(r=ne.access(t),c=X.extend({},r),ne.set(e,c))}}function f(t,o){var i=t.getElementsByTagName?t.getElementsByTagName(o||"*"):t.querySelectorAll?t.querySelectorAll(o||"*"):[];return o===e||o&&X.nodeName(t,o)?X.merge([t],i):i}function x(t,e){var o=e.nodeName.toLowerCase();"input"===o&&Se.test(t.type)?e.checked=t.checked:("input"===o||"textarea"===o)&&(e.defaultValue=t.defaultValue)}function _(t,e){if(e in t)return e;for(var o=e.charAt(0).toUpperCase()+e.slice(1),i=e,n=je.length;n--;)if(e=je[n]+o,e in t)return e;return i}function g(t,e){return t=e||t,"none"===X.css(t,"display")||!X.contains(t.ownerDocument,t)}function b(e){return t.getComputedStyle(e,null)}function D(t,e){for(var o,i,n,s=[],a=0,r=t.length;r>a;a++)i=t[a],i.style&&(s[a]=se.get(i,"olddisplay"),o=i.style.display,e?(s[a]||"none"!==o||(i.style.display=""),""===i.style.display&&g(i)&&(s[a]=se.access(i,"olddisplay",S(i.nodeName)))):s[a]||(n=g(i),(o&&"none"!==o||!n)&&se.set(i,"olddisplay",n?o:X.css(i,"display"))));for(a=0;r>a;a++)i=t[a],i.style&&(e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?s[a]||"":"none"));return t}function C(t,e,o){var i=ke.exec(e);return i?Math.max(0,i[1]-(o||0))+(i[2]||"px"):e}function B(t,e,o,i,n){for(var s=o===(i?"border":"content")?4:"width"===e?1:0,a=0;4>s;s+=2)"margin"===o&&(a+=X.css(t,o+Oe[s],!0,n)),i?("content"===o&&(a-=X.css(t,"padding"+Oe[s],!0,n)),"margin"!==o&&(a-=X.css(t,"border"+Oe[s]+"Width",!0,n))):(a+=X.css(t,"padding"+Oe[s],!0,n),"padding"!==o&&(a+=X.css(t,"border"+Oe[s]+"Width",!0,n)));return a}function v(t,e,o){var i=!0,n="width"===e?t.offsetWidth:t.offsetHeight,s=b(t),a=X.support.boxSizing&&"border-box"===X.css(t,"boxSizing",!1,s);if(0>=n||null==n){if(n=Le(t,e,s),(0>n||null==n)&&(n=t.style[e]),Ee.test(n))return n;i=a&&(X.support.boxSizingReliable||n===t.style[e]),n=parseFloat(n)||0}return n+B(t,e,o||(a?"border":"content"),i,s)+"px"}function S(t){var e=L,o=Ne[t];return o||(o=M(t,e),"none"!==o&&o||(Pe=(Pe||X("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(e.documentElement),e=(Pe[0].contentWindow||Pe[0].contentDocument).document,e.write("<!doctype html><html><body>"),e.close(),o=M(t,e),Pe.detach()),Ne[t]=o),o}function M(t,e){var o=X(e.createElement(t)).appendTo(e.body),i=X.css(o[0],"display");return o.remove(),i}function A(t,e,o,i){var n;if(X.isArray(e))X.each(e,function(e,n){o||We.test(t)?i(t,n):A(t+"["+("object"==typeof n?e:"")+"]",n,o,i)});else if(o||"object"!==X.type(e))i(t,e);else for(n in e)A(t+"["+n+"]",e[n],o,i)}var w,T,V=typeof e,L=(t.location,t.document),P=L.documentElement,I=t.jQuery,G=t.$,k={},E=[],R="2.0.3 -sizzle,-wrap,-event-alias,-ajax,-ajax/script,-ajax/jsonp,-ajax/xhr,-effects,-offset,-dimensions,-deprecated",N=E.concat,F=E.push,J=E.slice,O=E.indexOf,j=k.toString,Y=k.hasOwnProperty,W=R.trim,X=function(t,e){return new X.fn.init(t,e,w)},z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=/\S+/g,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,H=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,K=/^-ms-/,$=/-([\da-z])/gi,Z=function(t,e){return e.toUpperCase()},Q=function(){L.removeEventListener("DOMContentLoaded",Q,!1),t.removeEventListener("load",Q,!1),X.ready()};X.fn=X.prototype={jquery:R,constructor:X,init:function(t,o,i){var n,s;if(!t)return this;if("string"==typeof t){if(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:q.exec(t),!n||!n[1]&&o)return!o||o.jquery?(o||i).find(t):this.constructor(o).find(t);if(n[1]){if(o=o instanceof X?o[0]:o,X.merge(this,X.parseHTML(n[1],o&&o.nodeType?o.ownerDocument||o:L,!0)),H.test(n[1])&&X.isPlainObject(o))for(n in o)X.isFunction(this[n])?this[n](o[n]):this.attr(n,o[n]);return this}return s=L.getElementById(n[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=L,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):X.isFunction(t)?i.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),X.makeArray(t,this))},selector:"",length:0,toArray:function(){return J.call(this)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t){var e=X.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return X.each(this,t,e)},ready:function(t){return X.ready.promise().done(t),this},slice:function(){return this.pushStack(J.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,o=+t+(0>t?e:0);return this.pushStack(o>=0&&e>o?[this[o]]:[])},map:function(t){return this.pushStack(X.map(this,function(e,o){return t.call(e,o,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:F,sort:[].sort,splice:[].splice},X.fn.init.prototype=X.fn,X.extend=X.fn.extend=function(){var t,o,i,n,s,a,r=arguments[0]||{},c=1,l=arguments.length,h=!1;for("boolean"==typeof r&&(h=r,r=arguments[1]||{},c=2),"object"==typeof r||X.isFunction(r)||(r={}),l===c&&(r=this,--c);l>c;c++)if(null!=(t=arguments[c]))for(o in t)i=r[o],n=t[o],r!==n&&(h&&n&&(X.isPlainObject(n)||(s=X.isArray(n)))?(s?(s=!1,a=i&&X.isArray(i)?i:[]):a=i&&X.isPlainObject(i)?i:{},r[o]=X.extend(h,a,n)):n!==e&&(r[o]=n));return r},X.extend({expando:"jQuery"+(R+Math.random()).replace(/\D/g,""),noConflict:function(e){return t.$===X&&(t.$=G),e&&t.jQuery===X&&(t.jQuery=I),X},isReady:!1,readyWait:1,holdReady:function(t){t?X.readyWait++:X.ready(!0)},ready:function(t){(t===!0?--X.readyWait:X.isReady)||(X.isReady=!0,t!==!0&&--X.readyWait>0||(T.resolveWith(L,[X]),X.fn.trigger&&X(L).trigger("ready").off("ready")))},isFunction:function(t){return"function"===X.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?k[j.call(t)]||"object":typeof t},isPlainObject:function(t){if("object"!==X.type(t)||t.nodeType||X.isWindow(t))return!1;try{if(t.constructor&&!Y.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},error:function(t){throw new Error(t)},parseHTML:function(t,e,o){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(o=e,e=!1),e=e||L;var i=H.exec(t),n=!o&&[];
return i?[e.createElement(i[1])]:(i=X.buildFragment([t],e,n),n&&X(n).remove(),X.merge([],i.childNodes))},parseJSON:JSON.parse,parseXML:function(t){var o,i;if(!t||"string"!=typeof t)return null;try{i=new DOMParser,o=i.parseFromString(t,"text/xml")}catch(n){o=e}return(!o||o.getElementsByTagName("parsererror").length)&&X.error("Invalid XML: "+t),o},noop:function(){},globalEval:function(t){var e,o=eval;t=X.trim(t),t&&(1===t.indexOf("use strict")?(e=L.createElement("script"),e.text=t,L.head.appendChild(e).parentNode.removeChild(e)):o(t))},camelCase:function(t){return t.replace(K,"ms-").replace($,Z)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,i){var n,s=0,a=t.length,r=o(t);if(i){if(r)for(;a>s&&(n=e.apply(t[s],i),n!==!1);s++);else for(s in t)if(n=e.apply(t[s],i),n===!1)break}else if(r)for(;a>s&&(n=e.call(t[s],s,t[s]),n!==!1);s++);else for(s in t)if(n=e.call(t[s],s,t[s]),n===!1)break;return t},trim:function(t){return null==t?"":W.call(t)},makeArray:function(t,e){var i=e||[];return null!=t&&(o(Object(t))?X.merge(i,"string"==typeof t?[t]:t):F.call(i,t)),i},inArray:function(t,e,o){return null==e?-1:O.call(e,t,o)},merge:function(t,o){var i=o.length,n=t.length,s=0;if("number"==typeof i)for(;i>s;s++)t[n++]=o[s];else for(;o[s]!==e;)t[n++]=o[s++];return t.length=n,t},grep:function(t,e,o){var i,n=[],s=0,a=t.length;for(o=!!o;a>s;s++)i=!!e(t[s],s),o!==i&&n.push(t[s]);return n},map:function(t,e,i){var n,s=0,a=t.length,r=o(t),c=[];if(r)for(;a>s;s++)n=e(t[s],s,i),null!=n&&(c[c.length]=n);else for(s in t)n=e(t[s],s,i),null!=n&&(c[c.length]=n);return N.apply([],c)},guid:1,proxy:function(t,o){var i,n,s;return"string"==typeof o&&(i=t[o],o=t,t=i),X.isFunction(t)?(n=J.call(arguments,2),s=function(){return t.apply(o||this,n.concat(J.call(arguments)))},s.guid=t.guid=t.guid||X.guid++,s):e},access:function(t,o,i,n,s,a,r){var c=0,l=t.length,h=null==i;if("object"===X.type(i)){s=!0;for(c in i)X.access(t,o,c,i[c],!0,a,r)}else if(n!==e&&(s=!0,X.isFunction(n)||(r=!0),h&&(r?(o.call(t,n),o=null):(h=o,o=function(t,e,o){return h.call(X(t),o)})),o))for(;l>c;c++)o(t[c],i,r?n:n.call(t[c],c,o(t[c],i)));return s?t:h?o.call(t):l?o(t[0],i):a},now:Date.now,swap:function(t,e,o,i){var n,s,a={};for(s in e)a[s]=t.style[s],t.style[s]=e[s];n=o.apply(t,i||[]);for(s in e)t.style[s]=a[s];return n}}),X.ready.promise=function(e){return T||(T=X.Deferred(),"complete"===L.readyState?setTimeout(X.ready):(L.addEventListener("DOMContentLoaded",Q,!1),t.addEventListener("load",Q,!1))),T.promise(e)},X.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){k["[object "+e+"]"]=e.toLowerCase()}),w=X(L);var te,ee=P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector,oe=function(t,e){if(t===e)return te=!0,0;var o=e.compareDocumentPosition&&t.compareDocumentPosition&&t.compareDocumentPosition(e);return o?1&o?t===L||X.contains(L,t)?-1:e===L||X.contains(L,e)?1:0:4&o?-1:1:t.compareDocumentPosition?-1:1};X.extend({find:function(t,e,o,i){var n,s,a=0;if(o=o||[],e=e||L,!t||"string"!=typeof t)return o;if(1!==(s=e.nodeType)&&9!==s)return[];if(i)for(;n=i[a++];)X.find.matchesSelector(n,t)&&o.push(n);else X.merge(o,e.querySelectorAll(t));return o},unique:function(t){var e,o=[],i=0,n=0;if(te=!1,t.sort(oe),te){for(;e=t[i++];)e===t[i]&&(n=o.push(i));for(;n--;)t.splice(o[n],1)}return t},text:function(t){var e,o="",i=0,n=t.nodeType;if(n){if(1===n||9===n||11===n)return t.textContent;if(3===n||4===n)return t.nodeValue}else for(;e=t[i++];)o+=X.text(e);return o},contains:function(t,e){var o=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!o.contains(i))},isXMLDoc:function(t){return"HTML"!==(t.ownerDocument||t).documentElement.nodeName},expr:{attrHandle:{},match:{bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]/}}}),X.extend(X.find,{matches:function(t,e){return X.find(t,null,null,e)},matchesSelector:function(t,e){return ee.call(t,e)},attr:function(t,e){return t.getAttribute(e)}});var ie={};X.Callbacks=function(t){t="string"==typeof t?ie[t]||i(t):X.extend({},t);var o,n,s,a,r,c,l=[],h=!t.once&&[],m=function(e){for(o=t.memory&&e,n=!0,c=a||0,a=0,r=l.length,s=!0;l&&r>c;c++)if(l[c].apply(e[0],e[1])===!1&&t.stopOnFalse){o=!1;break}s=!1,l&&(h?h.length&&m(h.shift()):o?l=[]:u.disable())},u={add:function(){if(l){var e=l.length;!function i(e){X.each(e,function(e,o){var n=X.type(o);"function"===n?t.unique&&u.has(o)||l.push(o):o&&o.length&&"string"!==n&&i(o)})}(arguments),s?r=l.length:o&&(a=e,m(o))}return this},remove:function(){return l&&X.each(arguments,function(t,e){for(var o;(o=X.inArray(e,l,o))>-1;)l.splice(o,1),s&&(r>=o&&r--,c>=o&&c--)}),this},has:function(t){return t?X.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],r=0,this},disable:function(){return l=h=o=e,this},disabled:function(){return!l},lock:function(){return h=e,o||u.disable(),this},locked:function(){return!h},fireWith:function(t,e){return!l||n&&!h||(e=e||[],e=[t,e.slice?e.slice():e],s?h.push(e):m(e)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!n}};return u},X.extend({Deferred:function(t){var e=[["resolve","done",X.Callbacks("once memory"),"resolved"],["reject","fail",X.Callbacks("once memory"),"rejected"],["notify","progress",X.Callbacks("memory")]],o="pending",i={state:function(){return o},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var t=arguments;return X.Deferred(function(o){X.each(e,function(e,s){var a=s[0],r=X.isFunction(t[e])&&t[e];n[s[1]](function(){var t=r&&r.apply(this,arguments);t&&X.isFunction(t.promise)?t.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[a+"With"](this===i?o.promise():this,r?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?X.extend(t,i):i}},n={};return i.pipe=i.then,X.each(e,function(t,s){var a=s[2],r=s[3];i[s[1]]=a.add,r&&a.add(function(){o=r},e[1^t][2].disable,e[2][2].lock),n[s[0]]=function(){return n[s[0]+"With"](this===n?i:this,arguments),this},n[s[0]+"With"]=a.fireWith}),i.promise(n),t&&t.call(n,n),n},when:function(t){var e,o,i,n=0,s=J.call(arguments),a=s.length,r=1!==a||t&&X.isFunction(t.promise)?a:0,c=1===r?t:X.Deferred(),l=function(t,o,i){return function(n){o[t]=this,i[t]=arguments.length>1?J.call(arguments):n,i===e?c.notifyWith(o,i):--r||c.resolveWith(o,i)}};if(a>1)for(e=new Array(a),o=new Array(a),i=new Array(a);a>n;n++)s[n]&&X.isFunction(s[n].promise)?s[n].promise().done(l(n,i,s)).fail(c.reject).progress(l(n,o,e)):--r;return r||c.resolveWith(i,s),c.promise()}}),X.support=function(e){var o=L.createElement("input"),i=L.createDocumentFragment(),n=L.createElement("div"),s=L.createElement("select"),a=s.appendChild(L.createElement("option"));return o.type?(o.type="checkbox",e.checkOn=""!==o.value,e.optSelected=a.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,o.checked=!0,e.noCloneChecked=o.cloneNode(!0).checked,s.disabled=!0,e.optDisabled=!a.disabled,o=L.createElement("input"),o.value="t",o.type="radio",e.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),i.appendChild(o),e.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in t,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle="content-box"===n.style.backgroundClip,X(function(){var o,i,s="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",a=L.getElementsByTagName("body")[0];a&&(o=L.createElement("div"),o.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(o).appendChild(n),n.innerHTML="",n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",X.swap(a,null!=a.style.zoom?{zoom:1}:{},function(){e.boxSizing=4===n.offsetWidth}),t.getComputedStyle&&(e.pixelPosition="1%"!==(t.getComputedStyle(n,null)||{}).top,e.boxSizingReliable="4px"===(t.getComputedStyle(n,null)||{width:"4px"}).width,i=n.appendChild(L.createElement("div")),i.style.cssText=n.style.cssText=s,i.style.marginRight=i.style.width="0",n.style.width="1px",e.reliableMarginRight=!parseFloat((t.getComputedStyle(i,null)||{}).marginRight)),a.removeChild(o))}),e):e}({});var ne,se,ae=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,re=/([A-Z])/g;n.uid=1,n.accepts=function(t){return t.nodeType?1===t.nodeType||9===t.nodeType:!0},n.prototype={key:function(t){if(!n.accepts(t))return 0;var e={},o=t[this.expando];if(!o){o=n.uid++;try{e[this.expando]={value:o},Object.defineProperties(t,e)}catch(i){e[this.expando]=o,X.extend(t,e)}}return this.cache[o]||(this.cache[o]={}),o},set:function(t,e,o){var i,n=this.key(t),s=this.cache[n];if("string"==typeof e)s[e]=o;else if(X.isEmptyObject(s))X.extend(this.cache[n],e);else for(i in e)s[i]=e[i];return s},get:function(t,o){var i=this.cache[this.key(t)];return o===e?i:i[o]},access:function(t,o,i){var n;return o===e||o&&"string"==typeof o&&i===e?(n=this.get(t,o),n!==e?n:this.get(t,X.camelCase(o))):(this.set(t,o,i),i!==e?i:o)},remove:function(t,o){var i,n,s,a=this.key(t),r=this.cache[a];if(o===e)this.cache[a]={};else{X.isArray(o)?n=o.concat(o.map(X.camelCase)):(s=X.camelCase(o),o in r?n=[o,s]:(n=s,n=n in r?[n]:n.match(U)||[])),i=n.length;for(;i--;)delete r[n[i]]}},hasData:function(t){return!X.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}},ne=new n,se=new n,X.extend({acceptData:n.accepts,hasData:function(t){return ne.hasData(t)||se.hasData(t)},data:function(t,e,o){return ne.access(t,e,o)},removeData:function(t,e){ne.remove(t,e)},_data:function(t,e,o){return se.access(t,e,o)},_removeData:function(t,e){se.remove(t,e)}}),X.fn.extend({data:function(t,o){var i,n,a=this[0],r=0,c=null;if(t===e){if(this.length&&(c=ne.get(a),1===a.nodeType&&!se.get(a,"hasDataAttrs"))){for(i=a.attributes;r<i.length;r++)n=i[r].name,0===n.indexOf("data-")&&(n=X.camelCase(n.slice(5)),s(a,n,c[n]));se.set(a,"hasDataAttrs",!0)}return c}return"object"==typeof t?this.each(function(){ne.set(this,t)}):X.access(this,function(o){var i,n=X.camelCase(t);if(a&&o===e){if(i=ne.get(a,t),i!==e)return i;if(i=ne.get(a,n),i!==e)return i;if(i=s(a,n,e),i!==e)return i}else this.each(function(){var i=ne.get(this,n);ne.set(this,n,o),-1!==t.indexOf("-")&&i!==e&&ne.set(this,t,o)})},null,o,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){ne.remove(this,t)})}}),X.extend({queue:function(t,e,o){var i;return t?(e=(e||"fx")+"queue",i=se.get(t,e),o&&(!i||X.isArray(o)?i=se.access(t,e,X.makeArray(o)):i.push(o)),i||[]):void 0},dequeue:function(t,e){e=e||"fx";var o=X.queue(t,e),i=o.length,n=o.shift(),s=X._queueHooks(t,e),a=function(){X.dequeue(t,e)};"inprogress"===n&&(n=o.shift(),i--),n&&("fx"===e&&o.unshift("inprogress"),delete s.stop,n.call(t,a,s)),!i&&s&&s.empty.fire()},_queueHooks:function(t,e){var o=e+"queueHooks";return se.get(t,o)||se.access(t,o,{empty:X.Callbacks("once memory").add(function(){se.remove(t,[e+"queue",o])})})}}),X.fn.extend({queue:function(t,o){var i=2;return"string"!=typeof t&&(o=t,t="fx",i--),arguments.length<i?X.queue(this[0],t):o===e?this:this.each(function(){var e=X.queue(this,t,o);X._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&X.dequeue(this,t)})},dequeue:function(t){return this.each(function(){X.dequeue(this,t)})},delay:function(t,e){return t=X.fx?X.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,o){var i=setTimeout(e,t);o.stop=function(){clearTimeout(i)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,o){var i,n=1,s=X.Deferred(),a=this,r=this.length,c=function(){--n||s.resolveWith(a,[a])};for("string"!=typeof t&&(o=t,t=e),t=t||"fx";r--;)i=se.get(a[r],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(c));return c(),s.promise(o)}});var ce,le,he=/[\t\r\n\f]/g,me=/\r/g,ue=/^(?:input|select|textarea|button)$/i;X.fn.extend({attr:function(t,e){return X.access(this,X.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){X.removeAttr(this,t)})},prop:function(t,e){return X.access(this,X.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[X.propFix[t]||t]})},addClass:function(t){var e,o,i,n,s,a=0,r=this.length,c="string"==typeof t&&t;if(X.isFunction(t))return this.each(function(e){X(this).addClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(U)||[];r>a;a++)if(o=this[a],i=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(he," "):" ")){for(s=0;n=e[s++];)i.indexOf(" "+n+" ")<0&&(i+=n+" ");o.className=X.trim(i)}return this},removeClass:function(t){var e,o,i,n,s,a=0,r=this.length,c=0===arguments.length||"string"==typeof t&&t;if(X.isFunction(t))return this.each(function(e){X(this).removeClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(U)||[];r>a;a++)if(o=this[a],i=1===o.nodeType&&(o.className?(" "+o.className+" ").replace(he," "):"")){for(s=0;n=e[s++];)for(;i.indexOf(" "+n+" ")>=0;)i=i.replace(" "+n+" "," ");o.className=t?X.trim(i):""}return this},toggleClass:function(t,e){var o=typeof t;return"boolean"==typeof e&&"string"===o?e?this.addClass(t):this.removeClass(t):X.isFunction(t)?this.each(function(o){X(this).toggleClass(t.call(this,o,this.className,e),e)}):this.each(function(){if("string"===o)for(var e,i=0,n=X(this),s=t.match(U)||[];e=s[i++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else(o===V||"boolean"===o)&&(this.className&&se.set(this,"__className__",this.className),this.className=this.className||t===!1?"":se.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",o=0,i=this.length;i>o;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(he," ").indexOf(e)>=0)return!0;return!1},val:function(t){var o,i,n,s=this[0];{if(arguments.length)return n=X.isFunction(t),this.each(function(i){var s;1===this.nodeType&&(s=n?t.call(this,i,X(this).val()):t,null==s?s="":"number"==typeof s?s+="":X.isArray(s)&&(s=X.map(s,function(t){return null==t?"":t+""})),o=X.valHooks[this.type]||X.valHooks[this.nodeName.toLowerCase()],o&&"set"in o&&o.set(this,s,"value")!==e||(this.value=s))});if(s)return o=X.valHooks[s.type]||X.valHooks[s.nodeName.toLowerCase()],o&&"get"in o&&(i=o.get(s,"value"))!==e?i:(i=s.value,"string"==typeof i?i.replace(me,""):null==i?"":i)}}}),X.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){for(var e,o,i=t.options,n=t.selectedIndex,s="select-one"===t.type||0>n,a=s?null:[],r=s?n+1:i.length,c=0>n?r:s?n:0;r>c;c++)if(o=i[c],!(!o.selected&&c!==n||(X.support.optDisabled?o.disabled:null!==o.getAttribute("disabled"))||o.parentNode.disabled&&X.nodeName(o.parentNode,"optgroup"))){if(e=X(o).val(),s)return e;a.push(e)}return a},set:function(t,e){for(var o,i,n=t.options,s=X.makeArray(e),a=n.length;a--;)i=n[a],(i.selected=X.inArray(X(i).val(),s)>=0)&&(o=!0);return o||(t.selectedIndex=-1),s}}},attr:function(t,o,i){var n,s,a=t.nodeType;if(t&&3!==a&&8!==a&&2!==a)return typeof t.getAttribute===V?X.prop(t,o,i):(1===a&&X.isXMLDoc(t)||(o=o.toLowerCase(),n=X.attrHooks[o]||(X.expr.match.bool.test(o)?le:ce)),i===e?n&&"get"in n&&null!==(s=n.get(t,o))?s:(s=X.find.attr(t,o),null==s?e:s):null!==i?n&&"set"in n&&(s=n.set(t,i,o))!==e?s:(t.setAttribute(o,i+""),i):(X.removeAttr(t,o),void 0))},removeAttr:function(t,e){var o,i,n=0,s=e&&e.match(U);if(s&&1===t.nodeType)for(;o=s[n++];)i=X.propFix[o]||o,X.expr.match.bool.test(o)&&(t[i]=!1),t.removeAttribute(o)},attrHooks:{type:{set:function(t,e){if(!X.support.radioValue&&"radio"===e&&X.nodeName(t,"input")){var o=t.value;return t.setAttribute("type",e),o&&(t.value=o),e}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(t,o,i){var n,s,a,r=t.nodeType;if(t&&3!==r&&8!==r&&2!==r)return a=1!==r||!X.isXMLDoc(t),a&&(o=X.propFix[o]||o,s=X.propHooks[o]),i!==e?s&&"set"in s&&(n=s.set(t,i,o))!==e?n:t[o]=i:s&&"get"in s&&null!==(n=s.get(t,o))?n:t[o]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||ue.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),le={set:function(t,e,o){return e===!1?X.removeAttr(t,o):t.setAttribute(o,o),o}},X.each(X.expr.match.bool.source.match(/\w+/g),function(t,o){var i=X.expr.attrHandle[o]||X.find.attr;X.expr.attrHandle[o]=function(t,o,n){var s=X.expr.attrHandle[o],a=n?e:(X.expr.attrHandle[o]=e)!=i(t,o,n)?o.toLowerCase():null;return X.expr.attrHandle[o]=s,a}}),X.support.optSelected||(X.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),X.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){X.propFix[this.toLowerCase()]=this}),X.each(["radio","checkbox"],function(){X.valHooks[this]={set:function(t,e){return X.isArray(e)?t.checked=X.inArray(X(t).val(),e)>=0:void 0}},X.support.checkOn||(X.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var pe=/^key/,ye=/^(?:mouse|contextmenu)|click/,de=/^(?:focusinfocus|focusoutblur)$/,fe=/^([^.]*)(?:\.(.+)|)$/;X.event={global:{},add:function(t,o,i,n,s){var a,r,c,l,h,m,u,p,y,d,f,x=se.get(t);if(x){for(i.handler&&(a=i,i=a.handler,s=a.selector),i.guid||(i.guid=X.guid++),(l=x.events)||(l=x.events={}),(r=x.handle)||(r=x.handle=function(t){return typeof X===V||t&&X.event.triggered===t.type?e:X.event.dispatch.apply(r.elem,arguments)},r.elem=t),o=(o||"").match(U)||[""],h=o.length;h--;)c=fe.exec(o[h])||[],y=f=c[1],d=(c[2]||"").split(".").sort(),y&&(u=X.event.special[y]||{},y=(s?u.delegateType:u.bindType)||y,u=X.event.special[y]||{},m=X.extend({type:y,origType:f,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&X.expr.match.needsContext.test(s),namespace:d.join(".")},a),(p=l[y])||(p=l[y]=[],p.delegateCount=0,u.setup&&u.setup.call(t,n,d,r)!==!1||t.addEventListener&&t.addEventListener(y,r,!1)),u.add&&(u.add.call(t,m),m.handler.guid||(m.handler.guid=i.guid)),s?p.splice(p.delegateCount++,0,m):p.push(m),X.event.global[y]=!0);t=null}},remove:function(t,e,o,i,n){var s,a,r,c,l,h,m,u,p,y,d,f=se.hasData(t)&&se.get(t);if(f&&(c=f.events)){for(e=(e||"").match(U)||[""],l=e.length;l--;)if(r=fe.exec(e[l])||[],p=d=r[1],y=(r[2]||"").split(".").sort(),p){for(m=X.event.special[p]||{},p=(i?m.delegateType:m.bindType)||p,u=c[p]||[],r=r[2]&&new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=u.length;s--;)h=u[s],!n&&d!==h.origType||o&&o.guid!==h.guid||r&&!r.test(h.namespace)||i&&i!==h.selector&&("**"!==i||!h.selector)||(u.splice(s,1),h.selector&&u.delegateCount--,m.remove&&m.remove.call(t,h));a&&!u.length&&(m.teardown&&m.teardown.call(t,y,f.handle)!==!1||X.removeEvent(t,p,f.handle),delete c[p])}else for(p in c)X.event.remove(t,p+e[l],o,i,!0);X.isEmptyObject(c)&&(delete f.handle,se.remove(t,"events"))}},trigger:function(o,i,n,s){var a,r,c,l,h,m,u,p=[n||L],y=Y.call(o,"type")?o.type:o,d=Y.call(o,"namespace")?o.namespace.split("."):[];if(r=c=n=n||L,3!==n.nodeType&&8!==n.nodeType&&!de.test(y+X.event.triggered)&&(y.indexOf(".")>=0&&(d=y.split("."),y=d.shift(),d.sort()),h=y.indexOf(":")<0&&"on"+y,o=o[X.expando]?o:new X.Event(y,"object"==typeof o&&o),o.isTrigger=s?2:3,o.namespace=d.join("."),o.namespace_re=o.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,o.result=e,o.target||(o.target=n),i=null==i?[o]:X.makeArray(i,[o]),u=X.event.special[y]||{},s||!u.trigger||u.trigger.apply(n,i)!==!1)){if(!s&&!u.noBubble&&!X.isWindow(n)){for(l=u.delegateType||y,de.test(l+y)||(r=r.parentNode);r;r=r.parentNode)p.push(r),c=r;c===(n.ownerDocument||L)&&p.push(c.defaultView||c.parentWindow||t)}for(a=0;(r=p[a++])&&!o.isPropagationStopped();)o.type=a>1?l:u.bindType||y,m=(se.get(r,"events")||{})[o.type]&&se.get(r,"handle"),m&&m.apply(r,i),m=h&&r[h],m&&X.acceptData(r)&&m.apply&&m.apply(r,i)===!1&&o.preventDefault();return o.type=y,s||o.isDefaultPrevented()||u._default&&u._default.apply(p.pop(),i)!==!1||!X.acceptData(n)||h&&X.isFunction(n[y])&&!X.isWindow(n)&&(c=n[h],c&&(n[h]=null),X.event.triggered=y,n[y](),X.event.triggered=e,c&&(n[h]=c)),o.result}},dispatch:function(t){t=X.event.fix(t);var o,i,n,s,a,r=[],c=J.call(arguments),l=(se.get(this,"events")||{})[t.type]||[],h=X.event.special[t.type]||{};if(c[0]=t,t.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,t)!==!1){for(r=X.event.handlers.call(this,t,l),o=0;(s=r[o++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(a=s.handlers[i++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(a.namespace))&&(t.handleObj=a,t.data=a.data,n=((X.event.special[a.origType]||{}).handle||a.handler).apply(s.elem,c),n!==e&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,t),t.result}},handlers:function(t,o){var i,n,s,a,r=[],c=o.delegateCount,l=t.target;if(c&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==t.type){for(n=[],i=0;c>i;i++)a=o[i],s=a.selector+" ",n[s]===e&&(n[s]=a.needsContext?X(s,this).index(l)>=0:X.find(s,this,null,[l]).length),n[s]&&n.push(a);n.length&&r.push({elem:l,handlers:n})}return c<o.length&&r.push({elem:this,handlers:o.slice(c)}),r},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,o){var i,n,s,a=o.button;return null==t.pageX&&null!=o.clientX&&(i=t.target.ownerDocument||L,n=i.documentElement,s=i.body,t.pageX=o.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),t.pageY=o.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),t.which||a===e||(t.which=1&a?1:2&a?3:4&a?2:0),t}},fix:function(t){if(t[X.expando])return t;var e,o,i,n=t.type,s=t,a=this.fixHooks[n];for(a||(this.fixHooks[n]=a=ye.test(n)?this.mouseHooks:pe.test(n)?this.keyHooks:{}),i=a.props?this.props.concat(a.props):this.props,t=new X.Event(s),e=i.length;e--;)o=i[e],t[o]=s[o];return t.target||(t.target=L),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,s):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==c()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===c()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&X.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return X.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==e&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,o,i){var n=X.extend(new X.Event,o,{type:t,isSimulated:!0,originalEvent:{}});i?X.event.trigger(n,null,e):X.event.dispatch.call(e,n),n.isDefaultPrevented()&&o.preventDefault()}},X.removeEvent=function(t,e,o){t.removeEventListener&&t.removeEventListener(e,o,!1)},X.Event=function(t,e){return this instanceof X.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.getPreventDefault&&t.getPreventDefault()?a:r):this.type=t,e&&X.extend(this,e),this.timeStamp=t&&t.timeStamp||X.now(),this[X.expando]=!0,void 0):new X.Event(t,e)},X.Event.prototype={isDefaultPrevented:r,isPropagationStopped:r,isImmediatePropagationStopped:r,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=a,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=a,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=a,this.stopPropagation()}},X.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){X.event.special[t]={delegateType:e,bindType:e,handle:function(t){var o,i=this,n=t.relatedTarget,s=t.handleObj;return(!n||n!==i&&!X.contains(i,n))&&(t.type=s.origType,o=s.handler.apply(this,arguments),t.type=e),o}}}),X.support.focusinBubbles||X.each({focus:"focusin",blur:"focusout"},function(t,e){var o=0,i=function(t){X.event.simulate(e,t.target,X.event.fix(t),!0)};X.event.special[e]={setup:function(){0===o++&&L.addEventListener(t,i,!0)},teardown:function(){0===--o&&L.removeEventListener(t,i,!0)}}}),X.fn.extend({on:function(t,o,i,n,s){var a,c;if("object"==typeof t){"string"!=typeof o&&(i=i||o,o=e);for(c in t)this.on(c,o,i,t[c],s);return this}if(null==i&&null==n?(n=o,i=o=e):null==n&&("string"==typeof o?(n=i,i=e):(n=i,i=o,o=e)),n===!1)n=r;else if(!n)return this;return 1===s&&(a=n,n=function(t){return X().off(t),a.apply(this,arguments)},n.guid=a.guid||(a.guid=X.guid++)),this.each(function(){X.event.add(this,t,n,i,o)})},one:function(t,e,o,i){return this.on(t,e,o,i,1)},off:function(t,o,i){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,X(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(s in t)this.off(s,o,t[s]);return this}return(o===!1||"function"==typeof o)&&(i=o,o=e),i===!1&&(i=r),this.each(function(){X.event.remove(this,t,i,o)})},trigger:function(t,e){return this.each(function(){X.event.trigger(t,e,this)})},triggerHandler:function(t,e){var o=this[0];return o?X.event.trigger(t,e,o,!0):void 0}});var xe=/^.[^:#\[\.,]*$/,_e=/^(?:parents|prev(?:Until|All))/,ge=X.expr.match.needsContext,be={children:!0,contents:!0,next:!0,prev:!0};X.fn.extend({find:function(t){var e,o=[],i=this,n=i.length;if("string"!=typeof t)return this.pushStack(X(t).filter(function(){for(e=0;n>e;e++)if(X.contains(i[e],this))return!0}));for(e=0;n>e;e++)X.find(t,i[e],o);return o=this.pushStack(n>1?X.unique(o):o),o.selector=this.selector?this.selector+" "+t:t,o},has:function(t){var e=X(t,this),o=e.length;return this.filter(function(){for(var t=0;o>t;t++)if(X.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(h(this,t||[],!0))},filter:function(t){return this.pushStack(h(this,t||[],!1))},is:function(t){return!!h(this,"string"==typeof t&&ge.test(t)?X(t):t||[],!1).length},closest:function(t,e){for(var o,i=0,n=this.length,s=[],a=ge.test(t)||"string"!=typeof t?X(t,e||this.context):0;n>i;i++)for(o=this[i];o&&o!==e;o=o.parentNode)if(o.nodeType<11&&(a?a.index(o)>-1:1===o.nodeType&&X.find.matchesSelector(o,t))){o=s.push(o);break}return this.pushStack(s.length>1?X.unique(s):s)},index:function(t){return t?"string"==typeof t?O.call(X(t),this[0]):O.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){var o="string"==typeof t?X(t,e):X.makeArray(t&&t.nodeType?[t]:t),i=X.merge(this.get(),o);return this.pushStack(X.unique(i))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),X.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return X.dir(t,"parentNode")},parentsUntil:function(t,e,o){return X.dir(t,"parentNode",o)},next:function(t){return l(t,"nextSibling")},prev:function(t){return l(t,"previousSibling")},nextAll:function(t){return X.dir(t,"nextSibling")},prevAll:function(t){return X.dir(t,"previousSibling")},nextUntil:function(t,e,o){return X.dir(t,"nextSibling",o)},prevUntil:function(t,e,o){return X.dir(t,"previousSibling",o)},siblings:function(t){return X.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return X.sibling(t.firstChild)},contents:function(t){return t.contentDocument||X.merge([],t.childNodes)}},function(t,e){X.fn[t]=function(o,i){var n=X.map(this,e,o);return"Until"!==t.slice(-5)&&(i=o),i&&"string"==typeof i&&(n=X.filter(i,n)),this.length>1&&(be[t]||X.unique(n),_e.test(t)&&n.reverse()),this.pushStack(n)}}),X.extend({filter:function(t,e,o){var i=e[0];return o&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?X.find.matchesSelector(i,t)?[i]:[]:X.find.matches(t,X.grep(e,function(t){return 1===t.nodeType}))},dir:function(t,o,i){for(var n=[],s=i!==e;(t=t[o])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&X(t).is(i))break;n.push(t)}return n},sibling:function(t,e){for(var o=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&o.push(t);return o}});var De=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ce=/<([\w:]+)/,Be=/<|&#?\w+;/,ve=/<(?:script|style|link)/i,Se=/^(?:checkbox|radio)$/i,Me=/checked\s*(?:[^=]|=\s*.checked.)/i,Ae=/^$|\/(?:java|ecma)script/i,we=/^true\/(.*)/,Te=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ve={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ve.optgroup=Ve.option,Ve.tbody=Ve.tfoot=Ve.colgroup=Ve.caption=Ve.thead,Ve.th=Ve.td,X.fn.extend({text:function(t){return X.access(this,function(t){return t===e?X.text(this):this.empty().append((this[0]&&this[0].ownerDocument||L).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=m(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=m(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var o,i=t?X.filter(t,this):this,n=0;null!=(o=i[n]);n++)e||1!==o.nodeType||X.cleanData(f(o)),o.parentNode&&(e&&X.contains(o.ownerDocument,o)&&y(f(o,"script")),o.parentNode.removeChild(o));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(X.cleanData(f(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return X.clone(this,t,e)})},html:function(t){return X.access(this,function(t){var o=this[0]||{},i=0,n=this.length;if(t===e&&1===o.nodeType)return o.innerHTML;if("string"==typeof t&&!ve.test(t)&&!Ve[(Ce.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(De,"<$1></$2>");try{for(;n>i;i++)o=this[i]||{},1===o.nodeType&&(X.cleanData(f(o,!1)),o.innerHTML=t);o=0}catch(s){}}o&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=X.map(this,function(t){return[t.nextSibling,t.parentNode]}),e=0;return this.domManip(arguments,function(o){var i=t[e++],n=t[e++];n&&(i&&i.parentNode!==n&&(i=this.nextSibling),X(this).remove(),n.insertBefore(o,i))},!0),e?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e,o){t=N.apply([],t);var i,n,s,a,r,c,l=0,h=this.length,m=this,y=h-1,d=t[0],x=X.isFunction(d);if(x||!(1>=h||"string"!=typeof d||X.support.checkClone)&&Me.test(d))return this.each(function(i){var n=m.eq(i);x&&(t[0]=d.call(this,i,n.html())),n.domManip(t,e,o)});if(h&&(i=X.buildFragment(t,this[0].ownerDocument,!1,!o&&this),n=i.firstChild,1===i.childNodes.length&&(i=n),n)){for(s=X.map(f(i,"script"),u),a=s.length;h>l;l++)r=i,l!==y&&(r=X.clone(r,!0,!0),a&&X.merge(s,f(r,"script"))),e.call(this[l],r,l);if(a)for(c=s[s.length-1].ownerDocument,X.map(s,p),l=0;a>l;l++)r=s[l],Ae.test(r.type||"")&&!se.access(r,"globalEval")&&X.contains(c,r)&&(r.src?X._evalUrl(r.src):X.globalEval(r.textContent.replace(Te,"")))}return this}}),X.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){X.fn[t]=function(t){for(var o,i=[],n=X(t),s=n.length-1,a=0;s>=a;a++)o=a===s?this:this.clone(!0),X(n[a])[e](o),F.apply(i,o.get());
return this.pushStack(i)}}),X.extend({clone:function(t,e,o){var i,n,s,a,r=t.cloneNode(!0),c=X.contains(t.ownerDocument,t);if(!(X.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||X.isXMLDoc(t)))for(a=f(r),s=f(t),i=0,n=s.length;n>i;i++)x(s[i],a[i]);if(e)if(o)for(s=s||f(t),a=a||f(r),i=0,n=s.length;n>i;i++)d(s[i],a[i]);else d(t,r);return a=f(r,"script"),a.length>0&&y(a,!c&&f(t,"script")),r},buildFragment:function(t,e,o,i){for(var n,s,a,r,c,l,h=0,m=t.length,u=e.createDocumentFragment(),p=[];m>h;h++)if(n=t[h],n||0===n)if("object"===X.type(n))X.merge(p,n.nodeType?[n]:n);else if(Be.test(n)){for(s=s||u.appendChild(e.createElement("div")),a=(Ce.exec(n)||["",""])[1].toLowerCase(),r=Ve[a]||Ve._default,s.innerHTML=r[1]+n.replace(De,"<$1></$2>")+r[2],l=r[0];l--;)s=s.lastChild;X.merge(p,s.childNodes),s=u.firstChild,s.textContent=""}else p.push(e.createTextNode(n));for(u.textContent="",h=0;n=p[h++];)if((!i||-1===X.inArray(n,i))&&(c=X.contains(n.ownerDocument,n),s=f(u.appendChild(n),"script"),c&&y(s),o))for(l=0;n=s[l++];)Ae.test(n.type||"")&&o.push(n);return u},cleanData:function(t){for(var o,i,s,a,r,c,l=X.event.special,h=0;(i=t[h])!==e;h++){if(n.accepts(i)&&(r=i[se.expando],r&&(o=se.cache[r]))){if(s=Object.keys(o.events||{}),s.length)for(c=0;(a=s[c])!==e;c++)l[a]?X.event.remove(i,a):X.removeEvent(i,a,o.handle);se.cache[r]&&delete se.cache[r]}delete ne.cache[i[ne.expando]]}},_evalUrl:function(t){return X.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});var Le,Pe,Ie=/^(none|table(?!-c[ea]).+)/,Ge=/^margin/,ke=new RegExp("^("+z+")(.*)$","i"),Ee=new RegExp("^("+z+")(?!px)[a-z%]+$","i"),Re=new RegExp("^([+-])=("+z+")","i"),Ne={BODY:"block"},Fe={position:"absolute",visibility:"hidden",display:"block"},Je={letterSpacing:0,fontWeight:400},Oe=["Top","Right","Bottom","Left"],je=["Webkit","O","Moz","ms"];X.fn.extend({css:function(t,o){return X.access(this,function(t,o,i){var n,s,a={},r=0;if(X.isArray(o)){for(n=b(t),s=o.length;s>r;r++)a[o[r]]=X.css(t,o[r],!1,n);return a}return i!==e?X.style(t,o,i):X.css(t,o)},t,o,arguments.length>1)},show:function(){return D(this,!0)},hide:function(){return D(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){g(this)?X(this).show():X(this).hide()})}}),X.extend({cssHooks:{opacity:{get:function(t,e){if(e){var o=Le(t,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,o,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,a,r,c=X.camelCase(o),l=t.style;return o=X.cssProps[c]||(X.cssProps[c]=_(l,c)),r=X.cssHooks[o]||X.cssHooks[c],i===e?r&&"get"in r&&(s=r.get(t,!1,n))!==e?s:l[o]:(a=typeof i,"string"===a&&(s=Re.exec(i))&&(i=(s[1]+1)*s[2]+parseFloat(X.css(t,o)),a="number"),null==i||"number"===a&&isNaN(i)||("number"!==a||X.cssNumber[c]||(i+="px"),X.support.clearCloneStyle||""!==i||0!==o.indexOf("background")||(l[o]="inherit"),r&&"set"in r&&(i=r.set(t,i,n))===e||(l[o]=i)),void 0)}},css:function(t,o,i,n){var s,a,r,c=X.camelCase(o);return o=X.cssProps[c]||(X.cssProps[c]=_(t.style,c)),r=X.cssHooks[o]||X.cssHooks[c],r&&"get"in r&&(s=r.get(t,!0,i)),s===e&&(s=Le(t,o,n)),"normal"===s&&o in Je&&(s=Je[o]),""===i||i?(a=parseFloat(s),i===!0||X.isNumeric(a)?a||0:s):s}}),Le=function(t,o,i){var n,s,a,r=i||b(t),c=r?r.getPropertyValue(o)||r[o]:e,l=t.style;return r&&(""!==c||X.contains(t.ownerDocument,t)||(c=X.style(t,o)),Ee.test(c)&&Ge.test(o)&&(n=l.width,s=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=c,c=r.width,l.width=n,l.minWidth=s,l.maxWidth=a)),c},X.each(["height","width"],function(t,e){X.cssHooks[e]={get:function(t,o,i){return o?0===t.offsetWidth&&Ie.test(X.css(t,"display"))?X.swap(t,Fe,function(){return v(t,e,i)}):v(t,e,i):void 0},set:function(t,o,i){var n=i&&b(t);return C(t,o,i?B(t,e,i,X.support.boxSizing&&"border-box"===X.css(t,"boxSizing",!1,n),n):0)}}}),X(function(){X.support.reliableMarginRight||(X.cssHooks.marginRight={get:function(t,e){return e?X.swap(t,{display:"inline-block"},Le,[t,"marginRight"]):void 0}}),!X.support.pixelPosition&&X.fn.position&&X.each(["top","left"],function(t,e){X.cssHooks[e]={get:function(t,o){return o?(o=Le(t,e),Ee.test(o)?X(t).position()[e]+"px":o):void 0}}})}),X.expr&&X.expr.filters&&(X.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},X.expr.filters.visible=function(t){return!X.expr.filters.hidden(t)}),X.each({margin:"",padding:"",border:"Width"},function(t,e){X.cssHooks[t+e]={expand:function(o){for(var i=0,n={},s="string"==typeof o?o.split(" "):[o];4>i;i++)n[t+Oe[i]+e]=s[i]||s[i-2]||s[0];return n}},Ge.test(t)||(X.cssHooks[t+e].set=C)});var Ye=/%20/g,We=/\[\]$/,Xe=/\r?\n/g,ze=/^(?:submit|button|image|reset|file)$/i,Ue=/^(?:input|select|textarea|keygen)/i;X.fn.extend({serialize:function(){return X.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=X.prop(this,"elements");return t?X.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!X(this).is(":disabled")&&Ue.test(this.nodeName)&&!ze.test(t)&&(this.checked||!Se.test(t))}).map(function(t,e){var o=X(this).val();return null==o?null:X.isArray(o)?X.map(o,function(t){return{name:e.name,value:t.replace(Xe,"\r\n")}}):{name:e.name,value:o.replace(Xe,"\r\n")}}).get()}}),X.param=function(t,o){var i,n=[],s=function(t,e){e=X.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(o===e&&(o=X.ajaxSettings&&X.ajaxSettings.traditional),X.isArray(t)||t.jquery&&!X.isPlainObject(t))X.each(t,function(){s(this.name,this.value)});else for(i in t)A(i,t[i],o,s);return n.join("&").replace(Ye,"+")},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=X:"function"==typeof define&&define.amd&&define("jquery",[],function(){return X}),"object"==typeof t&&"object"==typeof t.document&&(t.jQuery=t.$=X)}(window),define("virtualjoystick",[],function(){var t=function(t){t=t||{},this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._stickEl=t.stickElement||this._buildJoystickStick(),this._baseEl=t.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==t.mouseSupport?t.mouseSupport:!1,this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._baseX=0,this._baseY=0,this._stickX=0,this._stickY=0;var e=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=e(this._onTouchStart,this),this._$onTouchEnd=e(this._onTouchEnd,this),this._$onTouchMove=e(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=e(this._onMouseDown,this),this._$onMouseUp=e(this._onMouseUp,this),this._$onMouseMove=e(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};return t.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},t.touchScreenAvailable=function(){return"createTouch"in document?!0:!1},function(t){t.addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},t.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},t.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t]){for(var e=this._events[t].slice(),o=0;o<e.length;o++){var i=e[o].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}return void 0}}}(t.prototype),t.prototype.deltaX=function(){return this._stickX-this._baseX},t.prototype.deltaY=function(){return this._stickY-this._baseY},t.prototype.up=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),e=this.deltaY();return e>=0?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},t.prototype.down=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),e=this.deltaY();return 0>=e?!1:Math.abs(t)>2*Math.abs(e)?!1:!0},t.prototype.right=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),e=this.deltaY();return 0>=t?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},t.prototype.left=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),e=this.deltaY();return t>=0?!1:Math.abs(e)>2*Math.abs(t)?!1:!0},t.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0},t.prototype._onDown=function(t,e){this._pressed=!0,this._baseX=t,this._baseY=e,this._stickX=t,this._stickY=e,this._stickEl.style.display="",this._stickEl.style.left=t-this._stickEl.width/2+"px",this._stickEl.style.top=e-this._stickEl.height/2+"px",this._baseEl.style.display="",this._baseEl.style.left=t-this._baseEl.width/2+"px",this._baseEl.style.top=e-this._baseEl.height/2+"px"},t.prototype._onMove=function(t,e){this._pressed===!0&&(this._stickX=t,this._stickY=e,this._stickEl.style.left=t-this._stickEl.width/2+"px",this._stickEl.style.top=e-this._stickEl.height/2+"px")},t.prototype._onMouseUp=function(){return this._onUp()},t.prototype._onMouseDown=function(t){var e=t.clientX,o=t.clientY;return this._onDown(e,o)},t.prototype._onMouseMove=function(t){var e=t.clientX,o=t.clientY;return this._onMove(e,o)},t.prototype._onTouchStart=function(t){if(null===this._touchIdx){var e=this.dispatchEvent("touchStartValidation",t);if(e!==!1){t.preventDefault();var o=t.changedTouches[0];this._touchIdx=o.identifier;var i=o.pageX,n=o.pageY;return this._onDown(i,n)}}},t.prototype._onTouchEnd=function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,o=0;o<e.length&&e[o].identifier!==this._touchIdx;o++);if(o!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}},t.prototype._onTouchMove=function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,o=0;o<e.length&&e[o].identifier!==this._touchIdx;o++);if(o!==e.length){var i=e[o];t.preventDefault();var n=i.pageX,s=i.pageY;return this._onMove(n,s)}}},t.prototype._buildJoystickBase=function(){var t=document.createElement("canvas");t.width=126,t.height=126;var e=t.getContext("2d");return e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=6,e.arc(t.width/2,t.width/2,40,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=2,e.arc(t.width/2,t.width/2,60,0,2*Math.PI,!0),e.stroke(),t},t.prototype._buildJoystickStick=function(){var t=document.createElement("canvas");t.width=86,t.height=86;var e=t.getContext("2d");return e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=6,e.arc(t.width/2,t.width/2,40,0,2*Math.PI,!0),e.stroke(),t},t}),define("systems/playercontrol",["jquery","lodash","pc","vent","virtualjoystick"],function(t,e,o,i,n){return o.systems.Input.extend("PlayerControlSystem",{},{init:function(){this.joystickR=new n({container:t("#virtualjoystick")[0],strokeStyle:"cyan"}),this.joystickR.addEventListener("touchStartValidation",function(t){var e=t.changedTouches[0];return e.pageX>=window.innerWidth/2?!1:!0}),this.joystickL=new n({container:t("#virtualjoystick")[0],strokeStyle:"orange"}),this.joystickL.addEventListener("touchStartValidation",function(t){var e=t.changedTouches[0];return e.pageX<window.innerWidth/2?!1:!0}),this._super()},process:function(t){var e,n,s,a=t.getComponent("input"),r=t.getComponent("state");return a?(this._super(t),r.isAlive()&&(this.isInputState(t,"moving up")||this.joystickR.up()?e="N":this.isInputState(t,"moving down")||this.joystickR.down()?e="S":this.isInputState(t,"moving right")||this.joystickR.right()?e="E":(this.isInputState(t,"moving left")||this.joystickR.left())&&(e="W"),n=this.isInputState(t,"attacking"),n||(this.joystickL.up()?(e="N",n=!0):this.joystickL.down()?(e="S",n=!0):this.joystickL.right()?(e="E",n=!0):this.joystickL.left()&&(e="W",n=!0)),n?s=["attack",e||a.lastDirection||"S"]:e?s=["move",e||a.lastDirection||"S"]:a&&(s=["stop"]),(s[0]!==a.lastAction||s[1]!==a.lastDirection)&&(a.lastAction=s[0],a.lastDirection=s[1]||a.lastDirection,i.trigger("input",s[0],s[1]))),void 0):(o.device.input.stateBindings.clear(),void 0)}})}),define("systems/meta",["pc"],function(t){return t.systems.EntitySystem.extend("MetaSystem",{},{init:function(){this._super(["meta"])},process:function(e){var o=e.getComponent("spatial"),i=e.getComponent("meta"),n=(i.username,t.device.ctx);o&&i&&i.username&&(n.font="11px ponderosa,monospace",n.textAlign="center",n.fillStyle=e.hasTag("PLAYER")?"rgba(255,255,255,1.0)":"rgba(255,157,0,1.0)",n.fillText(i.username,e.layer.screenX(o.pos.x+.5*o.getDim().x),e.layer.screenY(o.pos.y+.12*o.getDim().y)))}})}),define("lobbymanager",["jquery","lodash","vent"],function(t,e,o){var i=function(){this.show=function(){this.$lobby.show()},this.hide=function(){this.$lobby.hide()},this.updatedLeaderBoard=function(){var e=this,o=t("<table/>"),i="<tr><td>Pos</td><td>Player</td><td>Kills</td><td>Deaths</td><td>Score</td></tr>",n=_.map(this.metacollector,function(t){return t}),n=_.sortBy(n,"score");o.append(i),_.each(n,function(t,i){t.position=i+1,o.append(e.leaderboardEntryTpl(t))}),this.$leaderboard.html(o)},this.getRandomName=function(){var t=["Aayla Secura","Ackbar","Isard","Motti","Ahsoka Tano","Anakin Solo","Asajj","Ventress","Aurra Sing","Bail Organa","Barriss","Offee","Bastila Shan","Bib Fortuna","Biggs","Boba Fett","Bossk","Boss Nass","C3P0","Cad Bane","Ordo","Captain Rex","Chewbacca","Cody","Count Dooku","Dak","Bane","Krayt","Malak","Maul","Nihilus","Revan","Sion","Traya","Vader","Dash Rendar","Dengar","Desann","Evazan","Durge","Palpatine","Exar Kun","Grievous","General","Madine","Gilad","Pellaeon","Thrawn","Greedo","Han Solo","HK-47","Hondo Ohnaka","IG-88","Jabba","Jacen Solo","Jaina Solo","Jango Fett","Jaxxon","Jek Porkins","Jerec","Joruus C'baoth","Ki-Adi-Mundi","Kir Kanos","Kit Fisto","Kyle Katarn","Lando","Calrissian","Lobot","Skywalker","Luminara","Unduli","Lumiya","Mace Windu","Mara Jade","Max Rebo","Mon Mothma","Natasi Daala","Nien Nunb","Noa","Briqualon","Obi-Wan Kenobi","Oola","Amidala","Plo Koon","Leia","Prince Xizor","PROXY","Qui-Gon Jinn","Quinlan Vos","R2-D2","Salacious","Sebulba","Shaak Ti","Starkiller","Talon Karrde","Uncle Owen","Watto","Antilles","Wicket","Yaddle","Yoda","Zam Wesell"],e=["Darth","Commander","Lord","Emperor","Duke"],o=t[_.random(t.length-1)],i=e[_.random(e.length-1)],n=i+" "+o;return n.length>12?o:n},this.init=function(){var e=this;this.metacollector={},this.leaderboardEntryTpl=_.template("<tr><td><%- position %></td><td><%- username %></td><td><%- kills %></td><td><%- deaths %></td><td><%- score %></td></tr>"),t(".username").val().length||t(".username").val(this.getRandomName()),this.$lobby=t(".lobby"),this.$leaderboard=this.$lobby.find(".leaderboard"),this.$lobby.on("change",".username",function(){o.trigger("username",t(this).val())}),this.$lobby.on("click",".spawn",function(){o.trigger("username",t(".username").val()),o.trigger("spawn")}),this.$lobby.on("click",".need-help",function(){t(".help").toggle()}),o.on("connected",function(){e.$lobby.find(".status").text("Connected :)"),_.delay(function(){o.trigger("username",t(".username").val())},100),e.$lobby.find(".spawn").show()}),o.on("disconnected",function(){e.$lobby.show(),e.$lobby.find(".status").text("Connection lost :("),e.$lobby.find(".spawn").hide()}),o.on("meta",function(t){e.metacollector[t.id]=t,e.updatedLeaderBoard()}),o.on("remove",function(t){e.metacollector[t.id]&&(delete e.metacollector[t.id],e.updatedLeaderBoard())})}};return new i}),define("scenes/game",["lodash","pc","vent","entityfactory","systems/playercontrol","systems/meta","lobbymanager"],function(t,e,o,i,n,s,a){var r=e.Scene.extend("pc.archers.GameScene",{},{entities:{},cameraOperationLag:0,init:function(){var r,c,l,h=this;for(this._super(),this.factory=new i,this.playercontrol=new n,this.loadFromTMX(e.device.loader.get("map").resource,this.factory),this.layer=this.get("500main"),l=this.layers.first;l;)r=l.object(),c=r.name.match(/\d+/),c&&c.length&&r.setZIndex(parseInt(c[0],10)),r.setOriginTrack(this.layer),l=l.next();this.layer.addSystem(new e.systems.Render),this.layer.addSystem(this.playercontrol),this.layer.addSystem(new s),o.on("update",function(t){if(h.isActive()){var o=e.Point.create(t.width,t.height),i={id:t.id,state:t.state,player:t.player};h.entities[t.id]=h.factory.createEntity(h.layer,t.entityType,t.x,t.y,t.direction,o,i)}}),o.on("frame",function(e){if(h.isActive()){var o=h.entities[e.id],i=o.getComponent("spatial"),n=o.getComponent("state"),s=o.getComponent("sprite"),r=["dead","unknown"];i&&(i.getPos().x=e.x-.5*i.getDim().x,i.getPos().y=e.y-.5*i.getDim().y),n&&s&&(o.hasTag("PLAYER")&&!t.contains(r,n.state)&&t.contains(r,e.state)&&(a.show(),h.player.getComponent("input")._bound=!1,h.player.removeComponentByType("input")),o.hasTag("PLAYER")&&t.contains(r,n.state)&&!t.contains(r,e.state)&&(a.hide(),h.player.addComponent(h.factory.getInput())),n.changeState(s,e.state,e.direction))}}),o.on("remove",function(t){if(h.isActive()){var e=h.entities[t.id];e.remove()}}),o.on("meta",function(t){var e,o=h.entities[t.id];o&&(e=o.getComponent("meta"),e&&e.update(t))})},onActivated:function(){a.show()},onDeactivated:function(){a.hide()},hoverCamera:function(){var t,e,o,i=this.layers.first.object(),n=i.tileMap.tileWidth*i.tileMap.tilesWide,s=i.tileMap.tileHeight*i.tileMap.tilesHigh,a=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};this.viewPort.w>=n||this.viewPort.h>=s||(this.cameraOperationLag++,4==this.cameraOperationLag?(t=this.layer.origin.x+1,this.cameraOperationLag=0):t=this.layer.origin.x,e=t+this.viewPort.w,o=this.layer.origin.y+this.viewPort.h,e>n||o>s?this.layer.setOrigin(a(1,n-this.viewPort.w),a(1,n-this.viewPort.h)):this.layer.setOrigin(t,this.layer.origin.y))},process:function(){var t,o;e.device.loader.finished&&(t=this.layer.entityManager.getTagged("PLAYER"),t&&(this.player=t=t.first.object(),o=t.getComponent("state")),t&&o.isAlive()?this.layer.setOrigin(t.getComponent("spatial").getCenterPos().x-this.viewPort.w/2,t.getComponent("spatial").getCenterPos().y-this.viewPort.h/2):this.hoverCamera(),e.device.ctx.clearRect(0,0,e.device.canvasWidth,e.device.canvasHeight),this._super())}});return r}),define("archers",["pc","networking","scenes/game","lobbymanager"],function(t,e,o,i){var n=t.Game.extend("Archers",{},{onReady:function(){this._super(),i.init(),t.device.loader.add(new t.DataResource("map","/resources/map.tmx")),t.device.loader.add(new t.Image("combined","/resources/tiles.png")),t.device.loader.add(new t.Image("archer","/resources/archer.png")),t.device.loader.add(new t.Image("arrow","/resources/arrow.png")),t.device.loader.add(new t.Image("skeleton","/resources/skeleton.png")),t.device.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this))},onLoading:function(e){var o=t.device.ctx;o.clearRect(0,0,t.device.canvasWidth,t.device.canvasHeight),o.font="normal 50px Times",o.fillStyle="#bbb",o.fillText("Archers!",40,t.device.canvasHeight/2-50),o.font="normal 14px Verdana",o.fillStyle="#777",o.fillText("Loading:  "+e+"%",40,t.device.canvasHeight/2)},onLoaded:function(){this.gameScene=new o,this.addScene(this.gameScene),this.activateScene(this.gameScene),this.networking=new e}});return n}),define("bootstrap",["pc","archers"],function(t,e){window.Archers=e,t.device.boot("game","Archers")}),require(["bootstrap"])}();