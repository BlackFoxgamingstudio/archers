function printStackTrace(e){e=e||{guess:!0};var t=e.e||null,n=!!e.guess,r=new printStackTrace.implementation,i=r.run(t);return n?r.guessAnonymousFunctions(i):i}window.pc||(window.pc={},pc.VERSION="0.5.6"),window.gamecore={hasOwn:Object.prototype.hasOwnProperty,isFunction:function(e){return!!(e&&e.constructor&&e.call&&e.apply)},isWindow:function(e){return!!e&&!!e.setInterval},isArray:Array.isArray||function(e){return e.constructor===Array},isString:function(e){return typeof e=="string"},isObject:function(e){return e===Object(e)},isPlainObject:function(e){if(!e||this.isObject(e)||e.nodeType||this.isWindow(e))return!1;try{if(e.constructor&&!this.hasOwn.call(e,"constructor")&&!this.hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return n===undefined||this.hasOwn.call(e,n)},extend:function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!gamecore.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(this.isPlainObject(r)||(i=this.isArray(r)))?(i?(i=!1,s=n&&this.isArray(n)?n:[]):s=n&&this.isPlainObject(n)?n:{},o[t]=this.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o}},gamecore.push=Array.prototype.push,gamecore.merge=function(e,t){var n=e.length,r=0;if(typeof t.length=="number")for(var i=t.length;r<i;r++)e[n++]=t[r];else while(t[r]!==undefined)e[n++]=t[r++];return e.length=n,e},gamecore.makeArray=function(e,t){var n=t||[];return e!=null&&(e.length==null||gamecore.isString(e)||gamecore.isFunction(e)||gamecore.isWindow(e)?gamecore.push.call(n,e):gamecore.merge(n,e)),n},gamecore.each=function(e,t,n){var r,i=0,s=e.length,o=s===undefined||gamecore.isFunction(e);if(n){if(o){for(r in e)if(t.apply(e[r],n)===!1)break}else for(;i<s;)if(t.apply(e[i++],n)===!1)break}else if(o){for(r in e)if(t.call(e[r],r,e[r])===!1)break}else for(;i<s;)if(t.call(e[i],i,e[i++])===!1)break;return e},gamecore._flagsCache={},gamecore.createFlags=function(e){var t=gamecore._flagsCache[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t},gamecore.Callbacks=function(e){e=e?gamecore._flagsCache[e]||gamecore.createFlags(e):{};var t=[],n=[],r,i,s,o,u,a=function(n){var r,i,s,o;for(r=0,i=n.length;r<i;r++)s=n[r],gamecore.isArray(s)?a(s):gamecore.isFunction(s)&&(!e.unique||!l.has(s))&&t.push(s)},f=function(a,f){f=f||[],r=!e.memory||[a,f],i=!0,u=s||0,s=0,o=t.length;for(;t&&u<o;u++)if(t[u].apply(a,f)===!1&&e.stopOnFalse){r=!0;break}i=!1,t&&(e.once?r===!0?l.disable():t=[]:n&&n.length&&(r=n.shift(),l.fireWith(r[0],r[1])))},l={add:function(){if(t){var e=t.length;a(arguments),i?o=t.length:r&&r!==!0&&(s=e,f(r[0],r[1]))}return this},remove:function(){if(t){var n=arguments,r=0,s=n.length;for(;r<s;r++)for(var a=0;a<t.length;a++)if(n[r]===t[a]){i&&a<=o&&(o--,a<=u&&u--),t.splice(a--,1);if(e.unique)break}}return this},has:function(e){if(t){var n=0,r=t.length;for(;n<r;n++)if(e===t[n])return!0}return!1},empty:function(){return t=[],this},disable:function(){return t=n=r=undefined,this},disabled:function(){return!t},lock:function(){return n=undefined,(!r||r===!0)&&l.disable(),this},locked:function(){return!n},fireWith:function(t,s){return n&&(i?e.once||n.push([t,s]):(!e.once||!r)&&f(t,s)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},gamecore.extend({Deferred:function(e){var t=gamecore.Callbacks("once memory"),n=gamecore.Callbacks("once memory"),r=gamecore.Callbacks("memory"),i="pending",s={resolve:t,reject:n,notify:r},o={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return u.done(e).fail(t).progress(n),this},always:function(){return u.done.apply(u,arguments).fail.apply(u,arguments),this},pipe:function(e,t,n){return gamecore.Deferred(function(r){gamecore.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],s;gamecore.isFunction(n)?u[e](function(){s=n.apply(this,arguments),s&&gamecore.isFunction(s.promise)?s.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===u?r:this,[s])}):u[e](r[i])})}).promise()},promise:function(e){if(e==null)e=o;else for(var t in o)e[t]=o[t];return e}},u=o.promise({}),a;for(a in s)u[a]=s[a].fire,u[a+"With"]=s[a].fireWith;return u.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(u,u),u},when:function(e){function l(e){return function(r){n[e]=arguments.length>1?t.call(arguments,0):r,--o||a.resolveWith(a,n)}}function c(e){return function(n){s[e]=arguments.length>1?t.call(arguments,0):n,a.notifyWith(f,s)}}var t=[].slice,n=t.call(arguments,0),r=0,i=n.length,s=new Array(i),o=i,u=i,a=i<=1&&e&&gamecore.isFunction(e.promise)?e:gamecore.Deferred(),f=a.promise();if(i>1){for(;r<i;r++)n[r]&&n[r].promise&&gamecore.isFunction(n[r].promise)?n[r].promise().then(l(r),a.reject,c(r)):--o;o||a.resolveWith(a,n)}else a!==e&&a.resolveWith(a,i?[e]:[]);return f}}),define("playcraft/ext/gamecore.js/src/gamecore",function(){}),function(e){var t={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowUp:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},n=function(e,t,n){return e[t]||n&&(e[t]={})},r=function(e){var t=typeof e;return t&&(t=="function"||t=="object")},i=function(i,s,o){var u=i?i.split(t.dot):[],a=u.length,f=e.isArray(s)?s:[s||window],l,c,h,p=0,d;if(a==0)return f[0];while(l=f[p++]){for(h=0;h<a-1&&r(l);h++)l=n(l,u[h],o);if(r(l)){c=n(l,u[h],o);if(c!==undefined)return o===!1&&delete l[u[h]],c}}},s=e.String={getObject:i,capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.substr(1)},camelize:function(e){return e=s.classize(e),e.charAt(0).toLowerCase()+e.substr(1)},classize:function(e,n){var r=e.split(t.undHash),i=0;for(;i<r.length;i++)r[i]=s.capitalize(r[i]);return r.join(n||"")},niceName:function(e){return s.classize(e," ")},underscore:function(e){return e.replace(t.colons,"/").replace(t.words,"$1_$2").replace(t.lowUp,"$1_$2").replace(t.dash,"_").toLowerCase()},sub:function(e,n,r){var s=[];return s.push(e.replace(t.replacer,function(e,t){var o=i(t,n,typeof r=="boolean"?!r:r),u=typeof o;return u!=="object"&&u!=="function"||u===null?""+o:(s.push(o),"")})),s.length<=1?s[0]:s}}}(gamecore),function(e){var t=!1,n=e.makeArray,r=e.isFunction,i=e.isArray,s=e.extend,o=function(e){if(!e||typeof e!="object")return e;if(e instanceof Array){var t=[];for(var n=0;n<e.length;n++)t[n]=o(e[n]);return t}var r={};for(var i in e)r[i]=o(e[i]);return r},u=function(e,t){return e.concat(n(t))},a=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,f=function(e,t,n){n=n||e;for(var i in e)n[i]=r(e[i])&&r(t[i])&&a.test(e[i])?function(e,n){return function(){var r=this._super,i;return this._super=t[e],i=n.apply(this,arguments),this._super=r,i}}(i,e[i]):e[i]},l=e.Class=function(){if(arguments.length)return l.extend.apply(l,arguments)};s(l,{callback:function(e){var t=n(arguments),r;return e=t.shift(),i(e)||(e=[e]),r=this,function(){var s=u(t,arguments),o,a=e.length,f=0,l;for(;f<a;f++){l=e[f];if(!l)continue;o=typeof l=="string",o&&r._set_called&&(r.called=l),s=(o?r[l]:l).apply(r,s||[]),f<a-1&&(s=!i(s)||s._use_call?[s]:s)}return s}},getObject:e.String.getObject,newInstance:function(){var e=this.rawInstance(),t;e.setup&&(t=e.setup.apply(e,arguments));for(var n in e.__proto__)e[n]=o(e[n]);return e.init&&e.init.apply(e,i(t)?t:arguments),e},setup:function(e,t){return this.defaults=s(!0,{},e.defaults,this.defaults),this._types==undefined&&(this._types=[]),this._types.push(this.fullName),this._fullTypeName==undefined&&(this._fullTypeName="|"),this._fullTypeName+=this.fullName+"|",arguments},rawInstance:function(){t=!0;var e=new this;return t=!1,e},extend:function(e,n,r){function v(){if(t)return;return this.constructor!==v&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}typeof e!="string"&&(r=n,n=e,e=null),r||(r=n,n=null),r=r||{};var i=this,a=this.prototype,c,h,p,d;this.isA=function(e){return this._fullTypeName.indexOf("|"+e+"|")!=-1},t=!0,d=new this,t=!1,f(r,a,d);for(c in this)this.hasOwnProperty(c)&&(v[c]=o(this[c]));f(n,this,v);if(e){var m=e.split(/\./),h=m.pop();m.length>0&&(current=l.getObject(m.join("."),window,!0),p=current),current[h]=v}s(v,{prototype:d,namespace:p,shortName:h,constructor:v,fullName:e}),v.prototype.Class=v.prototype.constructor=v;var g=v.setup.apply(v,u([i],arguments));return v.init&&v.init.apply(v,g||[]),v}}),l.prototype.callback=l.callback}(gamecore),define("playcraft/ext/gamecore.js/src/class",function(){}),gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(e,t,n){var r="";e&&(r=":"+e),console.log(this.fullName+r+" ["+t+"] "+n)},warn:function(e){this.log(null,this.WARN,e)},debug:function(e){this.log(null,this.DEBUG,e)},error:function(e){this.log(null,this.ERROR,e)},info:function(e){this.log(null,this.INFO,e)},assert:function(e,t){if(!t)throw e}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++,this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(e){this.Class.log(this.objectId,this.Class.WARN,e)},debug:function(e){this.Class.log(this.objectId,this.Class.DEBUG,e)},error:function(e){this.Class.log(this.objectId,this.Class.ERROR,e)},info:function(e){this.Class.log(this.objectId,this.Class.INFO,e)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}}),define("playcraft/ext/gamecore.js/src/base",function(){}),gamecore.Hashtable=function(){function n(t){var r;if(typeof t=="string")return t;if(typeof t.hashCode==e)return r=t.hashCode(),typeof r=="string"?r:n(r);if(typeof t.toString==e)return t.toString();try{return String(t)}catch(i){return Object.prototype.toString.call(t)}}function r(e,t){return e.equals(t)}function i(t,n){return typeof n.equals==e?n.equals(t):t===n}function s(e){return function(t){if(t===null)throw new Error("null is not a valid "+e);if(typeof t=="undefined")throw new Error(e+" must not be undefined")}}function a(e,t,n,r){this[0]=e,this.entries=[],this.addEntry(t,n),r!==null&&(this.getEqualityFunction=function(){return r})}function h(e){return function(t){var n=this.entries.length,r,i=this.getEqualityFunction(t);while(n--){r=this.entries[n];if(i(t,r[0]))switch(e){case f:return!0;case l:return r;case c:return[n,r[1]]}}return!1}}function p(e){return function(t){var n=t.length;for(var r=0,i=this.entries.length;r<i;++r)t[n+r]=this.entries[r][e]}}function d(e,t){var n=e.length,r;while(n--){r=e[n];if(t===r[0])return n}return null}function v(e,t){var n=e[t];return n&&n instanceof a?n:null}function m(r,i){var s=this,f=[],l={},c=typeof r==e?r:n,h=typeof i==e?i:null;this.put=function(e,t){o(e),u(t);var n=c(e),r,i,s=null;return r=v(l,n),r?(i=r.getEntryForKey(e),i?(s=i[1],i[1]=t):r.addEntry(e,t)):(r=new a(n,e,t,h),f[f.length]=r,l[n]=r),s},this.get=function(e){o(e);var t=c(e),n=v(l,t);if(n){var r=n.getEntryForKey(e);if(r)return r[1]}return null},this.containsKey=function(e){o(e);var t=c(e),n=v(l,t);return n?n.containsKey(e):!1},this.containsValue=function(e){u(e);var t=f.length;while(t--)if(f[t].containsValue(e))return!0;return!1},this.clear=function(){f.length=0,l={}},this.isEmpty=function(){return!f.length};var p=function(e){return function(){var t=[],n=f.length;while(n--)f[n][e](t);return t}};this.keys=p("keys"),this.values=p("values"),this.entries=p("getEntries"),this.remove=function(e){o(e);var n=c(e),r,i=null,s=v(l,n);return s&&(i=s.removeEntryForKey(e),i!==null&&(s.entries.length||(r=d(f,n),t(f,r),delete l[n]))),i},this.size=function(){var e=0,t=f.length;while(t--)e+=f[t].entries.length;return e},this.each=function(e){var t=s.entries(),n=t.length,r;while(n--)r=t[n],e(r[0],r[1])},this.putAll=function(t,n){var r=t.entries(),i,o,u,a,f=r.length,l=typeof n==e;while(f--)i=r[f],o=i[0],u=i[1],l&&(a=s.get(o))&&(u=n(o,a,u)),s.put(o,u)},this.clone=function(){var e=new m(r,i);return e.putAll(s),e},this.toString=function(){var e="",t=this.keys();for(var n=0;n<t.length;n++){var r=this.get(t[n]);e+=t[n].toString()+" = "+r.toString()+"\n"}return e}}var e="function",t=typeof Array.prototype.splice==e?function(e,t){e.splice(t,1)}:function(e,t){var n,r,i;if(t===e.length-1)e.length=t;else{n=e.slice(t+1),e.length=t;for(r=0,i=n.length;r<i;++r)e[t+r]=n[r]}},o=s("key"),u=s("value"),f=0,l=1,c=2;return a.prototype={getEqualityFunction:function(t){return typeof t.equals==e?r:i},getEntryForKey:h(l),getEntryAndIndexForKey:h(c),removeEntryForKey:function(e){var n=this.getEntryAndIndexForKey(e);return n?(t(this.entries,n[0]),n[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]},keys:p(0),values:p(1),getEntries:function(e){var t=e.length;for(var n=0,r=this.entries.length;n<r;++n)e[t+n]=this.entries[n].slice(0)},containsKey:h(f),containsValue:function(e){var t=this.entries.length;while(t--)if(e===this.entries[t][1])return!0;return!1}},m}(),define("playcraft/ext/gamecore.js/src/jhashtable",function(){}),gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1,this.isiPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1,this.isiPod=navigator.userAgent.toLowerCase().indexOf("ipod")!=-1,this.isiPhone4=this.pixelRatio==2&&this.isiPhone,this.isiPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,this.isAndroid=navigator.userAgent.toLowerCase().indexOf("android")!=-1,this.isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,this.isChrome=navigator.userAgent.toLowerCase().indexOf("chrome")!=-1,this.isOpera=navigator.userAgent.toLowerCase().indexOf("opera")!=-1,this.isTouch="ontouchstart"in document.documentElement,this.isiOS=this.isiPhone||this.iPad||this.isiPod,window.performance!=undefined&&(this.hasMemoryProfiling=window.performance.memory),/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var e=new Audio;e.canPlayType("audio/ogg")&&(this.canPlayOgg=!0),e.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0),e.canPlayType("audio/x-wav")&&(this.canPlayWav=!0),this.requestAnimFrame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,16,Date.now())};return function(t,n){e.apply(window,[t,n])}}()},canPlay:function(e){return e.toLowerCase()==="mp3"&&this.canPlayMP3?!0:e.toLowerCase()==="ogg"&&this.canPlayOgg?!0:e.toLowerCase()==="wav"&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{}),define("playcraft/ext/gamecore.js/src/device",function(){}),gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(e){this.description=e,this.start(),this.Class.history.push(this)},start:function(){this.timeStart=Date.now(),this.memStart=gamecore.Device.getUsedHeap()},end:function(){return this.timeEnd=Date.now(),this.timeDelta=this.timeEnd-this.timeStart,this.memEnd=gamecore.Device.getUsedHeap(),this.memEnd<this.memStart?this.memDelta=0:this.memDelta=this.memEnd-this.memStart,this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(this.memDelta==0?"unknown":this.memDelta)+" byte(s)"}}),define("playcraft/ext/gamecore.js/src/perf",function(){}),gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}}),gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super(),this.objToNodeMap=new gamecore.Hashtable},getNode:function(e){return this.objToNodeMap.get(e.getUniqueId())},addNode:function(e){var t=new gamecore.LinkedNode;return t.obj=e,t.prevLinked=null,t.nextLinked=null,t.free=!1,this.objToNodeMap.put(e.getUniqueId(),t),t},add:function(e){var t=this.getNode(e);if(t==null)t=this.addNode(e);else{if(t.free==0)throw"Attempting to add object: "+e.getUniqueId()+" twice to list "+this.getUniqueId();t.obj=e,t.free=!1,t.nextLinked=null,t.prevLinked=null}if(this.first==null)this.first=t,this.last=t,t.nextLinked=null,t.prevLinked=null;else{if(this.last==null)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=t,t.prevLinked=this.last,this.last=t,t.nextLinked=null}this.count++,this.showDebug&&this.dump("after add")},has:function(e){var t=this.getNode(e);return t!=null&&t.free!=1},moveUp:function(e){this.dump("before move up");var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.prevLinked==null)return;var n=t.prevLinked,r=n.prevLinked;t==this.last&&(this.last=n);var i=t.nextLinked;r&&(r.nextLinked=t),t.nextLinked=n,t.prevLinked=n.prevLinked,n.nextLinked=i,n.prevLinked=t,this.first==n&&(this.first=t)},moveDown:function(e){var t=this.getNode(e);if(!t)throw"Oops, trying to move an object that isn't in the list";if(t.nextLinked==null)return;var n=t.nextLinked;this.moveUp(n.obj),this.last==n&&(this.last=t)},sort:function(e){var t=[],n=this.first;while(n)t.push(n.object()),n=n.next();this.clear(),t.sort(e);for(var r=0;r<t.length;r++)this.add(t[r])},remove:function(e){this.showDebug&&this.dump("before remove of "+e);var t=this.getNode(e);return t==null||t.free==1?!1:(t.prevLinked!=null&&(t.prevLinked.nextLinked=t.nextLinked),t.nextLinked!=null&&(t.nextLinked.prevLinked=t.prevLinked),t.prevLinked==null&&(this.first=t.nextLinked),t.nextLinked==null&&(this.last=t.prevLinked),t.free=!0,t.prevLinked=null,t.nextLinked=null,this.count--,this.showDebug&&this.dump("after remove"),!0)},clear:function(){var e=this.first;while(e!=null)e.free=!0,e=e.nextLinked;this.first=null,this.count=0},length:function(){return this.count},dump:function(e){this.debug("===================="+e+"=====================");var t=this.first;while(t!=null)this.debug("{"+t.obj.toString()+"} previous="+(t.prevLinked?t.prevLinked.obj:"NULL")),t=t.next();this.debug("==================================="),this.debug("Last: {"+(this.last?this.last.obj:"NULL")+"} "+"First: {"+(this.first?this.first.obj:"NULL")+"}")}}),define("playcraft/ext/gamecore.js/src/linkedlist",function(){}),gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(e,t){var n=this.hashtable.get(e);n==null&&(n=new pc.LinkedList,this.hashtable.put(e,n)),n.add(t)},remove:function(e,t){var n=this.hashtable.get(e);if(n==null)throw"No list for a key in hashlist when removing";n.remove(t)},get:function(e){return this.hashtable.get(e)}}),define("playcraft/ext/gamecore.js/src/hashlist",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(e,t){return e=e||this.createException(),t=t||this.mode(e),t==="other"?this.other(arguments.callee):this[t](e)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return e.arguments&&e.stack?"chrome":typeof e.message=="string"&&typeof window!="undefined"&&window.opera?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":e.stack?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":e.stack?"firefox":"other"},instrumentFunction:function(e,t,n){e=e||window;var r=e[t];e[t]=function(){return n.call(this,printStackTrace().slice(4)),e[t]._instrumented.apply(this,arguments)},e[t]._instrumented=r},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){var t=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return t.pop(),t},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(e){var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[4]+":"+u[1]+":"+u[2],f=u[3]||"global code";f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),i.push(f+"@"+a+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera10b:function(e){var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),r=[];for(var i=0,s=n.length;i<s;i++){var o=t.exec(n[i]);if(o){var u=o[1]?o[1]+"()":"global code";r.push(u+"@"+o[2]+":"+o[3])}}return r},opera10a:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[3]||t;i.push(a+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera9:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[];for(var s=2,o=r.length;s<o;s+=2){var u=n.exec(r[s]);u&&i.push(t+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}return i},other:function(e){var t="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,r=[],i,s,o=10;while(e&&e.arguments&&r.length<o)i=n.test(e.toString())?RegExp.$1||t:t,s=Array.prototype.slice.call(e.arguments||[]),r[r.length]=i+"("+this.stringifyArguments(s)+")",e=e.caller;return r},stringifyArguments:function(e){var t=[],n=Array.prototype.slice;for(var r=0;r<e.length;++r){var i=e[r];i===undefined?t[r]="undefined":i===null?t[r]="null":i.constructor&&(i.constructor===Array?i.length<3?t[r]="["+this.stringifyArguments(i)+"]":t[r]="["+this.stringifyArguments(n.call(i,0,1))+"..."+this.stringifyArguments(n.call(i,-1))+"]":i.constructor===Object?t[r]="#object":i.constructor===Function?t[r]="#function":i.constructor===String?t[r]='"'+i+'"':i.constructor===Number&&(t[r]=i))}return t.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){}return""},createXMLHTTPObject:function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(r){}},isSameDomain:function(e){return typeof location!="undefined"&&e.indexOf(location.hostname)!==-1},getSource:function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,i=e[t],s=n.exec(i);if(s){var o=r.exec(s[1]);if(o){var u=o[1],a=o[2],f=o[3]||0;if(u&&this.isSameDomain(u)&&a){var l=this.guessAnonymousFunction(u,a,f);e[t]=i.replace("{anonymous}",l)}}}}return e},guessAnonymousFunction:function(e,t,n){var r;try{r=this.findFunctionName(this.getSource(e),t)}catch(i){r="getSource failed with url: "+e+", exception: "+i.toString()}return r},findFunctionName:function(e,t){var n=/function\s+([^(]*?)\s*\(([^)]*)\)/,r=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,i=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,s="",o,u=Math.min(t,20),a,f;for(var l=0;l<u;++l){o=e[t-l-1],f=o.indexOf("//"),f>=0&&(o=o.substr(0,f));if(o){s=o+s,a=r.exec(s);if(a&&a[1])return a[1];a=n.exec(s);if(a&&a[1])return a[1];a=i.exec(s);if(a&&a[1])return a[1]}}return"(?)"}},define("playcraft/ext/gamecore.js/src/stacktrace",function(){}),gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(e){var t=this.getPool(e);if(t==undefined||t==null)t=new gamecore.Pool(e,this.INITIAL_POOL_SIZE),this.pools.put(e.fullName,t);return t.acquire()},release:function(e){var t=this.pools.get(e.Class.fullName);if(t==undefined)throw"Oops, trying to release an object of type "+e.Class.fullName+" but no pool exists. Did you new an object instead of using create.";t.release(e)},getPool:function(e){return this.pools.get(e.fullName)},getStats:function(){var e="",t=this.pools.keys();for(var n=0;n<t.length;n++){var r=t[n],i=this.pools.get(r);e+=r+": "+i.getStats()+"\n"}return e}},{freeList:null,expansion:1,traces:null,init:function(e,t){this._super(),this.classType=e,this.freeList=[],this.expand(t)},startTracing:function(){if(this.tracing)return;this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable},stopTracing:function(){this.tracing=!1},expand:function(e){gamecore.Pool.totalPooled+=e,this.debug("expanding "+this.classType.fullName+" by "+e+" total="+gamecore.Pool.totalPooled);for(var t=0;t<e;t++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){this.freeList.length<=0&&(this.expansion=Math.round(this.expansion*1.2)+1,this.expand(this.expansion));if(this.tracing){var e=printStackTrace(),t=e.length-1;while(e[t].indexOf("Class.addTo")==0&&t>0)t--;var n=this.traces.get(e[t]);n==null?this.traces.put(e[t],{value:1}):n.value++}return this.freeList.pop()},release:function(e){this.freeList.push(e)},getStats:function(){var e=this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){e+="TRACING\n";var t=this.traces.keys();for(var n in t)e+=t[n]+" ("+this.traces.get(t[n]).value+")\n"}return e},dump:function(e){this.info("================== "+e+" ==================="),this.info("FREE"),this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}}),gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(e){var t=this.getPool(e);if(t==undefined||t==null)t=new gamecore.DualPool(e,this.INITIAL_POOL_SIZE),this.pools.put(e.fullName,t);return t.acquire()},getStats:function(){var e="",t=this.pools.keys();for(var n=0;n<t.length;n++){var r=t[n],i=this.pools.get(r);e+=r+" (free: "+i.freeList.length()+" used: "+i.usedList.length()+")\n"}return e}},{freeList:null,usedList:null,init:function(e,t){this.classType=e,this.usedList=new gamecore.LinkedList,this.freeList=new gamecore.LinkedList,this.expand(t)},expand:function(e){gamecore.Pool.totalPooled+=e;for(var t=0;t<e;t++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){this.freeList.first==null&&this.expand(Math.round(this.size()/5)+1),this.returnObj=this.freeList.first.obj,this.freeList.remove(this.returnObj),this.returnObj.destroyed=!1,this.usedList.add(this.returnObj);if(this.tracing){var e=printStackTrace(),t=e.length-1;while(e[t].indexOf("Class.addTo")==0&&t>0)t--;var n=this.traces.get(e[t]);n==null?this.traces.put(e[t],{value:1}):n.value++}return this.returnObj},release:function(e){this.freeList.add(e),this.usedList.remove(e)},dump:function(e){this.info("================== "+e+" ==================="),this.info("FREE"),this.freeList.dump(),this.info("USED"),this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}}),gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.Pool.release(this)},onRelease:function(){}}),gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease(),gamecore.DualPool.release(this)},onRelease:function(){}}),define("playcraft/ext/gamecore.js/src/pooled",function(){}),goog={inherits:function(e,t){function n(){}n.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new n,e.prototype.constructor=e}},goog.debug={},goog.debug.Error=function(e){this.stack=Error().stack||"",e&&(this.message=""+e)},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.string={},goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},goog.string.endsWith=function(e,t){var n=e.length-t.length;return 0<=n&&e.indexOf(t,n)==n},goog.string.caseInsensitiveStartsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(0,t.length))},goog.string.caseInsensitiveEndsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},goog.string.subs=function(e,t){for(var n=1;n<arguments.length;n++)var r=(""+arguments[n]).replace(/\$/g,"$$$$"),e=e.replace(/\%s/,r);return e},goog.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmpty=function(e){return/^[\s\xa0]*$/.test(e)},goog.string.isEmptySafe=function(e){return goog.string.isEmpty(goog.string.makeSafe(e))},goog.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},goog.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},goog.string.isNumeric=function(e){return!/[^0-9]/.test(e)},goog.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},goog.string.isSpace=function(e){return" "==e},goog.string.isUnicodeChar=function(e){return 1==e.length&&" "<=e&&"~">=e||""<=e&&"�">=e},goog.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")},goog.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")},goog.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(e,t){var n=(""+e).toLowerCase(),r=(""+t).toLowerCase();return n<r?-1:n==r?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var n=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=t.toLowerCase().match(goog.string.numerateCompareRegExp_),i=Math.min(n.length,r.length),s=0;s<i;s++){var o=n[s],u=r[s];if(o!=u)return n=parseInt(o,10),!isNaN(n)&&(r=parseInt(u,10),!isNaN(r)&&n-r)?n-r:o<u?-1:1}return n.length!=r.length?n.length-r.length:e<t?-1:1},goog.string.encodeUriRegExp_=/^[a-zA-Z0-9\-_.!~*'()]*$/,goog.string.urlEncode=function(e){return e=""+e,goog.string.encodeUriRegExp_.test(e)?e:encodeURIComponent(e)},goog.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},goog.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},goog.string.htmlEscape=function(e,t){return t?e.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;"):goog.string.allRe_.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(goog.string.amperRe_,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(goog.string.ltRe_,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(goog.string.gtRe_,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(goog.string.quotRe_,"&quot;")),e):e},goog.string.amperRe_=/&/g,goog.string.ltRe_=/</g,goog.string.gtRe_=/>/g,goog.string.quotRe_=/\"/g,goog.string.allRe_=/[&<>\"]/,goog.string.unescapeEntities=function(e){return goog.string.contains(e,"&")?"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(e):goog.string.unescapePureXmlEntities_(e):e},goog.string.unescapeEntitiesUsingDom_=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},n=document.createElement("div");return e.replace(goog.string.HTML_ENTITY_PATTERN_,function(e,r){var i=t[e];if(i)return i;if("#"==r.charAt(0)){var s=Number("0"+r.substr(1));isNaN(s)||(i=String.fromCharCode(s))}return i||(n.innerHTML=e+" ",i=n.firstChild.nodeValue.slice(0,-1)),t[e]=i})},goog.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var n=Number("0"+t.substr(1));if(!isNaN(n))return String.fromCharCode(n)}return e}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(e,t){return goog.string.newLineToBr(e.replace(/  /g," &#160;"),t)},goog.string.stripQuotes=function(e,t){for(var n=t.length,r=0;r<n;r++){var i=1==n?t:t.charAt(r);if(e.charAt(0)==i&&e.charAt(e.length-1)==i)return e.substring(1,e.length-1)}return e},goog.string.truncate=function(e,t,n){return n&&(e=goog.string.unescapeEntities(e)),e.length>t&&(e=e.substring(0,t-3)+"..."),n&&(e=goog.string.htmlEscape(e)),e},goog.string.truncateMiddle=function(e,t,n,r){n&&(e=goog.string.unescapeEntities(e));if(r&&e.length>t){r>t&&(r=t);var i=e.length-r,e=e.substring(0,t-r)+"..."+e.substring(i)}else e.length>t&&(r=Math.floor(t/2),i=e.length-r,e=e.substring(0,r+t%2)+"..."+e.substring(i));return n&&(e=goog.string.htmlEscape(e)),e},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(e){e=""+e;if(e.quote)return e.quote();for(var t=['"'],n=0;n<e.length;n++){var r=e.charAt(n),i=r.charCodeAt(0);t[n+1]=goog.string.specialEscapeChars_[r]||(31<i&&127>i?r:goog.string.escapeChar(r))}return t.push('"'),t.join("")},goog.string.escapeString=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=goog.string.escapeChar(e.charAt(n));return t.join("")},goog.string.escapeChar=function(e){if(e in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[e];if(e in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e];var t=e,n=e.charCodeAt(0);if(31<n&&127>n)t=e;else{if(256>n){if(t="\\x",16>n||256<n)t+="0"}else t="\\u",4096>n&&(t+="0");t+=n.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[e]=t},goog.string.toMap=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=!0;return t},goog.string.contains=function(e,t){return-1!=e.indexOf(t)},goog.string.removeAt=function(e,t,n){var r=e;return 0<=t&&t<e.length&&0<n&&(r=e.substr(0,t)+e.substr(t+n,e.length-t-n)),r},goog.string.remove=function(e,t){var n=RegExp(goog.string.regExpEscape(t),"");return e.replace(n,"")},goog.string.removeAll=function(e,t){var n=RegExp(goog.string.regExpEscape(t),"g");return e.replace(n,"")},goog.string.regExpEscape=function(e){return(""+e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(e,t){return Array(t+1).join(e)},goog.string.padNumber=function(e,t,n){return e=goog.isDef(n)?e.toFixed(n):""+e,n=e.indexOf("."),-1==n&&(n=e.length),goog.string.repeat("0",Math.max(0,t-n))+e},goog.string.makeSafe=function(e){return null==e?"":""+e},goog.string.buildString=function(e){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)},goog.string.compareVersions=function(e,t){for(var n=0,r=goog.string.trim(""+e).split("."),i=goog.string.trim(""+t).split("."),s=Math.max(r.length,i.length),o=0;0==n&&o<s;o++){var u=r[o]||"",a=i[o]||"",f=RegExp("(\\d*)(\\D*)","g"),l=RegExp("(\\d*)(\\D*)","g");do{var c=f.exec(u)||["","",""],h=l.exec(a)||["","",""];if(0==c[0].length&&0==h[0].length)break;var n=0==c[1].length?0:parseInt(c[1],10),p=0==h[1].length?0:parseInt(h[1],10),n=goog.string.compareElements_(n,p)||goog.string.compareElements_(0==c[2].length,0==h[2].length)||goog.string.compareElements_(c[2],h[2])}while(0==n)}return n},goog.string.compareElements_=function(e,t){return e<t?-1:e>t?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(e){for(var t=0,n=0;n<e.length;++n)t=31*t+e.charCodeAt(n),t%=goog.string.HASHCODE_MAX_;return t},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(e){var t=Number(e);return 0==t&&goog.string.isEmpty(e)?NaN:t},goog.string.toCamelCaseCache_={},goog.string.toCamelCase=function(e){return goog.string.toCamelCaseCache_[e]||(goog.string.toCamelCaseCache_[e]=(""+e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()}))},goog.string.toSelectorCaseCache_={},goog.string.toSelectorCase=function(e){return goog.string.toSelectorCaseCache_[e]||(goog.string.toSelectorCaseCache_[e]=(""+e).replace(/([A-Z])/g,"-$1").toLowerCase())},goog.array={},goog.NATIVE_ARRAY_PROTOTYPES=!0,goog.array.peek=function(e){return e[e.length-1]},goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,t,n)}:function(e,t,n){n=null==n?0:0>n?Math.max(0,e.length+n):n;if(goog.isString(e))return!goog.isString(t)||1!=t.length?-1:e.indexOf(t,n);for(;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,t,null==n?e.length-1:n)}:function(e,t,n){n=null==n?e.length-1:n,0>n&&(n=Math.max(0,e.length+n));if(goog.isString(e))return!goog.isString(t)||1!=t.length?-1:e.lastIndexOf(t,n);for(;0<=n;n--)if(n in e&&e[n]===t)return n;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(e,t,n){goog.array.ARRAY_PROTOTYPE_.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)},goog.array.forEachRight=function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,r=r-1;0<=r;--r)r in i&&t.call(n,i[r],r,e)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.filter.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=[],s=0,o=goog.isString(e)?e.split(""):e,u=0;u<r;u++)if(u in o){var a=o[u];t.call(n,a,u,e)&&(i[s++]=a)}return i},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.map.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=Array(r),s=goog.isString(e)?e.split(""):e,o=0;o<r;o++)o in s&&(i[o]=t.call(n,s[o],o,e));return i},goog.array.reduce=function(e,t,n,r){if(e.reduce)return r?e.reduce(goog.bind(t,r),n):e.reduce(t,n);var i=n;return goog.array.forEach(e,function(n,s){i=t.call(r,i,n,s,e)}),i},goog.array.reduceRight=function(e,t,n,r){if(e.reduceRight)return r?e.reduceRight(goog.bind(t,r),n):e.reduceRight(t,n);var i=n;return goog.array.forEachRight(e,function(n,s){i=t.call(r,i,n,s,e)}),i},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.some.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,s=0;s<r;s++)if(s in i&&t.call(n,i[s],s,e))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(e,t,n){return goog.array.ARRAY_PROTOTYPE_.every.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,s=0;s<r;s++)if(s in i&&!t.call(n,i[s],s,e))return!1;return!0},goog.array.find=function(e,t,n){return t=goog.array.findIndex(e,t,n),0>t?null:goog.isString(e)?e.charAt(t):e[t]},goog.array.findIndex=function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,s=0;s<r;s++)if(s in i&&t.call(n,i[s],s,e))return s;return-1},goog.array.findRight=function(e,t,n){return t=goog.array.findIndexRight(e,t,n),0>t?null:goog.isString(e)?e.charAt(t):e[t]},goog.array.findIndexRight=function(e,t,n){for(var r=e.length,i=goog.isString(e)?e.split(""):e,r=r-1;0<=r;r--)if(r in i&&t.call(n,i[r],r,e))return r;return-1},goog.array.contains=function(e,t){return 0<=goog.array.indexOf(e,t)},goog.array.isEmpty=function(e){return 0==e.length},goog.array.clear=function(e){if(!goog.isArray(e))for(var t=e.length-1;0<=t;t--)delete e[t];e.length=0},goog.array.insert=function(e,t){goog.array.contains(e,t)||e.push(t)},goog.array.insertAt=function(e,t,n){goog.array.splice(e,n,0,t)},goog.array.insertArrayAt=function(e,t,n){goog.partial(goog.array.splice,e,n,0).apply(null,t)},goog.array.insertBefore=function(e,t,n){var r;2==arguments.length||0>(r=goog.array.indexOf(e,n))?e.push(t):goog.array.insertAt(e,t,r)},goog.array.remove=function(e,t){var n=goog.array.indexOf(e,t),r;return(r=0<=n)&&goog.array.removeAt(e,n),r},goog.array.removeAt=function(e,t){return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1).length},goog.array.removeIf=function(e,t,n){return t=goog.array.findIndex(e,t,n),0<=t?(goog.array.removeAt(e,t),!0):!1},goog.array.concat=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.clone=function(e){if(goog.isArray(e))return goog.array.concat(e);for(var t=[],n=0,r=e.length;n<r;n++)t[n]=e[n];return t},goog.array.toArray=function(e){return goog.isArray(e)?goog.array.concat(e):goog.array.clone(e)},goog.array.extend=function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n],i;if(goog.isArray(r)||(i=goog.isArrayLike(r))&&r.hasOwnProperty("callee"))e.push.apply(e,r);else if(i)for(var s=e.length,o=r.length,u=0;u<o;u++)e[s+u]=r[u];else e.push(r)}},goog.array.splice=function(e,t,n,r){return goog.array.ARRAY_PROTOTYPE_.splice.apply(e,goog.array.slice(arguments,1))},goog.array.slice=function(e,t,n){return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(e,t):goog.array.ARRAY_PROTOTYPE_.slice.call(e,t,n)},goog.array.removeDuplicates=function(e,t){for(var n=t||e,r={},i=0,s=0;s<e.length;){var o=e[s++],u=goog.isObject(o)?"o"+goog.getUid(o):(typeof o).charAt(0)+o;Object.prototype.hasOwnProperty.call(r,u)||(r[u]=!0,n[i++]=o)}n.length=i},goog.array.binarySearch=function(e,t,n){return goog.array.binarySearch_(e,n||goog.array.defaultCompare,!1,t)},goog.array.binarySelect=function(e,t,n){return goog.array.binarySearch_(e,t,!0,void 0,n)},goog.array.binarySearch_=function(e,t,n,r,i){for(var s=0,o=e.length,u;s<o;){var a=s+o>>1,f;f=n?t.call(i,e[a],a,e):t(r,e[a]),0<f?s=a+1:(o=a,u=!f)}return u?s:~s},goog.array.sort=function(e,t){goog.array.ARRAY_PROTOTYPE_.sort.call(e,t||goog.array.defaultCompare)},goog.array.stableSort=function(e,t){for(var n=0;n<e.length;n++)e[n]={index:n,value:e[n]};var r=t||goog.array.defaultCompare;goog.array.sort(e,function(e,t){return r(e.value,t.value)||e.index-t.index});for(n=0;n<e.length;n++)e[n]=e[n].value},goog.array.sortObjectsByKey=function(e,t,n){var r=n||goog.array.defaultCompare;goog.array.sort(e,function(e,n){return r(e[t],n[t])})},goog.array.isSorted=function(e,t,n){for(var t=t||goog.array.defaultCompare,r=1;r<e.length;r++){var i=t(e[r-1],e[r]);if(0<i||0==i&&n)return!1}return!0},goog.array.equals=function(e,t,n){if(!goog.isArrayLike(e)||!goog.isArrayLike(t)||e.length!=t.length)return!1;for(var r=e.length,n=n||goog.array.defaultCompareEquality,i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0},goog.array.compare=function(e,t,n){return goog.array.equals(e,t,n)},goog.array.compare3=function(e,t,n){for(var n=n||goog.array.defaultCompare,r=Math.min(e.length,t.length),i=0;i<r;i++){var s=n(e[i],t[i]);if(0!=s)return s}return goog.array.defaultCompare(e.length,t.length)},goog.array.defaultCompare=function(e,t){return e>t?1:e<t?-1:0},goog.array.defaultCompareEquality=function(e,t){return e===t},goog.array.binaryInsert=function(e,t,n){return n=goog.array.binarySearch(e,t,n),0>n?(goog.array.insertAt(e,t,-(n+1)),!0):!1},goog.array.binaryRemove=function(e,t,n){return t=goog.array.binarySearch(e,t,n),0<=t?goog.array.removeAt(e,t):!1},goog.array.bucket=function(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r],s=t(i,r,e);goog.isDef(s)&&(n[s]||(n[s]=[])).push(i)}return n},goog.array.repeat=function(e,t){for(var n=[],r=0;r<t;r++)n[r]=e;return n},goog.array.flatten=function(e){for(var t=[],n=0;n<arguments.length;n++){var r=arguments[n];goog.isArray(r)?t.push.apply(t,goog.array.flatten.apply(null,r)):t.push(r)}return t},goog.array.rotate=function(e,t){return e.length&&(t%=e.length,0<t?goog.array.ARRAY_PROTOTYPE_.unshift.apply(e,e.splice(-t,t)):0>t&&goog.array.ARRAY_PROTOTYPE_.push.apply(e,e.splice(0,-t))),e},goog.array.zip=function(e){if(!arguments.length)return[];for(var t=[],n=0;;n++){for(var r=[],i=0;i<arguments.length;i++){var s=arguments[i];if(n>=s.length)return t;r.push(s[n])}t.push(r)}},goog.array.shuffle=function(e,t){for(var n=t||Math.random,r=e.length-1;0<r;r--){var i=Math.floor(n()*(r+1)),s=e[r];e[r]=e[i],e[i]=s}},goog.structs={},goog.structs.Queue=function(){this.elements_=[]},goog.structs.Queue.prototype.head_=0,goog.structs.Queue.prototype.tail_=0,goog.structs.Queue.prototype.enqueue=function(e){this.elements_[this.tail_++]=e},goog.structs.Queue.prototype.dequeue=function(){if(this.head_!=this.tail_){var e=this.elements_[this.head_];return delete this.elements_[this.head_],this.head_++,e}},goog.structs.Queue.prototype.peek=function(){return this.head_==this.tail_?void 0:this.elements_[this.head_]},goog.structs.Queue.prototype.getCount=function(){return this.tail_-this.head_},goog.structs.Queue.prototype.isEmpty=function(){return 0==this.tail_-this.head_},goog.structs.Queue.prototype.clear=function(){this.tail_=this.head_=this.elements_.length=0},goog.structs.Queue.prototype.contains=function(e){return goog.array.contains(this.elements_,e)},goog.structs.Queue.prototype.remove=function(e){return e=goog.array.indexOf(this.elements_,e),0>e?!1:(e==this.head_?this.dequeue():(goog.array.removeAt(this.elements_,e),this.tail_--),!0)},goog.structs.Queue.prototype.getValues=function(){return this.elements_.slice(this.head_,this.tail_)};var Box2D={Common:{}};Box2D.Common.Math={},Box2D.Common.Math.b2Vec2=function(e,t){this.x=e,this.y=t},Box2D.Common.Math.b2Vec2._freeCache=[],Box2D.Common.Math.b2Vec2.Get=function(e,t){if(0<Box2D.Common.Math.b2Vec2._freeCache.length){var n=Box2D.Common.Math.b2Vec2._freeCache.pop();return n.Set(e,t),n}return new Box2D.Common.Math.b2Vec2(e,t)},Box2D.Common.Math.b2Vec2.Free=function(e){null!=e&&Box2D.Common.Math.b2Vec2._freeCache.push(e)},Box2D.Common.Math.b2Vec2.prototype.SetZero=function(){this.y=this.x=0},Box2D.Common.Math.b2Vec2.prototype.Set=function(e,t){this.x=e,this.y=t},Box2D.Common.Math.b2Vec2.prototype.SetV=function(e){this.x=e.x,this.y=e.y},Box2D.Common.Math.b2Vec2.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec2.Get(-this.x,-this.y)},Box2D.Common.Math.b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},Box2D.Common.Math.b2Vec2.prototype.Copy=function(){return Box2D.Common.Math.b2Vec2.Get(this.x,this.y)},Box2D.Common.Math.b2Vec2.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},Box2D.Common.Math.b2Vec2.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},Box2D.Common.Math.b2Vec2.prototype.Multiply=function(e){this.x*=e,this.y*=e},Box2D.Common.Math.b2Vec2.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},Box2D.Common.Math.b2Vec2.prototype.MulTM=function(e){var t=this.x*e.col1.x+this.y*e.col1.y;this.y=this.x*e.col2.x+this.y*e.col2.y,this.x=t},Box2D.Common.Math.b2Vec2.prototype.CrossVF=function(e){var t=this.x;this.x=e*this.y,this.y=-e*t},Box2D.Common.Math.b2Vec2.prototype.CrossFV=function(e){var t=this.x;this.x=-e*this.y,this.y=e*t},Box2D.Common.Math.b2Vec2.prototype.MinV=function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y)},Box2D.Common.Math.b2Vec2.prototype.MaxV=function(e){this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y)},Box2D.Common.Math.b2Vec2.prototype.Abs=function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Box2D.Common.Math.b2Vec2.prototype.Length=function(){return Math.sqrt(this.LengthSquared())},Box2D.Common.Math.b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},Box2D.Common.Math.b2Vec2.prototype.Normalize=function(){var e=this.Length();if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},Box2D.Common.Math.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},Box2D.Common.b2Settings={},Box2D.Common.b2Settings.b2MixFriction=function(e,t){return Math.sqrt(e*t)},Box2D.Common.b2Settings.b2MixRestitution=function(e,t){return e>t?e:t},Box2D.Common.b2Settings.b2Assert=function(e){if(!e)throw"Assertion Failed"},Box2D.Common.b2Settings.VERSION="2.1a-playcraft",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*Math.PI,Box2D.Common.b2Settings.b2_toiSlop=8*Box2D.Common.b2Settings.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*Math.PI,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=Box2D.Common.b2Settings.b2_maxTranslation*Box2D.Common.b2Settings.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*Math.PI,Box2D.Common.b2Settings.b2_maxRotationSquared=Box2D.Common.b2Settings.b2_maxRotation*Box2D.Common.b2Settings.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_linearSleepToleranceSquared=Box2D.Common.b2Settings.b2_linearSleepTolerance*Box2D.Common.b2Settings.b2_linearSleepTolerance,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*Math.PI,Box2D.Common.b2Settings.b2_angularSleepToleranceSquared=Box2D.Common.b2Settings.b2_angularSleepTolerance*Box2D.Common.b2Settings.b2_angularSleepTolerance,Box2D.Common.b2Settings.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Common.Math.b2Mat22=function(){this.col1=Box2D.Common.Math.b2Vec2.Get(0,0),this.col2=Box2D.Common.Math.b2Vec2.Get(0,0),this.SetIdentity()},Box2D.Common.Math.b2Mat22._freeCache=[],Box2D.Common.Math.b2Mat22.Get=function(){if(0<Box2D.Common.Math.b2Mat22._freeCache.length){var e=Box2D.Common.Math.b2Mat22._freeCache.pop();return e.SetZero(),e}return new Box2D.Common.Math.b2Mat22},Box2D.Common.Math.b2Mat22.Free=function(e){null!=e&&Box2D.Common.Math.b2Mat22._freeCache.push(e)},Box2D.Common.Math.b2Mat22.FromAngle=function(e){var t=Box2D.Common.Math.b2Mat22.Get();return t.Set(e),t},Box2D.Common.Math.b2Mat22.FromVV=function(e,t){var n=Box2D.Common.Math.b2Mat22.Get();return n.SetVV(e,t),n},Box2D.Common.Math.b2Mat22.prototype.Set=function(e){var t=Math.cos(e),e=Math.sin(e);this.col1.Set(t,e),this.col2.Set(-e,t)},Box2D.Common.Math.b2Mat22.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},Box2D.Common.Math.b2Mat22.prototype.Copy=function(){var e=Box2D.Common.Math.b2Mat22.Get();return e.SetM(this),e},Box2D.Common.Math.b2Mat22.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},Box2D.Common.Math.b2Mat22.prototype.AddM=function(e){this.col1.Add(e.col1),this.col2.Add(e.col2)},Box2D.Common.Math.b2Mat22.prototype.SetIdentity=function(){this.col1.Set(1,0),this.col2.Set(0,1)},Box2D.Common.Math.b2Mat22.prototype.SetZero=function(){this.col1.Set(0,0),this.col2.Set(0,0)},Box2D.Common.Math.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},Box2D.Common.Math.b2Mat22.prototype.GetInverse=function(e){var t=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==t&&(t=1/t),e.col1.x=t*this.col2.y,e.col2.x=-t*this.col2.x,e.col1.y=-t*this.col1.y,e.col2.y=t*this.col1.x,e},Box2D.Common.Math.b2Mat22.prototype.Solve=function(e,t,n){var r=this.col1.x*this.col2.y-this.col2.x*this.col1.y;return 0!==r&&(r=1/r),e.x=r*(this.col2.y*t-this.col2.x*n),e.y=r*(this.col1.x*n-this.col1.y*t),e},Box2D.Common.Math.b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},Box2D.Common.Math.b2Math={},Box2D.Common.Math.b2Math.Dot=function(e,t){return e.x*t.x+e.y*t.y},Box2D.Common.Math.b2Math.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},Box2D.Common.Math.b2Math.CrossVF=function(e,t){return Box2D.Common.Math.b2Vec2.Get(t*e.y,-t*e.x)},Box2D.Common.Math.b2Math.CrossFV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(-e*t.y,e*t.x)},Box2D.Common.Math.b2Math.MulMV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},Box2D.Common.Math.b2Math.MulTMV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(t,e.col1),Box2D.Common.Math.b2Math.Dot(t,e.col2))},Box2D.Common.Math.b2Math.MulX=function(e,t){var n=Box2D.Common.Math.b2Math.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},Box2D.Common.Math.b2Math.MulXT=function(e,t){var n=Box2D.Common.Math.b2Math.SubtractVV(t,e.position),r=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=r,n},Box2D.Common.Math.b2Math.AddVV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(e.x+t.x,e.y+t.y)},Box2D.Common.Math.b2Math.SubtractVV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(e.x-t.x,e.y-t.y)},Box2D.Common.Math.b2Math.Distance=function(e,t){return Math.sqrt(Box2D.Common.Math.b2Math.DistanceSquared(e,t))},Box2D.Common.Math.b2Math.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},Box2D.Common.Math.b2Math.MulFV=function(e,t){return Box2D.Common.Math.b2Vec2.Get(e*t.x,e*t.y)},Box2D.Common.Math.b2Math.AddMM=function(e,t){var n=Box2D.Common.Math.b2Math.AddVV(e.col1,t.col1),r=Box2D.Common.Math.b2Math.AddVV(e.col2,t.col2),i=Box2D.Common.Math.b2Mat22.FromVV(n,r);return Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(r),i},Box2D.Common.Math.b2Math.MulMM=function(e,t){var n=Box2D.Common.Math.b2Math.MulMV(e,t.col1),r=Box2D.Common.Math.b2Math.MulMV(e,t.col2),i=Box2D.Common.Math.b2Mat22.FromVV(n,r);return Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(r),i},Box2D.Common.Math.b2Math.MulTMM=function(e,t){var n=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(e.col1,t.col1),Box2D.Common.Math.b2Math.Dot(e.col2,t.col1)),r=Box2D.Common.Math.b2Vec2.Get(Box2D.Common.Math.b2Math.Dot(e.col1,t.col2),Box2D.Common.Math.b2Math.Dot(e.col2,t.col2)),i=Box2D.Common.Math.b2Mat22.FromVV(n,r);return Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(r),i},Box2D.Common.Math.b2Math.AbsV=function(e){return Box2D.Common.Math.b2Vec2.Get(Math.abs(e.x),Math.abs(e.y))},Box2D.Common.Math.b2Math.AbsM=function(e){var t=Box2D.Common.Math.b2Math.AbsV(e.col1),e=Box2D.Common.Math.b2Math.AbsV(e.col2),n=Box2D.Common.Math.b2Mat22.FromVV(t,e);return Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(e),n},Box2D.Common.Math.b2Math.Clamp=function(e,t,n){return e<t?t:e>n?n:e},Box2D.Common.Math.b2Math.ClampV=function(e,t,n){var r=Box2D.Common.Math.b2Math.Clamp(e.x,t.x,n.x),e=Box2D.Common.Math.b2Math.Clamp(e.y,t.y,n.y);return Box2D.Common.Math.b2Vec2.Get(r,e)},Box2D.Dynamics={},Box2D.Dynamics.Joints={},Box2D.Dynamics.Joints.b2JointEdge=function(){},Box2D.Dynamics.Joints.b2Joint=function(e){this.m_edgeA=new Box2D.Dynamics.Joints.b2JointEdge,this.m_edgeB=new Box2D.Dynamics.Joints.b2JointEdge,this.m_localCenterA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localCenterB=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Common.b2Settings.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_next=this.m_prev=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected},Box2D.Dynamics.Joints.b2Joint.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorA=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetAnchorB=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionForce=function(){return null},Box2D.Dynamics.Joints.b2Joint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},Box2D.Dynamics.Joints.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},Box2D.Dynamics.Joints.b2Joint.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Joints.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},Box2D.Dynamics.Joints.b2Joint.Create=function(e){return e.Create()},Box2D.Dynamics.Joints.b2Joint.prototype.InitVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolveVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.FinalizeVelocityConstraints=function(){},Box2D.Dynamics.Joints.b2Joint.prototype.SolvePositionConstraints=function(){return!1},Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3,Box2D.Dynamics.Joints.b2LineJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat22,this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),e*this.m_impulse.y},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2),t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1);return e.x*t+e.y*n},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i,i=n.col1.y*r+n.col2.y*i,r=s;n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y,s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r);var s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i),a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity,e=e.m_angularVelocity,t=t.m_angularVelocity;return n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetLimits=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},Box2D.Dynamics.Joints.b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2LineJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2LineJoint.prototype.SetMaxMotorForce=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},Box2D.Dynamics.Joints.b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2LineJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();n.GetTransform(),r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y,i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i;r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i;r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,s=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=s+o+u*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+o+u*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.y=0):r>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,s=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u=0,a=0,f=0,l=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+l,-e,e),l=this.m_motorImpulse-u,u=l*this.m_axis.x,a=l*this.m_axis.y,f=l*this.m_a1,l*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*a,i-=this.m_invIA*f,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*a,o+=this.m_invIB*l),a=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(e=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),f=Box2D.Common.Math.b2Vec2.Get(0,0),e=this.m_K.Solve(f,-a,-e),Box2D.Common.Math.b2Vec2.Free(f),this.m_impulse.Add(e),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.y=Math.max(this.m_impulse.y,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.y=Math.min(this.m_impulse.y,0)),a=-a-(this.m_impulse.y-u.y)*this.m_K.col2.x,f=0,f=0!=this.m_K.col1.x?a/this.m_K.col1.x+u.x:u.x,this.m_impulse.x=f,e.x=this.m_impulse.x-u.x,e.y=this.m_impulse.y-u.y,Box2D.Common.Math.b2Vec2.Free(u),u=e.x*this.m_perp.x+e.y*this.m_axis.x,a=e.x*this.m_perp.y+e.y*this.m_axis.y,f=e.x*this.m_s1+e.y*this.m_a1,l=e.x*this.m_s2+e.y*this.m_a2):(e=0,e=0!=this.m_K.col1.x?-a/this.m_K.col1.x:0,this.m_impulse.x+=e,u=e*this.m_perp.x,a=e*this.m_perp.y,f=e*this.m_s1,l=e*this.m_s2),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*a,i-=this.m_invIA*f,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*a,o+=this.m_invIB*l,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},Box2D.Dynamics.Joints.b2LineJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o,u=0,a=0,f=0,l=0,c=o=0,h=0,a=!1,p=0,d=Box2D.Common.Math.b2Mat22.FromAngle(r),f=Box2D.Common.Math.b2Mat22.FromAngle(s);o=d;var h=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y,u=o.col1.x*h+o.col2.x*v,v=o.col1.y*h+o.col2.y*v,h=u;o=f,f=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*f+o.col2.x*l,l=o.col1.y*f+o.col2.y*l,f=u,o=i.x+f-n.x-h,u=i.y+l-n.y-v;if(this.m_enableLimit){this.m_axis=Box2D.Common.Math.b2Math.MulMV(d,this.m_localXAxis1),this.m_a1=(o+h)*this.m_axis.y-(u+v)*this.m_axis.x,this.m_a2=f*this.m_axis.y-l*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*u;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(p=Box2D.Common.Math.b2Math.Clamp(m,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),c=Math.abs(m),a=!0):m<=this.m_lowerTranslation?(p=Box2D.Common.Math.b2Math.Clamp(m-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),c=this.m_lowerTranslation-m,a=!0):m>=this.m_upperTranslation&&(p=Box2D.Common.Math.b2Math.Clamp(m-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),c=m-this.m_upperTranslation,a=!0)}return this.m_perp=Box2D.Common.Math.b2Math.MulMV(d,this.m_localYAxis1),this.m_s1=(o+h)*this.m_perp.y-(u+v)*this.m_perp.x,this.m_s2=f*this.m_perp.y-l*this.m_perp.x,d=Box2D.Common.Math.b2Vec2.Get(0,0),v=this.m_perp.x*o+this.m_perp.y*u,c=Math.max(c,Math.abs(v)),h=0,a?(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,this.m_K.col1.x=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+f+l*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2,this.m_K.Solve(d,-v,-p)):(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,p=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,d.x=0!=p?-v/p:0,d.y=0),p=d.x*this.m_perp.x+d.y*this.m_axis.x,a=d.x*this.m_perp.y+d.y*this.m_axis.y,v=d.x*this.m_s1+d.y*this.m_a1,d=d.x*this.m_s2+d.y*this.m_a2,n.x-=this.m_invMassA*p,n.y-=this.m_invMassA*a,r-=this.m_invIA*v,i.x+=this.m_invMassB*p,i.y+=this.m_invMassB*a,s+=this.m_invIB*d,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),c<=Box2D.Common.b2Settings.b2_linearSlop&&h<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2JointDef=function(){this.type=Box2D.Dynamics.Joints.b2Joint.e_unknownJoint,this.bodyB=this.bodyA=null,this.collideConnected=!1},Box2D.Dynamics.Joints.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2LineJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},Box2D.Dynamics.Joints.b2LineJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2LineJoint(this)},Box2D.Collision={},Box2D.Collision.b2DistanceProxy=function(){this.m_radius=this.m_count=0,this.m_vertices=[]},Box2D.Collision.b2DistanceProxy.prototype.SetValues=function(e,t,n){this.m_count=e,this.m_radius=t,this.m_vertices=n},Box2D.Collision.b2DistanceProxy.prototype.Set=function(e){e.SetDistanceProxy(this)},Box2D.Collision.b2DistanceProxy.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;r++){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},Box2D.Collision.b2DistanceProxy.prototype.GetSupportVertex=function(e){return this.m_vertices[this.GetSupport(e)]},Box2D.Collision.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},Box2D.Collision.b2DistanceProxy.prototype.GetVertex=function(e){return void 0===e&&(e=0),Box2D.Common.b2Settings.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},Box2D.Common.Math.b2Sweep=function(){this.localCenter=Box2D.Common.Math.b2Vec2.Get(0,0),this.c0=Box2D.Common.Math.b2Vec2.Get(0,0),this.c=Box2D.Common.Math.b2Vec2.Get(0,0),this.t0=this.a=this.a0=null},Box2D.Common.Math.b2Sweep.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},Box2D.Common.Math.b2Sweep.prototype.Copy=function(){var e=new Box2D.Common.Math.b2Sweep;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},Box2D.Common.Math.b2Sweep.prototype.GetTransform=function(e,t){void 0===t&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},Box2D.Common.Math.b2Sweep.prototype.Advance=function(e){void 0===e&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},Box2D.Collision.b2TOIInput=function(){this.proxyA=new Box2D.Collision.b2DistanceProxy,this.proxyB=new Box2D.Collision.b2DistanceProxy,this.sweepA=new Box2D.Common.Math.b2Sweep,this.sweepB=new Box2D.Common.Math.b2Sweep},Box2D.Common.Math.b2Vec3=function(e,t,n){this.x=e,this.y=t,this.z=n},Box2D.Common.Math.b2Vec3._freeCache=[],Box2D.Common.Math.b2Vec3.Get=function(e,t,n){if(0<Box2D.Common.Math.b2Vec3._freeCache.length){var r=Box2D.Common.Math.b2Vec3._freeCache.pop();return r.Set(e,t,n),r}return new Box2D.Common.Math.b2Vec3(e,t,n)},Box2D.Common.Math.b2Vec3.Free=function(e){null!=e&&Box2D.Common.Math.b2Vec3._freeCache.push(e)},Box2D.Common.Math.b2Vec3.prototype.SetZero=function(){this.z=this.y=this.x=0},Box2D.Common.Math.b2Vec3.prototype.Set=function(e,t,n){this.x=e,this.y=t,this.z=n},Box2D.Common.Math.b2Vec3.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},Box2D.Common.Math.b2Vec3.prototype.GetNegative=function(){return Box2D.Common.Math.b2Vec3.Get(-this.x,-this.y,-this.z)},Box2D.Common.Math.b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},Box2D.Common.Math.b2Vec3.prototype.Copy=function(){return Box2D.Common.Math.b2Vec3.Get(this.x,this.y,this.z)},Box2D.Common.Math.b2Vec3.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},Box2D.Common.Math.b2Vec3.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},Box2D.Common.Math.b2Vec3.prototype.Multiply=function(e){this.x*=e,this.y*=e,this.z*=e},Box2D.Common.Math.b2Mat33=function(e,t,n){this.col1=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col2=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.col3=Box2D.Common.Math.b2Vec3.Get(0,0,0),e&&this.col1.SetV(e),t&&this.col2.SetV(t),n&&this.col3.SetV(n)},Box2D.Common.Math.b2Mat33.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},Box2D.Common.Math.b2Mat33.prototype.Copy=function(){return new Box2D.Common.Math.b2Mat33(this.col1,this.col2,this.col3)},Box2D.Common.Math.b2Mat33.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},Box2D.Common.Math.b2Mat33.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},Box2D.Common.Math.b2Mat33.prototype.SetIdentity=function(){this.col1.Set(1,0,0),this.col2.Set(0,1,0),this.col3.Set(0,0,1)},Box2D.Common.Math.b2Mat33.prototype.SetZero=function(){this.col1.Set(0,0,0),this.col2.Set(0,0,0),this.col3.Set(0,0,0)},Box2D.Common.Math.b2Mat33.prototype.Solve22=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return 0!=u&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},Box2D.Common.Math.b2Mat33.prototype.Solve33=function(e,t,n,r){var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return 0!=p&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},Box2D.Dynamics.Joints.b2PrismaticJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localXAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localYAxis1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_perp=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K=new Box2D.Common.Math.b2Mat33,this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),e*this.m_impulse.y},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2),t=r.x-n.x,i=r.y-n.y;return Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(r),e=e.GetWorldVector(this.m_localXAxis1),n=e.x*t+e.y*i,Box2D.Common.Math.b2Vec2.Free(e),n},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i,i=n.col1.y*r+n.col2.y*i,r=s;n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y,s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,s=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),a=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);n=e.GetWorldVector(this.m_localXAxis1);var f=e.m_linearVelocity,l=t.m_linearVelocity,e=e.m_angularVelocity,t=t.m_angularVelocity,r=s*-e*n.y+a*e*n.x+(n.x*(l.x+ -t*u-f.x- -e*i)+n.y*(l.y+t*o-f.y-e*r));return Box2D.Common.Math.b2Vec2.Free(n),r},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetLimits=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SetMaxMotorForce=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y,i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i;r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i;r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI;var l=Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localXAxis1);this.m_axis.SetV(l),Box2D.Common.Math.b2Vec2.Free(l),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),s=Box2D.Common.Math.b2Math.MulMV(s.R,this.m_localYAxis1),this.m_perp.SetV(s),Box2D.Common.Math.b2Vec2.Free(s),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,o=this.m_invMassA,u=this.m_invMassB,a=this.m_invIA,f=this.m_invIB,this.m_K.col1.x=o+u+a*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=a*this.m_s1+f*this.m_s2,this.m_K.col1.z=a*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+f,this.m_K.col2.z=a*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=o+u+a*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit,this.m_impulse.z=0):r>=this.m_upperTranslation?this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,0==this.m_enableMotor&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,o=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*o):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u=0,a=0,f=0,l=0;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+l,-e,e),l=this.m_motorImpulse-u,u=l*this.m_axis.x,a=l*this.m_axis.y,f=l*this.m_a1,l*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*a,i-=this.m_invIA*f,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*a,o+=this.m_invIB*l),f=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,a=o-i,this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit?(l=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),e=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_K.Solve33(e,-f,-a,-l),this.m_impulse.Add(e),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?this.m_impulse.z=Math.max(this.m_impulse.z,0):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=Math.min(this.m_impulse.z,0)),f=-f-(this.m_impulse.z-u.z)*this.m_K.col3.x,a=-a-(this.m_impulse.z-u.z)*this.m_K.col3.y,l=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(l,f,a),l.x+=u.x,l.y+=u.y,this.m_impulse.x=l.x,this.m_impulse.y=l.y,Box2D.Common.Math.b2Vec2.Free(l),e.x=this.m_impulse.x-u.x,e.y=this.m_impulse.y-u.y,e.z=this.m_impulse.z-u.z,u=e.x*this.m_perp.x+e.z*this.m_axis.x,a=e.x*this.m_perp.y+e.z*this.m_axis.y,f=e.x*this.m_s1+e.y+e.z*this.m_a1,l=e.x*this.m_s2+e.y+e.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(e)):(e=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(e,-f,-a),this.m_impulse.x+=e.x,this.m_impulse.y+=e.y,u=e.x*this.m_perp.x,a=e.x*this.m_perp.y,f=e.x*this.m_s1+e.y,l=e.x*this.m_s2+e.y,Box2D.Common.Math.b2Vec2.Free(e)),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*a,i-=this.m_invIA*f,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*a,o+=this.m_invIB*l,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},Box2D.Dynamics.Joints.b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o=0,u=0,a=0,f=o=0,l=0,c=0,u=!1,h=0,p=Box2D.Common.Math.b2Mat22.FromAngle(r),c=this.m_localAnchor1.x-this.m_localCenterA.x,d=this.m_localAnchor1.y-this.m_localCenterA.y,o=p.col1.x*c+p.col2.x*d,d=p.col1.y*c+p.col2.y*d;Box2D.Common.Math.b2Mat22.Free(p);var c=o,f=Box2D.Common.Math.b2Mat22.FromAngle(s),v=this.m_localAnchor2.x-this.m_localCenterB.x,a=this.m_localAnchor2.y-this.m_localCenterB.y,o=f.col1.x*v+f.col2.x*a,a=f.col1.y*v+f.col2.y*a;Box2D.Common.Math.b2Mat22.Free(f),v=o,o=i.x+v-n.x-c,f=i.y+a-n.y-d;if(this.m_enableLimit){Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.MulMV(p,this.m_localXAxis1),this.m_a1=(o+c)*this.m_axis.y-(f+d)*this.m_axis.x,this.m_a2=v*this.m_axis.y-a*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*f;Math.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*Box2D.Common.b2Settings.b2_linearSlop?(h=Box2D.Common.Math.b2Math.Clamp(m,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),l=Math.abs(m),u=!0):m<=this.m_lowerTranslation?(h=Box2D.Common.Math.b2Math.Clamp(m-this.m_lowerTranslation+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),l=this.m_lowerTranslation-m,u=!0):m>=this.m_upperTranslation&&(h=Box2D.Common.Math.b2Math.Clamp(m-this.m_upperTranslation+Box2D.Common.b2Settings.b2_linearSlop,0,Box2D.Common.b2Settings.b2_maxLinearCorrection),l=m-this.m_upperTranslation,u=!0)}return Box2D.Common.Math.b2Vec2.Free(this.m_perp),this.m_perp=Box2D.Common.Math.b2Math.MulMV(p,this.m_localYAxis1),this.m_s1=(o+c)*this.m_perp.y-(f+d)*this.m_perp.x,this.m_s2=v*this.m_perp.y-a*this.m_perp.x,p=Box2D.Common.Math.b2Vec3.Get(0,0,0),d=this.m_perp.x*o+this.m_perp.y*f,v=s-r-this.m_refAngle,l=Math.max(l,Math.abs(d)),c=Math.abs(v),u?(u=this.m_invMassA,a=this.m_invMassB,o=this.m_invIA,f=this.m_invIB,this.m_K.col1.x=u+a+o*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+f*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+f,this.m_K.col2.z=o*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+a+o*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_K.Solve33(p,-d,-v,-h)):(u=this.m_invMassA,a=this.m_invMassB,o=this.m_invIA,f=this.m_invIB,h=o*this.m_s1+f*this.m_s2,m=o+f,this.m_K.col1.Set(u+a+o*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,h,0),this.m_K.col2.Set(h,m,0),h=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_K.Solve22(h,-d,-v),p.x=h.x,p.y=h.y,Box2D.Common.Math.b2Vec2.Free(h),p.z=0),h=p.x*this.m_perp.x+p.z*this.m_axis.x,u=p.x*this.m_perp.y+p.z*this.m_axis.y,d=p.x*this.m_s1+p.y+p.z*this.m_a1,v=p.x*this.m_s2+p.y+p.z*this.m_a2,Box2D.Common.Math.b2Vec3.Free(p),n.x-=this.m_invMassA*h,n.y-=this.m_invMassA*u,r-=this.m_invIA*d,i.x+=this.m_invMassB*h,i.y+=this.m_invMassB*u,s+=this.m_invIB*v,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),l<=Box2D.Common.b2Settings.b2_linearSlop&&c<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAxisA=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},goog.inherits(Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2PrismaticJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PrismaticJoint(this)},Box2D.Dynamics.Joints.b2WeldJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle},goog.inherits(Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionForce=function(e){return Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse.x,e*this.m_impulse.y)},Box2D.Dynamics.Joints.b2WeldJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},Box2D.Dynamics.Joints.b2WeldJoint.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y,n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n;t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y,n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n;t=r.m_invMass;var n=i.m_invMass,f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolveVelocityConstraints=function(){var e,t=0,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,s=n.m_angularVelocity,o=r.m_linearVelocity,u=r.m_angularVelocity,a=n.m_invMass,f=r.m_invMass,l=n.m_invI,c=r.m_invI;e=n.m_xf.R;var h=this.m_localAnchorA.x-n.m_sweep.localCenter.x,p=this.m_localAnchorA.y-n.m_sweep.localCenter.y,t=e.col1.x*h+e.col2.x*p,p=e.col1.y*h+e.col2.y*p,h=t;e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x,v=this.m_localAnchorB.y-r.m_sweep.localCenter.y,t=e.col1.x*d+e.col2.x*v,v=e.col1.y*d+e.col2.y*v,d=t;e=o.x-u*v-i.x+s*p;var t=o.y+u*d-i.y-s*h,m=u-s,g=Box2D.Common.Math.b2Vec3.Get(0,0,0);this.m_mass.Solve33(g,-e,-t,-m),this.m_impulse.Add(g),i.x-=a*g.x,i.y-=a*g.y,s-=l*(h*g.y-p*g.x+g.z),o.x+=f*g.x,o.y+=f*g.y,u+=c*(d*g.y-v*g.x+g.z),Box2D.Common.Math.b2Vec3.Free(g),n.m_angularVelocity=s,r.m_angularVelocity=u},Box2D.Dynamics.Joints.b2WeldJoint.prototype.SolvePositionConstraints=function(){var e,t=0,n=this.m_bodyA,r=this.m_bodyB;e=n.m_xf.R;var i=this.m_localAnchorA.x-n.m_sweep.localCenter.x,s=this.m_localAnchorA.y-n.m_sweep.localCenter.y,t=e.col1.x*i+e.col2.x*s,s=e.col1.y*i+e.col2.y*s,i=t;e=r.m_xf.R;var o=this.m_localAnchorB.x-r.m_sweep.localCenter.x,u=this.m_localAnchorB.y-r.m_sweep.localCenter.y,t=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=t;e=n.m_invMass;var t=r.m_invMass,a=n.m_invI,f=r.m_invI,l=r.m_sweep.c.x+o-n.m_sweep.c.x-i,c=r.m_sweep.c.y+u-n.m_sweep.c.y-s,h=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,p=10*Box2D.Common.b2Settings.b2_linearSlop,d=Math.sqrt(l*l+c*c),v=Math.abs(h);return d>p&&(a*=1,f*=1),this.m_mass.col1.x=e+t+s*s*a+u*u*f,this.m_mass.col2.x=-s*i*a-u*o*f,this.m_mass.col3.x=-s*a-u*f,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+t+i*i*a+o*o*f,this.m_mass.col3.y=i*a+o*f,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=a+f,p=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass.Solve33(p,-l,-c,-h),n.m_sweep.c.x-=e*p.x,n.m_sweep.c.y-=e*p.y,n.m_sweep.a-=a*(i*p.y-s*p.x+p.z),r.m_sweep.c.x+=t*p.x,r.m_sweep.c.y+=t*p.y,r.m_sweep.a+=f*(o*p.y-u*p.x+p.z),Box2D.Common.Math.b2Vec3.Free(p),n.SynchronizeTransform(),r.SynchronizeTransform(),d<=Box2D.Common.b2Settings.b2_linearSlop&&v<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_weldJoint,this.referenceAngle=0},goog.inherits(Box2D.Dynamics.Joints.b2WeldJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2WeldJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2WeldJoint(this)},Box2D.Collision.b2DistanceOutput=function(){this.pointA=Box2D.Common.Math.b2Vec2.Get(0,0),this.pointB=Box2D.Common.Math.b2Vec2.Get(0,0),this.distance=0},Box2D.Collision.b2SimplexVertex=function(){this.wA=Box2D.Common.Math.b2Vec2.Get(0,0),this.wB=Box2D.Common.Math.b2Vec2.Get(0,0),this.w=Box2D.Common.Math.b2Vec2.Get(0,0),this.indexB=this.indexA=this.a=0},Box2D.Collision.b2SimplexVertex.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},Box2D.Collision.b2Simplex=function(){this.m_v1=new Box2D.Collision.b2SimplexVertex,this.m_v2=new Box2D.Collision.b2SimplexVertex,this.m_v3=new Box2D.Collision.b2SimplexVertex,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]},Box2D.Collision.b2Simplex._freeCache=[],Box2D.Collision.b2Simplex.Get=function(){if(0<Box2D.Collision.b2Simplex._freeCache.length){for(var e=Box2D.Collision.b2Simplex._freeCache.pop(),t=0;t<e.m_vertices.length;t++){var n=e.m_vertices[t];null!=n.wA&&n.wA.Set(0,0),null!=n.wB&&n.wB.Set(0,0),null!=n.w&&n.w.Set(0,0),n.indexA=0,n.indexB=0,n.a=0}return e}return new Box2D.Collision.b2Simplex},Box2D.Collision.b2Simplex.Free=function(e){null!=e&&Box2D.Collision.b2Simplex._freeCache.push(e)},Box2D.Collision.b2Simplex.prototype.ReadCache=function(e,t,n,r,i){Box2D.Common.b2Settings.b2Assert(0<=e.count&&3>=e.count);var s,o;this.m_count=e.count;for(var u=this.m_vertices,a=0;a<this.m_count;a++){var f=u[a];f.indexA=e.indexA[a],f.indexB=e.indexB[a],s=t.GetVertex(f.indexA),o=r.GetVertex(f.indexB),Box2D.Common.Math.b2Vec2.Free(f.wA),Box2D.Common.Math.b2Vec2.Free(f.wB),Box2D.Common.Math.b2Vec2.Free(f.w),f.wA=Box2D.Common.Math.b2Math.MulX(n,s),f.wB=Box2D.Common.Math.b2Math.MulX(i,o),f.w=Box2D.Common.Math.b2Math.SubtractVV(f.wB,f.wA),f.a=0}1<this.m_count&&(e=e.metric,s=this.GetMetric(),s<.5*e||2*e<s||s<Number.MIN_VALUE)&&(this.m_count=0),0==this.m_count&&(f=u[0],f.indexA=0,f.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),Box2D.Common.Math.b2Vec2.Free(f.wA),Box2D.Common.Math.b2Vec2.Free(f.wB),Box2D.Common.Math.b2Vec2.Free(f.w),f.wA=Box2D.Common.Math.b2Math.MulX(n,s),f.wB=Box2D.Common.Math.b2Math.MulX(i,o),f.w=Box2D.Common.Math.b2Math.SubtractVV(f.wB,f.wA),this.m_count=1)},Box2D.Collision.b2Simplex.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=this.m_count;for(var t=this.m_vertices,n=0;n<this.m_count;n++)e.indexA[n]=t[n].indexA,e.indexB[n]=t[n].indexB},Box2D.Collision.b2Simplex.prototype.GetSearchDirection=function(){if(1==this.m_count)return this.m_v1.w.GetNegative();if(2==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),t=this.m_v1.w.GetNegative(),n=Box2D.Common.Math.b2Math.CrossVV(e,t);return Box2D.Common.Math.b2Vec2.Free(t),t=null,t=0<n?Box2D.Common.Math.b2Math.CrossFV(1,e):Box2D.Common.Math.b2Math.CrossVF(e,1),Box2D.Common.Math.b2Vec2.Free(e),t}return Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Simplex.prototype.GetClosestPoint=function(){return 1==this.m_count?this.m_v1.w:2==this.m_count?Box2D.Common.Math.b2Vec2.Get(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):(Box2D.Common.b2Settings.b2Assert(!1),Box2D.Common.Math.b2Vec2.Get(0,0))},Box2D.Collision.b2Simplex.prototype.GetWitnessPoints=function(e,t){1==this.m_count?(e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB)):2==this.m_count?(e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y):3==this.m_count?(t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y):Box2D.Common.b2Settings.b2Assert(!1)},Box2D.Collision.b2Simplex.prototype.GetMetric=function(){if(1==this.m_count)return 0;if(2==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v1.w,this.m_v2.w),t=e.Length();return Box2D.Common.Math.b2Vec2.Free(e),t}if(3==this.m_count){var e=Box2D.Common.Math.b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),n=Box2D.Common.Math.b2Math.SubtractVV(this.m_v3.w,this.m_v1.w),t=Box2D.Common.Math.b2Math.CrossVV(e,n);return Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(n),t}return Box2D.Common.b2Settings.b2Assert(!1),0},Box2D.Collision.b2Simplex.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=Box2D.Common.Math.b2Math.SubtractVV(t,e),e=-(e.x*n.x+e.y*n.y);0>=e?(Box2D.Common.Math.b2Vec2.Free(n),this.m_count=this.m_v1.a=1):(t=t.x*n.x+t.y*n.y,Box2D.Common.Math.b2Vec2.Free(n),0>=t?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},Box2D.Collision.b2Simplex.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=Box2D.Common.Math.b2Math.SubtractVV(t,e),i=Box2D.Common.Math.b2Math.Dot(e,r),s=Box2D.Common.Math.b2Math.Dot(t,r),i=-i,o=Box2D.Common.Math.b2Math.SubtractVV(n,e),u=Box2D.Common.Math.b2Math.Dot(e,o),a=Box2D.Common.Math.b2Math.Dot(n,o),f=Box2D.Common.Math.b2Math.CrossVV(r,o);Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(o);var r=-u,u=Box2D.Common.Math.b2Math.SubtractVV(n,t),l=Box2D.Common.Math.b2Math.Dot(t,u),o=Box2D.Common.Math.b2Math.Dot(n,u);Box2D.Common.Math.b2Vec2.Free(u),u=-l,l=f*Box2D.Common.Math.b2Math.CrossVV(t,n),n=f*Box2D.Common.Math.b2Math.CrossVV(n,e),e=f*Box2D.Common.Math.b2Math.CrossVV(e,t),0>=i&&0>=r?this.m_count=this.m_v1.a=1:0<s&&0<i&&0>=e?(a=1/(s+i),this.m_v1.a=s*a,this.m_v2.a=i*a,this.m_count=2):0<a&&0<r&&0>=n?(s=1/(a+r),this.m_v1.a=a*s,this.m_v3.a=r*s,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=s&&0>=u?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=a&&0>=o?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<o&&0<u&&0>=l?(s=1/(o+u),this.m_v2.a=o*s,this.m_v3.a=u*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(l+n+e),this.m_v1.a=l*s,this.m_v2.a=n*s,this.m_v3.a=e*s,this.m_count=3)},Box2D.Collision.b2Distance={},Box2D.Collision.b2Distance.Distance=function(e,t,n){var r=Box2D.Collision.b2Simplex.Get();r.ReadCache(t,n.proxyA,n.transformA,n.proxyB,n.transformB),(1>r.m_count||3<r.m_count)&&Box2D.Common.b2Settings.b2Assert(!1);for(var i=0;20>i;){for(var s=[],o=0;o<r.m_count;o++)s[o]={},s[o].indexA=r.m_vertices[o].indexA,s[o].indexB=r.m_vertices[o].indexB;2==r.m_count?r.Solve2():3==r.m_count&&r.Solve3();if(3==r.m_count)break;o=r.GetSearchDirection();if(o.LengthSquared()<Box2D.Common.b2Settings.MIN_VALUE_SQUARED){Box2D.Common.Math.b2Vec2.Free(o);break}Box2D.Common.Math.b2Vec2.Free(r.m_vertices[r.m_count].wA),Box2D.Common.Math.b2Vec2.Free(r.m_vertices[r.m_count].wB),Box2D.Common.Math.b2Vec2.Free(r.m_vertices[r.m_count].w);var u=o.GetNegative(),a=Box2D.Common.Math.b2Math.MulTMV(n.transformA.R,u);Box2D.Common.Math.b2Vec2.Free(u),r.m_vertices[r.m_count].indexA=n.proxyA.GetSupport(a),Box2D.Common.Math.b2Vec2.Free(a),r.m_vertices[r.m_count].wA=Box2D.Common.Math.b2Math.MulX(n.transformA,n.proxyA.GetVertex(r.m_vertices[r.m_count].indexA)),u=Box2D.Common.Math.b2Math.MulTMV(n.transformB.R,o),Box2D.Common.Math.b2Vec2.Free(o),r.m_vertices[r.m_count].indexB=n.proxyB.GetSupport(u),Box2D.Common.Math.b2Vec2.Free(u),r.m_vertices[r.m_count].wB=Box2D.Common.Math.b2Math.MulX(n.transformB,n.proxyB.GetVertex(r.m_vertices[r.m_count].indexB)),r.m_vertices[r.m_count].w=Box2D.Common.Math.b2Math.SubtractVV(r.m_vertices[r.m_count].wB,r.m_vertices[r.m_count].wA),i++,u=!1;for(o=0;o<s.length;o++)if(r.m_vertices[r.m_count].indexA==s[o].indexA&&r.m_vertices[r.m_count].indexB==s[o].indexB){u=!0;break}if(u)break;r.m_count++}r.GetWitnessPoints(e.pointA,e.pointB),i=Box2D.Common.Math.b2Math.SubtractVV(e.pointA,e.pointB),e.distance=i.Length(),Box2D.Common.Math.b2Vec2.Free(i),r.WriteCache(t),Box2D.Collision.b2Simplex.Free(r),n.useRadii&&(t=n.proxyA.m_radius,n=n.proxyB.m_radius,e.distance>t+n&&e.distance>Number.MIN_VALUE?(e.distance-=t+n,r=Box2D.Common.Math.b2Math.SubtractVV(e.pointB,e.pointA),r.Normalize(),e.pointA.x+=t*r.x,e.pointA.y+=t*r.y,e.pointB.x-=n*r.x,e.pointB.y-=n*r.y,Box2D.Common.Math.b2Vec2.Free(r)):(n=Box2D.Common.Math.b2Vec2.Get(0,0),n.x=.5*(e.pointA.x+e.pointB.x),n.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=n.x,e.pointA.y=e.pointB.y=n.y,e.distance=0,Box2D.Common.Math.b2Vec2.Free(n)))},Box2D.Collision.b2SimplexCache=function(){this.indexA=[0,0,0],this.indexB=[0,0,0]},Box2D.Collision.b2DistanceInput=function(){this.useRadii=!1,this.transformB=this.transformA=this.proxyB=this.proxyA=null},Box2D.Collision.Shapes={},Box2D.Collision.Shapes.b2Shape=function(){this.m_radius=Box2D.Common.b2Settings.b2_linearSlop},Box2D.Collision.Shapes.b2Shape.prototype.Set=function(e){this.m_radius=e.m_radius},Box2D.Collision.Shapes.b2Shape.TestOverlap=function(e,t,n,r){var i=new Box2D.Collision.b2DistanceInput;return i.proxyA=new Box2D.Collision.b2DistanceProxy,i.proxyA.Set(e),i.proxyB=new Box2D.Collision.b2DistanceProxy,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new Box2D.Collision.b2SimplexCache,e.count=0,t=new Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2Distance.Distance(t,e,i),Box2D.Common.Math.b2Vec2.Free(t.pointA),Box2D.Common.Math.b2Vec2.Free(t.pointB),t.distance<10*Number.MIN_VALUE},Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2CircleShape=function(e){Box2D.Collision.Shapes.b2Shape.call(this),this.m_radius=e,this.m_radiusSquared=e*e,this.m_p=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[this.m_p]},goog.inherits(Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2CircleShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2CircleShape.NAME},Box2D.Collision.Shapes.b2CircleShape.prototype.Copy=function(){var e=new Box2D.Collision.Shapes.b2CircleShape(this.m_radius);return e.Set(this),e},Box2D.Collision.Shapes.b2CircleShape.prototype.Set=function(e){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,e),e instanceof Box2D.Collision.Shapes.b2CircleShape&&this.m_p.SetV(e.m_p)},Box2D.Collision.Shapes.b2CircleShape.prototype.TestPoint=function(e,t){var n=t.x-(e.position.x+(e.R.col1.x*this.m_p.x+e.R.col2.x*this.m_p.y)),r=t.y-(e.position.y+(e.R.col1.y*this.m_p.x+e.R.col2.y*this.m_p.y));return n*n+r*r<=this.m_radiusSquared},Box2D.Collision.Shapes.b2CircleShape.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y)),n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radiusSquared);return 0>a||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeMass=function(e,t){var n=t*Math.PI*this.m_radiusSquared;e.SetV(n,this.m_p,n*(.5*this.m_radiusSquared+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y)))},Box2D.Collision.Shapes.b2CircleShape.prototype.ComputeSubmergedArea=function(e,t,n,r){var n=Box2D.Common.Math.b2Math.MulX(n,this.m_p),i=-(Box2D.Common.Math.b2Math.Dot(e,n)-t);return i<-this.m_radius+Number.MIN_VALUE?(Box2D.Common.Math.b2Vec2.Free(n),0):i>this.m_radius?(Box2D.Common.Math.b2Vec2.Free(n),r.SetV(n),Math.PI*this.m_radiusSquared):(t=i*i,i=this.m_radiusSquared*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(this.m_radiusSquared-t),t=-2/3*Math.pow(this.m_radiusSquared-t,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,Box2D.Common.Math.b2Vec2.Free(n),i)},Box2D.Collision.Shapes.b2CircleShape.prototype.SetDistanceProxy=function(e){e.SetValues(1,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},Box2D.Collision.Shapes.b2CircleShape.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},Box2D.Collision.Shapes.b2CircleShape.prototype.GetRadius=function(){return this.m_radius},Box2D.Collision.Shapes.b2CircleShape.prototype.SetRadius=function(e){this.m_radius=e,this.m_radiusSquared=e*e},Box2D.Collision.Shapes.b2CircleShape.NAME="b2CircleShape",Box2D.Consts={},Box2D.Consts.MIN_VALUE_SQUARED=Number.MIN_VALUE*Number.MIN_VALUE,Box2D.Collision.b2AABB=function(){this.lowerBound=Box2D.Common.Math.b2Vec2.Get(0,0),this.upperBound=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2AABB._freeCache=[],Box2D.Collision.b2AABB.Get=function(){if(0<Box2D.Collision.b2AABB._freeCache.length){var e=Box2D.Collision.b2AABB._freeCache.pop();return e.SetZero(),e}return new Box2D.Collision.b2AABB},Box2D.Collision.b2AABB.Free=function(e){null!=e&&Box2D.Collision.b2AABB._freeCache.push(e)},Box2D.Collision.b2AABB.prototype.SetZero=function(){this.lowerBound.Set(0,0),this.upperBound.Set(0,0)},Box2D.Collision.b2AABB.prototype.IsValid=function(){return 0>this.upperBound.x-this.lowerBound.x||0>this.upperBound.y-this.lowerBound.y?!1:this.lowerBound.IsValid()&&this.upperBound.IsValid()},Box2D.Collision.b2AABB.prototype.GetCenter=function(){return Box2D.Common.Math.b2Vec2.Get((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},Box2D.Collision.b2AABB.prototype.SetCenter=function(e){var t=this.GetCenter();this.lowerBound.Subtract(t),this.upperBound.Subtract(t),this.lowerBound.Add(e),this.upperBound.Add(e),Box2D.Common.Math.b2Vec2.Free(t)},Box2D.Collision.b2AABB.prototype.GetExtents=function(){return Box2D.Common.Math.b2Vec2.Get((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},Box2D.Collision.b2AABB.prototype.Contains=function(e){var t;return t=(t=(t=(t=this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y},Box2D.Collision.b2AABB.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p2.x-t.p1.x;if(Math.abs(i)<Number.MIN_VALUE){if(t.p1.x<this.lowerBound.x||this.upperBound.x<t.p1.x)return!1}else{var s=1/i,i=(this.lowerBound.x-t.p1.x)*s,s=(this.upperBound.x-t.p1.x)*s,o=-1;i>s&&(o=i,i=s,s=o,o=1),i>n&&(e.normal.x=o,e.normal.y=0,n=i),r=Math.min(r,s);if(n>r)return!1}i=t.p2.y-t.p1.y;if(Math.abs(i)<Number.MIN_VALUE){if(t.p1.y<this.lowerBound.y||this.upperBound.y<t.p1.y)return!1}else if(s=1/i,i=(this.lowerBound.y-t.p1.y)*s,s*=this.upperBound.y-t.p1.y,o=-1,i>s&&(o=i,i=s,s=o,o=1),i>n&&(e.normal.y=o,e.normal.x=0,n=i),r=Math.min(r,s),n>r)return!1;return e.fraction=n,!0},Box2D.Collision.b2AABB.prototype.TestOverlap=function(e){return 0<e.lowerBound.x-this.upperBound.x||0<e.lowerBound.y-this.upperBound.y||0<this.lowerBound.x-e.upperBound.x||0<this.lowerBound.y-e.upperBound.y?!1:!0},Box2D.Collision.b2AABB.Combine=function(e,t){var n=Box2D.Collision.b2AABB.Get();return n.Combine(e,t),n},Box2D.Collision.b2AABB.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},Box2D.Dynamics.b2FixtureListNode=function(e){this.fixture=e,this.previous=this.next=null},Box2D.Dynamics.b2FixtureListNode.prototype.SetNextNode=function(e){this.next=e},Box2D.Dynamics.b2FixtureListNode.prototype.SetPreviousNode=function(e){this.previous=e},Box2D.Dynamics.b2FixtureListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2FixtureListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Collision.b2ContactID=function(){this._incidentVertex=this._incidentEdge=this._referenceEdge=this._key=0},Box2D.Collision.b2ContactID.prototype.GetKey=function(){return this._key},Box2D.Collision.b2ContactID.prototype.SetKey=function(e){this._key=e,this._referenceEdge=this._key&255,this._incidentEdge=(this._key&65280)>>8&255,this._incidentVertex=(this._key&16711680)>>16&255,this._flip=(this._key&4278190080)>>24&255},Box2D.Collision.b2ContactID.prototype.Set=function(e){this.SetKey(e._key)},Box2D.Collision.b2ContactID.prototype.SetReferenceEdge=function(e){this._referenceEdge=e,this._key=this._key&4294967040|this._referenceEdge&255},Box2D.Collision.b2ContactID.prototype.SetIncidentEdge=function(e){this._incidentEdge=e,this._key=this._key&4294902015|this._incidentEdge<<8&65280},Box2D.Collision.b2ContactID.prototype.SetIncidentVertex=function(e){this._incidentVertex=e,this._key=this._key&4278255615|this._incidentVertex<<16&16711680},Box2D.Collision.b2ContactID.prototype.SetFlip=function(e){this._flip=e,this._key=this._key&16777215|this._flip<<24&4278190080},Box2D.Collision.b2ContactID.prototype.Copy=function(){var e=new Box2D.Collision.b2ContactID;return e.Set(this),e},Box2D.Collision.b2ManifoldPoint=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_id=new Box2D.Collision.b2ContactID,this.m_tangentImpulse=this.m_normalImpulse=0},Box2D.Collision.b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.SetKey(0)},Box2D.Collision.b2ManifoldPoint.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},Box2D.Collision.b2DynamicTreeNode=function(e){this.aabb=Box2D.Collision.b2AABB.Get(),this.parent=this.child2=this.child1=null,this.fixture=e},Box2D.Collision.b2DynamicTreeNode._freeCache=[],Box2D.Collision.b2DynamicTreeNode.Get=function(e){"undefined"==typeof e&&(e=null);if(0<Box2D.Collision.b2DynamicTreeNode._freeCache.length){var t=Box2D.Collision.b2DynamicTreeNode._freeCache.pop();return t.fixture=e,t.aabb.SetZero(),t}return new Box2D.Collision.b2DynamicTreeNode(e)},Box2D.Collision.b2DynamicTreeNode.prototype.Destroy=function(){this.fixture=this.parent=this.child2=this.child1=null,Box2D.Collision.b2DynamicTreeNode._freeCache.push(this)},Box2D.Collision.b2DynamicTreeNode.prototype.IsLeaf=function(){return null===this.child1},Box2D.Collision.b2RayCastInput=function(e,t,n){this.p1=Box2D.Common.Math.b2Vec2.Get(e.x,e.y),this.p2=Box2D.Common.Math.b2Vec2.Get(t.x,t.y),this.maxFraction=n},Box2D.Collision.b2DynamicTree=function(){this.m_root=null,this.m_insertionCount=this.m_path=0},Box2D.Collision.b2DynamicTree.prototype.CreateProxy=function(e,t){var n=Box2D.Collision.b2DynamicTreeNode.Get(t),r=Box2D.Common.b2Settings.b2_aabbExtension,i=Box2D.Common.b2Settings.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,this.InsertLeaf(n),n},Box2D.Collision.b2DynamicTree.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),e.Destroy()},Box2D.Collision.b2DynamicTree.prototype.MoveProxy=function(e,t,n){Box2D.Common.b2Settings.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(n.x),n=Box2D.Common.b2Settings.b2_aabbExtension+Box2D.Common.b2Settings.b2_aabbMultiplier*Math.abs(n.y);return e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},Box2D.Collision.b2DynamicTree.prototype.Rebalance=function(e){if(null!==this.m_root)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;!n.IsLeaf();)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;this.m_path++,this.RemoveLeaf(n),this.InsertLeaf(n)}},Box2D.Collision.b2DynamicTree.prototype.GetFatAABB=function(e){return e.aabb},Box2D.Collision.b2DynamicTree.prototype.Query=function(e,t,n){if(null!==this.m_root){var r=[];for(r.push(this.m_root);0<r.length;){var i=r.pop();if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e.call(n,i.fixture))break}else r.push(i.child1),r.push(i.child2)}}},Box2D.Collision.b2DynamicTree.prototype.RayCast=function(e,t){if(null!==this.m_root){var n=Box2D.Common.Math.b2Math.SubtractVV(t.p1,t.p2);n.Normalize();var r=Box2D.Common.Math.b2Math.CrossFV(1,n);Box2D.Common.Math.b2Vec2.Free(n);var n=Box2D.Common.Math.b2Math.AbsV(r),i=t.maxFraction,s=t.p1.x+i*(t.p2.x-t.p1.x),i=t.p1.y+i*(t.p2.y-t.p1.y),o=Box2D.Collision.b2AABB.Get();o.lowerBound.x=Math.min(t.p1.x,s),o.lowerBound.y=Math.min(t.p1.y,i),o.upperBound.x=Math.max(t.p1.x,s),o.upperBound.y=Math.max(t.p1.y,i);var u=[];for(u.push(this.m_root);0<u.length;)if(s=u.pop(),s.aabb.TestOverlap(o)){var i=s.aabb.GetCenter(),a=s.aabb.GetExtents(),f=Math.abs(r.x*(t.p1.x-i.x)+r.y*(t.p1.y-i.y))-n.x*a.x-n.y*a.y;Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(a);if(!(0<f))if(s.IsLeaf()){new Box2D.Collision.b2RayCastInput(t.p1,t.p2,t.maxFraction),i=e(t,s.fixture);if(0==i)break;0<i&&(s=t.p1.x+i*(t.p2.x-t.p1.x),i=t.p1.y+i*(t.p2.y-t.p1.y),o.lowerBound.x=Math.min(t.p1.x,s),o.lowerBound.y=Math.min(t.p1.y,i),o.upperBound.x=Math.max(t.p1.x,s),o.upperBound.y=Math.max(t.p1.y,i))}else u.push(s.child1),u.push(s.child2)}Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(n),Box2D.Collision.b2AABB.Free(o)}},Box2D.Collision.b2DynamicTree.prototype.InsertLeaf=function(e){this.m_insertionCount++;if(null===this.m_root)this.m_root=e,this.m_root.parent=null;else{var t=this.GetBestSibling(e),n=t.parent,r=Box2D.Collision.b2DynamicTreeNode.Get();r.parent=n,r.aabb.Combine(e.aabb,t.aabb);if(n){t.parent.child1==t?n.child1=r:n.child2=r,r.child1=t,r.child2=e,t.parent=r;for(e.parent=r;n&&!n.aabb.Contains(r.aabb);)n.aabb.Combine(n.child1.aabb,n.child2.aabb),r=n,n=n.parent}else r.child1=t,r.child2=e,t.parent=r,this.m_root=e.parent=r}},Box2D.Collision.b2DynamicTree.prototype.GetBestSibling=function(e){for(var e=e.aabb.GetCenter(),t=this.m_root;!t.IsLeaf();)var n=t.child1,t=t.child2,r=Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-e.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-e.y),i=Math.abs((t.aabb.lowerBound.x+t.aabb.upperBound.x)/2-e.x)+Math.abs((t.aabb.lowerBound.y+t.aabb.upperBound.y)/2-e.y),t=r<i?n:t;return Box2D.Common.Math.b2Vec2.Free(e),t},Box2D.Collision.b2DynamicTree.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent,e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e;for(e.parent=n;n;){e=n.aabb,n.aabb.Combine(n.child1.aabb,n.child2.aabb);if(e.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null;t.Destroy()}},Box2D.Collision.ClipVertex=function(){this.v=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.ClipVertex.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},Box2D.Collision.b2Manifold=function(){this.m_type=this.m_pointCount=0,this.m_points=[];for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new Box2D.Collision.b2ManifoldPoint;this.m_localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Manifold.prototype.Reset=function(){for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},Box2D.Collision.b2Manifold.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<Box2D.Common.b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},Box2D.Collision.b2Manifold.prototype.Copy=function(){var e=new Box2D.Collision.b2Manifold;return e.Set(this),e},Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4,Box2D.Collision.b2Collision={},Box2D.Collision.b2Collision.ClipSegmentToLine=function(e,t,n,r){var i=0,s=t[0].v,o=t[1].v,u=n.x*s.x+n.y*s.y-r,n=n.x*o.x+n.y*o.y-r;return 0>=u&&e[i++].Set(t[0]),0>=n&&e[i++].Set(t[1]),0>u*n&&(n=u/(u-n),r=e[i].v,r.x=s.x+n*(o.x-s.x),r.y=s.y+n*(o.y-s.y),e[i].id=0<u?t[0].id:t[1].id,i++),i},Box2D.Collision.b2Collision.EdgeSeparation=function(e,t,n,r,i){for(var s=t.R.col1.x*e.m_normals[n].x+t.R.col2.x*e.m_normals[n].y,o=t.R.col1.y*e.m_normals[n].x+t.R.col2.y*e.m_normals[n].y,u=i.R.col1.x*s+i.R.col1.y*o,a=i.R.col2.x*s+i.R.col2.y*o,f=0,l=Number.MAX_VALUE,c=0;c<r.m_vertexCount;c++){var h=r.m_vertices[c].x*u+r.m_vertices[c].y*a;h<l&&(l=h,f=c)}return(i.position.x+(i.R.col1.x*r.m_vertices[f].x+i.R.col2.x*r.m_vertices[f].y)-(t.position.x+(t.R.col1.x*e.m_vertices[n].x+t.R.col2.x*e.m_vertices[n].y)))*s+(i.position.y+(i.R.col1.y*r.m_vertices[f].x+i.R.col2.y*r.m_vertices[f].y)-(t.position.y+(t.R.col1.y*e.m_vertices[n].x+t.R.col2.y*e.m_vertices[n].y)))*o},Box2D.Collision.b2Collision.FindMaxSeparation=function(e,t,n,r){for(var i=r.position.x+(r.R.col1.x*n.m_centroid.x+r.R.col2.x*n.m_centroid.y),s=r.position.y+(r.R.col1.y*n.m_centroid.x+r.R.col2.y*n.m_centroid.y),i=i-(t.position.x+(t.R.col1.x*e.m_centroid.x+t.R.col2.x*e.m_centroid.y)),s=s-(t.position.y+(t.R.col1.y*e.m_centroid.x+t.R.col2.y*e.m_centroid.y)),o=i*t.R.col1.x+s*t.R.col1.y,s=i*t.R.col2.x+s*t.R.col2.y,i=0,u=-Number.MAX_VALUE,a=0;a<e.m_vertexCount;++a){var f=e.m_normals[a].x*o+e.m_normals[a].y*s;f>u&&(u=f,i=a)}o=Box2D.Collision.b2Collision.EdgeSeparation(e,t,i,n,r),s=i-1,0>s&&(s=e.m_vertexCount-1),u=Box2D.Collision.b2Collision.EdgeSeparation(e,t,s,n,r),a=i+1,a>=e.m_vertexCount&&(a=0);var f=Box2D.Collision.b2Collision.EdgeSeparation(e,t,a,n,r),l=0,c=0;if(u>o&&u>f){l=s;for(c=u;;){if(i=l-1,0>i&&(i=e.m_vertexCount-1),o=Box2D.Collision.b2Collision.EdgeSeparation(e,t,i,n,r),!(o>c))break;l=i,c=o}}else if(f>o){l=a;for(c=f;;){if(i=l+1,i>=e.m_vertexCount&&(i=0),o=Box2D.Collision.b2Collision.EdgeSeparation(e,t,i,n,r),!(o>c))break;l=i,c=o}}else l=i,c=o;return{bestEdge:l,separation:c}},Box2D.Collision.b2Collision.FindIncidentEdge=function(e,t,n,r,i,s){for(var o=n.R.col1.x*t.m_normals[r].x+n.R.col2.x*t.m_normals[r].y,t=n.R.col1.y*t.m_normals[r].x+n.R.col2.y*t.m_normals[r].y,n=s.R.col1.x*o+s.R.col1.y*t,t=s.R.col2.x*o+s.R.col2.y*t,o=n,n=0,u=Number.MAX_VALUE,a=0;a<i.m_vertexCount;a++){var f=o*i.m_normals[a].x+t*i.m_normals[a].y;f<u&&(u=f,n=a)}o=n+1,o>=i.m_vertexCount&&(o=0),e[0].v.x=s.position.x+(s.R.col1.x*i.m_vertices[n].x+s.R.col2.x*i.m_vertices[n].y),e[0].v.y=s.position.y+(s.R.col1.y*i.m_vertices[n].x+s.R.col2.y*i.m_vertices[n].y),e[0].id.SetReferenceEdge(r),e[0].id.SetIncidentEdge(n),e[0].id.SetIncidentVertex(0),e[1].v.x=s.position.x+(s.R.col1.x*i.m_vertices[o].x+s.R.col2.x*i.m_vertices[o].y),e[1].v.y=s.position.y+(s.R.col1.y*i.m_vertices[o].x+s.R.col2.y*i.m_vertices[o].y),e[1].id.SetReferenceEdge(r),e[1].id.SetIncidentEdge(o),e[1].id.SetIncidentVertex(1)},Box2D.Collision.b2Collision.MakeClipPointVector=function(){return[new Box2D.Collision.ClipVertex,new Box2D.Collision.ClipVertex]},Box2D.Collision.b2Collision.CollidePolygons=function(e,t,n,r,i){e.m_pointCount=0;var s=t.m_radius+r.m_radius,o=Box2D.Collision.b2Collision.FindMaxSeparation(t,n,r,i);if(!(o.separation>s)){var u=Box2D.Collision.b2Collision.FindMaxSeparation(r,i,t,n);if(!(u.separation>s)){var a=t,f=r,l=n,c=i,h=0,p=o.bestEdge;e.m_type=Box2D.Collision.b2Manifold.e_faceA,u.separation>.98*o.separation+.001&&(a=r,f=t,l=i,c=n,p=u.bestEdge,e.m_type=Box2D.Collision.b2Manifold.e_faceB,h=1),t=Box2D.Collision.b2Collision.s_incidentEdge,Box2D.Collision.b2Collision.FindIncidentEdge(t,a,l,p,f,c),f=a.m_vertices[p],a=p+1<a.m_vertexCount?a.m_vertices[p+1]:a.m_vertices[0],Box2D.Collision.b2Collision.s_localTangent.Set(a.x-f.x,a.y-f.y),Box2D.Collision.b2Collision.s_localTangent.Normalize(),Box2D.Collision.b2Collision.s_localNormal.x=Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_localNormal.y=-Box2D.Collision.b2Collision.s_localTangent.x,Box2D.Collision.b2Collision.s_planePoint.Set(.5*(f.x+a.x),.5*(f.y+a.y)),Box2D.Collision.b2Collision.s_tangent.x=l.R.col1.x*Box2D.Collision.b2Collision.s_localTangent.x+l.R.col2.x*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent.y=l.R.col1.y*Box2D.Collision.b2Collision.s_localTangent.x+l.R.col2.y*Box2D.Collision.b2Collision.s_localTangent.y,Box2D.Collision.b2Collision.s_tangent2.x=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_tangent2.y=-Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.x=Box2D.Collision.b2Collision.s_tangent.y,Box2D.Collision.b2Collision.s_normal.y=-Box2D.Collision.b2Collision.s_tangent.x,Box2D.Collision.b2Collision.s_v11.x=l.position.x+(l.R.col1.x*f.x+l.R.col2.x*f.y),Box2D.Collision.b2Collision.s_v11.y=l.position.y+(l.R.col1.y*f.x+l.R.col2.y*f.y),Box2D.Collision.b2Collision.s_v12.x=l.position.x+(l.R.col1.x*a.x+l.R.col2.x*a.y),Box2D.Collision.b2Collision.s_v12.y=l.position.y+(l.R.col1.y*a.x+l.R.col2.y*a.y);if(!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints1,t,Box2D.Collision.b2Collision.s_tangent2,-Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v11.x-Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v11.y+s))&&!(2>Box2D.Collision.b2Collision.ClipSegmentToLine(Box2D.Collision.b2Collision.s_clipPoints2,Box2D.Collision.b2Collision.s_clipPoints1,Box2D.Collision.b2Collision.s_tangent,Box2D.Collision.b2Collision.s_tangent.x*Box2D.Collision.b2Collision.s_v12.x+Box2D.Collision.b2Collision.s_tangent.y*Box2D.Collision.b2Collision.s_v12.y+s))){e.m_localPlaneNormal.SetV(Box2D.Collision.b2Collision.s_localNormal),e.m_localPoint.SetV(Box2D.Collision.b2Collision.s_planePoint),l=Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_v11.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_v11.y;for(p=a=0;p<Box2D.Common.b2Settings.b2_maxManifoldPoints;++p)Box2D.Collision.b2Collision.s_normal.x*Box2D.Collision.b2Collision.s_clipPoints2[p].v.x+Box2D.Collision.b2Collision.s_normal.y*Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-l<=s&&(f=Box2D.Collision.b2Collision.s_clipPoints2[p].v.x-c.position.x,t=Box2D.Collision.b2Collision.s_clipPoints2[p].v.y-c.position.y,e.m_points[a].m_localPoint.x=f*c.R.col1.x+t*c.R.col1.y,e.m_points[a].m_localPoint.y=f*c.R.col2.x+t*c.R.col2.y,e.m_points[a].m_id.Set(Box2D.Collision.b2Collision.s_clipPoints2[p].id),e.m_points[a].m_id.SetFlip(h),a++);e.m_pointCount=a}}}},Box2D.Collision.b2Collision.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s=i.position.x+(i.R.col1.x*r.m_p.x+i.R.col2.x*r.m_p.y)-(n.position.x+(n.R.col1.x*t.m_p.x+n.R.col2.x*t.m_p.y)),n=i.position.y+(i.R.col1.y*r.m_p.x+i.R.col2.y*r.m_p.y)-(n.position.y+(n.R.col1.y*t.m_p.x+n.R.col2.y*t.m_p.y)),i=t.m_radius+r.m_radius;s*s+n*n>i*i||(e.m_type=Box2D.Collision.b2Manifold.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.SetKey(0))},Box2D.Collision.b2Collision.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;for(var s=i.position.x+(i.R.col1.x*r.m_p.x+i.R.col2.x*r.m_p.y)-n.position.x,o=i.position.y+(i.R.col1.y*r.m_p.x+i.R.col2.y*r.m_p.y)-n.position.y,i=s*n.R.col1.x+o*n.R.col1.y,n=s*n.R.col2.x+o*n.R.col2.y,s=0,o=-Number.MAX_VALUE,u=t.m_radius+r.m_radius,a=0;a<t.m_vertexCount;++a){var f=t.m_normals[a].x*(i-t.m_vertices[a].x)+t.m_normals[a].y*(n-t.m_vertices[a].y);if(f>u)return;f>o&&(o=f,s=a)}f=s+1,f>=t.m_vertexCount&&(f=0);var a=t.m_vertices[s],l=t.m_vertices[f];o<Number.MIN_VALUE?(e.m_pointCount=1,e.m_type=Box2D.Collision.b2Manifold.e_faceA,e.m_localPlaneNormal.SetV(t.m_normals[s]),e.m_localPoint.x=.5*(a.x+l.x),e.m_localPoint.y=.5*(a.y+l.y),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.SetKey(0)):0>=(i-a.x)*(l.x-a.x)+(n-a.y)*(l.y-a.y)?(i-a.x)*(i-a.x)+(n-a.y)*(n-a.y)>u*u||(e.m_pointCount=1,e.m_type=Box2D.Collision.b2Manifold.e_faceA,e.m_localPlaneNormal.x=i-a.x,e.m_localPlaneNormal.y=n-a.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(a),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.SetKey(0)):0>=(i-l.x)*(a.x-l.x)+(n-l.y)*(a.y-l.y)?(i-l.x)*(i-l.x)+(n-l.y)*(n-l.y)>u*u||(e.m_pointCount=1,e.m_type=Box2D.Collision.b2Manifold.e_faceA,e.m_localPlaneNormal.x=i-l.x,e.m_localPlaneNormal.y=n-l.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(l),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.SetKey(0)):(f=.5*(a.x+l.x),a=.5*(a.y+l.y),o=(i-f)*t.m_normals[s].x+(n-a)*t.m_normals[s].y,o>u||(e.m_pointCount=1,e.m_type=Box2D.Collision.b2Manifold.e_faceA,e.m_localPlaneNormal.x=t.m_normals[s].x,e.m_localPlaneNormal.y=t.m_normals[s].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(f,a),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.SetKey(0)))},Box2D.Collision.b2Collision.s_incidentEdge=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=Box2D.Collision.b2Collision.MakeClipPointVector(),Box2D.Collision.b2Collision.s_localTangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_localNormal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_planePoint=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_normal=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_tangent2=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v11=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2Collision.s_v12=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Collision.b2SeparationFunction=function(){this.m_localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_axis=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_proxyB=this.m_proxyA=null},Box2D.Collision.b2SeparationFunction.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r;var s=e.count;Box2D.Common.b2Settings.b2Assert(0<s&&3>s);var o,u,a=u=o=0,f=0,r=t=0,l,c,a=0;1==s?(this.m_type=Box2D.Collision.b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(e.indexA[0]),e=this.m_proxyB.GetVertex(e.indexB[0]),c=s,l=n.R,o=n.position.x+(l.col1.x*c.x+l.col2.x*c.y),u=n.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=e,l=i.R,a=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),f=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),this.m_axis.x=a-o,this.m_axis.y=f-u,this.m_axis.Normalize()):e.indexB[0]==e.indexB[1]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),e=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+r.x),this.m_localPoint.y=.5*(t.y+r.y),f=Box2D.Common.Math.b2Math.SubtractVV(r,t),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(f,1),Box2D.Common.Math.b2Vec2.Free(f),this.m_axis.Normalize(),c=this.m_axis,l=n.R,t=l.col1.x*c.x+l.col2.x*c.y,r=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=n.R,o=n.position.x+(l.col1.x*c.x+l.col2.x*c.y),u=n.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=e,l=i.R,a=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),f=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),0>(a-o)*t+(f-u)*r&&this.m_axis.NegativeSelf()):e.indexA[0]==e.indexA[0]?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,o=this.m_proxyB.GetVertex(e.indexB[0]),u=this.m_proxyB.GetVertex(e.indexB[1]),s=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(o.x+u.x),this.m_localPoint.y=.5*(o.y+u.y),f=Box2D.Common.Math.b2Math.SubtractVV(u,o),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(f,1),Box2D.Common.Math.b2Vec2.Free(f),this.m_axis.Normalize(),c=this.m_axis,l=i.R,t=l.col1.x*c.x+l.col2.x*c.y,r=l.col1.y*c.x+l.col2.y*c.y,c=this.m_localPoint,l=i.R,a=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),f=i.position.y+(l.col1.y*c.x+l.col2.y*c.y),c=s,l=n.R,o=n.position.x+(l.col1.x*c.x+l.col2.x*c.y),u=n.position.y+(l.col1.y*c.x+l.col2.y*c.y),0>(o-a)*t+(u-f)*r&&this.m_axis.NegativeSelf()):(t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),o=this.m_proxyB.GetVertex(e.indexB[0]),u=this.m_proxyB.GetVertex(e.indexB[1]),f=Box2D.Common.Math.b2Math.SubtractVV(r,t),a=Box2D.Common.Math.b2Math.MulMV(n.R,f),Box2D.Common.Math.b2Vec2.Free(f),f=Box2D.Common.Math.b2Math.SubtractVV(u,o),l=Box2D.Common.Math.b2Math.MulMV(i.R,f),Box2D.Common.Math.b2Vec2.Free(f),i=a.x*a.x+a.y*a.y,n=l.x*l.x+l.y*l.y,f=Box2D.Common.Math.b2Math.SubtractVV(l,a),e=a.x*f.x+a.y*f.y,s=l.x*f.x+l.y*f.y,Box2D.Common.Math.b2Vec2.Free(f),f=a.x*l.x+a.y*l.y,l=i*n-f*f,a=0,0!=l&&(a=Box2D.Common.Math.b2Math.Clamp((f*s-e*n)/l,0,1)),0>(f*a+s)/n&&(a=Box2D.Common.Math.b2Math.Clamp((f-e)/i,0,1)),s=Box2D.Common.Math.b2Vec2.Get(0,0),s.x=t.x+a*(r.x-t.x),s.y=t.y+a*(r.y-t.y),e=Box2D.Common.Math.b2Vec2.Get(0,0),e.x=o.x+a*(u.x-o.x),e.y=o.y+a*(u.y-o.y),0==a||1==a?(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceB,f=Box2D.Common.Math.b2Math.SubtractVV(u,o),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(f,1),Box2D.Common.Math.b2Vec2.Free(f),this.m_axis.Normalize(),this.m_localPoint=e):(this.m_type=Box2D.Collision.b2SeparationFunction.e_faceA,f=Box2D.Common.Math.b2Math.SubtractVV(r,t),Box2D.Common.Math.b2Vec2.Free(this.m_axis),this.m_axis=Box2D.Common.Math.b2Math.CrossVF(f,1),Box2D.Common.Math.b2Vec2.Free(f),this.m_localPoint=s),0>a&&this.m_axis.NegativeSelf(),Box2D.Common.Math.b2Vec2.Free(s),Box2D.Common.Math.b2Vec2.Free(e))},Box2D.Collision.b2SeparationFunction.prototype.Evaluate=function(e,t){var n=0;switch(this.m_type){case Box2D.Collision.b2SeparationFunction.e_points:var n=Box2D.Common.Math.b2Math.MulTMV(e.R,this.m_axis),r=this.m_axis.GetNegative(),i=Box2D.Common.Math.b2Math.MulTMV(t.R,r);Box2D.Common.Math.b2Vec2.Free(r);var s=this.m_proxyA.GetSupportVertex(n);Box2D.Common.Math.b2Vec2.Free(n),n=this.m_proxyB.GetSupportVertex(i),Box2D.Common.Math.b2Vec2.Free(i),i=Box2D.Common.Math.b2Math.MulX(e,s),s=Box2D.Common.Math.b2Math.MulX(t,n),n=(s.x-i.x)*this.m_axis.x+(s.y-i.y)*this.m_axis.y,Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(s);break;case Box2D.Collision.b2SeparationFunction.e_faceA:r=Box2D.Common.Math.b2Math.MulMV(e.R,this.m_axis),s=r.GetNegative(),i=Box2D.Common.Math.b2Math.MulTMV(t.R,s),Box2D.Common.Math.b2Vec2.Free(s),n=this.m_proxyB.GetSupportVertex(i),Box2D.Common.Math.b2Vec2.Free(i),i=Box2D.Common.Math.b2Math.MulX(e,this.m_localPoint),s=Box2D.Common.Math.b2Math.MulX(t,n),n=(s.x-i.x)*r.x+(s.y-i.y)*r.y,Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(s);break;case Box2D.Collision.b2SeparationFunction.e_faceB:r=Box2D.Common.Math.b2Math.MulMV(t.R,this.m_axis),s=r.GetNegative(),n=Box2D.Common.Math.b2Math.MulTMV(e.R,s),Box2D.Common.Math.b2Vec2.Free(s),s=this.m_proxyA.GetSupportVertex(n),Box2D.Common.Math.b2Vec2.Free(n),i=Box2D.Common.Math.b2Math.MulX(e,s),s=Box2D.Common.Math.b2Math.MulX(t,this.m_localPoint),n=(i.x-s.x)*r.x+(i.y-s.y)*r.y,Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(i),Box2D.Common.Math.b2Vec2.Free(s);break;default:Box2D.Common.b2Settings.b2Assert(!1)}return n},Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4,Box2D.Common.Math.b2Transform=function(e,t){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.R=new Box2D.Common.Math.b2Mat22,e&&this.position.SetV(e),t&&this.R.SetM(t)},Box2D.Common.Math.b2Transform.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},Box2D.Common.Math.b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},Box2D.Common.Math.b2Transform.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},Box2D.Common.Math.b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},Box2D.Collision.b2TimeOfImpact={},Box2D.Collision.b2TimeOfImpact.TimeOfImpact=function(e){Box2D.Collision.b2TimeOfImpact.b2_toiCalls++;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;Box2D.Common.b2Settings.b2Assert(r.t0==i.t0),Box2D.Common.b2Settings.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius,e=e.tolerance,o=0,u=0,a=0;Box2D.Collision.b2TimeOfImpact.s_cache.count=0;for(Box2D.Collision.b2TimeOfImpact.s_distanceInput.useRadii=!1;;){r.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,o),i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,o),Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyA=t,Box2D.Collision.b2TimeOfImpact.s_distanceInput.proxyB=n,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformA=Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_distanceInput.transformB=Box2D.Collision.b2TimeOfImpact.s_xfB,Box2D.Collision.b2Distance.Distance(Box2D.Collision.b2TimeOfImpact.s_distanceOutput,Box2D.Collision.b2TimeOfImpact.s_cache,Box2D.Collision.b2TimeOfImpact.s_distanceInput);if(0>=Box2D.Collision.b2TimeOfImpact.s_distanceOutput.distance){o=1;break}Box2D.Collision.b2TimeOfImpact.s_fcn.Initialize(Box2D.Collision.b2TimeOfImpact.s_cache,t,Box2D.Collision.b2TimeOfImpact.s_xfA,n,Box2D.Collision.b2TimeOfImpact.s_xfB);var f=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(0>=f){o=1;break}0==u&&(a=f>s?Math.max(s-e,.75*s):Math.max(f-e,.02*s));if(f-a<.5*e){if(0==u){o=1;break}break}var l=o,c=o,h=1;r.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,h),i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,h);var p=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(p>=a){o=1;break}for(var d=0;;){var v=0,v=d&1?c+(a-f)*(h-c)/(p-f):.5*(c+h);r.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfA,v),i.GetTransform(Box2D.Collision.b2TimeOfImpact.s_xfB,v);var m=Box2D.Collision.b2TimeOfImpact.s_fcn.Evaluate(Box2D.Collision.b2TimeOfImpact.s_xfA,Box2D.Collision.b2TimeOfImpact.s_xfB);if(Math.abs(m-a)<.025*e){l=v;break}m>a?(c=v,f=m):(h=v,p=m),d++,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters++;if(50==d)break}Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters,d);if(l<(1+100*Number.MIN_VALUE)*o)break;o=l,u++,Box2D.Collision.b2TimeOfImpact.b2_toiIters++;if(1e3==u)break}return Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=Math.max(Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters,u),o},Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new Box2D.Collision.b2SimplexCache,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new Box2D.Collision.b2DistanceInput,Box2D.Collision.b2TimeOfImpact.s_xfA=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_xfB=new Box2D.Common.Math.b2Transform,Box2D.Collision.b2TimeOfImpact.s_fcn=new Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new Box2D.Collision.b2DistanceOutput,Box2D.Dynamics.b2BodyDef=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearVelocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=this.angle=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,this.active=!0,this.inertiaScale=1},Box2D.Dynamics.b2BodyDef.b2_staticBody=0,Box2D.Dynamics.b2BodyDef.b2_kinematicBody=1,Box2D.Dynamics.b2BodyDef.b2_dynamicBody=2,Box2D.Dynamics.Contacts={},Box2D.Dynamics.Contacts.b2Contact=function(e,t){this.ID="Contact"+Box2D.Dynamics.Contacts.b2Contact.NEXT_ID++,this.m_manifold=new Box2D.Collision.b2Manifold,this.m_oldManifold=new Box2D.Collision.b2Manifold,this.touching=!1;var n=e.GetBody(),r=t.GetBody();this.continuous=n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()||r.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||r.IsBullet(),this.sensor=e.IsSensor()||t.IsSensor(),this.filtering=!1,this.m_fixtureA=e,this.m_fixtureB=t,this.enabled=!0,this.bodyAList=n.GetContactList(),this.bodyBList=r.GetContactList(),this.worldList=r.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.Reset=function(e,t){this.m_manifold.Reset(),this.m_oldManifold.Reset(),this.touching=!1;var n=e.GetBody(),r=t.GetBody();this.continuous=n.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||n.IsBullet()||r.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||r.IsBullet(),this.sensor=e.IsSensor()||t.IsSensor(),this.filtering=!1,this.m_fixtureA=e,this.m_fixtureB=t,this.enabled=!0,this.bodyAList=n.GetContactList(),this.bodyBList=r.GetContactList(),this.worldList=r.GetWorld().GetContactList(),this.AddToLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.AddToLists=function(){this.bodyAList.AddContact(this),this.bodyBList.AddContact(this),this.worldList.AddContact(this),this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.UpdateLists=function(){var e=!1,t=!1;!this.IsSensor()&&this.IsEnabled()&&(this.IsTouching()&&(e=!0),this.IsContinuous()&&(t=!0)),this.bodyAList.UpdateContact(this,e,t),this.bodyBList.UpdateContact(this,e,t),this.worldList.UpdateContact(this,e,t)},Box2D.Dynamics.Contacts.b2Contact.prototype.RemoveFromLists=function(){this.bodyAList.RemoveContact(this),this.bodyBList.RemoveContact(this),this.worldList.RemoveContact(this)},Box2D.Dynamics.Contacts.b2Contact.prototype.GetManifold=function(){return this.m_manifold},Box2D.Dynamics.Contacts.b2Contact.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},Box2D.Dynamics.Contacts.b2Contact.prototype.IsTouching=function(){return this.touching},Box2D.Dynamics.Contacts.b2Contact.prototype.IsContinuous=function(){return this.continuous},Box2D.Dynamics.Contacts.b2Contact.prototype.SetSensor=function(e){this.sensor=e,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsSensor=function(){return this.sensor},Box2D.Dynamics.Contacts.b2Contact.prototype.SetEnabled=function(e){this.enabled=e,this.UpdateLists()},Box2D.Dynamics.Contacts.b2Contact.prototype.IsEnabled=function(){return this.enabled},Box2D.Dynamics.Contacts.b2Contact.prototype.GetNext=function(){return this.m_next},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},Box2D.Dynamics.Contacts.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},Box2D.Dynamics.Contacts.b2Contact.prototype.GetOther=function(e){var t=this.m_fixtureA.GetBody();return t!=e?t:this.m_fixtureB.GetBody()},Box2D.Dynamics.Contacts.b2Contact.prototype.FlagForFiltering=function(){this.filtering=!0},Box2D.Dynamics.Contacts.b2Contact.prototype.ClearFiltering=function(){this.filtering=!1},Box2D.Dynamics.Contacts.b2Contact.prototype.IsFiltering=function(){return this.filtering},Box2D.Dynamics.Contacts.b2Contact.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.enabled=!0;var t=!1,n=this.IsTouching(),r=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.sensor)s&&(t=Box2D.Collision.Shapes.b2Shape.TestOverlap(this.m_fixtureA.GetShape(),r.GetTransform(),this.m_fixtureB.GetShape(),i.GetTransform())),this.m_manifold.m_pointCount=0;else{this.continuous=r.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||r.IsBullet()||i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody||i.IsBullet()?!0:!1;if(s){this.Evaluate(),t=0<this.m_manifold.m_pointCount;for(s=0;s<this.m_manifold.m_pointCount;s++){var o=this.m_manifold.m_points[s];o.m_normalImpulse=0;for(var u=o.m_tangentImpulse=0;u<this.m_oldManifold.m_pointCount;u++){var a=this.m_oldManifold.m_points[u];if(a.m_id.GetKey()==o.m_id.GetKey()){o.m_normalImpulse=a.m_normalImpulse,o.m_tangentImpulse=a.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;t!=n&&(r.SetAwake(!0),i.SetAwake(!0))}this.touching=t,t!=n&&this.UpdateLists(),!n&&t&&e.BeginContact(this),n&&!t&&e.EndContact(this),this.sensor||e.PreSolve(this,this.m_oldManifold)},Box2D.Dynamics.Contacts.b2Contact.prototype.Evaluate=function(){},Box2D.Dynamics.Contacts.b2Contact.prototype.ComputeTOI=function(e,t){return Box2D.Dynamics.Contacts.b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),Box2D.Dynamics.Contacts.b2Contact.s_input.sweepA=e,Box2D.Dynamics.Contacts.b2Contact.s_input.sweepB=t,Box2D.Dynamics.Contacts.b2Contact.s_input.tolerance=Box2D.Common.b2Settings.b2_linearSlop,Box2D.Collision.b2TimeOfImpact.TimeOfImpact(Box2D.Dynamics.Contacts.b2Contact.s_input)},Box2D.Dynamics.Contacts.b2Contact.s_input=new Box2D.Collision.b2TOIInput,Box2D.Dynamics.Contacts.b2Contact.NEXT_ID=0,Box2D.Collision.Shapes.b2MassData=function(){this.mass=0,this.center=Box2D.Common.Math.b2Vec2.Get(0,0),this.I=0},Box2D.Collision.Shapes.b2MassData._freeCache=[],Box2D.Collision.Shapes.b2MassData.Get=function(){if(0<Box2D.Collision.Shapes.b2MassData._freeCache.length){var e=Box2D.Collision.Shapes.b2MassData._freeCache.pop();return e.mass=0,e.center.SetZero(),e.I=0,e}return new Box2D.Collision.Shapes.b2MassData},Box2D.Collision.Shapes.b2MassData.Free=function(e){null!=e&&Box2D.Collision.Shapes.b2MassData._freeCache.push(e)},Box2D.Collision.Shapes.b2MassData.prototype.SetV=function(e,t,n){this.mass=e,this.center.SetV(t),this.I=n},Box2D.Collision.Shapes.b2MassData.prototype.Set=function(e,t,n,r){this.mass=e,this.center.Set(t,n),this.I=r},Box2D.Collision.Shapes.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.call(this),this.m_centroid=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_vertices=[],this.m_normals=[]},goog.inherits(Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2PolygonShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2PolygonShape.NAME},Box2D.Collision.Shapes.b2PolygonShape.prototype.Copy=function(){var e=new Box2D.Collision.Shapes.b2PolygonShape;return e.Set(this),e},Box2D.Collision.Shapes.b2PolygonShape.prototype.Set=function(e){Box2D.Collision.Shapes.b2Shape.prototype.Set.call(this,e);if(e instanceof Box2D.Collision.Shapes.b2PolygonShape){this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsArray=function(e){this.SetAsVector(e)},Box2D.Collision.Shapes.b2PolygonShape.AsArray=function(e){var t=new Box2D.Collision.Shapes.b2PolygonShape;return t.SetAsArray(e),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsVector=function(e){var t=e.length;Box2D.Common.b2Settings.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);for(t=t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e[t]);for(t=0;t<this.m_vertexCount;++t){e=Box2D.Common.Math.b2Math.SubtractVV(this.m_vertices[t+1<this.m_vertexCount?t+1:0],this.m_vertices[t]),Box2D.Common.b2Settings.b2Assert(e.LengthSquared()>Number.MIN_VALUE);var n=Box2D.Common.Math.b2Math.CrossVF(e,1);Box2D.Common.Math.b2Vec2.Free(e),this.m_normals[t].SetV(n),Box2D.Common.Math.b2Vec2.Free(n),this.m_normals[t].Normalize()}this.m_centroid=Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},Box2D.Collision.Shapes.b2PolygonShape.AsVector=function(e){var t=new Box2D.Collision.Shapes.b2PolygonShape;return t.SetAsVector(e),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsBox=function(e,t){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},Box2D.Collision.Shapes.b2PolygonShape.AsBox=function(e,t){var n=new Box2D.Collision.Shapes.b2PolygonShape;return n.SetAsBox(e,t),n},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsOrientedBox=function(e,t,n,r){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new Box2D.Common.Math.b2Mat22,e.Set(r),n=new Box2D.Common.Math.b2Transform(n,e);for(r=0;r<this.m_vertexCount;++r)this.m_vertices[r]=Box2D.Common.Math.b2Math.MulX(n,this.m_vertices[r]),this.m_normals[r]=Box2D.Common.Math.b2Math.MulMV(n.R,this.m_normals[r])},Box2D.Collision.Shapes.b2PolygonShape.AsOrientedBox=function(e,t,n,r){var i=new Box2D.Collision.Shapes.b2PolygonShape;return i.SetAsOrientedBox(e,t,n,r),i},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y);var n=Box2D.Common.Math.b2Math.SubtractVV(t,e),r=Box2D.Common.Math.b2Math.CrossVF(n,1);Box2D.Common.Math.b2Vec2.Free(n),this.m_normals[0]=r,Box2D.Common.Math.b2Vec2.Free(r),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},Box2D.Collision.Shapes.b2PolygonShape.AsEdge=function(e,t){var n=new Box2D.Collision.Shapes.b2PolygonShape;return n.SetAsEdge(e,t),n},Box2D.Collision.Shapes.b2PolygonShape.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u)if(n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u],0<n.x*r+n.y*i)return!1;return!0},Box2D.Collision.Shapes.b2PolygonShape.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a,s=t.p1.x-n.position.x,o=t.p1.y-n.position.y;u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y,s=t.p2.x-n.position.x,o=t.p2.y-n.position.y;u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=-1,h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(0==o){if(0>s)return!1}else 0>o&&s<r*o?(r=s/o,c=h):0<o&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return 0<=c?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a)var r=this.m_vertices[a],f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r;e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeMass=function(e,t){if(2==this.m_vertexCount)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u)var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[u+1]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d,i=i+v,n=n+v*o*(0+a.x+f.x),r=r+v*o*(0+a.y+f.y),a=l,s=s+d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0));e.Set(t*i,n*(1/i),r*(1/i),t*s)}},Box2D.Collision.Shapes.b2PolygonShape.prototype.ComputeSubmergedArea=function(e,t,n,r){for(var i=Box2D.Common.Math.b2Math.MulTMV(n.R,e),s=t-Box2D.Common.Math.b2Math.Dot(e,n.position),o=[],u=0,a=-1,t=-1,f=!1,e=e=0;e<this.m_vertexCount;++e){o[e]=Box2D.Common.Math.b2Math.Dot(i,this.m_vertices[e])-s;var l=o[e]<-Number.MIN_VALUE;0<e&&(l?f||(a=e-1,u++):f&&(t=e-1,u++)),f=l}Box2D.Common.Math.b2Vec2.Free(i);switch(u){case 0:return f?(e=Box2D.Collision.Shapes.b2MassData.Get(),this.ComputeMass(e,1),n=Box2D.Common.Math.b2Math.MulX(n,e.center),r.SetV(n),Box2D.Common.Math.b2Vec2.Free(n),r=e.mass,Box2D.Collision.Shapes.b2MassData.Free(e),r):0;case 1:-1==a?a=this.m_vertexCount-1:t=this.m_vertexCount-1}e=(a+1)%this.m_vertexCount,i=(t+1)%this.m_vertexCount,s=(0-o[a])/(o[e]-o[a]),o=(0-o[t])/(o[i]-o[t]),a=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[a].x*(1-s)+this.m_vertices[e].x*s,this.m_vertices[a].y*(1-s)+this.m_vertices[e].y*s),s=Box2D.Common.Math.b2Vec2.Get(this.m_vertices[t].x*(1-o)+this.m_vertices[i].x*o,this.m_vertices[t].y*(1-o)+this.m_vertices[i].y*o),t=0,o=Box2D.Common.Math.b2Vec2.Get(0,0);for(u=this.m_vertices[e];e!=i;)e=(e+1)%this.m_vertexCount,f=e==i?s:this.m_vertices[e],l=.5*((u.x-a.x)*(f.y-a.y)-(u.y-a.y)*(f.x-a.x)),t+=l,o.x+=l*(a.x+u.x+f.x)/3,o.y+=l*(a.y+u.y+f.y)/3,u=f;return Box2D.Common.Math.b2Vec2.Free(a),Box2D.Common.Math.b2Vec2.Free(s),o.Multiply(1/t),n=Box2D.Common.Math.b2Math.MulX(n,o),Box2D.Common.Math.b2Vec2.Free(o),r.SetV(n),Box2D.Common.Math.b2Vec2.Free(n),t},Box2D.Collision.Shapes.b2PolygonShape.prototype.SetDistanceProxy=function(e){e.SetValues(this.m_vertexCount,this.m_radius,this.m_vertices)},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},Box2D.Collision.Shapes.b2PolygonShape.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},Box2D.Collision.Shapes.b2PolygonShape.prototype.Reserve=function(e){for(var t=0;t<this.m_vertices.length;t++)Box2D.Common.Math.b2Vec2.Free(this.m_vertices[t]),Box2D.Common.Math.b2Vec2.Free(this.m_normals[t]);this.m_vertices=[],this.m_normals=[];for(t=0;t<e;t++)this.m_vertices[t]=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_normals[t]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.Shapes.b2PolygonShape.ComputeCentroid=function(e,t){for(var n=Box2D.Common.Math.b2Vec2.Get(0,0),r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[s+1]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0)),r=r+a;n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},Box2D.Collision.Shapes.b2PolygonShape.s_mat=new Box2D.Common.Math.b2Mat22,Box2D.Collision.Shapes.b2PolygonShape.NAME="b2PolygonShape",Box2D.Collision.Shapes.b2EdgeShape=function(e,t){Box2D.Collision.Shapes.b2Shape.call(this),this.m_nextEdge=this.m_prevEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction=Box2D.Common.Math.b2Vec2.Get(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal=Box2D.Common.Math.b2Vec2.Get(this.m_direction.y,-this.m_direction.x),this.m_coreV1=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2=Box2D.Common.Math.b2Vec2.Get(-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-Box2D.Common.b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2=Box2D.Common.Math.b2Vec2.Get(-this.m_normal.x,-this.m_normal.y),this.m_cornerConvex2=this.m_cornerConvex1=!1},goog.inherits(Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2Shape),Box2D.Collision.Shapes.b2EdgeShape.prototype.GetTypeName=function(){return Box2D.Collision.Shapes.b2EdgeShape.NAME},Box2D.Collision.Shapes.b2EdgeShape.prototype.TestPoint=function(){return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.RayCast=function(e,t,n){var r=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,s=n.R,o=n.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),u=n.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),a=n.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-u,n=-(n.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-o),s=100*Number.MIN_VALUE,f=-(r*a+i*n);if(f>s){var o=t.p1.x-o,l=t.p1.y-u,u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f&&(t=-r*l+i*o,-s*f<=t&&t<=f*(1+s)))return e.fraction=u/f,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}return!1},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y),n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y);r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},Box2D.Collision.Shapes.b2EdgeShape.prototype.ComputeSubmergedArea=function(e,t,n,r){void 0===t&&(t=0);var i=Box2D.Common.Math.b2Vec2.Get(e.x*t,e.y*t),s=Box2D.Common.Math.b2Math.MulX(n,this.m_v1),n=Box2D.Common.Math.b2Math.MulX(n,this.m_v2),o=Box2D.Common.Math.b2Math.Dot(e,s)-t,e=Box2D.Common.Math.b2Math.Dot(e,n)-t;if(0<o){if(0<e)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else 0<e&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetLength=function(){return this.m_length},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},Box2D.Collision.Shapes.b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetFirstVertex=function(e){var t=e.R;return Box2D.Common.Math.b2Vec2.Get(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},Box2D.Collision.Shapes.b2EdgeShape.prototype.Support=function(e,t,n){var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y),e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);return i*t+s*n>o*t+e*n?Box2D.Common.Math.b2Vec2.Get(i,s):Box2D.Common.Math.b2Vec2.Get(o,e)},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},Box2D.Collision.Shapes.b2EdgeShape.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},Box2D.Collision.Shapes.b2EdgeShape.NAME="b2EdgeShape",Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=function(e,t){Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.call(this,e,t)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Reset=function(e,t){Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2EdgeShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,e,t)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.Evaluate=function(){this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},Box2D.Dynamics.b2TimeStep=function(e,t,n,r,i){this.Reset(e,t,n,r,i)},Box2D.Dynamics.b2TimeStep.prototype.Reset=function(e,t,n,r,i){this.dt=e;var s=0;0<e&&(s=1/e),this.inv_dt=s,this.dtRatio=t,this.positionIterations=n,this.velocityIterations=r,this.warmStarting=i},Box2D.Dynamics.Joints.b2FrictionJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_linearMass=new Box2D.Common.Math.b2Mat22,this.m_linearImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),new Box2D.Common.Math.b2Vec2.Get(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),e*this.m_angularImpulse},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxForce=function(e){void 0===e&&(e=0),this.m_maxForce=e},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SetMaxTorque=function(e){void 0===e&&(e=0),this.m_maxTorque=e},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y,n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n;t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y,n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n;t=r.m_invMass;var n=i.m_invMass,f=r.m_invI,l=i.m_invI,c=new b2Mat22;c.col1.x=t+n,c.col2.x=0,c.col1.y=0,c.col2.y=t+n,c.col1.x+=f*o*o,c.col2.x+=-f*s*o,c.col1.y+=-f*s*o,c.col2.y+=f*s*s,c.col1.x+=l*a*a,c.col2.x+=-l*u*a,c.col1.y+=-l*u*a,c.col2.y+=l*u*u,c.GetInverse(this.m_linearMass),this.m_angularMass=f+l,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,r.m_linearVelocity.x-=t*e.x,r.m_linearVelocity.y-=t*e.y,r.m_angularVelocity-=f*(s*e.y-o*e.x+this.m_angularImpulse),i.m_linearVelocity.x+=n*e.x,i.m_linearVelocity.y+=n*e.y,i.m_angularVelocity+=l*(u*e.y-a*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,o=r.m_angularVelocity,u=i.m_linearVelocity,a=i.m_angularVelocity,f=r.m_invMass,l=i.m_invMass,c=r.m_invI,h=i.m_invI;t=r.m_xf.R;var p=this.m_localAnchorA.x-r.m_sweep.localCenter.x,d=this.m_localAnchorA.y-r.m_sweep.localCenter.y,n=t.col1.x*p+t.col2.x*d,d=t.col1.y*p+t.col2.y*d,p=n;t=i.m_xf.R;var v=this.m_localAnchorB.x-i.m_sweep.localCenter.x,m=this.m_localAnchorB.y-i.m_sweep.localCenter.y,n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n;t=0;var n=-this.m_angularMass*(a-o),g=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-g,o-=c*n,a+=h*n,t=Box2D.Common.Math.b2Vec2.Get(-(u.x-a*m-s.x+o*d),-(u.y+a*v-s.y-o*p)),t.MulM(this.m_linearMass),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),Box2D.Common.Math.b2Vec2.Free(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=Box2D.Common.Math.b2Math.SubtractVV(this.m_linearImpulse,n),Box2D.Common.Math.b2Vec2.Free(n),s.x-=f*t.x,s.y-=f*t.y,o-=c*(p*t.y-d*t.x),u.x+=l*t.x,u.y+=l*t.y,a+=h*(v*t.y-m*t.x),Box2D.Common.Math.b2Vec2.Free(t),r.m_angularVelocity=o,i.m_angularVelocity=a},Box2D.Dynamics.Joints.b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2DestructionListener=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeJoint=function(){},Box2D.Dynamics.b2DestructionListener.prototype.SayGoodbyeFixture=function(){},Box2D.Dynamics.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},Box2D.Dynamics.b2FilterData.prototype.Copy=function(){var e=new Box2D.Dynamics.b2FilterData;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},Box2D.Dynamics.b2Fixture=function(e,t,n){this.ID="Fixture"+Box2D.Dynamics.b2Fixture.NEXT_ID++,this.m_filter=n.filter.Copy(),this.m_aabb=Box2D.Collision.b2AABB.Get(),this.m_aabb_temp=Box2D.Collision.b2AABB.Get(),this.m_body=e,this.m_shape=n.shape.Copy(),this.m_density=n.density,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_isSensor=n.isSensor},Box2D.Dynamics.b2Fixture.prototype.GetShape=function(){return this.m_shape},Box2D.Dynamics.b2Fixture.prototype.SetSensor=function(e){if(this.m_isSensor!=e&&(this.m_isSensor=e,null!=this.m_body))for(e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode()){var t=e.contact.GetFixtureA(),n=e.contact.GetFixtureB();(t==this||n==this)&&e.contact.SetSensor(t.IsSensor()||n.IsSensor())}},Box2D.Dynamics.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},Box2D.Dynamics.b2Fixture.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(null!=this.m_body)for(e=this.m_body.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())(e.contact.GetFixtureA()==this||e.contact.GetFixtureB()==this)&&e.contact.FlagForFiltering()},Box2D.Dynamics.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},Box2D.Dynamics.b2Fixture.prototype.GetBody=function(){return this.m_body},Box2D.Dynamics.b2Fixture.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},Box2D.Dynamics.b2Fixture.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},Box2D.Dynamics.b2Fixture.prototype.GetMassData=function(e){return e||(e=Box2D.Collision.Shapes.b2MassData.Get()),this.m_shape.ComputeMass(e,this.m_density),e},Box2D.Dynamics.b2Fixture.prototype.SetDensity=function(e){this.m_density=e},Box2D.Dynamics.b2Fixture.prototype.GetDensity=function(){return this.m_density},Box2D.Dynamics.b2Fixture.prototype.GetFriction=function(){return this.m_friction},Box2D.Dynamics.b2Fixture.prototype.SetFriction=function(e){this.m_friction=e},Box2D.Dynamics.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},Box2D.Dynamics.b2Fixture.prototype.SetRestitution=function(e){this.m_restitution=e},Box2D.Dynamics.b2Fixture.prototype.GetAABB=function(){return this.m_aabb},Box2D.Dynamics.b2Fixture.prototype.Destroy=function(){Box2D.Collision.b2AABB.Free(this.m_aabb)},Box2D.Dynamics.b2Fixture.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},Box2D.Dynamics.b2Fixture.prototype.DestroyProxy=function(e){null!=this.m_proxy&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},Box2D.Dynamics.b2Fixture.prototype.Synchronize=function(e,t,n){this.m_proxy&&(this.m_shape.ComputeAABB(this.m_aabb,t),this.m_shape.ComputeAABB(this.m_aabb_temp,n),this.m_aabb.Combine(this.m_aabb,this.m_aabb_temp),t=Box2D.Common.Math.b2Math.SubtractVV(n.position,t.position),e.MoveProxy(this.m_proxy,this.m_aabb,t),Box2D.Common.Math.b2Vec2.Free(t))},Box2D.Dynamics.b2Fixture.NEXT_ID=0,Box2D.Dynamics.iContactListener=function(){},Box2D.Dynamics.iContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.iContactListener.prototype.EndContact=function(){},Box2D.Dynamics.iContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.iContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.Contacts.b2CircleContact=function(e,t){Box2D.Dynamics.Contacts.b2Contact.call(this,e,t)},goog.inherits(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2CircleContact.prototype.Reset=function(e,t){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,e,t)},Box2D.Dynamics.Contacts.b2CircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetShape(),t=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollideCircles(this.m_manifold,e,this.m_fixtureA.GetBody().m_xf,t,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=function(e,t){Box2D.Dynamics.Contacts.b2Contact.call(this,e,t)},goog.inherits(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Reset=function(e,t){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,e,t)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.Evaluate=function(){this.m_fixtureA.GetBody(),this.m_fixtureB.GetBody(),this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),this.m_fixtureA.GetBody().m_xf,this.m_fixtureB.GetShape(),this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},Box2D.Dynamics.Joints.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},goog.inherits(Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.Dynamics.Joints.b2FrictionJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2FrictionJoint(this)},Box2D.Dynamics.Joints.b2RevoluteJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.K3=new Box2D.Common.Math.b2Mat22,this.impulse3=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.impulse2=Box2D.Common.Math.b2Vec2.Get(0,0),this.reduced=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec3.Get(0,0,0),this.m_mass=new Box2D.Common.Math.b2Mat33,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_motorMass=0},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse.x,e*this.m_impulse.y)},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetReactionTorque=function(e){return void 0===e&&(e=0),e*this.m_impulse.z},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableLimit=function(e){this.m_enableLimit=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetLimits=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.EnableMotor=function(e){this.m_enableMotor=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMotorSpeed=function(e){void 0===e&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(e){void 0===e&&(e=0),this.m_maxMotorTorque=e},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i=0;r=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i;var f=t.m_invMass,l=n.m_invMass,c=t.m_invI,h=n.m_invI;this.m_mass.col1.x=f+l+o*o*c+a*a*h,this.m_mass.col2.x=-o*s*c-a*u*h,this.m_mass.col3.x=-o*c-a*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=f+l+s*s*c+u*u*h,this.m_mass.col3.y=s*c+u*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,c+h==0?this.m_motorMass=0:this.m_motorMass=.01,this.m_enableMotor||(this.m_motorImpulse=0);if(this.m_enableLimit){var p=n.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;Math.abs(this.m_upperAngle-this.m_lowerAngle)<2*Box2D.Common.b2Settings.b2_angularSlop?this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit):(this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var d=this.m_impulse.x,v=this.m_impulse.y;t.m_linearVelocity.x-=f*d,t.m_linearVelocity.y-=f*v,t.m_angularVelocity-=c*(s*v-o*d+this.m_motorImpulse+this.m_impulse.z),n.m_linearVelocity.x+=l*d,n.m_linearVelocity.y+=l*v,n.m_angularVelocity+=h*(u*v-a*d+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=0,i=r=0,s=0,o=0,u=0,a=t.m_linearVelocity,f=t.m_angularVelocity,l=n.m_linearVelocity,c=n.m_angularVelocity,h=t.m_invMass,p=n.m_invMass,d=t.m_invI,v=n.m_invI;this.m_enableMotor&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_equalLimits&&(i=this.m_motorMass*-(c-f-this.m_motorSpeed),s=this.m_motorImpulse,o=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=Box2D.Common.Math.b2Math.Clamp(this.m_motorImpulse+i,-o,o),i=this.m_motorImpulse-s,f-=d*i,c+=v*i);if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var e=t.m_xf.R,i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=e.col1.x*i+e.col2.x*s,s=e.col1.y*i+e.col2.y*s,i=r,e=n.m_xf.R,o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,r=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=r,e=l.x+ -c*u-a.x- -f*s,m=l.y+c*o-a.y-f*i;this.m_mass.Solve33(this.impulse3,-e,-m,-(c-f)),this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,0>r&&(this.m_mass.Solve22(this.reduced,-e,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,0<r&&(this.m_mass.Solve22(this.reduced,-e,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),a.x-=h*this.impulse3.x,a.y-=h*this.impulse3.y,f-=d*(i*this.impulse3.y-s*this.impulse3.x+this.impulse3.z),l.x+=p*this.impulse3.x,l.y+=p*this.impulse3.y,c+=v*(o*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else e=t.m_xf.R,i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=e.col1.x*i+e.col2.x*s,s=e.col1.y*i+e.col2.y*s,i=r,e=n.m_xf.R,o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,r=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=r,this.m_mass.Solve22(this.impulse2,-(l.x+ -c*u-a.x- -f*s),-(l.y+c*o-a.y-f*i)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,a.x-=h*this.impulse2.x,a.y-=h*this.impulse2.y,f-=d*(i*this.impulse2.y-s*this.impulse2.x),l.x+=p*this.impulse2.x,l.y+=p*this.impulse2.y,c+=v*(o*this.impulse2.y-u*this.impulse2.x);t.m_linearVelocity.SetV(a),t.m_angularVelocity=f,n.m_linearVelocity.SetV(l),n.m_angularVelocity=c},Box2D.Dynamics.Joints.b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var e=0,t,n=this.m_bodyA,r=this.m_bodyB,i=0,s=t=0,o=0,u=0;if(this.m_enableLimit&&this.m_limitState!=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit){var e=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,a=0;this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_equalLimits?(e=Box2D.Common.Math.b2Math.Clamp(e-this.m_lowerAngle,-Box2D.Common.b2Settings.b2_maxAngularCorrection,Box2D.Common.b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e,i=Math.abs(e)):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit?(e-=this.m_lowerAngle,i=-e,e=Box2D.Common.Math.b2Math.Clamp(e+Box2D.Common.b2Settings.b2_angularSlop,-Box2D.Common.b2Settings.b2_maxAngularCorrection,0),a=-this.m_motorMass*e):this.m_limitState==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(i=e-=this.m_upperAngle,e=Box2D.Common.Math.b2Math.Clamp(e-Box2D.Common.b2Settings.b2_angularSlop,0,Box2D.Common.b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e),n.m_sweep.a-=n.m_invI*a,r.m_sweep.a+=r.m_invI*a,n.SynchronizeTransform(),r.SynchronizeTransform()}t=n.m_xf.R,a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,e=this.m_localAnchor1.y-n.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*e,e=t.col1.y*a+t.col2.y*e,a=s,t=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y,s=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=s,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e,c=o*o+u*u;t=Math.sqrt(c);var s=n.m_invMass,h=r.m_invMass,p=n.m_invI,d=r.m_invI,v=10*Box2D.Common.b2Settings.b2_linearSlop;return c>v*v&&(c=1/(s+h),o=c*-o,u=c*-u,n.m_sweep.c.x-=.5*s*o,n.m_sweep.c.y-=.5*s*u,r.m_sweep.c.x+=.5*h*o,r.m_sweep.c.y+=.5*h*u,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e),this.K1.col1.x=s+h,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=s+h,this.K2.col1.x=p*e*e,this.K2.col2.x=-p*a*e,this.K2.col1.y=-p*a*e,this.K2.col2.y=p*a*a,this.K3.col1.x=d*l*l,this.K3.col2.x=-d*f*l,this.K3.col1.y=-d*f*l,this.K3.col2.y=d*f*f,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse,-o,-u),o=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.x,u=Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse.y,n.m_sweep.c.x-=n.m_invMass*o,n.m_sweep.c.y-=n.m_invMass*u,n.m_sweep.a-=n.m_invI*(a*u-e*o),r.m_sweep.c.x+=r.m_invMass*o,r.m_sweep.c.y+=r.m_invMass*u,r.m_sweep.a+=r.m_invI*(f*u-l*o),n.SynchronizeTransform(),r.SynchronizeTransform(),t<=Box2D.Common.b2Settings.b2_linearSlop&&i<=Box2D.Common.b2Settings.b2_angularSlop},Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=Box2D.Common.Math.b2Vec2.Get(0,0),Box2D.Dynamics.Joints.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint,this.localAnchorA.SetZero(),this.localAnchorB.SetZero(),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},goog.inherits(Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.Dynamics.Joints.b2RevoluteJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2RevoluteJoint(this)},Box2D.Dynamics.Contacts.b2PositionSolverManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_separations=[],this.m_points=[];for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype.Initialize=function(e){Box2D.Common.b2Settings.b2Assert(0<e.pointCount);switch(e.type){case Box2D.Collision.b2Manifold.e_circles:this._InitializeCircles(e);break;case Box2D.Collision.b2Manifold.e_faceA:this._InitializeFaceA(e);break;case Box2D.Collision.b2Manifold.e_faceB:this._InitializeFaceB(e)}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeCircles=function(e){var t=e.bodyA.m_xf.R,n=e.localPoint,r=e.bodyA.m_xf.position.x+(t.col1.x*n.x+t.col2.x*n.y),i=e.bodyA.m_xf.position.y+(t.col1.y*n.x+t.col2.y*n.y),t=e.bodyB.m_xf.R,n=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(t.col1.x*n.x+t.col2.x*n.y),t=e.bodyB.m_xf.position.y+(t.col1.y*n.x+t.col2.y*n.y),n=s-r,o=t-i,u=n*n+o*o;u>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(u=Math.sqrt(u),this.m_normal.x=n/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(r+s),this.m_points[0].y=.5*(i+t),this.m_separations[0]=n*this.m_normal.x+o*this.m_normal.y-e.radius},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceA=function(e){this.m_normal.x=e.bodyA.m_xf.R.col1.x*e.localPlaneNormal.x+e.bodyA.m_xf.R.col2.x*e.localPlaneNormal.y,this.m_normal.y=e.bodyA.m_xf.R.col1.y*e.localPlaneNormal.x+e.bodyA.m_xf.R.col2.y*e.localPlaneNormal.y;for(var t=e.bodyA.m_xf.position.x+(e.bodyA.m_xf.R.col1.x*e.localPoint.x+e.bodyA.m_xf.R.col2.x*e.localPoint.y),n=e.bodyA.m_xf.position.y+(e.bodyA.m_xf.R.col1.y*e.localPoint.x+e.bodyA.m_xf.R.col2.y*e.localPoint.y),r=0;r<e.pointCount;r++){var i=e.bodyB.m_xf.position.x+(e.bodyB.m_xf.R.col1.x*e.points[r].localPoint.x+e.bodyB.m_xf.R.col2.x*e.points[r].localPoint.y),s=e.bodyB.m_xf.position.y+(e.bodyB.m_xf.R.col1.y*e.points[r].localPoint.x+e.bodyB.m_xf.R.col2.y*e.points[r].localPoint.y);this.m_separations[r]=(i-t)*this.m_normal.x+(s-n)*this.m_normal.y-e.radius,this.m_points[r].x=i,this.m_points[r].y=s}},Box2D.Dynamics.Contacts.b2PositionSolverManifold.prototype._InitializeFaceB=function(e){this.m_normal.x=e.bodyB.m_xf.R.col1.x*e.localPlaneNormal.x+e.bodyB.m_xf.R.col2.x*e.localPlaneNormal.y,this.m_normal.y=e.bodyB.m_xf.R.col1.y*e.localPlaneNormal.x+e.bodyB.m_xf.R.col2.y*e.localPlaneNormal.y;for(var t=e.bodyB.m_xf.position.x+(e.bodyB.m_xf.R.col1.x*e.localPoint.x+e.bodyB.m_xf.R.col2.x*e.localPoint.y),n=e.bodyB.m_xf.position.y+(e.bodyB.m_xf.R.col1.y*e.localPoint.x+e.bodyB.m_xf.R.col2.y*e.localPoint.y),r=0;r<e.pointCount;r++){var i=e.bodyA.m_xf.position.x+(e.bodyA.m_xf.R.col1.x*e.points[r].localPoint.x+e.bodyA.m_xf.R.col2.x*e.points[r].localPoint.y),s=e.bodyA.m_xf.position.y+(e.bodyA.m_xf.R.col1.y*e.points[r].localPoint.x+e.bodyA.m_xf.R.col2.y*e.points[r].localPoint.y);this.m_separations[r]=(i-t)*this.m_normal.x+(s-n)*this.m_normal.y-e.radius,this.m_points[r].Set(i,s)}this.m_normal.x*=-1,this.m_normal.y*=-1},Box2D.Dynamics.Contacts.b2PolyAndCircleContact=function(e,t){Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.call(this,e,t)},goog.inherits(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Reset=function(e,t){Box2D.Common.b2Settings.b2Assert(e.GetShape()instanceof Box2D.Collision.Shapes.b2PolygonShape),Box2D.Common.b2Settings.b2Assert(t.GetShape()instanceof Box2D.Collision.Shapes.b2CircleShape),Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,e,t)},Box2D.Dynamics.Contacts.b2PolyAndCircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetShape(),t=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygonAndCircle(this.m_manifold,e,this.m_fixtureA.GetBody().m_xf,t,this.m_fixtureB.GetBody().m_xf)},Box2D.Dynamics.Contacts.b2ContactConstraintPoint=function(){this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.rA=Box2D.Common.Math.b2Vec2.Get(0,0),this.rB=Box2D.Common.Math.b2Vec2.Get(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraintPoint.prototype.Reset=function(){this.localPoint.Set(0,0),this.rA.Set(0,0),this.rB.Set(0,0),this.tangentImpulse=this.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactConstraint=function(){this.localPlaneNormal=Box2D.Common.Math.b2Vec2.Get(0,0),this.localPoint=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.normalMass=new Box2D.Common.Math.b2Mat22,this.K=new Box2D.Common.Math.b2Mat22,this.points=[];for(var e=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.points[e]=new Box2D.Dynamics.Contacts.b2ContactConstraintPoint},Box2D.Dynamics.b2FixtureList=function(){this.fixtureLastNode=this.fixtureFirstNode=null,this.fixtureNodeLookup={},this.fixtureCount=0},Box2D.Dynamics.b2FixtureList.prototype.GetFirstNode=function(){return this.fixtureFirstNode},Box2D.Dynamics.b2FixtureList.prototype.AddFixture=function(e){var t=e.ID;if(null==this.fixtureNodeLookup[t]){var e=new Box2D.Dynamics.b2FixtureListNode(e),n=this.fixtureLastNode;null!=n?n.SetNextNode(e):this.fixtureFirstNode=e,e.SetPreviousNode(n),this.fixtureLastNode=e,this.fixtureNodeLookup[t]=e,this.fixtureCount++}},Box2D.Dynamics.b2FixtureList.prototype.RemoveFixture=function(e){var e=e.ID,t=this.fixtureNodeLookup[e];if(null!=t){var n=t.GetPreviousNode(),t=t.GetNextNode();null==n?this.fixtureFirstNode=t:n.SetNextNode(t),null==t?this.fixtureLastNode=n:t.SetPreviousNode(n),delete this.fixtureNodeLookup[e],this.fixtureCount--}},Box2D.Dynamics.b2FixtureList.prototype.GetFixtureCount=function(){return this.fixtureCount},Box2D.Dynamics.Joints.b2Jacobian=function(){this.linearA=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearB=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.Joints.b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},Box2D.Dynamics.Joints.b2Jacobian.prototype.Set=function(e,t,n,r){void 0===t&&(t=0),void 0===r&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},Box2D.Dynamics.Joints.b2Jacobian.prototype.Compute=function(e,t,n,r){return void 0===t&&(t=0),void 0===r&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},Box2D.Dynamics.Joints.b2GearJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_J=new Box2D.Dynamics.Joints.b2Jacobian;var t=e.joint1.m_type,n=e.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute1=e.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint?(this.m_revolute2=e.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetReactionTorque=function(e){void 0===e&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r,r=t.col1.y*n+t.col2.y*r;return e*(this.m_impulse*this.m_J.angularB-i*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},Box2D.Dynamics.Joints.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2GearJoint.prototype.SetRatio=function(e){void 0===e&&(e=0),this.m_ratio=e},Box2D.Dynamics.Joints.b2GearJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f=u=0,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(t=t.m_xf.R,o=this.m_prismatic1.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-u,l+=r.m_invMass+r.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(t=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*u,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*u*u)),this.m_mass=0<l?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},Box2D.Dynamics.Joints.b2GearJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=0,r=0,n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),n=-this.m_mass*(this.m_constant-(n+this.m_ratio*r));return e.m_sweep.c.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*n*this.m_J.angularA,t.m_sweep.c.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_sweep.c.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_sweep.a+=t.m_invI*n*this.m_J.angularB,e.SynchronizeTransform(),t.SynchronizeTransform(),0<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.type=Box2D.Dynamics.Joints.b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},goog.inherits(Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2GearJointDef.prototype.Initialize=function(e,t,n){this.joint1=e,this.bodyA=e.GetBodyA(),this.joint2=t,this.bodyB=t.GetBodyA(),this.ratio=n},Box2D.Dynamics.Joints.b2GearJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2GearJoint(this)},Box2D.Dynamics.Joints.b2PulleyJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_groundAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_groundAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=Math.min(e.maxLengthA,this.m_constant-this.m_ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=Math.min(e.maxLengthB,(this.m_constant-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(t*t+e*e)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(t*t+e*e)},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,o=r.col1.x*i+r.col2.x*s,s=r.col1.y*i+r.col2.y*s,i=o;r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,o=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=o;r=n.m_sweep.c.x+u;var o=n.m_sweep.c.y+a,f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(t.m_sweep.c.x+i-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),t.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(r-f,o-l),r=this.m_u1.Length(),o=this.m_u2.Length(),r>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),o>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/o):this.m_u2.SetZero(),0<this.m_constant-r-this.m_ratio*o?(this.m_state=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,o<this.m_maxLength2?(this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit,r=i*this.m_u1.y-s*this.m_u1.x,o=u*this.m_u2.y-a*this.m_u2.x,this.m_limitMass1=t.m_invMass+t.m_invI*r*r,this.m_limitMass2=n.m_invMass+n.m_invI*o*o,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,o=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,f=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(i*r-s*e),n.m_linearVelocity.x+=n.m_invMass*o,n.m_linearVelocity.y+=n.m_invMass*f,n.m_angularVelocity+=n.m_invI*(u*f-a*o)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i,i=n.col1.y*r+n.col2.y*i,r=s;n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y,s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,a=s=n=0,f=0;n=f=n=f=a=s=n=0,this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u1.x*n+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*a+this.m_u2.y*f),f=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=Math.max(0,this.m_impulse+f),f=this.m_impulse-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,a=-this.m_ratio*f*this.m_u2.x,f=-this.m_ratio*f*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n),t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a)),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,n=-(this.m_u1.x*n+this.m_u1.y*s),f=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=Math.max(0,this.m_limitImpulse1+f),f=this.m_limitImpulse1-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n)),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u2.x*a+this.m_u2.y*f),f=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=Math.max(0,this.m_limitImpulse2+f),f=this.m_limitImpulse2-n,a=-f*this.m_u2.x,f=-f*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a))},Box2D.Dynamics.Joints.b2PulleyJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,u=0,a=0,f=0,l=0,c=n=0,h=0,p=0,d=c=p=n=c=n=0;return this.m_state==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u1.Set(n-r,c-i),this.m_u2.Set(h-s,p-o),n=this.m_u1.Length(),c=this.m_u2.Length(),n>Box2D.Common.b2Settings.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero(),c>Box2D.Common.b2Settings.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),n=this.m_constant-n-this.m_ratio*c,d=Math.max(d,-n),n=Box2D.Common.Math.b2Math.Clamp(n+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_pulleyMass*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,h=-this.m_ratio*p*this.m_u2.x,p=-this.m_ratio*p*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),e.SynchronizeTransform(),t.SynchronizeTransform()),this.m_limitState1==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,this.m_u1.Set(n-r,c-i),n=this.m_u1.Length(),n>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u1.x*=1/n,this.m_u1.y*=1/n):this.m_u1.SetZero(),n=this.m_maxLength1-n,d=Math.max(d,-n),n=Box2D.Common.Math.b2Math.Clamp(n+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass1*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),e.SynchronizeTransform()),this.m_limitState2==Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit&&(n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u2.Set(h-s,p-o),c=this.m_u2.Length(),c>Box2D.Common.b2Settings.b2_linearSlop?(this.m_u2.x*=1/c,this.m_u2.y*=1/c):this.m_u2.SetZero(),n=this.m_maxLength2-c,d=Math.max(d,-n),n=Box2D.Common.Math.b2Math.Clamp(n+Box2D.Common.b2Settings.b2_linearSlop,-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass2*n,h=-p*this.m_u2.x,p=-p*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),t.SynchronizeTransform()),d<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=1,Box2D.Dynamics.b2ContactImpulse=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.b2ContactImpulse.prototype.Reset=function(){this.normalImpulses=[],this.tangentImpulses=[]},Box2D.Dynamics.Contacts.b2ContactListNode=function(e){this.contact=e,this.previous=this.next=null},Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes=[],Box2D.Dynamics.Contacts.b2ContactListNode.GetNode=function(e){if(0<Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.length){var t=Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.pop();return t.next=null,t.previous=null,t.contact=e,t}return new Box2D.Dynamics.Contacts.b2ContactListNode(e)},Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode=function(e){Box2D.Dynamics.Contacts.b2ContactListNode.freeNodes.push(e)},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetNextNode=function(e){this.next=e},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.SetPreviousNode=function(e){this.previous=e},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetContact=function(){return this.contact},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Contacts.b2ContactListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Contacts.b2ContactList=function(){this.contactFirstNodes=[];for(var e=0;e<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;e++)this.contactFirstNodes[e]=null;this.contactLastNodes=[];for(e=0;e<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;e++)this.contactLastNodes[e]=null;this.contactNodeLookup={},this.contactCount=0},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetFirstNode=function(e){return this.contactFirstNodes[e]},Box2D.Dynamics.Contacts.b2ContactList.prototype.AddContact=function(e){var t=e.ID;if(null==this.contactNodeLookup[t]){this.contactNodeLookup[t]=[];for(var n=0;n<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;n++)this.contactNodeLookup[t][n]=null;this.CreateNode(e,t,Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts),this.contactCount++}},Box2D.Dynamics.Contacts.b2ContactList.prototype.UpdateContact=function(e,t,n){t?this.CreateNode(e,e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts):this.RemoveNode(e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts),n?this.CreateNode(e,e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts):this.RemoveNode(e.ID,Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts)},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveContact=function(e){e=e.ID;if(null!=this.contactNodeLookup[e]){for(var t=0;t<=Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts;t++)this.RemoveNode(e,t);delete this.contactNodeLookup[e],this.contactCount--}},Box2D.Dynamics.Contacts.b2ContactList.prototype.RemoveNode=function(e,t){var n=this.contactNodeLookup[e];if(null!=n){var r=n[t];if(null!=r){n[t]=null;var n=r.GetPreviousNode(),i=r.GetNextNode();null==n?this.contactFirstNodes[t]=i:n.SetNextNode(i),null==i?this.contactLastNodes[t]=n:i.SetPreviousNode(n),Box2D.Dynamics.Contacts.b2ContactListNode.FreeNode(r)}}},Box2D.Dynamics.Contacts.b2ContactList.prototype.CreateNode=function(e,t,n){t=this.contactNodeLookup[t],null==t[n]&&(t[n]=Box2D.Dynamics.Contacts.b2ContactListNode.GetNode(e),e=this.contactLastNodes[n],null!=e?(e.SetNextNode(t[n]),t[n].SetPreviousNode(e)):this.contactFirstNodes[n]=t[n],this.contactLastNodes[n]=t[n])},Box2D.Dynamics.Contacts.b2ContactList.prototype.GetContactCount=function(){return this.contactCount},Box2D.Dynamics.Contacts.b2ContactList.TYPES={nonSensorEnabledTouchingContacts:0,nonSensorEnabledContinuousContacts:1,allContacts:2},Box2D.Collision.b2Segment=function(){this.p1=Box2D.Common.Math.b2Vec2.Get(0,0),this.p2=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2Segment.prototype.TestSegment=function(e,t,n,r){var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y,n=this.p2.y-this.p1.y,u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y,i=l*n+c*u;if(0<=i&&i<=r*f&&(r=-s*c+o*l,-a*f<=r&&r<=f*(1+a)))return i/=f,r=Math.sqrt(n*n+u*u),e[0]=i,t.Set(n/r,u/r),!0}return!1},Box2D.Collision.b2Segment.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},Box2D.Collision.b2Segment.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,e=Math.min(0<t?(e.upperBound.x-this.p1.x)/t:0>t?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,0<n?(e.upperBound.y-this.p1.y)/n:0>n?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},Box2D.Collision.b2Segment.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y,e=Math.min(0<t?(e.upperBound.x-this.p2.x)/t:0>t?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,0<n?(e.upperBound.y-this.p2.y)/n:0>n?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},Box2D.Dynamics.Joints.b2MouseJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.K=new Box2D.Common.Math.b2Mat22,this.K1=new Box2D.Common.Math.b2Mat22,this.K2=new Box2D.Common.Math.b2Mat22,this.m_localAnchor=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_impulse=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_mass=new Box2D.Common.Math.b2Mat22,this.m_C=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},goog.inherits(Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorA=function(){return Box2D.Common.Math.b2Vec2.Get(this.m_target.x,this.m_target.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionForce=function(e){return void 0===e&&(e=0),Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse.x,e*this.m_impulse.y)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetTarget=function(){return this.m_target},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetTarget=function(e){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=e},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetMaxForce=function(e){void 0===e&&(e=0),this.m_maxForce=e},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetFrequency=function(e){void 0===e&&(e=0),this.m_frequencyHz=e},Box2D.Dynamics.Joints.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SetDampingRatio=function(e){void 0===e&&(e=0),this.m_dampingRatio=e},Box2D.Dynamics.Joints.b2MouseJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma;var i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y,s=i.col1.x*n+i.col2.x*r,r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI;this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y,r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o,u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},Box2D.Dynamics.Joints.b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},Box2D.Dynamics.b2BodyListNode=function(e){this.body=e,this.previous=this.next=null},Box2D.Dynamics.b2BodyListNode.prototype.SetNextNode=function(e){this.next=e},Box2D.Dynamics.b2BodyListNode.prototype.SetPreviousNode=function(e){this.previous=e},Box2D.Dynamics.b2BodyListNode.prototype.GetBody=function(){return this.body},Box2D.Dynamics.b2BodyListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.b2BodyListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Common.b2Color=function(e,t,n){this._r=255*Box2D.Common.Math.b2Math.Clamp(e,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(t,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(n,0,1)},Box2D.Common.b2Color.prototype.Set=function(e,t,n){this._r=255*Box2D.Common.Math.b2Math.Clamp(e,0,1),this._g=255*Box2D.Common.Math.b2Math.Clamp(t,0,1),this._b=255*Box2D.Common.Math.b2Math.Clamp(n,0,1)},Box2D.Common.b2Color.prototype.GetColor=function(){return this._r<<16|this._g<<8|this._b},Box2D.Dynamics.b2BodyList=function(){this.bodyFirstNodes=[];for(var e=0;e<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;e++)this.bodyFirstNodes[e]=null;this.bodyLastNodes=[];for(e=0;e<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;e++)this.bodyLastNodes[e]=null;this.bodyNodeLookup={},this.bodyCount=0},Box2D.Dynamics.b2BodyList.prototype.GetFirstNode=function(e){return this.bodyFirstNodes[e]},Box2D.Dynamics.b2BodyList.prototype.AddBody=function(e){var t=e.ID;null==this.bodyNodeLookup[t]&&(this.CreateNode(e,t,Box2D.Dynamics.b2BodyList.TYPES.allBodies),this.UpdateBody(e),e.m_lists.push(this),this.bodyCount++)},Box2D.Dynamics.b2BodyList.prototype.UpdateBody=function(e){var t=e.GetType(),n=e.ID,r=e.IsAwake(),i=e.IsActive();t==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?this.CreateNode(e,n,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies):this.RemoveNode(n,Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies),t!=Box2D.Dynamics.b2BodyDef.b2_staticBody?this.CreateNode(e,n,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies):this.RemoveNode(n,Box2D.Dynamics.b2BodyList.TYPES.nonStaticBodies),t!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&i&&r?this.CreateNode(e,n,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies):this.RemoveNode(n,Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies),r?this.CreateNode(e,n,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies):this.RemoveNode(n,Box2D.Dynamics.b2BodyList.TYPES.awakeBodies),i?this.CreateNode(e,n,Box2D.Dynamics.b2BodyList.TYPES.activeBodies):this.RemoveNode(n,Box2D.Dynamics.b2BodyList.TYPES.activeBodies)},Box2D.Dynamics.b2BodyList.prototype.RemoveBody=function(e){var t=e.ID;if(null!=this.bodyNodeLookup[t]){goog.array.remove(e.m_lists,this);for(e=0;e<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;e++)this.RemoveNode(t,e);delete this.bodyNodeLookup[t],this.bodyCount--}},Box2D.Dynamics.b2BodyList.prototype.RemoveNode=function(e,t){var n=this.bodyNodeLookup[e];if(null!=n){var r=n[t];null!=r&&(n[t]=null,n=r.GetPreviousNode(),r=r.GetNextNode(),null==n?this.bodyFirstNodes[t]=r:n.SetNextNode(r),null==r?this.bodyLastNodes[t]=n:r.SetPreviousNode(n))}},Box2D.Dynamics.b2BodyList.prototype.CreateNode=function(e,t,n){var r=this.bodyNodeLookup[t];if(null==r){for(var r=[],i=0;i<=Box2D.Dynamics.b2BodyList.TYPES.allBodies;i++)r[i]=null;this.bodyNodeLookup[t]=r}null==r[n]&&(r[n]=new Box2D.Dynamics.b2BodyListNode(e),e=this.bodyLastNodes[n],null!=e?e.SetNextNode(r[n]):this.bodyFirstNodes[n]=r[n],r[n].SetPreviousNode(e),this.bodyLastNodes[n]=r[n])},Box2D.Dynamics.b2BodyList.prototype.GetBodyCount=function(){return this.bodyCount},Box2D.Dynamics.b2BodyList.TYPES={dynamicBodies:0,nonStaticBodies:1,activeBodies:2,nonStaticActiveAwakeBodies:3,awakeBodies:4,allBodies:5},Box2D.Dynamics.Controllers={},Box2D.Dynamics.Controllers.b2Controller=function(){this.ID="Controller"+Box2D.Dynamics.Controllers.b2Controller.NEXT_ID++,this.m_world=null,this.bodyList=new Box2D.Dynamics.b2BodyList},Box2D.Dynamics.Controllers.b2Controller.prototype.Step=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.Draw=function(){},Box2D.Dynamics.Controllers.b2Controller.prototype.AddBody=function(e){this.bodyList.AddBody(e),e.AddController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.RemoveBody=function(e){this.bodyList.RemoveBody(e),e.RemoveController(this)},Box2D.Dynamics.Controllers.b2Controller.prototype.Clear=function(){for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);e;e=e.GetNextNode())this.RemoveBody(e.body)},Box2D.Dynamics.Controllers.b2Controller.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.Controllers.b2Controller.NEXT_ID=0,Box2D.Dynamics.Controllers.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.A=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantAccelController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantAccelController.prototype.Step=function(e){for(var e=Box2D.Common.Math.b2Vec2.Get(this.A.x*e.dt,this.A.y*e.dt),t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);t;t=t.GetNextNode()){var n=t.body,r=n.GetLinearVelocity(),r=Box2D.Common.Math.b2Vec2.Get(r.x+e.x,r.y+e.y);n.SetLinearVelocity(r),Box2D.Common.Math.b2Vec2.Free(r)}Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Dynamics.Contacts.b2PolygonContact=function(e,t){Box2D.Dynamics.Contacts.b2Contact.call(this,e,t)},goog.inherits(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2Contact),Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Reset=function(e,t){Box2D.Dynamics.Contacts.b2Contact.prototype.Reset.call(this,e,t)},Box2D.Dynamics.Contacts.b2PolygonContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetShape(),t=this.m_fixtureB.GetShape();Box2D.Collision.b2Collision.CollidePolygons(this.m_manifold,e,this.m_fixtureA.GetBody().m_xf,t,this.m_fixtureB.GetBody().m_xf)},Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Dynamics.b2Island=function(e,t){this.m_listener=e,this.m_contactSolver=t,this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[],this.impulse=new Box2D.Dynamics.b2ContactImpulse},Box2D.Dynamics.b2Island.prototype.Reset=function(e,t){this.m_listener=e,this.m_contactSolver=t},Box2D.Dynamics.b2Island.prototype.Clear=function(){this.m_bodies=[],this.m_dynamicBodies=[],this.m_nonStaticBodies=[],this.m_contacts=[],this.m_joints=[]},Box2D.Dynamics.b2Island.prototype.Solve=function(e,t,n){this._InitializeVelocities(e,t),this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contacts.length),this._SolveVelocityConstraints(e),this._SolveBodies(e),this._SolvePositionConstraints(e),this.Report(this.m_contactSolver.m_constraints),n&&this._SleepIfTired(e)},Box2D.Dynamics.b2Island.prototype._InitializeVelocities=function(e,t){for(var n=0;n<this.m_dynamicBodies.length;n++){var r=this.m_dynamicBodies[n],i=t.x,s=t.y;r._pc_gravityX!=undefined&&(i=r._pc_gravityX),r._pc_gravityY!=undefined&&(s=r._pc_gravityY),r.m_linearVelocity.x+=e.dt*(i+r.m_invMass*r.m_force.x),r.m_linearVelocity.y+=e.dt*(s+r.m_invMass*r.m_force.y),r.m_angularVelocity+=e.dt*r.m_invI*r.m_torque,r.m_linearVelocity.Multiply(Box2D.Common.Math.b2Math.Clamp(1-e.dt*r.m_linearDamping,0,1)),r.m_angularVelocity*=Box2D.Common.Math.b2Math.Clamp(1-e.dt*r.m_angularDamping,0,1)}},Box2D.Dynamics.b2Island.prototype._SolveVelocityConstraints=function(e){this.m_contactSolver.InitVelocityConstraints(e);for(var t=0;t<this.m_joints.length;t++)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;t++){for(var n=0;n<this.m_joints.length;n++)this.m_joints[n].SolveVelocityConstraints(e);this.m_contactSolver.SolveVelocityConstraints()}for(e=0;e<this.m_joints.length;e++)this.m_joints[e].FinalizeVelocityConstraints();this.m_contactSolver.FinalizeVelocityConstraints()},Box2D.Dynamics.b2Island.prototype._SolveBodies=function(e){for(var t=0;t<this.m_nonStaticBodies.length;++t){var n=this.m_nonStaticBodies[t],r=e.dt*n.m_linearVelocity.x,i=e.dt*n.m_linearVelocity.y;r*r+i*i>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*e.inv_dt),r=e.dt*n.m_angularVelocity,r*r>Box2D.Common.b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*e.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}},Box2D.Dynamics.b2Island.prototype._SolvePositionConstraints=function(e){for(var t=0;t<e.positionIterations;t++){for(var n=this.m_contactSolver.SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),r=!0,i=0;i<this.m_joints.length;i++)var s=this.m_joints[i].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),r=r&&s;if(n&&r)break}},Box2D.Dynamics.b2Island.prototype._SleepIfTired=function(e){for(var t=Number.MAX_VALUE,n=0;n<this.m_nonStaticBodies.length;n++){var r=this.m_nonStaticBodies[n];!r.m_allowSleep||Math.abs(r.m_angularVelocity)>Box2D.Common.b2Settings.b2_angularSleepTolerance||Box2D.Common.Math.b2Math.Dot(r.m_linearVelocity,r.m_linearVelocity)>Box2D.Common.b2Settings.b2_linearSleepToleranceSquared?t=r.m_sleepTime=0:(r.m_sleepTime+=e.dt,t=Math.min(t,r.m_sleepTime))}if(t>=Box2D.Common.b2Settings.b2_timeToSleep)for(e=0;e<this.m_bodies.length;e++)this.m_bodies[e].SetAwake(!1)},Box2D.Dynamics.b2Island.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contacts.length);for(var r=this.m_contactSolver,t=0;t<this.m_joints.length;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_joints.length;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_nonStaticBodies.length;++t){var n=this.m_nonStaticBodies[t],i=e.dt*n.m_linearVelocity.x,s=e.dt*n.m_linearVelocity.y;i*i+s*s>Box2D.Common.b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=Box2D.Common.b2Settings.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=Box2D.Common.b2Settings.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>Box2D.Common.b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity=0>n.m_angularVelocity?-Box2D.Common.b2Settings.b2_maxRotation*e.inv_dt:Box2D.Common.b2Settings.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),s=!0;for(n=0;n<this.m_joints.length;++n)var o=this.m_joints[n].SolvePositionConstraints(Box2D.Common.b2Settings.b2_contactBaumgarte),s=s&&o;if(i&&s)break}this.Report(r.m_constraints)},Box2D.Dynamics.b2Island.prototype.Report=function(e){if(null!=this.m_listener)for(var t=0;t<this.m_contacts.length;++t){var n=this.m_contacts[t],r=e[t];this.impulse.Reset();for(var i=0;i<r.pointCount;++i)this.impulse.normalImpulses[i]=r.points[i].normalImpulse,this.impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,this.impulse)}},Box2D.Dynamics.b2Island.prototype.AddBody=function(e){this.m_bodies.push(e),e.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_nonStaticBodies.push(e),e.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&this.m_dynamicBodies.push(e))},Box2D.Dynamics.b2Island.prototype.AddContact=function(e){this.m_contacts.push(e)},Box2D.Dynamics.b2Island.prototype.AddJoint=function(e){this.m_joints.push(e)},Box2D.Dynamics.Contacts.b2ContactRegister=function(){this.pool=null,this.poolCount=0},Box2D.Collision.b2DynamicTreePair=function(e,t){this.fixtureA=e,this.fixtureB=t},Box2D.Collision.b2DynamicTreePair._freeCache=[],Box2D.Collision.b2DynamicTreePair.Get=function(e,t){if(0<Box2D.Collision.b2DynamicTreePair._freeCache.length){var n=Box2D.Collision.b2DynamicTreePair._freeCache.pop();return n.fixtureA=e,n.fixtureB=t,n}return new Box2D.Collision.b2DynamicTreePair(e,t)},Box2D.Collision.b2DynamicTreePair.Free=function(e){null!=e&&Box2D.Collision.b2DynamicTreePair._freeCache.push(e)},Box2D.Dynamics.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1,this.m_drawFlags=0,this.m_originX=0,this.m_originY=0,this.m_ctx=null},Box2D.Dynamics.b2DebugDraw.prototype.SetOrigin=function(e,t){this.m_originX=e,this.m_originY=t},Box2D.Dynamics.b2DebugDraw.prototype.Clear=function(){},Box2D.Dynamics.b2DebugDraw.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},Box2D.Dynamics.b2DebugDraw.prototype.SetFlags=function(e){this.m_drawFlags=e},Box2D.Dynamics.b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},Box2D.Dynamics.b2DebugDraw.prototype.AppendFlags=function(e){this.m_drawFlags|=e},Box2D.Dynamics.b2DebugDraw.prototype.ClearFlags=function(e){this.m_drawFlags&=~e},Box2D.Dynamics.b2DebugDraw.prototype.SetSprite=function(e){this.m_ctx=e},Box2D.Dynamics.b2DebugDraw.prototype.GetSprite=function(){return this.m_ctx},Box2D.Dynamics.b2DebugDraw.prototype.SetDrawScale=function(e){this.m_drawScale=e},Box2D.Dynamics.b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},Box2D.Dynamics.b2DebugDraw.prototype.SetLineThickness=function(e){this.m_lineThickness=e,this.m_ctx.strokeWidth=e},Box2D.Dynamics.b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},Box2D.Dynamics.b2DebugDraw.prototype.SetAlpha=function(e){this.m_alpha=e},Box2D.Dynamics.b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},Box2D.Dynamics.b2DebugDraw.prototype.SetFillAlpha=function(e){this.m_fillAlpha=e},Box2D.Dynamics.b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},Box2D.Dynamics.b2DebugDraw.prototype.SetXFormScale=function(e){this.m_xformScale=e},Box2D.Dynamics.b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},function(e){e.prototype.DrawPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.GetColor(),this.m_alpha),r.moveTo(e[0].x*i-this.m_originX,e[0].y*i-this.m_originY);for(n=1;n<t;n++)r.lineTo(e[n].x*i-this.m_originX,e[n].y*i-this.m_originY);r.lineTo(e[0].x*i-this.m_originX,e[0].y*i-this.m_originY),r.closePath(),r.stroke()}},e.prototype.DrawSolidPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.GetColor(),this.m_alpha),r.fillStyle=this._color(n.GetColor(),this.m_fillAlpha),r.moveTo(e[0].x*i-this.m_originX,e[0].y*i-this.m_originY);for(n=1;n<t;n++)r.lineTo(e[n].x*i-this.m_originX,e[n].y*i-this.m_originY);r.lineTo(e[0].x*i-this.m_originX,e[0].y*i-this.m_originY),r.closePath(),r.fill(),r.stroke()}},e.prototype.DrawCircle=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.GetColor(),this.m_alpha),r.arc(e.x*i-this.m_originX,e.y*i-this.m_originY,t*i,0,2*Math.PI,!0),r.closePath(),r.stroke()}},e.prototype.DrawSolidCircle=function(e,t,n,r){if(t){var i=this.m_ctx,s=this.m_drawScale,o=e.x*s-this.m_originX,u=e.y*s-this.m_originY;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.GetColor(),this.m_alpha),i.fillStyle=this._color(r.GetColor(),this.m_fillAlpha),i.arc(o,u,t*s,0,2*Math.PI,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s-this.m_originX,(e.y+n.y*t)*s-this.m_originY),i.closePath(),i.fill(),i.stroke()}},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.GetColor(),this.m_alpha),r.beginPath(),r.moveTo(e.x*i-this.m_originX,e.y*i-this.m_originY),r.lineTo(t.x*i-this.m_originX,t.y*i-this.m_originY),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n-this.m_originX,e.position.y*n-this.m_originY),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n-this.m_originX,(e.position.y+this.m_xformScale*e.R.col1.y)*n-this.m_originY),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n-this.m_originX,e.position.y*n-this.m_originY),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n-this.m_originX,(e.position.y+this.m_xformScale*e.R.col2.y)*n-this.m_originY),t.closePath(),t.stroke()}}(Box2D.Dynamics.b2DebugDraw),Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32,Box2D.Collision.b2RayCastOutput=function(){this.normal=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Dynamics.iContactFilter=function(){},Box2D.Dynamics.iContactFilter.prototype.ShouldCollide=function(){},Box2D.Dynamics.b2ContactFilter=function(){},Box2D.Dynamics.b2ContactFilter.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&0!=n.groupIndex?0<n.groupIndex:0!=(n.maskBits&r.categoryBits)&&0!=(n.categoryBits&r.maskBits)},Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.Joints.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.target=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},goog.inherits(Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2MouseJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2MouseJoint(this)},Box2D.Dynamics.Contacts.b2ContactFactory=function(){this.m_registers={},this.m_freeContacts={},this.AddType(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Collision.Shapes.b2CircleShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2PolygonShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Collision.Shapes.b2EdgeShape.NAME,Box2D.Collision.Shapes.b2CircleShape.NAME),this.AddType(Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Collision.Shapes.b2PolygonShape.NAME,Box2D.Collision.Shapes.b2EdgeShape.NAME)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.AddType=function(e,t,n){this.m_freeContacts[t]=this.m_freeContacts[t]||{},this.m_freeContacts[t][n]=this.m_freeContacts[t][n]||[],this.m_registers[t]=this.m_registers[t]||{},this.m_registers[t][n]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[t][n].ctor=e,this.m_registers[t][n].primary=!0,t!=n&&(this.m_registers[n]=this.m_registers[n]||{},this.m_registers[n][t]=new Box2D.Dynamics.Contacts.b2ContactRegister,this.m_registers[n][t].ctor=e,this.m_registers[n][t].primary=!1)},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Create=function(e,t){var n=e.GetShape().GetTypeName(),r=t.GetShape().GetTypeName(),i=this.m_registers[n][r],s=i.ctor;return null!=s?i.primary?0<this.m_freeContacts[n][r].length?(n=this.m_freeContacts[n][r].pop(),n.Reset(e,t),n):new s(e,t):0<this.m_freeContacts[r][n].length?(n=this.m_freeContacts[r][n].pop(),n.Reset(t,e),n):new s(t,e):null},Box2D.Dynamics.Contacts.b2ContactFactory.prototype.Destroy=function(e){var t=e.GetFixtureA().GetShape().GetTypeName(),n=e.GetFixtureB().GetShape().GetTypeName();this.m_freeContacts[t][n].push(e)},Box2D.Dynamics.b2ContactListener=function(){},Box2D.Dynamics.b2ContactListener.prototype.BeginContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.EndContact=function(){},Box2D.Dynamics.b2ContactListener.prototype.PreSolve=function(){},Box2D.Dynamics.b2ContactListener.prototype.PostSolve=function(){},Box2D.Dynamics.b2ContactListener.b2_defaultListener=new Box2D.Dynamics.b2ContactListener,Box2D.Collision.b2ContactPoint=function(){this.position=Box2D.Common.Math.b2Vec2.Get(0,0),this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.id=new Box2D.Collision.b2ContactID},Box2D.Collision.b2DynamicTreeBroadPhase=function(){this.m_tree=new Box2D.Collision.b2DynamicTree,this.m_moveBuffer=[],this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return this.BufferMove(n),n},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(e){this.UnBufferMove(e),this.m_tree.DestroyProxy(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_tree.length},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(e){this.lastQueryFixtureB=this.lastQueryFixtureA=null;for(this.updatePairsCallback=e;0<this.m_moveBuffer.length;)this.queryProxy=this.m_moveBuffer.pop(),this.m_tree.Query(this.QueryCallback,this.m_tree.GetFatAABB(this.queryProxy),this);this.queryProxy=this.updatePairsCallback=this.lastQueryFixtureB=this.lastQueryFixtureA=null},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.QueryCallback=function(e){return e!=this.queryProxy.fixture&&(this.queryProxy.fixture!=this.lastQueryFixtureA||e!=this.lastQueryFixtureB)&&(this.queryProxy.fixture!=this.lastQueryFixtureB||e!=this.lastQueryFixtureA)&&(this.updatePairsCallback(this.queryProxy.fixture,e),this.lastQueryFixtureA=this.queryProxy.fixture,this.lastQueryFixtureB=e),!0},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Query=function(e,t){this.m_tree.Query(e,t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.Rebalance=function(e){this.m_tree.Rebalance(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.BufferMove=function(e){this.m_moveBuffer.push(e)},Box2D.Collision.b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(e){goog.array.remove(this.m_moveBuffer,e)},Box2D.Collision.b2DynamicTreeBroadPhase.__implements={},Box2D.Collision.b2DynamicTreeBroadPhase.__implements[Box2D.Collision.IBroadPhase]=!0,Box2D.Dynamics.b2ContactManager=function(e){this.m_world=e,this.m_contactFilter=Box2D.Dynamics.b2ContactFilter.b2_defaultFilter,this.m_contactListener=Box2D.Dynamics.b2ContactListener.b2_defaultListener,this.m_contactFactory=new Box2D.Dynamics.Contacts.b2ContactFactory,this.m_broadPhase=new Box2D.Collision.b2DynamicTreeBroadPhase},Box2D.Dynamics.b2ContactManager.prototype.AddPair=function(e,t){var n=e.GetBody(),r=t.GetBody();if(n!=r&&r.ShouldCollide(n)&&this.m_contactFilter.ShouldCollide(e,t)){for(n=r.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);n;n=n.GetNextNode())if(r=n.contact.GetFixtureA(),r==e){if(r=n.contact.GetFixtureB(),r==t)return}else if(r==t&&(r=n.contact.GetFixtureB(),r==e))return;this.m_contactFactory.Create(e,t)}},Box2D.Dynamics.b2ContactManager.prototype.FindNewContacts=function(){var e=this;this.m_broadPhase.UpdatePairs(function(t,n){e.AddPair(t,n)})},Box2D.Dynamics.b2ContactManager.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),t=t.GetBody(),n=n.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e),0<e.m_manifold.m_pointCount&&(t.SetAwake(!0),n.SetAwake(!0)),e.RemoveFromLists(),this.m_contactFactory.Destroy(e)},Box2D.Dynamics.b2ContactManager.prototype.Collide=function(){for(var e=this.m_world.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode()){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB(),i=n.GetBody(),s=r.GetBody();if(i.IsAwake()||s.IsAwake()){if(t.IsFiltering()){if(!s.ShouldCollide(i)){this.Destroy(t);continue}if(!this.m_contactFilter.ShouldCollide(n,r)){this.Destroy(t);continue}t.ClearFiltering()}this.m_broadPhase.TestOverlap(n.m_proxy,r.m_proxy)?t.Update(this.m_contactListener):this.Destroy(t)}}},Box2D.Dynamics.b2ContactManager.s_evalCP=new Box2D.Collision.b2ContactPoint,Box2D.Dynamics.Joints.b2DistanceJoint=function(e){Box2D.Dynamics.Joints.b2Joint.call(this,e),this.m_localAnchor1=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor2=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_u=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2Joint),Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionForce=function(e){return Box2D.Common.Math.b2Vec2.Get(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetLength=function(e){this.m_length=e},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchor1.x-r.m_sweep.localCenter.x,o=this.m_localAnchor1.y-r.m_sweep.localCenter.y,n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n;t=i.m_xf.R;var u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n;this.m_u.x=i.m_sweep.c.x+u-r.m_sweep.c.x-s,this.m_u.y=i.m_sweep.c.y+a-r.m_sweep.c.y-o,n=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),n>Box2D.Common.b2Settings.b2_linearSlop?this.m_u.Multiply(1/n):this.m_u.SetZero(),t=s*this.m_u.y-o*this.m_u.x;var f=u*this.m_u.y-a*this.m_u.x;t=r.m_invMass+r.m_invI*t*t+i.m_invMass+i.m_invI*f*f,this.m_mass=0!=t?1/t:0;if(0<this.m_frequencyHz){var n=n-this.m_length,f=2*Math.PI*this.m_frequencyHz,l=this.m_mass*f*f;this.m_gamma=e.dt*(2*this.m_mass*this.m_dampingRatio*f+e.dt*l),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=n*e.dt*l*this.m_gamma,this.m_mass=t+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}e.warmStarting?(this.m_impulse*=e.dtRatio,e=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y,r.m_linearVelocity.x-=r.m_invMass*e,r.m_linearVelocity.y-=r.m_invMass*t,r.m_angularVelocity-=r.m_invI*(s*t-o*e),i.m_linearVelocity.x+=i.m_invMass*e,i.m_linearVelocity.y+=i.m_invMass*t,i.m_angularVelocity+=i.m_invI*(u*t-a*e)):this.m_impulse=0},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,t=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,n=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*t,t=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*t,e=n,r=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,i=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,n=this.m_bodyB.m_xf.R.col1.x*r+this.m_bodyB.m_xf.R.col2.x*i,i=this.m_bodyB.m_xf.R.col1.y*r+this.m_bodyB.m_xf.R.col2.y*i,r=n,s=-this.m_mass*(this.m_u.x*(this.m_bodyB.m_linearVelocity.x-this.m_bodyB.m_angularVelocity*i-(this.m_bodyA.m_linearVelocity.x-this.m_bodyA.m_angularVelocity*t))+this.m_u.y*(this.m_bodyB.m_linearVelocity.y+this.m_bodyB.m_angularVelocity*r-(this.m_bodyA.m_linearVelocity.y+this.m_bodyA.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=s,n=s*this.m_u.x,s*=this.m_u.y,this.m_bodyA.m_linearVelocity.x-=this.m_bodyA.m_invMass*n,this.m_bodyA.m_linearVelocity.y-=this.m_bodyA.m_invMass*s,this.m_bodyA.m_angularVelocity-=this.m_bodyA.m_invI*(e*s-t*n),this.m_bodyB.m_linearVelocity.x+=this.m_bodyB.m_invMass*n,this.m_bodyB.m_linearVelocity.y+=this.m_bodyB.m_invMass*s,this.m_bodyB.m_angularVelocity+=this.m_bodyB.m_invI*(r*s-i*n)},Box2D.Dynamics.Joints.b2DistanceJoint.prototype.SolvePositionConstraints=function(){if(0<this.m_frequencyHz)return!0;var e=this.m_localAnchor1.x-this.m_bodyA.m_sweep.localCenter.x,t=this.m_localAnchor1.y-this.m_bodyA.m_sweep.localCenter.y,n=this.m_bodyA.m_xf.R.col1.x*e+this.m_bodyA.m_xf.R.col2.x*t,t=this.m_bodyA.m_xf.R.col1.y*e+this.m_bodyA.m_xf.R.col2.y*t,e=n,r=this.m_localAnchor2.x-this.m_bodyB.m_sweep.localCenter.x,i=this.m_localAnchor2.y-this.m_bodyB.m_sweep.localCenter.y,n=this.m_bodyB.m_xf.R.col1.x*r+this.m_bodyB.m_xf.R.col2.x*i,i=this.m_bodyB.m_xf.R.col1.y*r+this.m_bodyB.m_xf.R.col2.y*i,r=n,s=this.m_bodyB.m_sweep.c.x+r-this.m_bodyA.m_sweep.c.x-e,o=this.m_bodyB.m_sweep.c.y+i-this.m_bodyA.m_sweep.c.y-t,n=Math.sqrt(s*s+o*o),s=s/n,o=o/n,n=Box2D.Common.Math.b2Math.Clamp(n-this.m_length,-Box2D.Common.b2Settings.b2_maxLinearCorrection,Box2D.Common.b2Settings.b2_maxLinearCorrection),u=-this.m_mass*n;return this.m_u.Set(s,o),s=u*this.m_u.x,o=u*this.m_u.y,this.m_bodyA.m_sweep.c.x-=this.m_bodyA.m_invMass*s,this.m_bodyA.m_sweep.c.y-=this.m_bodyA.m_invMass*o,this.m_bodyA.m_sweep.a-=this.m_bodyA.m_invI*(e*o-t*s),this.m_bodyB.m_sweep.c.x+=this.m_bodyB.m_invMass*s,this.m_bodyB.m_sweep.c.y+=this.m_bodyB.m_invMass*o,this.m_bodyB.m_sweep.a+=this.m_bodyB.m_invI*(r*o-i*s),this.m_bodyA.SynchronizeTransform(),this.m_bodyB.SynchronizeTransform(),Math.abs(n)<Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Joints.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},goog.inherits(Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},Box2D.Dynamics.Joints.b2DistanceJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2DistanceJoint(this)},Box2D.Dynamics.Controllers.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.normal=Box2D.Common.Math.b2Vec2.Get(0,-1),this.density=this.offset=0,this.velocity=Box2D.Common.Math.b2Vec2.Get(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},goog.inherits(Box2D.Dynamics.Controllers.b2BuoyancyController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Step=function(){this.useWorldGravity&&(this.gravity=this.m_world.GetGravity());for(var e=Box2D.Common.Math.b2Vec2.Get(0,0),t=Box2D.Common.Math.b2Vec2.Get(0,0),n=Box2D.Common.Math.b2Vec2.Get(0,0),r=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);r;r=r.GetNextNode()){t.Set(0,0),e.Set(0,0);for(var i=r.body,s=0,o=0,u=i.GetFixtureList().GetFirstNode();u;u=u.GetNextNode()){n.Set(0,0);var a=u.fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),n),s=s+a;e.x+=a*n.x,e.y+=a*n.y;var f=0,f=1,o=o+a*f;t.x+=a*n.x*f,t.y+=a*n.y*f}s<Number.MIN_VALUE||(e.x/=s,e.y/=s,t.x/=o,t.y/=o,o=this.gravity.GetNegative(),o.Multiply(this.density*s),i.ApplyForce(o,t),Box2D.Common.Math.b2Vec2.Free(o),o=i.GetLinearVelocityFromWorldPoint(e),o.Subtract(this.velocity),o.Multiply(-this.linearDrag*s),i.ApplyForce(o,e),Box2D.Common.Math.b2Vec2.Free(o),i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag))}Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(e)},Box2D.Dynamics.Controllers.b2BuoyancyController.prototype.Draw=function(e){var t=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset+1e3*this.normal.y,this.normal.y*this.offset-1e3*this.normal.x),n=Box2D.Common.Math.b2Vec2.Get(this.normal.x*this.offset-1e3*this.normal.y,this.normal.y*this.offset+1e3*this.normal.x);e.DrawSegment(t,n,Box2D.Dynamics.Controllers.b2BuoyancyController.color),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(n)},Box2D.Dynamics.Controllers.b2BuoyancyController.color=new Box2D.Common.b2Color(0,0,1),Box2D.Dynamics.Controllers.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.G=1,this.invSqr=!0},goog.inherits(Box2D.Dynamics.Controllers.b2GravityController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2GravityController.prototype.Step=function(){var e=null,t=null,n=0,r=null,i=null,s=0,o=0,u=0,s=null;if(this.invSqr){for(var a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode())for(var e=a.body,t=e.GetWorldCenter(),n=e.GetMass(),f=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);f;f=f.GetNextNode())if(r=f.body,e.IsAwake()||r.IsAwake())i=r.GetWorldCenter(),s=i.x-t.x,o=i.y-t.y,u=s*s+o*o,u<Number.MIN_VALUE||(s=Box2D.Common.Math.b2Vec2.Get(s,o),s.Multiply(this.G/u/Math.sqrt(u)*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(s,t),s.Multiply(-1),r.IsAwake()&&r.ApplyForce(s,i),Box2D.Common.Math.b2Vec2.Free(s))}else for(a=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);a;a=a.GetNextNode()){e=bodyNode.body,t=e.GetWorldCenter(),n=e.GetMass();for(f=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);f;f=f.GetNextNode())if(r=bodyNode.body,e.IsAwake()||r.IsAwake())i=r.GetWorldCenter(),s=i.x-t.x,o=i.y-t.y,u=s*s+o*o,u<Number.MIN_VALUE||(s=Box2D.Common.Math.b2Vec2.Get(s,o),s.Multiply(this.G/u*n*r.GetMass()),e.IsAwake()&&e.ApplyForce(s,t),s.Multiply(-1),r.IsAwake()&&r.ApplyForce(s,i),Box2D.Common.Math.b2Vec2.Free(s))}},Box2D.Collision.b2WorldManifold=function(){this.m_normal=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_points=[];for(var e=this.m_pointCount=0;e<Box2D.Common.b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=Box2D.Common.Math.b2Vec2.Get(0,0)},Box2D.Collision.b2WorldManifold.prototype.Initialize=function(e,t,n,r,i){if(0!=e.m_pointCount){var s=0,o,u,a=0,f=0,l=0,c=0,h=0;o=0;switch(e.m_type){case Box2D.Collision.b2Manifold.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Box2D.Common.b2Settings.MIN_VALUE_SQUARED?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case Box2D.Collision.b2Manifold.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case Box2D.Collision.b2Manifold.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},Box2D.Dynamics.Contacts.b2ContactSolver=function(){this.m_constraints=[]},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.Initialize=function(e,t,n){for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new Box2D.Dynamics.Contacts.b2ContactConstraint;for(e=0;e<n;e++){var r=t[e],i=r.m_fixtureA,s=r.m_fixtureB,o=i.m_shape.m_radius,u=s.m_shape.m_radius,a=i.GetBody(),f=s.GetBody(),l=r.GetManifold(),c=Box2D.Common.b2Settings.b2MixFriction(i.GetFriction(),s.GetFriction()),h=Box2D.Common.b2Settings.b2MixRestitution(i.GetRestitution(),s.GetRestitution()),p=a.m_linearVelocity.x,d=a.m_linearVelocity.y,v=f.m_linearVelocity.x,m=f.m_linearVelocity.y,g=a.m_angularVelocity,y=f.m_angularVelocity;Box2D.Common.b2Settings.b2Assert(0<l.m_pointCount),Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.Initialize(l,a.m_xf,o,f.m_xf,u),s=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.x,r=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_normal.y,i=this.m_constraints[e],i.bodyA=a,i.bodyB=f,i.manifold=l,i.normal.x=s,i.normal.y=r,i.pointCount=l.m_pointCount,i.friction=c,i.restitution=h,i.localPlaneNormal.x=l.m_localPlaneNormal.x,i.localPlaneNormal.y=l.m_localPlaneNormal.y,i.localPoint.x=l.m_localPoint.x,i.localPoint.y=l.m_localPoint.y,i.radius=o+u,i.type=l.m_type;for(o=0;o<i.pointCount;++o){c=l.m_points[o],u=i.points[o],u.normalImpulse=c.m_normalImpulse,u.tangentImpulse=c.m_tangentImpulse,u.localPoint.SetV(c.m_localPoint);var c=u.rA.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[o].x-a.m_sweep.c.x,h=u.rA.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[o].y-a.m_sweep.c.y,b=u.rB.x=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[o].x-f.m_sweep.c.x,w=u.rB.y=Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold.m_points[o].y-f.m_sweep.c.y,E=c*r-h*s,S=b*r-w*s,E=E*E,S=S*S;u.normalMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S);var x=a.m_mass*a.m_invMass+f.m_mass*f.m_invMass,x=x+(a.m_mass*a.m_invI*E+f.m_mass*f.m_invI*S);u.equalizedMass=1/x,S=r,x=-s,E=c*x-h*S,S=b*x-w*S,E*=E,S*=S,u.tangentMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S),u.velocityBias=0,c=i.normal.x*(v+ -y*w-p- -g*h)+i.normal.y*(m+y*b-d-g*c),c<-Box2D.Common.b2Settings.b2_velocityThreshold&&(u.velocityBias+=-i.restitution*c)}2==i.pointCount&&(m=i.points[0],v=i.points[1],l=a.m_invMass,a=a.m_invI,p=f.m_invMass,f=f.m_invI,d=m.rA.x*r-m.rA.y*s,m=m.rB.x*r-m.rB.y*s,g=v.rA.x*r-v.rA.y*s,v=v.rB.x*r-v.rB.y*s,s=l+p+a*d*d+f*m*m,r=l+p+a*g*g+f*v*v,f=l+p+a*d*g+f*m*v,s*s<100*(s*r-f*f)?(i.K.col1.Set(s,f),i.K.col2.Set(f,r),i.K.GetInverse(i.normalMass)):i.pointCount=1)}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;e++)this.SolveVelocityConstraints_Constraint(this.m_constraints[e])},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_Constraint=function(e){for(var t=e.normal.x,n=e.normal.y,r=0;r<e.pointCount;r++)Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint(e,e.points[r]);if(1==e.pointCount){var r=e.points[0],i=r.normalImpulse-r.normalMass*((e.bodyB.m_linearVelocity.x-e.bodyB.m_angularVelocity*r.rB.y-e.bodyA.m_linearVelocity.x+e.bodyA.m_angularVelocity*r.rA.y)*t+(e.bodyB.m_linearVelocity.y+e.bodyB.m_angularVelocity*r.rB.x-e.bodyA.m_linearVelocity.y-e.bodyA.m_angularVelocity*r.rA.x)*n-r.velocityBias),i=0<i?i:0,s=i-r.normalImpulse,o=s*t,n=s*n;e.bodyA.m_linearVelocity.x-=e.bodyA.m_invMass*o,e.bodyA.m_linearVelocity.y-=e.bodyA.m_invMass*n,e.bodyA.m_angularVelocity-=e.bodyA.m_invI*(r.rA.x*n-r.rA.y*o),e.bodyB.m_linearVelocity.x+=e.bodyB.m_invMass*o,e.bodyB.m_linearVelocity.y+=e.bodyB.m_invMass*n,e.bodyB.m_angularVelocity+=e.bodyB.m_invI*(r.rB.x*n-r.rB.y*o),r.normalImpulse=i}else for(var r=e.points[0],i=e.points[1],s=r.normalImpulse,o=i.normalImpulse,u=(e.bodyB.m_linearVelocity.x-e.bodyB.m_angularVelocity*r.rB.y-e.bodyA.m_linearVelocity.x+e.bodyA.m_angularVelocity*r.rA.y)*t+(e.bodyB.m_linearVelocity.y+e.bodyB.m_angularVelocity*r.rB.x-e.bodyA.m_linearVelocity.y-e.bodyA.m_angularVelocity*r.rA.x)*n-r.velocityBias,n=(e.bodyB.m_linearVelocity.x-e.bodyB.m_angularVelocity*i.rB.y-e.bodyA.m_linearVelocity.x+e.bodyA.m_angularVelocity*i.rA.y)*t+(e.bodyB.m_linearVelocity.y+e.bodyB.m_angularVelocity*i.rB.x-e.bodyA.m_linearVelocity.y-e.bodyA.m_angularVelocity*i.rA.x)*n-i.velocityBias,u=u-(e.K.col1.x*s+e.K.col2.x*o),n=n-(e.K.col1.y*s+e.K.col2.y*o);;){t=-(e.normalMass.col1.x*u+e.normalMass.col2.x*n);if(0<=t){var a=-(e.normalMass.col1.y*u+e.normalMass.col2.y*n);if(0<=a){this.SolveVelocityConstraints_ConstraintPointUpdate(e,r,i,t-s,a-o),r.normalImpulse=t,i.normalImpulse=a;break}}t=-r.normalMass*u;if(0<=t&&0<=e.K.col1.y*t+n){this.SolveVelocityConstraints_ConstraintPointUpdate(e,r,i,t-s,-o),r.normalImpulse=t,i.normalImpulse=0;break}t=-i.normalMass*n;if(0<=t&&0<=e.K.col2.x*t+u){this.SolveVelocityConstraints_ConstraintPointUpdate(e,r,i,-s,t-o),r.normalImpulse=0,i.normalImpulse=t;break}if(0<=u&&0<=n){this.SolveVelocityConstraints_ConstraintPointUpdate(e,r,i,-s,-o),r.normalImpulse=0,i.normalImpulse=0;break}break}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPoint=function(e,t){var n=e.normal.y,r=-e.normal.x,i=e.friction*t.normalImpulse,i=Box2D.Common.Math.b2Math.Clamp(t.tangentImpulse-t.tangentMass*((e.bodyB.m_linearVelocity.x-e.bodyB.m_angularVelocity*t.rB.y-e.bodyA.m_linearVelocity.x+e.bodyA.m_angularVelocity*t.rA.y)*n+(e.bodyB.m_linearVelocity.y+e.bodyB.m_angularVelocity*t.rB.x-e.bodyA.m_linearVelocity.y-e.bodyA.m_angularVelocity*t.rA.x)*r),-i,i),s=i-t.tangentImpulse,n=s*n,r=s*r;e.bodyA.m_linearVelocity.x-=e.bodyA.m_invMass*n,e.bodyA.m_linearVelocity.y-=e.bodyA.m_invMass*r,e.bodyA.m_angularVelocity-=e.bodyA.m_invI*(t.rA.x*r-t.rA.y*n),e.bodyB.m_linearVelocity.x+=e.bodyB.m_invMass*n,e.bodyB.m_linearVelocity.y+=e.bodyB.m_invMass*r,e.bodyB.m_angularVelocity+=e.bodyB.m_invI*(t.rB.x*r-t.rB.y*n),t.tangentImpulse=i},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolveVelocityConstraints_ConstraintPointUpdate=function(e,t,n,r,i){var s=r*e.normal.x,r=r*e.normal.y,o=i*e.normal.x,i=i*e.normal.y;e.bodyA.m_linearVelocity.x-=e.bodyA.m_invMass*(s+o),e.bodyA.m_linearVelocity.y-=e.bodyA.m_invMass*(r+i),e.bodyA.m_angularVelocity-=e.bodyA.m_invI*(t.rA.x*r-t.rA.y*s+n.rA.x*i-n.rA.y*o),e.bodyB.m_linearVelocity.x+=e.bodyB.m_invMass*(s+o),e.bodyB.m_linearVelocity.y+=e.bodyB.m_invMass*(r+i),e.bodyB.m_angularVelocity+=e.bodyB.m_invI*(t.rB.x*r-t.rB.y*s+n.rB.x*i-n.rB.y*o),t.normalImpulse=0,n.normalImpulse=0},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints=function(e){void 0===e&&(e=0);for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(r);for(var l=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,c=0;c<r.pointCount;c++){var h=r.points[c],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[c],d=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[c],v=p.x-i.m_sweep.c.x,m=p.y-i.m_sweep.c.y,g=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y,t=t<d?t:d,d=Box2D.Common.Math.b2Math.Clamp(e*(d+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),d=-h.equalizedMass*d,h=d*l.x,d=d*l.y;i.m_sweep.c.x-=o*h,i.m_sweep.c.y-=o*d,i.m_sweep.a-=u*(v*d-m*h),i.SynchronizeTransform(),s.m_sweep.c.x+=a*h,s.m_sweep.c.y+=a*d,s.m_sweep.a+=f*(g*d-p*h),s.SynchronizeTransform()}}return t>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.prototype.SolvePositionConstraints_NEW=function(e){void 0===e&&(e=0);for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.Initialize(r);for(var l=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_normal,c=0;c<r.pointCount;c++){var h=r.points[c],p=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_points[c],d=Box2D.Dynamics.Contacts.b2ContactSolver.s_psm.m_separations[c],v=p.x-i.m_sweep.c.x,m=p.y-i.m_sweep.c.y,g=p.x-s.m_sweep.c.x,p=p.y-s.m_sweep.c.y;d<t&&(t=d),0!=e&&Box2D.Common.Math.b2Math.Clamp(e*(d+Box2D.Common.b2Settings.b2_linearSlop),-Box2D.Common.b2Settings.b2_maxLinearCorrection,0),d=0*-h.equalizedMass,h=d*l.x,d*=l.y,i.m_sweep.c.x-=o*h,i.m_sweep.c.y-=o*d,i.m_sweep.a-=u*(v*d-m*h),i.SynchronizeTransform(),s.m_sweep.c.x+=a*h,s.m_sweep.c.y+=a*d,s.m_sweep.a+=f*(g*d-p*h),s.SynchronizeTransform()}}return t>-1.5*Box2D.Common.b2Settings.b2_linearSlop},Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new Box2D.Collision.b2WorldManifold,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2ControllerListNode=function(e){this.controller=e,this.previous=this.next=null},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetNextNode=function(e){this.next=e},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.SetPreviousNode=function(e){this.previous=e},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetNextNode=function(){return this.next},Box2D.Dynamics.Controllers.b2ControllerListNode.prototype.GetPreviousNode=function(){return this.previous},Box2D.Dynamics.Controllers.b2ControllerList=function(){this.controllerLastNode=this.controllerFirstNode=null,this.controllerNodeLookup={},this.controllerCount=0},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetFirstNode=function(){return this.controllerFirstNode},Box2D.Dynamics.Controllers.b2ControllerList.prototype.AddController=function(e){var t=e.ID;if(null==this.controllerNodeLookup[t]){var e=new Box2D.Dynamics.Controllers.b2ControllerListNode(e),n=this.controllerLastNode;null!=n?n.SetNextNode(e):this.controllerFirstNode=e,e.SetPreviousNode(n),this.controllerLastNode=e,this.controllerNodeLookup[t]=e,this.controllerCount++}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.RemoveController=function(e){var e=e.ID,t=this.controllerNodeLookup[e];if(null!=t){var n=t.GetPreviousNode(),t=t.GetNextNode();null==n?this.controllerFirstNode=t:n.SetNextNode(t),null==t?this.controllerLastNode=n:t.SetPreviousNode(n),delete this.controllerNodeLookup[e],this.controllerCount--}},Box2D.Dynamics.Controllers.b2ControllerList.prototype.GetControllerCount=function(){return this.controllerCount},Box2D.Dynamics.b2FixtureDef=function(){this.filter=new Box2D.Dynamics.b2FilterData,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.shape=null,this.friction=.2,this.density=this.restitution=0,this.isSensor=!1},Box2D.Dynamics.b2Body=function(e,t){this.ID="Body"+Box2D.Dynamics.b2Body.NEXT_ID++,this.m_xf=new Box2D.Common.Math.b2Transform,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep=new Box2D.Common.Math.b2Sweep,this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle,this.m_sweep.c.x=this.m_xf.R.col1.x*this.m_sweep.localCenter.x+this.m_xf.R.col2.x*this.m_sweep.localCenter.y,this.m_sweep.c.y=this.m_xf.R.col1.y*this.m_sweep.localCenter.x+this.m_xf.R.col2.y*this.m_sweep.localCenter.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_linearVelocity=e.linearVelocity.Copy(),this.m_force=Box2D.Common.Math.b2Vec2.Get(0,0),this.m_bullet=e.bullet,this.m_fixedRotation=e.fixedRotation,this.m_allowSleep=e.allowSleep,this.m_awake=e.awake,this.m_active=e.active,this.m_world=t,this.m_userData=null,this.m_jointList=null,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_controllerCount=0,this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_mass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invMass=this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody?1:0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.fixtureList=new Box2D.Dynamics.b2FixtureList,this.m_lists=[]},Box2D.Dynamics.b2Body.prototype.CreateFixture=function(e){return Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),e=new Box2D.Dynamics.b2Fixture(this,this.m_xf,e),this.m_active&&e.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),this.fixtureList.AddFixture(e),e.m_body=this,0<e.m_density&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},Box2D.Dynamics.b2Body.prototype.CreateFixture2=function(e,t){var n=new Box2D.Dynamics.b2FixtureDef;return n.shape=e,n.density=t,this.CreateFixture(n)},Box2D.Dynamics.b2Body.prototype.Destroy=function(){Box2D.Common.Math.b2Vec2.Free(this.m_linearVelocity),Box2D.Common.Math.b2Vec2.Free(this.m_force)},Box2D.Dynamics.b2Body.prototype.DestroyFixture=function(e){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.fixtureList.RemoveFixture(e);for(var t=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())(e==t.contact.GetFixtureA()||e==t.contact.GetFixtureB())&&this.m_world.m_contactManager.Destroy(t.contact);this.m_active&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.SetPositionAndAngle=function(e,t){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked()),this.m_xf.R.Set(t),this.m_xf.position.SetV(e);var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,n=this.m_world.m_contactManager.m_broadPhase;for(r=this.fixtureList.GetFirstNode();r;r=r.GetNextNode())r.fixture.Synchronize(n,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2Body.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetTransform=function(){return this.m_xf},Box2D.Dynamics.b2Body.prototype.GetPosition=function(){return this.m_xf.position},Box2D.Dynamics.b2Body.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},Box2D.Dynamics.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},Box2D.Dynamics.b2Body.prototype.SetAngle=function(e){this.SetPositionAndAngle(this.GetPosition(),e)},Box2D.Dynamics.b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},Box2D.Dynamics.b2Body.prototype.GetUserData=function(){return this.m_userData},Box2D.Dynamics.b2Body.prototype.SetUserData=function(e){this.m_userData=e},Box2D.Dynamics.b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},Box2D.Dynamics.b2Body.prototype.SetLinearVelocity=function(e){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_linearVelocity.SetV(e)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},Box2D.Dynamics.b2Body.prototype.SetAngularVelocity=function(e){this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_angularVelocity=e)},Box2D.Dynamics.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},Box2D.Dynamics.b2Body.prototype.GetDefinition=function(){var e=new Box2D.Dynamics.b2BodyDef;return e.type=this.GetType(),e.allowSleep=this.m_allowSleep,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=this.m_fixedRotation,e.bullet=this.m_bullet,e.active=this.m_active,e.awake=this.m_awake,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position.SetV(this.GetPosition()),e},Box2D.Dynamics.b2Body.prototype.ApplyForce=function(e,t){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},Box2D.Dynamics.b2Body.prototype.ApplyTorque=function(e){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_torque+=e)},Box2D.Dynamics.b2Body.prototype.ApplyImpulse=function(e,t){this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},Box2D.Dynamics.b2Body.prototype.Split=function(e){for(var t=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),r=this.GetWorldCenter(),i=this.m_world.CreateBody(this.GetDefinition()),s=this.fixtureList.GetFirstNode();s;s=s.GetNextNode()){var o=s.fixture;e(o)&&(this.fixtureList.RemoveFixture(o),i.fixtureList.AddFixture(o))}return this.ResetMassData(),i.ResetMassData(),s=this.GetWorldCenter(),e=i.GetWorldCenter(),o=Box2D.Common.Math.b2Math.SubtractVV(s,r),s=Box2D.Common.Math.b2Math.CrossFV(n,o),Box2D.Common.Math.b2Vec2.Free(o),o=Box2D.Common.Math.b2Math.AddVV(t,s),Box2D.Common.Math.b2Vec2.Free(s),this.SetLinearVelocity(o),Box2D.Common.Math.b2Vec2.Free(o),e=Box2D.Common.Math.b2Math.SubtractVV(e,r),r=Box2D.Common.Math.b2Math.CrossFV(n,e),Box2D.Common.Math.b2Vec2.Free(e),e=Box2D.Common.Math.b2Math.AddVV(t,r),Box2D.Common.Math.b2Vec2.Free(r),i.SetLinearVelocity(e),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(t),this.SetAngularVelocity(n),i.SetAngularVelocity(n),this.SynchronizeFixtures(),i.SynchronizeFixtures(),i},Box2D.Dynamics.b2Body.prototype.Merge=function(e){for(var t=e.fixtureList.GetFirstNode();t;t=t.GetNextNode())this.fixtureList.AddFixture(t.fixture),e.fixtureList.RemoveFixture(t.fixture);e.ResetMassData(),this.ResetMassData(),this.SynchronizeFixtures()},Box2D.Dynamics.b2Body.prototype.GetMass=function(){return this.m_mass},Box2D.Dynamics.b2Body.prototype.GetInertia=function(){return this.m_I},Box2D.Dynamics.b2Body.prototype.GetMassData=function(e){return e||(e=Box2D.Collision.Shapes.b2MassData.Get()),e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter),e},Box2D.Dynamics.b2Body.prototype.SetMassData=function(e){Box2D.Common.b2Settings.b2Assert(!this.m_world.IsLocked());if(this.m_type==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=e.mass,0>=this.m_mass&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<e.I&&!this.m_fixedRotation&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x),Box2D.Common.Math.b2Vec2.Free(t)}},Box2D.Dynamics.b2Body.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&this.m_type!=Box2D.Dynamics.b2BodyDef.b2_kinematicBody){for(var e=Box2D.Common.Math.b2Vec2.Get(0,0),t=this.fixtureList.GetFirstNode();t;t=t.GetNextNode()){var n=t.fixture;0!=n.m_density&&(n=n.GetMassData(),this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I)}0<this.m_mass?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1,0<this.m_I&&!this.m_fixedRotation?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,Box2D.Common.b2Settings.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,t=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(Box2D.Common.Math.b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x),Box2D.Common.Math.b2Vec2.Free(e),Box2D.Common.Math.b2Vec2.Free(t)}},Box2D.Dynamics.b2Body.prototype.GetWorldPoint=function(e){var t=this.m_xf.R,e=Box2D.Common.Math.b2Vec2.Get(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},Box2D.Dynamics.b2Body.prototype.GetWorldVector=function(e){return Box2D.Common.Math.b2Math.MulMV(this.m_xf.R,e)},Box2D.Dynamics.b2Body.prototype.GetLocalPoint=function(e){return Box2D.Common.Math.b2Math.MulXT(this.m_xf,e)},Box2D.Dynamics.b2Body.prototype.GetLocalVector=function(e){return Box2D.Common.Math.b2Math.MulTMV(this.m_xf.R,e)},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(e){return Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},Box2D.Dynamics.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R,e=Box2D.Common.Math.b2Vec2.Get(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,t=Box2D.Common.Math.b2Vec2.Get(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x)),Box2D.Common.Math.b2Vec2.Free(e),t},Box2D.Dynamics.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},Box2D.Dynamics.b2Body.prototype.SetLinearDamping=function(e){this.m_linearDamping=e},Box2D.Dynamics.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},Box2D.Dynamics.b2Body.prototype.SetAngularDamping=function(e){this.m_angularDamping=e},Box2D.Dynamics.b2Body.prototype.SetType=function(e){if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==Box2D.Dynamics.b2BodyDef.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.FlagForFiltering();for(e=0;e<this.m_lists.length;e++)this.m_lists[e].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.GetType=function(){return this.m_type},Box2D.Dynamics.b2Body.prototype.SetBullet=function(e){this.m_bullet=e},Box2D.Dynamics.b2Body.prototype.IsBullet=function(){return this.m_bullet},Box2D.Dynamics.b2Body.prototype.SetSleepingAllowed=function(e){(this.m_allowSleep=e)||this.SetAwake(!0)},Box2D.Dynamics.b2Body.prototype.SetAwake=function(e){if(this.m_awake!=e){this.m_awake=e,this.m_sleepTime=0,e||(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0);for(e=0;e<this.m_lists.length;e++)this.m_lists[e].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsAwake=function(){return this.m_awake},Box2D.Dynamics.b2Body.prototype.SetFixedRotation=function(e){this.m_fixedRotation=e,this.ResetMassData()},Box2D.Dynamics.b2Body.prototype.IsFixedRotation=function(){return this.m_fixedRotation},Box2D.Dynamics.b2Body.prototype.SetActive=function(e){if(e!=this.m_active){if(e){this.m_active=!0;for(var e=this.m_world.m_contactManager.m_broadPhase,t=this.fixtureList.GetFirstNode();t;t=t.GetNextNode())t.fixture.CreateProxy(e,this.m_xf)}else{this.m_active=!1,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.fixtureList.GetFirstNode();t;t=t.GetNextNode())t.fixture.DestroyProxy(e);for(e=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())this.m_world.m_contactManager.Destroy(e.contact)}for(e=0;e<this.m_lists.length;e++)this.m_lists[e].UpdateBody(this)}},Box2D.Dynamics.b2Body.prototype.IsActive=function(){return this.m_active},Box2D.Dynamics.b2Body.prototype.IsSleepingAllowed=function(){return this.m_allowSleep},Box2D.Dynamics.b2Body.prototype.GetFixtureList=function(){return this.fixtureList},Box2D.Dynamics.b2Body.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2Body.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2Body.prototype.AddController=function(e){this.controllerList.AddController(e)},Box2D.Dynamics.b2Body.prototype.RemoveController=function(e){this.controllerList.RemoveController(e)},Box2D.Dynamics.b2Body.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2Body.prototype.GetWorld=function(){return this.m_world},Box2D.Dynamics.b2Body.prototype.SynchronizeFixtures=function(){var e=Box2D.Dynamics.b2Body.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),t=this.m_world.m_contactManager.m_broadPhase;for(n=this.fixtureList.GetFirstNode();n;n=n.GetNextNode())n.fixture.Synchronize(t,e,this.m_xf)},Box2D.Dynamics.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},Box2D.Dynamics.b2Body.prototype.ShouldCollide=function(e){if(this.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&e.m_type!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&0==t.joint.m_collideConnected)return!1;return!0},Box2D.Dynamics.b2Body.prototype.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.Dynamics.b2Body.NEXT_ID=0,Box2D.Dynamics.b2Body.s_xf1=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World=function(e,t){this.m_contactManager=new Box2D.Dynamics.b2ContactManager(this),this.m_contactSolver=new Box2D.Dynamics.Contacts.b2ContactSolver,this.m_newFixture=this.m_isLocked=!1,this.m_debugDraw=this.m_destructionListener=null,this.bodyList=new Box2D.Dynamics.b2BodyList,this.contactList=new Box2D.Dynamics.Contacts.b2ContactList,this.m_jointList=null,this.controllerList=new Box2D.Dynamics.Controllers.b2ControllerList,this.m_jointCount=0,this.m_continuousPhysics=this.m_warmStarting=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_groundBody=this.CreateBody(new Box2D.Dynamics.b2BodyDef),this.mainTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.islandTimeStep=new Box2D.Dynamics.b2TimeStep(0,0,0,0,this.m_warmStarting),this.island=new Box2D.Dynamics.b2Island(this.m_contactManager.m_contactListener,this.m_contactSolver)},Box2D.Dynamics.b2World.MAX_TOI=1-100*Number.MIN_VALUE,Box2D.Dynamics.b2World.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},Box2D.Dynamics.b2World.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},Box2D.Dynamics.b2World.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},Box2D.Dynamics.b2World.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},Box2D.Dynamics.b2World.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode())for(var r=n.body.GetFixtureList().GetFirstNode();r;r=r.GetNextNode()){var i=r.fixture;i.m_proxy=e.CreateProxy(t.GetFatAABB(i.m_proxy),i)}},Box2D.Dynamics.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},Box2D.Dynamics.b2World.prototype.CreateBody=function(e){return Box2D.Common.b2Settings.b2Assert(!this.IsLocked()),e=new Box2D.Dynamics.b2Body(e,this),this.bodyList.AddBody(e),e},Box2D.Dynamics.b2World.prototype.DestroyBody=function(e){Box2D.Common.b2Settings.b2Assert(!this.IsLocked());for(var t=e.m_jointList;t;){var n=t,t=t.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.GetControllerList().GetFirstNode();t;t=t.GetNextNode())t.controller.RemoveBody(e);for(t=e.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);t;t=t.GetNextNode())this.m_contactManager.Destroy(t.contact);for(t=e.GetFixtureList().GetFirstNode();t;t=t.GetNextNode())this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(t.fixture),e.DestroyFixture(t.fixture);e.Destroy(),this.bodyList.RemoveBody(e)},Box2D.Dynamics.b2World.prototype.CreateJoint=function(e){var t=Box2D.Dynamics.Joints.b2Joint.Create(e);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,this.m_jointCount++,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(!e.collideConnected)for(e=r.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.GetOther(r)==n&&e.contact.FlagForFiltering();return t},Box2D.Dynamics.b2World.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,this.m_jointCount--;if(!t)for(e=r.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);e;e=e.GetNextNode())e.contact.GetOther(r)==n&&e.contact.FlagForFiltering()},Box2D.Dynamics.b2World.prototype.GetControllerList=function(){return this.controllerList},Box2D.Dynamics.b2World.prototype.AddController=function(e){if(null!==e.m_world&&e.m_world!=this)throw Error("Controller can only be a member of one world");return this.controllerList.AddController(e),e.m_world=this,e},Box2D.Dynamics.b2World.prototype.RemoveController=function(e){this.controllerList.RemoveController(e),e.m_world=null,e.Clear()},Box2D.Dynamics.b2World.prototype.CreateController=function(e){return this.AddController(e)},Box2D.Dynamics.b2World.prototype.DestroyController=function(e){this.RemoveController(e)},Box2D.Dynamics.b2World.prototype.SetWarmStarting=function(e){this.m_warmStarting=e},Box2D.Dynamics.b2World.prototype.SetContinuousPhysics=function(e){this.m_continuousPhysics=e},Box2D.Dynamics.b2World.prototype.GetBodyCount=function(){return this.bodyList.GetBodyCount()},Box2D.Dynamics.b2World.prototype.GetJointCount=function(){return this.m_jointCount},Box2D.Dynamics.b2World.prototype.GetContactCount=function(){return this.contactList.GetContactCount()},Box2D.Dynamics.b2World.prototype.SetGravity=function(e){this.m_gravity=e},Box2D.Dynamics.b2World.prototype.GetGravity=function(){return this.m_gravity},Box2D.Dynamics.b2World.prototype.GetGroundBody=function(){return this.m_groundBody},Box2D.Dynamics.b2World.prototype.Step=function(e,t,n){this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_isLocked=!0,this.mainTimeStep.Reset(e,this.m_inv_dt0*e,t,n,this.m_warmStarting),this.m_contactManager.Collide(),0<this.mainTimeStep.dt&&(this.Solve(this.mainTimeStep),this.m_continuousPhysics&&this.SolveTOI(this.mainTimeStep),this.m_inv_dt0=this.mainTimeStep.inv_dt),this.m_isLocked=!1},Box2D.Dynamics.b2World.prototype.ClearForces=function(){for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.dynamicBodies);e;e=e.GetNextNode())e.body.m_force.SetZero(),e.body.m_torque=0},Box2D.Dynamics.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){this.m_debugDraw.Clear();var e=this.m_debugDraw.GetFlags();if(e&Box2D.Dynamics.b2DebugDraw.e_shapeBit)for(var t=Box2D.Dynamics.b2World.s_color_inactive,n=Box2D.Dynamics.b2World.s_color_static,r=Box2D.Dynamics.b2World.s_color_kinematic,i=Box2D.Dynamics.b2World.s_color_dynamic_sleeping,s=Box2D.Dynamics.b2World.s_color_dynamic_awake,o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())for(var u=o.body,a=u.GetFixtureList().GetFirstNode();a;a=a.GetNextNode()){var f=a.fixture,f=f.GetShape();u.IsActive()?u.GetType()==Box2D.Dynamics.b2BodyDef.b2_staticBody?this.DrawShape(f,u.m_xf,n):u.GetType()==Box2D.Dynamics.b2BodyDef.b2_kinematicBody?this.DrawShape(f,u.m_xf,r):u.IsAwake()?this.DrawShape(f,u.m_xf,s):this.DrawShape(f,u.m_xf,i):this.DrawShape(f,u.m_xf,t)}if(e&Box2D.Dynamics.b2DebugDraw.e_jointBit)for(o=this.m_jointList;o;o=o.m_next)this.DrawJoint(o);if(e&Box2D.Dynamics.b2DebugDraw.e_controllerBit)for(o=this.controllerList.GetFirstNode();o;o=o.GetNextNode())o.controller.Draw(this.m_debugDraw);if(e&Box2D.Dynamics.b2DebugDraw.e_pairBit){o=Box2D.Dynamics.b2World.s_pairColor;for(a=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);a;a=a.GetNextNode())t=a.contact.GetFixtureA(),u=a.contact.GetFixtureB(),t=t.GetAABB().GetCenter(),u=u.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(t,u,o),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(u)}if(e&Box2D.Dynamics.b2DebugDraw.e_aabbBit){t=Box2D.Dynamics.b2World.s_aabbColor;for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.activeBodies);o;o=o.GetNextNode()){u=o.body;for(a=u.GetFixtureList().GetFirstNode();a;a=a.GetNextNode())f=a.fixture,u=this.m_contactManager.m_broadPhase.GetFatAABB(f.m_proxy),u=[Box2D.Common.Math.b2Vec2.Get(u.lowerBound.x,u.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(u.upperBound.x,u.lowerBound.y),Box2D.Common.Math.b2Vec2.Get(u.upperBound.x,u.upperBound.y),Box2D.Common.Math.b2Vec2.Get(u.lowerBound.x,u.upperBound.y)],this.m_debugDraw.DrawPolygon(u,4,t),Box2D.Common.Math.b2Vec2.Free(u[0]),Box2D.Common.Math.b2Vec2.Free(u[1]),Box2D.Common.Math.b2Vec2.Free(u[2]),Box2D.Common.Math.b2Vec2.Free(u[3])}}if(e&Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit)for(o=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);o;o=o.GetNextNode())u=o.body,Box2D.Dynamics.b2World.s_xf.R=u.m_xf.R,Box2D.Dynamics.b2World.s_xf.position=u.GetWorldCenter(),this.m_debugDraw.DrawTransform(Box2D.Dynamics.b2World.s_xf)}},Box2D.Dynamics.b2World.prototype.QueryAABB=function(e,t){this.m_contactManager.m_broadPhase.Query(e,t)},Box2D.Dynamics.b2World.prototype.QueryPoint=function(e,t){var n=Box2D.Collision.b2AABB.Get();n.lowerBound.Set(t.x-Box2D.Common.b2Settings.b2_linearSlop,t.y-Box2D.Common.b2Settings.b2_linearSlop),n.upperBound.Set(t.x+Box2D.Common.b2Settings.b2_linearSlop,t.y+Box2D.Common.b2Settings.b2_linearSlop),this.m_contactManager.m_broadPhase.Query(function(n){return n.TestPoint(t)?e(n):!0},n),Box2D.Collision.b2AABB.Free(n)},Box2D.Dynamics.b2World.prototype.RayCast=function(e,t,n){var r=this.m_contactManager.m_broadPhase,i=new Box2D.Collision.b2RayCastOutput,s=new Box2D.Collision.b2RayCastInput(t,n,1);r.RayCast(function(r,s){if(s.RayCast(i,r)){var o=1-i.fraction,o=Box2D.Common.Math.b2Vec2.Get(o*t.x+i.fraction*n.x,o*t.y+i.fraction*n.y),u=e(s,o,i.normal,i.fraction);return Box2D.Common.Math.b2Vec2.Free(o),u}return r.maxFraction},s)},Box2D.Dynamics.b2World.prototype.RayCastOne=function(e,t){var n=null;return this.RayCast(function(e,t,r,i){return n=e,i},e,t),n},Box2D.Dynamics.b2World.prototype.RayCastAll=function(e,t){var n=[];return this.RayCast(function(e){return n.push(e),1},e,t),n},Box2D.Dynamics.b2World.prototype.GetBodyList=function(){return this.bodyList},Box2D.Dynamics.b2World.prototype.GetJointList=function(){return this.m_jointList},Box2D.Dynamics.b2World.prototype.GetContactList=function(){return this.contactList},Box2D.Dynamics.b2World.prototype.IsLocked=function(){return this.m_isLocked},Box2D.Dynamics.b2World.prototype.Solve=function(e){for(var t=this.controllerList.GetFirstNode();t;t=t.GetNextNode())t.controller.Step(e);t=this.island,t.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode())n.body.m_islandFlag=!1;for(var r=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);r;r=r.GetNextNode())r.contact.m_islandFlag=!1;for(n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);n;n=n.GetNextNode())if(r=n.body,!r.m_islandFlag){t.Clear();var i=[];i.push(r);for(r.m_islandFlag=!0;0<i.length;){var s=i.pop();t.AddBody(s),s.IsAwake()||s.SetAwake(!0);if(s.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody){for(r=s.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);r;r=r.GetNextNode()){var o=r.contact;o.m_islandFlag||(t.AddContact(o),o.m_islandFlag=!0,o=o.GetOther(s),o.m_islandFlag||(i.push(o),o.m_islandFlag=!0))}for(r=s.m_jointList;r;r=r.next)!r.joint.m_islandFlag&&r.other.IsActive()&&(t.AddJoint(r.joint),r.joint.m_islandFlag=!0,r.other.m_islandFlag||(i.push(r.other),r.other.m_islandFlag=!0))}}t.Solve(e,this.m_gravity,this.m_allowSleep)}for(n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.nonStaticActiveAwakeBodies);n;n=n.GetNextNode())n.body.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},Box2D.Dynamics.b2World.prototype.SolveTOI=function(e){var t=this.island;t.Reset(this.m_contactManager.m_contactListener,this.m_contactSolver);for(var n=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.allBodies);n;n=n.GetNextNode()){var r=n.body;r.m_islandFlag=!1,r.m_sweep.t0=0}for(var i=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);i;i=i.GetNextNode())i.contact.m_islandFlag=!1,i.contact.m_toi=null;for(n=this.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(;;){var n=this._SolveTOI2(e),s=n.minContact,n=n.minTOI;if(null===s||Box2D.Dynamics.b2World.MAX_TOI<n)break;i=s.m_fixtureA.GetBody(),r=s.m_fixtureB.GetBody(),Box2D.Dynamics.b2World.s_backupA.Set(i.m_sweep),Box2D.Dynamics.b2World.s_backupB.Set(r.m_sweep),i.Advance(n),r.Advance(n),s.Update(this.m_contactManager.m_contactListener),s.m_toi=null;if(s.IsSensor()||!s.IsEnabled())i.m_sweep.Set(Box2D.Dynamics.b2World.s_backupA),r.m_sweep.Set(Box2D.Dynamics.b2World.s_backupB),i.SynchronizeTransform(),r.SynchronizeTransform();else if(s.IsTouching()){i.GetType()!=Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&(i=r),t.Clear(),s=new goog.structs.Queue,s.enqueue(i);for(i.m_islandFlag=!0;0<s.size;)if(r=s.dequeue(),t.AddBody(r),r.IsAwake()||r.SetAwake(!0),r.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){for(i=r.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledTouchingContacts);i&&t.m_contactCount!=Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland;i=i.GetNextNode()){var o=i.contact;o.m_islandFlag||(t.AddContact(o),o.m_islandFlag=!0,o=o.GetOther(r),o.m_islandFlag||(o.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(o.Advance(n),o.SetAwake(!0),s.enqueue(o)),o.m_islandFlag=!0))}for(r=r.m_jointList;r;r=r.next)t.m_jointCount!=Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland&&!r.joint.m_islandFlag&&r.other.IsActive()&&(t.AddJoint(r.joint),r.joint.m_islandFlag=!0,r.other.m_islandFlag||(r.other.GetType()!=Box2D.Dynamics.b2BodyDef.b2_staticBody&&(r.other.Advance(n),r.other.SetAwake(!0),s.enqueue(r.other)),r.other.m_islandFlag=!0))}this.islandTimeStep.Reset((1-n)*e.dt,0,e.velocityIterations,e.positionIterations,!1),t.SolveTOI(this.islandTimeStep);for(n=0;n<t.m_bodies.length;n++)if(t.m_bodies[n].m_islandFlag=!1,t.m_bodies[n].IsAwake()&&t.m_bodies[n].GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody){t.m_bodies[n].SynchronizeFixtures();for(i=t.m_bodies[n].contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.allContacts);i;i=i.GetNextNode())i.contact.m_toi=null}for(n=0;n<t.m_contactCount;n++)t.m_contacts[n].m_islandFlag=!1,t.m_contacts[n].m_toi=null;for(n=0;n<t.m_jointCount;n++)t.m_joints[n].m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},Box2D.Dynamics.b2World.prototype._SolveTOI2=function(e){for(var t=null,n=1,r=this.contactList.GetFirstNode(Box2D.Dynamics.Contacts.b2ContactList.TYPES.nonSensorEnabledContinuousContacts);r;r=r.GetNextNode()){var i=r.contact;if(!this._SolveTOI2SkipContact(e,i)){var s=1;if(null!=i.m_toi)s=i.m_toi;else{if(i.IsTouching())s=1;else{var s=i.m_fixtureA.GetBody(),o=i.m_fixtureB.GetBody(),u=s.m_sweep.t0;s.m_sweep.t0<o.m_sweep.t0?(u=o.m_sweep.t0,s.m_sweep.Advance(u)):o.m_sweep.t0<s.m_sweep.t0&&(u=s.m_sweep.t0,o.m_sweep.Advance(u)),s=i.ComputeTOI(s.m_sweep,o.m_sweep),Box2D.Common.b2Settings.b2Assert(0<=s&&1>=s),0<s&&1>s&&(s=(1-s)*u+s)}i.m_toi=s}Number.MIN_VALUE<s&&s<n&&(t=i,n=s)}}return{minContact:t,minTOI:n}},Box2D.Dynamics.b2World.prototype._SolveTOI2SkipContact=function(e,t){var n=t.m_fixtureA.GetBody(),r=t.m_fixtureB.GetBody();return n.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&!!n.IsAwake()||r.GetType()==Box2D.Dynamics.b2BodyDef.b2_dynamicBody&&!!r.IsAwake()?!1:!0},Box2D.Dynamics.b2World.prototype.DrawJoint=function(e){if(e instanceof Box2D.Dynamics.Joints.b2DistanceJoint||e instanceof Box2D.Dynamics.Joints.b2MouseJoint){var t=e.GetAnchorA(),n=e.GetAnchorB();this.m_debugDraw.DrawSegment(t,n,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(n)}else if(e instanceof Box2D.Dynamics.Joints.b2PulleyJoint){var t=e.GetAnchorA(),n=e.GetAnchorB(),r=e.GetGroundAnchorA(),e=e.GetGroundAnchorB();this.m_debugDraw.DrawSegment(r,t,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(e,n,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(r,e,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(n),Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(e)}else t=e.GetAnchorA(),n=e.GetAnchorB(),e.GetBodyA()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e.GetBodyA().m_xf.position,t,Box2D.Dynamics.b2World.s_jointColor),this.m_debugDraw.DrawSegment(t,n,Box2D.Dynamics.b2World.s_jointColor),e.GetBodyB()!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e.GetBodyB().m_xf.position,n,Box2D.Dynamics.b2World.s_jointColor),Box2D.Common.Math.b2Vec2.Free(t),Box2D.Common.Math.b2Vec2.Free(n)},Box2D.Dynamics.b2World.prototype.DrawShape=function(e,t,n){if(e instanceof Box2D.Collision.Shapes.b2CircleShape){var r=Box2D.Common.Math.b2Math.MulX(t,e.m_p);this.m_debugDraw.DrawSolidCircle(r,e.m_radius,t.R.col1,n),Box2D.Common.Math.b2Vec2.Free(r)}else if(e instanceof Box2D.Collision.Shapes.b2PolygonShape){for(var r=0,i=e.GetVertexCount(),e=e.GetVertices(),s=[],r=0;r<i;r++)s[r]=Box2D.Common.Math.b2Math.MulX(t,e[r]);this.m_debugDraw.DrawSolidPolygon(s,i,n);for(r=0;r<i;r++)Box2D.Common.Math.b2Vec2.Free(s[r])}else e instanceof Box2D.Collision.Shapes.b2EdgeShape&&(r=Box2D.Common.Math.b2Math.MulX(t,e.GetVertex1()),t=Box2D.Common.Math.b2Math.MulX(t,e.GetVertex2()),this.m_debugDraw.DrawSegment(r,t,n),Box2D.Common.Math.b2Vec2.Free(r),Box2D.Common.Math.b2Vec2.Free(t))},Box2D.Dynamics.b2World.s_xf=new Box2D.Common.Math.b2Transform,Box2D.Dynamics.b2World.s_backupA=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_backupB=new Box2D.Common.Math.b2Sweep,Box2D.Dynamics.b2World.s_jointColor=new Box2D.Common.b2Color(.5,.8,.8),Box2D.Dynamics.b2World.s_color_inactive=new Box2D.Common.b2Color(.5,.5,.3),Box2D.Dynamics.b2World.s_color_static=new Box2D.Common.b2Color(.3,.3,.3),Box2D.Dynamics.b2World.s_color_kinematic=new Box2D.Common.b2Color(.5,.5,.9),Box2D.Dynamics.b2World.s_color_dynamic_sleeping=new Box2D.Common.b2Color(.6,.6,.6),Box2D.Dynamics.b2World.s_color_dynamic_awake=new Box2D.Common.b2Color(.6,.9,.6),Box2D.Dynamics.b2World.s_pairColor=new Box2D.Common.b2Color(.3,.9,.9),Box2D.Dynamics.b2World.s_aabbColor=new Box2D.Common.b2Color(0,0,.8),Box2D.generateCallback=function(e,t){return function(){t.apply(e,arguments)}},Box2D.Dynamics.Controllers.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.T=new Box2D.Common.Math.b2Mat22,this.maxTimestep=0},goog.inherits(Box2D.Dynamics.Controllers.b2TensorDampingController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.SetAxisAligned=function(e,t){this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=0<e||0<t?1/Math.max(e,t):0},Box2D.Dynamics.Controllers.b2TensorDampingController.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&0<this.maxTimestep&&(e=this.maxTimestep);for(var t=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);t;t=t.GetNextNode()){var n=t.body,r=n.GetLocalVector(n.GetLinearVelocity()),i=Box2D.Common.Math.b2Math.MulMV(this.T,r);Box2D.Common.Math.b2Vec2.Free(r),r=n.GetWorldVector(i),Box2D.Common.Math.b2Vec2.Free(i),i=Box2D.Common.Math.b2Vec2.Get(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e),Box2D.Common.Math.b2Vec2.Free(r),n.SetLinearVelocity(i),Box2D.Common.Math.b2Vec2.Free(i)}}},Box2D.Collision.Shapes.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.Dynamics.Controllers.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.call(this),this.F=Box2D.Common.Math.b2Vec2.Get(0,0)},goog.inherits(Box2D.Dynamics.Controllers.b2ConstantForceController,Box2D.Dynamics.Controllers.b2Controller),Box2D.Dynamics.Controllers.b2ConstantForceController.prototype.Step=function(){for(var e=this.bodyList.GetFirstNode(Box2D.Dynamics.b2BodyList.TYPES.awakeBodies);e;e=e.GetNextNode()){var t=e.body;t.ApplyForce(this.F,t.GetWorldCenter())}},Box2D.Dynamics.Joints.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.call(this),this.groundAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.groundAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorA=Box2D.Common.Math.b2Vec2.Get(0,0),this.localAnchorB=Box2D.Common.Math.b2Vec2.Get(0,0),this.type=Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},goog.inherits(Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2JointDef),Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Initialize=function(e,t,n,r,i,s,o){void 0===o&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(o-Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength)/this.ratio},Box2D.Dynamics.Joints.b2PulleyJointDef.prototype.Create=function(){return new Box2D.Dynamics.Joints.b2PulleyJoint(this)},typeof module!="undefined"&&(module.exports=Box2D),define("playcraft/ext/box2dweb.2.1a-pc",function(){}),pc.Hashtable=gamecore.Hashtable,pc.Base=gamecore.Base("pc.Base",{},{}),pc.Pool=gamecore.Pool.extend("pc.Pool",{},{}),pc.Pooled=gamecore.Pooled.extend("pc.Pooled",{},{}),pc.LinkedList=gamecore.LinkedList.extend("pc.LinkedList",{},{}),pc.LinkedListNode=gamecore.LinkedListNode.extend("pc.LinkedListNode",{},{}),pc.HashList=gamecore.HashList.extend("pc.HashList",{},{}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be fBound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),define("playcraft/boot",function(){}),pc.Input=pc.Base("pc.Input",{_eventPos:null,getEventPosition:function(e,t){this._eventPos==null&&(this._eventPos=pc.Point.create(0,0));var n=t;return pc.Tools.isValid(t)||(n=this._eventPos),e.pageX||e.pageY?(n.x=e.pageX,n.y=e.pageY):(n.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),pc.Tools.isValid(e.alpha)&&(n.x=e.alpha,n.y=e.gamma),n}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:!1,mouseRightButtonDown:!1,deviceOrientation:null,init:function(){this._super(),this.stateBindings=new pc.Hashtable,this.states=new pc.Hashtable,this.actionBindings=new pc.Hashtable,this.mousePos=pc.Point.create(0,0),this.deviceOrientation=pc.Point.create(0,0)},bindState:function(e,t,n,r){if(e.uniqueId==null)throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function";if(!pc.InputType.getCode(n))throw"Unknown input code "+n+" - see pc.InputType for a list of input names";n=n.toUpperCase();var i={stateName:t,object:e,input:n,state:{on:!1,event:null},uiTarget:r},s=this.stateBindings.get(n);s==null?this.stateBindings.put(n,[i]):s.push(i),this.states.put(e.uniqueId+"\\\\"+t,{on:!1,event:null}),pc.InputType.isPositional(pc.InputType.getCode(n))&&this._positionals.push(i)},clearStates:function(e){var t=this.stateBindings.entries();for(var n=0;n<t.length;n++){var r=t[n];for(var i=0;i<r.length;i++){var s=r[i];if(s.object==e){var o=this.states.get(next.object.uniqueId+"\\\\"+next.stateName);o.on=!1,o.event=null,pc.InputType.isPositional(s.input)&&pc.tools.arrayRemove(this._positionals,s)}}}},isInputState:function(e,t){var n=this.states.get(e.uniqueId+"\\\\"+t);if(n==null)throw"Ooops, unknown state "+t;return n.on},getInputState:function(e,t){return this.states.get(e.uniqueId+"\\\\"+t)},bindAction:function(e,t,n,r){n=n.toUpperCase();var i=this.actionBindings.get(n);i==null?this.actionBindings.put(n,[{actionName:t,object:e,input:n,uiTarget:r}]):i.push({actionName:t,input:n,object:e,uiTarget:r})},fireAction:function(e,t){var n=this.actionBindings.get(pc.InputType.getName(e));if(n==null)return!1;for(var r=0;r<n.length;r++){var i=n[r],s=n[r].object;if(!s.isActive||s.isActive())if(pc.InputType.isPositional(e)){var o=this.Class.getEventPosition(t);if(pc.InputType.isDeviceOrientation(e))return s.onAction(i.actionName,t,o,i.uiTarget),!0;var u=null;pc.valid(i.uiTarget)?u=i.uiTarget.getScreenRect():u=s.getScreenRect?s.getScreenRect():null;if(u&&u.containsPoint(o)){var a=s.onAction(i.actionName,t,o,i.uiTarget);if(pc.valid(a)&&!a)break}}else{var f=s.onAction(i.actionName);if(pc.valid(f)&&!f)break}}return!0},_onReady:function(){pc.device.canvas.addEventListener("touchstart",this._touchStart.bind(this),!0),pc.device.canvas.addEventListener("touchend",this._touchEnd.bind(this),!0),pc.device.canvas.addEventListener("touchmove",this._touchMove.bind(this),!0),pc.device.canvas.addEventListener("mouseup",this._mouseUp.bind(this),!0),pc.device.canvas.addEventListener("mousedown",this._mouseDown.bind(this),!0),pc.device.canvas.addEventListener("mousemove",this._mouseMove.bind(this),!0),pc.device.canvas.addEventListener("mousewheel",this._mouseWheel.bind(this),!0),pc.device.canvas.addEventListener("contextmenu",this._contextMenu.bind(this),!0),window.addEventListener("keydown",this._keyDown.bind(this),!0),window.addEventListener("keyup",this._keyUp.bind(this),!0),window.addEventListener("deviceorientation",this._deviceOrientation.bind(this),!0)},_positionals:[],_checkPositional:function(e){for(var t=0;t<this._positionals.length;t++){var n=this._positionals[t];if(e.type=="mousemove"&&pc.InputType.isTouch(pc.InputType.getCode(n.input)))continue;if(e.type=="touchmove"&&!pc.InputType.isTouch(pc.InputType.getCode(n.input)))continue;if(pc.InputType.getCode(n.input)==pc.InputType.MOUSE_BUTTON_LEFT_UP||pc.InputType.getCode(n.input)==pc.InputType.MOUSE_BUTTON_LEFT_DOWN||pc.InputType.getCode(n.input)==pc.InputType.MOUSE_BUTTON_RIGHT_UP||pc.InputType.getCode(n.input)==pc.InputType.MOUSE_BUTTON_RIGHT_DOWN)continue;var r=null;pc.valid(n.uiTarget)?r=n.uiTarget.getScreenRect():r=n.object.getScreenRect?n.object.getScreenRect():null;if(r)if(!r.containsPoint(this.Class.getEventPosition(e))){var i=this.states.get(n.object.uniqueId+"\\\\"+n.stateName);i.on=!1,i.event=e}else{var s=this.states.get(n.object.uniqueId+"\\\\"+n.stateName);s.on=!0,s.event=e}}},_changeState:function(e,t,n){var r=pc.InputType.getName(e);if(r==null)return this.log("Unknown keycode = "+e),!1;var i=this.stateBindings.get(r);if(i==null)return!1;for(var s=0;s<i.length;s++){var o=i[s];if(!o.object.isActive||o.object.isActive())if(pc.InputType.isPositional(e)){var u=this.Class.getEventPosition(n),a=null;pc.valid(o.uiTarget)?a=o.uiTarget.getScreenRect():a=o.object.getScreenRect?o.object.getScreenRect():null;if(a){if(a.containsPoint(u)){var f=this.states.get(o.object.uniqueId+"\\\\"+o.stateName);f.on=t,f.event=n}}else f=this.states.get(o.object.uniqueId+"\\\\"+o.stateName),f.on=t,f.event=n}else f=this.states.get(o.object.uniqueId+"\\\\"+o.stateName),f.on=t,f.event=n}return!0},_lastMouseMove:null,_lastDeviceOrientation:null,process:function(){this._lastMouseMove&&(this._checkPositional(this._lastMouseMove),this.fireAction(pc.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null),this._lastDeviceOrientation&&(this._changeState(pc.InputType.DEVICE_ORIENTATION,!0,this._lastDeviceOrientation),this.fireAction(pc.InputType.DEVICE_ORIENTATION,this._lastDeviceOrientation),this.Class.getEventPosition(this._lastDeviceOrientation,this.deviceOrientation),this._lastDeviceOrientation=null)},_keyDown:function(e){this._changeState(e.keyCode,!0,e)&&e.preventDefault(),this.fireAction(e.keyCode,e)&&e.preventDefault()},_keyUp:function(e){this._changeState(e.keyCode,!1,e)&&e.preventDefault()},_deviceOrientation:function(e){this._lastDeviceOrientation=e,e.preventDefault()},_touchStart:function(e){for(var t=0,n=e.touches.length;t<n;t++)this._changeState(pc.InputType.TOUCH,!0,e.touches[t]),this.fireAction(pc.InputType.TOUCH,e.touches[t]);e.preventDefault()},_touchEnd:function(e){for(var t=0,n=e.changedTouches.length;t<n;t++)this._checkPositional(e.touches[t]),this._changeState(pc.InputType.TOUCH_END,!1,e.changedTouches[t]),this.fireAction(pc.InputType.TOUCH_END,e.changedTouches[t]);e.preventDefault()},_touchMove:function(e){for(var t=0,n=e.touches.length;t<n;t++)this._checkPositional(e.touches[t]),this._changeState(pc.InputType.TOUCH_MOVE,!1,e.changedTouches[t]),this.fireAction(pc.InputType.TOUCH_MOVE,e.touches[t]);e.preventDefault()},_mouseUp:function(e){e.button==0||e.button==1?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!1,e),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!0,e),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_UP,e),this.mouseLeftButtonDown=!1):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!1,e),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,e),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,e),this.mouseRightButtonDown=!1),e.preventDefault()},_mouseDown:function(e){e.button==0||e.button==1?(this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,!0,e),this._changeState(pc.InputType.MOUSE_BUTTON_LEFT_UP,!1,e),this.fireAction(pc.InputType.MOUSE_BUTTON_LEFT_DOWN,e),this.mouseLeftButtonDown=!0):(this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,!0,e),this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!1,e),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_DOWN,e),this.mouseRightButtonDown=!0),e.preventDefault()},_mouseMove:function(e){this._lastMouseMove=e,e.preventDefault()},_contextMenu:function(e){this._changeState(pc.InputType.MOUSE_BUTTON_RIGHT_UP,!0,e),this.fireAction(pc.InputType.MOUSE_BUTTON_RIGHT_UP,e)},_mouseWheel:function(e){e.wheel>0?this.fireAction(pc.InputType.MOUSE_WHEEL_UP,e):this.fireAction(pc.InputType.MOUSE_WHEEL_DOWN,e),e.preventDefault()}}),pc.InputType=pc.Base.extend("pc.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1e3,MOUSE_MOVE:1100,MOUSE_BUTTON_LEFT_UP:1110,MOUSE_BUTTON_LEFT_DOWN:1111,MOUSE_BUTTON_RIGHT_UP:1120,MOUSE_BUTTON_RIGHT_DOWN:1121,MOUSE_WHEEL_UP:1130,MOUSE_WHEEL_DOWN:1131,TOUCH:1e3,TOUCH_MOVE:1001,TOUCH_END:1002,DEVICE_ORIENTATION:1020,init:function(){this.nameToCode=new pc.Hashtable,this.codeToName=new pc.Hashtable,this.addInput(8,"BACKSPACE"),this.addInput(9,"TAB"),this.addInput(13,"ENTER"),this.addInput(16,"SHIFT"),this.addInput(17,"CTRL"),this.addInput(18,"ALT"),this.addInput(19,"PAUSE"),this.addInput(20,"CAPS"),this.addInput(27,"ESC"),this.addInput(32,"SPACE"),this.addInput(33,"PAGE_UP"),this.addInput(34,"PAGE_DOWN"),this.addInput(35,"END"),this.addInput(36,"HOME"),this.addInput(37,"LEFT"),this.addInput(38,"UP"),this.addInput(39,"RIGHT"),this.addInput(40,"DOWN"),this.addInput(45,"INSERT"),this.addInput(46,"DELETE");for(var e=48;e<91;e++){var t=String.fromCharCode(e);this.addInput(e,t)}this.addInput(91,"WINDOW_LEFT"),this.addInput(92,"WINDOW_RIGHT"),this.addInput(93,"SELECT"),this.addInput(96,"NUM_0"),this.addInput(97,"NUM_1"),this.addInput(98,"NUM_2"),this.addInput(99,"NUM_3"),this.addInput(100,"NUM_4"),this.addInput(101,"NUM_5"),this.addInput(102,"NUM_6"),this.addInput(103,"NUM_7"),this.addInput(104,"NUM_8"),this.addInput(105,"NUM_9"),this.addInput(106,"*"),this.addInput(107,"+"),this.addInput(109,"-"),this.addInput(110,"."),this.addInput(111,"/"),this.addInput(112,"F1"),this.addInput(113,"F2"),this.addInput(114,"F3"),this.addInput(115,"F4"),this.addInput(116,"F5"),this.addInput(117,"F6"),this.addInput(118,"F7"),this.addInput(119,"F8"),this.addInput(120,"F9"),this.addInput(121,"F10"),this.addInput(122,"F11"),this.addInput(123,"F12"),this.addInput(144,"NUM_LOCK"),this.addInput(145,"SCROLL_LOCK"),this.addInput(186,";"),this.addInput(187,"="),this.addInput(188,","),this.addInput(189,"-"),this.addInput(190,"."),this.addInput(191,"/"),this.addInput(192,"`"),this.addInput(219,"["),this.addInput(220,"\\"),this.addInput(221,"]"),this.addInput(222,"'"),this.addInput(this.DEVICE_ORIENTATION,"DEVICE_ORIENTATION"),this.addInput(this.TOUCH,"TOUCH"),this.addInput(this.TOUCH_MOVE,"TOUCH_MOVE"),this.addInput(this.TOUCH_END,"TOUCH_END"),this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN"),this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP"),this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN"),this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP"),this.nameToCode.put("MOUSE_LEFT_BUTTON",this.MOUSE_BUTTON_LEFT_UP),this.nameToCode.put("MOUSE_RIGHT_BUTTON",this.MOUSE_BUTTON_RIGHT_UP),this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP"),this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN"),this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE")},isDeviceOrientation:function(e){return e==this.DEVICE_ORIENTATION},isTouch:function(e){return e==this.TOUCH},isPositional:function(e){return e>=this.POSITIONAL_EVENT_START},addInput:function(e,t){this.codeToName.put(e,t),this.nameToCode.put(t,e)},getName:function(e){return this.codeToName.get(e)},getCode:function(e){return this.nameToCode.get(e)}},{}),define("playcraft/input",function(){}),pc.Hashmap=pc.Base.extend("pc.Hashmap",{},{init:function(){this._super(),this.items={}},length:0,items:{},put:function(e,t){if(!pc.valid(e))throw"invaid key";this.items[e]=t,this.length++},get:function(e){return this.items[e]},hasKey:function(e){return this.items.hasOwnProperty(e)},remove:function(e){this.hasKey(e)&&(this.length--,delete this.items[e])},keys:function(){var e=[];for(var t in this.items)e.push(t);return e},values:function(){var e=[];for(var t in this.items)e.push(this.items[t]);return e},clear:function(){this.items={},this.length=0}}),define("playcraft/hashmap",function(){}),pc.Tools=pc.Base.extend("pc.Tools",{checked:function(e,t){return pc.valid(e)?e:t},isValid:function(e){return e!=null&&typeof e!="undefined"},assert:function(e,t){if(!e)throw t},arrayRemove:function(e,t){for(var n=e.length-1;n>=0;n--)e[n]==t&&e.splice(n,1)},arrayExclusiveAdd:function(e,t){e.indexOf(t)==-1&&e.push(t)},xmlToJson:function(e,t){var n={toObj:function(e){var t={};if(e.nodeType==1){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)t[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString();if(e.firstChild){var i=0,s=0,o=!1;for(var u=e.firstChild;u;u=u.nextSibling)u.nodeType==1?o=!0:u.nodeType==3&&u.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:u.nodeType==4&&s++;if(o)if(i<2&&s<2){n.removeWhite(e);for(var u=e.firstChild;u;u=u.nextSibling)u.nodeType==3?t["#text"]=n.escape(u.nodeValue):u.nodeType==4?t["#cdata"]=n.escape(u.nodeValue):t[u.nodeName]?t[u.nodeName]instanceof Array?t[u.nodeName][t[u.nodeName].length]=n.toObj(u):t[u.nodeName]=[t[u.nodeName],n.toObj(u)]:t[u.nodeName]=n.toObj(u)}else e.attributes.length?t["#text"]=n.escape(n.innerXml(e)):t=n.escape(n.innerXml(e));else if(i)e.attributes.length?t["#text"]=n.escape(n.innerXml(e)):t=n.escape(n.innerXml(e));else if(s)if(s>1)t=n.escape(n.innerXml(e));else for(var u=e.firstChild;u;u=u.nextSibling)t["#cdata"]=n.escape(u.nodeValue)}!e.attributes.length&&!e.firstChild&&(t=null)}else e.nodeType==9?t=n.toObj(e.documentElement):alert("unhandled node type: "+e.nodeType);return t},toJson:function(e,t,r){var i=t?'"'+t+'"':"";if(e instanceof Array){for(var s=0,o=e.length;s<o;s++)e[s]=n.toJson(e[s],"",r+"	");i+=(t?":[":"[")+(e.length>1?"\n"+r+"	"+e.join(",\n"+r+"	")+"\n"+r:e.join(""))+"]"}else if(e==null)i+=(t&&":")+"null";else if(typeof e=="object"){var u=[];for(var a in e)u[u.length]=n.toJson(e[a],a,r+"	");i+=(t?":{":"{")+(u.length>1?"\n"+r+"	"+u.join(",\n"+r+"	")+"\n"+r:u.join(""))+"}"}else typeof e=="string"?i+=(t&&":")+'"'+e.toString()+'"':i+=(t&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else{var n=function(e){var t="";if(e.nodeType==1){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=n(i);t+="</"+e.nodeName+">"}else t+="/>"}else e.nodeType==3?t+=e.nodeValue:e.nodeType==4&&(t+="<![CDATA["+e.nodeValue+"]]>");return t};for(var r=e.firstChild;r;r=r.nextSibling)t+=n(r)}return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var t=e.firstChild;t;)if(t.nodeType==3)if(!t.nodeValue.match(/[^ \f\n\r\t\v]/)){var r=t.nextSibling;e.removeChild(t),t=r}else t=t.nextSibling;else t.nodeType==1?(n.removeWhite(t),t=t.nextSibling):t=t.nextSibling;return e}};e.nodeType==9&&(e=e.documentElement);var r=n.toJson(n.toObj(n.removeWhite(e)),e.nodeName,"	");return"{\n"+t+(t?r.replace(/\t/g,t):r.replace(/\t|\n/g,""))+"\n}"}},{}),pc.tools=new pc.Tools,pc.valid=pc.Tools.isValid,pc.checked=pc.Tools.checked,pc.assert=pc.Tools.assert,pc.Base64=pc.Base.extend("pc.Base64",{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="",n,r,i,s,o,u,a,f=0;e=pc.Base64._utf8_encode(e);while(f<e.length)n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=e.charCodeAt(f++),s=n>>2,o=(n&3)<<4|r>>4,u=(r&15)<<2|i>>6,a=i&63,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a);return t},decode:function(e){var t=[],n,r,i,s,o,u,a,f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length)s=this._keyStr.indexOf(e.charAt(f++)),o=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),a=this._keyStr.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(o&15)<<4|u>>2,i=(u&3)<<6|a,t.push(String.fromCharCode(n)),u!=64&&t.push(String.fromCharCode(r)),a!=64&&t.push(String.fromCharCode(i));return t.join("")},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},_utf8_decode:function(e){var t="",n=0,r=c1=c2=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|c2&63),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63),n+=3);return t}},{}),window.btoa||(window.btoa=pc.Base64.encode),window.atob||(window.atob=pc.Base64.decode),define("playcraft/tools",function(){}),pc.Color=pc.Pooled.extend("pc.Color",{create:function(e){var t=this._super();return t.config(e),t}},{rgb:[],color:null,init:function(e){e!=undefined&&this.config(e)},config:function(e){if(Array.isArray(e))this.rgb=e;else{if(e.charAt(0)!=="#")throw"Invalid color: use either array [r,g,b] or '#RRGGBB'";this.rgb[0]=parseInt(e.substring(1,3),16),this.rgb[1]=parseInt(e.substring(3,5),16),this.rgb[2]=parseInt(e.substring(5,7),16)}this._updateColorCache()},set:function(e){this.config(e)},setRed:function(e){this.rgb[0]=pc.Math.limit(e,0,255),this._updateColorCache()},addRed:function(e){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],e,0,255),this._updateColorCache()},subRed:function(e){this.rgb[0]=pc.Math.limitAdd(this.rgb[0],-e,0,255),this._updateColorCache()},setGreen:function(e){this.rgb[1]=pc.Math.limit(e,0,255),this._updateColorCache()},addGreen:function(e){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],e,0,255),this._updateColorCache()},subGreen:function(e){this.rgb[1]=pc.Math.limitAdd(this.rgb[1],-e,0,255),this._updateColorCache()},setBlue:function(e){this.rgb[2]=pc.Math.limit(e,0,255),this._updateColorCache()},addBlue:function(e){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],e,0,255),this._updateColorCache()},subBlue:function(e){this.rgb[2]=pc.Math.limitAdd(this.rgb[2],-e,0,255),this._updateColorCache()},darken:function(e){this.subRed(e),this.subGreen(e),this.subBlue(e)},lighten:function(e){this.addRed(e),this.addGreen(e),this.addBlue(e)},_updateColorCache:function(){this.color="rgb("+this.rgb[0]+","+this.rgb[1]+","+this.rgb[2]+")"}}),define("playcraft/color",function(){}),pc.DebugPanel=pc.Base("pc.DebugPanel",{},{x:0,y:0,panelHeight:0,panelWidth:0,canvas:null,ctx:null,statusText:null,active:!1,timeGraph:null,memGraph:null,entityGraph:null,poolGraph:null,currentMem:0,lastMem:0,init:function(){this._super()},onReady:function(){this.attach("pcDebug")},attach:function(e){this.canvas=document.getElementById(e);if(this.canvas==null){this.warn('Showing debug requires a div with an id of "debug" to be added to your dom.'),pc.device.showDebug=!1;return}this.panelElement=this.canvas.parentNode,this.ctx=this.canvas.getContext("2d"),this.onResize();var t=4;this.timeGraph=new pc.CanvasLineGraph(this.ctx,"Performance","",10,[{name:"process (ms)",color:"#f55"},{name:"render (ms)",color:"#5f5"}],10,10,this.panelWidth/t-10,this.panelHeight-20),typeof console.memory=="undefined"||console.memory.totalJSHeapSize==0?this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","Memory profiling not available",0,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/t+10,10,this.panelWidth/t-10,this.panelHeight-20):this.memGraph=new pc.CanvasLineGraph(this.ctx,"Memory","",console.memory.totalJSHeapSize/1024/1024*1.2,[{name:"mem used (mb)",color:"#55f"}],this.panelWidth/t+10,10,this.panelWidth/t-10,this.panelHeight-20),this.poolGraph=new pc.CanvasLineGraph(this.ctx,"Pool Size","",100,[{name:"pooled",color:"#5b1654"}],this.panelWidth-this.panelWidth/t*2+10,10,this.panelWidth/t-20,this.panelHeight-20),this.entityGraph=new pc.CanvasLineGraph(this.ctx,"Entities","",100,[{name:"drawn (total)",color:"#f9f007"}],this.panelWidth-this.panelWidth/t+10,10,this.panelWidth/t-20,this.panelHeight-20),this.active=!0},onResize:function(){if(this.canvas==null)return;this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight,this.panelWidth=this.panelElement.offsetWidth,this.panelHeight=this.panelElement.offsetHeight,this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.panelWidth,this.panelHeight);var e=4;this.timeGraph!=null&&this.timeGraph.resize(10,10,this.panelWidth/e-10,this.panelHeight-20),this.memGraph!=null&&this.memGraph.resize(this.panelWidth/e+10,10,this.panelWidth/e-10,this.panelHeight-20),this.poolGraph!=null&&this.poolGraph.resize(this.panelWidth-this.panelWidth/e*2+20,10,this.panelWidth/e-20,this.panelHeight-20),this.entityGraph!=null&&this.entityGraph.resize(this.panelWidth-this.panelWidth/e+10,10,this.panelWidth/e-20,this.panelHeight-20)},_timeSince:0,update:function(e){if(!this.active)return;this._timeSince+=e,this._timeSince>30&&(this._timeSince=0,this.timeGraph!=null&&this.timeGraph.addLine2(pc.device.lastProcessMS,pc.device.lastDrawMS),this.entityGraph!=null&&this.entityGraph.addLine1(pc.device.elementsDrawn),this.memGraph!=null&&typeof console.memory!="undefined"&&console.memory.totalJSHeapSize!=0&&this.memGraph.addLine1(window.performance.memory.usedJSHeapSize/1024/1024),this.poolGraph!=null&&this.poolGraph.addLine1(gamecore.Pool.totalPooled))},draw:function(){if(!this.active)return;this.timeGraph!=null&&this.timeGraph.draw(),this.entityGraph!=null&&this.entityGraph.draw(),this.memGraph!=null&&this.memGraph.draw(),this.poolGraph!=null&&this.poolGraph.draw()}}),pc.CanvasLineGraph=pc.Base.extend("pc.CanvasLineGraph",{height:0,width:0,ctx:null,data:null,maxY:0,x:0,y:0,labels:null,graphName:null,bgCanvas:null,graphCanvas:null,message:null,cursor:0,init:function(e,t,n,r,i,s,o,u,a){this._super(),this.ctx=e,this.message=n,this.graphName=t,this.maxY=r,this.x=s,this.y=o,this.width=u,this.height=a,this.labels=i,this.graphX=this.x+this.graphLeftMargin,this.graphY=this.y+20,this.cursor=0,this.graphCanvas=document.createElement("canvas"),this.bgCanvas=document.createElement("canvas"),this.resize(s,o,u,a)},resize:function(e,t,n,r){this.width>n&&(this.data=this.data.slice(this.width-n,n)),this.width=n,this.height=r,this.x=e,this.y=t,this.graphHeight=this.height-40,this.graphWidth=this.width-(this.graphLeftMargin+this.graphRightMargin),this.graphX=this.graphLeftMargin,this.graphY=20,this.bgCanvas.width=this.width,this.bgCanvas.height=this.height,this.graphCanvas.width=Math.max(this.graphWidth,1),this.graphCanvas.height=Math.max(this.graphHeight,1),this.resizeDataArray(this.graphWidth,this.labels.length),this.renderBackground()},resizeDataArray:function(e,t){var n=0;if(e<=0)return;if(this.data==null)this.data=[];else{if(!(e>this.data.length)){this.data.splice(0,e-this.data.length),this.cursor>this.data.length-1&&(this.cursor=this.data.length-1);return}n=this.data.length-1}for(var r=n;r<e;r++)this.data.push(new Array(t))},_totalAdded:0,linesSinceLastPeak:0,lastPeak:0,_total:0,addLine2:function(e,t){if(!this.data)return;this._totalAdded++,this._total=e+t,this.checkMaxRange(this._total),this.data[this.cursor][0]=e,this.data[this.cursor][1]=t,this._updateGraph(this._total)},addLine1:function(e){if(!this.data)return;this._totalAdded++,this._total=e,this.checkMaxRange(this._total),this.data[this.cursor][0]=e,this._updateGraph(e)},checkMaxRange:function(e){e>this.maxY&&(this.maxY=e*1.4,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.renderBackground(),this.renderGraph(!0))},_updateGraph:function(e){this.linesSinceLastPeak++,this.linesSinceLastPeak>this.width*1.5&&(this.linesSinceLastPeak++,this.maxY=e*1.4,this.maxY<this.height/this.gridLineInc&&(this.maxY=this.height/this.gridLineInc),this.lastPeak=e*1.4,this.renderBackground(),this.linesSinceLastPeak=0),e>this.lastPeak&&(this.lastPeak=e*1.4),this.cursor++,this.cursor>this.data.length-1&&(this.cursor=0)},margin:20,linePixelSize:0,yline:0,unit:0,gridY:0,i:0,n:0,graphLeftMargin:30,graphRightMargin:15,graphHeight:0,graphWidth:0,graphX:0,graphY:0,gridLineInc:15,renderBackground:function(){var e=this.bgCanvas.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,this.width,this.height),e.fillStyle="#aaa",e.font="11px sans-serif",e.fillText(this.graphName,this.graphX,this.graphY-6),e.strokeStyle="#111",e.strokeRect(this.graphX+.5,this.graphY+.5,this.graphWidth,this.graphHeight),this.unit=this.graphHeight/this.maxY;var t=(this.graphHeight+this.gridLineInc)/this.gridLineInc,n=this.maxY/t,r=0,i=0;for(this.gridY=this.graphHeight+this.graphY;this.gridY>this.graphY+1;this.gridY-=this.gridLineInc){i++,e.textAlign="right",i%2==0?e.fillStyle="#111":e.fillStyle="#000";var s=this.gridLineInc;this.gridY-s<this.graphY?(s=this.gridY-this.graphY,e.fillRect(this.graphX+1,this.graphY+1,this.graphWidth-2,s-1)):e.fillRect(this.graphX+1,this.gridY-s-1,this.graphWidth-2,s),r=Math.round(n*i),e.fillStyle="#777",e.fillText(""+r,this.graphX-5,this.gridY)}e.globalAlpha=1,e.textAlign="left";var o=this.height-13,u=this.graphLeftMargin+3;for(this.n=0;this.n<this.labels.length;this.n++)e.fillStyle=this.labels[this.n].color,e.fillRect(u,o,5,5),e.fillStyle="#888",e.fillText(this.labels[this.n].name,u+8,o+6),u+=e.measureText(this.labels[this.n].name).width+18;this.renderGraph(!0)},renderGraph:function(e){if(!this.data)return;var t=this.graphCanvas.getContext("2d");e?(t.fillStyle="#000",t.fillRect(0,0,this.graphWidth,this.graphHeight)):this._totalAdded>this.graphWidth&&t.drawImage(this.graphCanvas,-1,0);var n=0;e?(n=this.data.length-1,this.dx=1):(this._totalAdded<this.graphWidth?this.dx=this.cursor:this.dx=this.graphWidth-1,n=this.dx+1);if(n==0)return;var r=this.cursor-1;r<0&&(r=this.data.length-1);for(;this.dx<n;this.dx++){r>this.data.length-1&&(r=0),t.fillStyle="#000",t.fillRect(this.dx,0,1,this.graphHeight),this.yline=this.graphHeight;for(this.i=0;this.i<this.data[r].length;this.i++){this.linePixelSize=this.data[r][this.i]*this.unit,t.strokeStyle=this.labels[this.i].color,t.beginPath(),t.moveTo(this.dx,this.yline);var i=this.yline-this.linePixelSize;i<0&&(i=0),t.lineTo(this.dx,i),t.closePath(),t.stroke(),this.yline-=this.linePixelSize}r++}},draw:function(){this.ctx.save(),this.ctx.drawImage(this.bgCanvas,this.x,this.y),this.renderGraph(!1),this.ctx.globalAlpha=.4,this.ctx.drawImage(this.graphCanvas,this.x+this.graphX,this.y+this.graphY),this.message&&(this.ctx.font="13px sans-serif",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.fillText(this.message,this.x+this.width/2,this.y+this.height/2-9)),this.ctx.restore()}}),define("playcraft/debug",function(){}),pc.Device=pc.Base.extend("pc.Device",{},{canvasId:null,canvas:null,canvasWidth:0,canvasHeight:0,loader:null,timer:null,ctx:null,started:!1,fps:0,currentFPS:0,tick:0,running:!0,scale:1,xmlParser:null,debugPanel:null,showDebug:!0,devMode:!0,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,screen:null,pixelRatio:1,isiPhone:!1,isiPhone4:!1,isiPad:!1,isAndroid:!1,isTouch:!1,isiOS:!1,isiPod:!1,requestAnimFrame:null,input:null,gameClass:null,game:null,elapsed:0,lastFrame:0,now:Date.now(),boot:function(e,t){this.devMode&&this.info("Playcraft Engine v"+pc.VERSION+" starting"),this.canvasId=e,this.gameClass=t,this.fps=60,this.tick=1e3/this.fps,this.debugPanel=new pc.DebugPanel,this.input=new pc.Input,this.loader=new pc.Loader,this.isAppMobi=typeof AppMobi!="undefined",this.pixelRatio=gamecore.Device.pixelRatio,this.isiPhone=gamecore.Device.isiPhone,this.isiPhone4=gamecore.Device.isiPhone4,this.isiPad=gamecore.Device.isiPad,this.isAndroid=gamecore.Device.isAndroid,this.isTouch=gamecore.Device.isTouch,this.isiOS=this.isiPhone||this.isiPad,this.device=gamecore.Device,this.requestAnimFrame=gamecore.Device.requestAnimFrame,this.requestAnimFrame=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60,Date.now())};return function(t,n){e.apply(window,[t,n])}}(),window.onresize=this.onResize.bind(this),this.onReady()},canPlay:function(e){return gamecore.Device.canPlay(e)},_calcScreenSize:function(){this.isAppMobi?(this.screen!=null&&this.screen.release(),this.screen=pc.Dim.create(document.body.offsetWidth,document.body.offsetHeight),this.canvas.width=this.screen.x,this.canvas.height=this.screen.y,this.canvas.innerWidth=this.screen.x,this.canvas.innerHeight=this.screen.y,this.canvasWidth=this.screen.x,this.canvasHeight=this.screen.y):(this.isiPad||this.isiPhone?(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight):this.panelElement&&(this.canvas.width=this.panelElement.offsetWidth,this.canvas.height=this.panelElement.offsetHeight),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.screen=pc.Dim.create(this.canvasWidth,this.canvasHeight))},onReady:function(){this.isiOS&&(this.showDebug=!1,this.soundEnabled=!1);if(this.started)return;this.game=eval("new "+this.gameClass+"()");if(!this.game)throw"Invalid game class";this.canvas=document.getElementById(this.canvasId);if(!this.canvas)throw"Abort! Could not attach to a canvas element using the id ["+this.canvasId+"]. "+'Add a canvas element to your HTML, such as <canvas id="pcGameCanvas"></canvas>';this.input._onReady(),this.ctx=this.canvas.getContext("2d"),this.panelElement=this.canvas.parentNode,this.onResize(),this.showDebug&&this.debugPanel.onReady(),this.lastFrame=Date.now(),this.game.onReady(),this.requestAnimFrame(this.cycle.bind(this)),this.started=!0},startTime:0,cycle:function(e){this.running!==!1&&(this.now=Date.now(),this.elapsed=this.now-this.lastFrame,this.lastDrawMS=0,this.currentFPS=Math.round(1e3/this.elapsed),this.elementsDrawn=0,this.startTime=Date.now(),this.elapsed<200&&(this.running=this.game.process()),this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,pc.device.input.process(),this.showDebug&&(this.debugPanel.update(this.elapsed),this.debugPanel.draw(this.ctx)),this.lastFrame=this.now,this.requestAnimFrame(this.cycle.bind(this)))},resize:function(e,t){this.canvas.width=e,this.canvas.height=t,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize(this.canvasWidth,this.canvasHeight)},onResize:function(){if(this.canvas==null)return;this._calcScreenSize();var e=!1;typeof window.orientation!="undefined"&&window.orientation!=0&&(e=!0),e,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.game.onResize(this.canvasWidth,this.canvasHeight),this.debugPanel.onResize()},isOnScreen:function(e,t,n,r){return pc.Math.isRectColliding(e,t,n,r,0,0,this.canvasWidth,this.canvasHeight)},parseXML:function(e){if(window.DOMParser)return this.xmlParser||(this.xmlParser=new DOMParser),this.xmlParser.parseFromString(e,"text/xml");var t=new ActiveXObject("Microsoft.XMLDOM");return t.loadXML(e),t}}),pc.device=new pc.Device,define("playcraft/device",function(){}),pc.Sound=pc.Base.extend("pc.Sound",{},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(e,t,n,r,i,s){this._super(),this.name=e,this.channels=r;var o=!1;for(var u=0;u<n.length;u++)if(pc.device.canPlay(n[u])){this.src=pc.device.loader.makeUrl(t+"."+n[u]),o=!0;break}o?pc.device.loader.started&&this.load(i,s):this.errored=!0},pause:function(){if(!this.canPlay())return;for(var e=0,t=this.sounds.length;e<t;e++)this.sounds[e].pause()},stop:function(){if(!this.canPlay())return;this.pause()},setVolume:function(e){if(!this.canPlay())return;for(var t=0,n=this.sounds.length;t<n;t++)this.sounds[t].volume=e},getDuration:function(){return this.canPlay()?this.sounds[0].duration:-1},setPlaybackRate:function(e){if(!this.canPlay())return;for(var t=0,n=this.sounds.length;t<n;t++)this.sounds[t].playbackRate=e},setPlayPosition:function(e){if(!this.canPlay())return;for(var t=0,n=this.sounds.length;t<n;t++)this.sounds[t].currentTime=e},load:function(e,t){this.onLoadCallback=e,this.onErrorCallback=t;if(this.loaded&&e){this.onLoadCallback(this);return}for(var n=0;n<this.channels;n++){var r=new Audio;r.preload="auto",r.addEventListener("canplaythrough",this.onLoad.bind(this),!1),r.addEventListener("error",this.onError.bind(this),!1),r.onerror=this.onError.bind(this),r.onload=this.onLoad.bind(this),r.src=this.src,r.load(),this.sounds.push(r),pc.device.isAppMobi&&this.onLoad(null)}},reload:function(){this.loaded=!1,this.errored=!1,this.load()},onLoad:function(e){this.numLoaded++,pc.device.isAppMobi||e.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1),this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback&&this.onLoadCallback(this))},onError:function(){this.errored=!0,this.loaded=!1,this.onErrorCallback&&this.onErrorCallback(this)},play:function(e){if(!this.canPlay())return null;for(var t=0,n=this.sounds.length;t<n;t++)if(this.sounds[t].paused||this.sounds[t].ended)return e&&(this.sounds[t].loop=!0),this.sounds[t].play(),this.sounds[t];return this.warn(this.name+" - all channels are in use"),null},canPlay:function(){return this.loaded&&pc.device.soundEnabled&&!this.errored}}),define("playcraft/sound",function(){}),pc.Layer=pc.Base.extend("pc.Layer",{},{name:null,paused:!1,active:!1,scene:null,zIndex:0,originTrack:null,originTrackXRatio:1,originTrackYRatio:1,origin:null,init:function(e,t){this._super(),this.name=e,this.origin=pc.Point.create(0,0),this._worldPos=pc.Point.create(0,0),this._screenPos=pc.Point.create(0,0),this.zIndex=pc.checked(t,0),this.originTrack=null,this.originTrackXRatio=0,this.originTrackYRatio=0},toString:function(){return""+this.name+" (origin: "+this.origin+", zIndex: "+this.zIndex+")"},release:function(){this.origin.release()},isActive:function(){return this.scene!=null&&!this.scene.active?!1:this.active},setActive:function(){this.scene.setLayerActive(this)},setInactive:function(){this.scene.setLayerInactive(this)},setZIndex:function(e){this.zIndex=e,this.scene&&this.scene.sortLayers()},_worldPos:null,worldPos:function(e){return this._worldPos.x=e.x+this.origin.x,this._worldPos.y=e.y+this.origin.y,this._worldPos},screenX:function(e){return e+this.scene.viewPort.x-this.origin.x},screenY:function(e){return e+this.scene.viewPort.y-this.origin.y},getScreenRect:function(){return this.scene.getScreenRect()},draw:function(){},setOriginTrack:function(e,t,n){this.originTrack=e,this.originTrackXRatio=pc.checked(t,1),this.originTrackYRatio=pc.checked(n,1)},setOrigin:function(e,t){return this.origin.x==Math.round(e)&&this.origin.y==Math.round(t)?!1:(this.origin.x=Math.round(e),this.origin.y=Math.round(t),!0)},process:function(){this.originTrack&&this.setOrigin(this.originTrack.origin.x*this.originTrackXRatio,this.originTrack.origin.y*this.originTrackYRatio)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},onResize:function(e,t){},onAddedToScene:function(){},onRemovedFromScene:function(){},onAction:function(e,t,n,r){}}),define("playcraft/layer",function(){}),pc.EntityLayer=pc.Layer.extend("pc.EntityLayer",{loadFromTMX:function(e,t,n){var r=t.getAttribute("name"),i=new pc.EntityLayer(r);e.addLayer(i);var s=t.getElementsByTagName("object");for(var o=0;o<s.length;o++){var u=s[o],a=null,f=parseInt(u.getAttribute("x")),l=parseInt(u.getAttribute("y")),c=parseInt(u.getAttribute("width")),h=parseInt(u.getAttribute("height")),p=null,d=u.getElementsByTagName("polygon");if(d.length>0){var v=d[0].getAttribute("points"),m=[],g=v.split(" ");for(var y=0;y<g.length;y++){var b=g[y].split(",");m.push([parseInt(b[0]),parseInt(b[1])])}p=pc.Poly.create(f,l,m)}else p=pc.Dim.create(c,h);var w={},E=u.getElementsByTagName("properties");if(E.length){var S=E[0].getElementsByTagName("property");for(var x=0;x<S.length;x++){var T=S[x].getAttribute("name"),N=S[x].getAttribute("value");w[T]=N,T==="entity"&&(a=N)}}a?n.createEntity(i,a,f,l,0,p,w):this.warn('Entity loaded from map with no "entity" type property set. x='+f+" y="+l)}}},{worldSize:null,entityManager:null,systemManager:null,init:function(e,t,n,r){this._super(e),this.entityFactory=r,this.systemManager=new pc.SystemManager(this),this.entityManager=new pc.EntityManager(this),this.worldSize=pc.Dim.create(pc.checked(t,1e4),pc.checked(n,1e4))},setOrigin:function(e,t){var n=this._super(e,t);return n&&this.systemManager.onOriginChange(e,t),n},getEntityManager:function(){return this.entityManager},getSystemManager:function(){return this.systemManager},addSystem:function(e){this.systemManager.add(e,this.entityManager)},getSystemsByComponentType:function(e){return this.systemManager.getByComponentType(e)},removeSystem:function(e){this.systemManager.remove(e)},process:function(){this._super(),this.systemManager.processAll(),this.entityManager.cleanup()},onResize:function(e,t){this.systemManager.onResize(e,t)}}),define("playcraft/entitylayer",function(){}),pc.TileSet=pc.Base.extend("pc.TileSet",{},{tileSpriteSheet:null,props:null,init:function(e){this.tileSpriteSheet=e,this.props=new Array(e.totalFrames);for(var t=0;t<this.props.length;t++)this.props[t]=new pc.Hashmap},drawTile:function(e,t,n,r){this.tileSpriteSheet.drawFrame(e,t%this.tileSpriteSheet.framesWide,pc.Math.floor(t/this.tileSpriteSheet.framesWide),n,r)},addProperty:function(e,t,n){this.props[e].put(t,n)},hasProperty:function(e,t){return this.props[e].hasKey(t)},getProperties:function(e){return this.props[e]}}),define("playcraft/tileset",function(){}),pc.TileMap=pc.Base.extend("pc.TileMap",{EMPTY_TILE:-1},{tiles:null,tilesWide:0,tilesHigh:0,tileWidth:0,tileHeight:0,tileSet:null,init:function(e,t,n,r,i,s){this.tiles=s,this.tileWidth=pc.Math.round(r),this.tileHeight=pc.Math.round(i),this.tilesWide=pc.Math.round(t),this.tilesHigh=pc.Math.round(n),this.tileSet=e},tileHasProperty:function(e,t,n){var r=this.getTile(e,t);return r>=0?this.tileSet.hasProperty(r,n):!1},generate:function(e){this.tiles=new Array(this.tilesHigh);var t=pc.checked(e,this.Class.EMPTY_TILE);for(var n=0;n<this.tilesHigh;n++){this.tiles[n]=new Array(this.tilesWide);for(var r=0;r<this.tilesWide;r++)this.tiles[n][r]=t}},paint:function(e,t,n,r,i){for(var s=t;s<t+r;s++)for(var o=e;o<e+n;o++)this.tiles[s][o]=i},isOnMap:function(e,t){return e>=0&&e<this.tilesWide&&t>=0&&t<this.tilesHigh},clear:function(e,t,n,r){this.paint(e,t,n,r,this.Class.EMPTY_TILE)},setTile:function(e,t,n){this.tiles[t][e]=n},getTile:function(e,t){return this.isOnMap(e,t)?this.tiles[t][e]:-1},loadFromTMX:function(e,t,n){this.tileWidth=t,this.tileHeight=n,this.tilesWide=parseInt(e.getAttribute("width")),this.tilesHigh=parseInt(e.getAttribute("height"));var r=e.getElementsByTagName("data")[0];if(r.getAttribute("compression")){this.error("map: "+name+": TMX map compression not supported, use base64 encoding");return}if(r.getAttribute("encoding")=="base64"){var i="";for(var s=0;s<r.childNodes.length;s++)i+=r.childNodes[s].nodeValue;i=i.replace(/[^A-Za-z0-9\+\/\=]/g,"");var o=pc.Base64.decode(i),u=[];for(var a=0;a<o.length/4;a++){u[a]=0;for(var f=3;f>=0;--f)u[a]+=o.charCodeAt(a*4+f)<<(f<<3)}}this.tiles=new Array(this.tilesHigh);for(var l=0;l<this.tilesHigh;l++){this.tiles[l]=new Array(this.tilesWide);for(var c=0;c<this.tilesWide;c++)this.tiles[l][c]=u[l*this.tilesWide+c]-1}}}),define("playcraft/tilemap",function(){}),pc.TileLayer=pc.Layer.extend("pc.TileLayer",{loadFromTMX:function(e,t,n,r,i){var s=t.getAttribute("name"),o=new pc.TileLayer(s,!0,null,i);o.tileMap.loadFromTMX(t,n,r),e.addLayer(o)}},{tileMap:null,debugShowGrid:!1,prerenders:null,usePrerendering:!0,prerenderSize:512,init:function(e,t,n,r){this._super(e),this.tileMap=pc.checked(n,new pc.TileMap(r)),this.usePrerendering=pc.checked(t,!0),this.tileMap&&this.tileMap.tileWidth>256&&(this.usePrerendering=!1)},setTileMap:function(e){this.tileMap=e,this.usePrerendering&&this.prerender()},prerender:function(){var e=this.tileMap.tilesWide*this.tileMap.tileWidth,t=this.tileMap.tilesHigh*this.tileMap.tileHeight,n=Math.ceil(e/this.prerenderSize),r=Math.ceil(t/this.prerenderSize);this.prerenders=[];for(var i=0;i<r;i++){this.prerenders[i]=[];for(var s=0;s<n;s++){var o=m==n-1?e-m*this.prerenderSize:this.prerenderSize,u=g==r-1?t-g*this.prerenderSize:this.prerenderSize,a=o/this.tileMap.tileWidth+1,f=u/this.tileMap.tileHeight+1,l=s*this.prerenderSize%this.tileMap.tileWidth,c=i*this.prerenderSize%this.tileMap.tileHeight,h=Math.floor(s*this.prerenderSize/this.tileMap.tileWidth),p=Math.floor(i*this.prerenderSize/this.tileMap.tileHeight),d=document.createElement("canvas");d.width=o,d.height=u;var v=d.getContext("2d");for(var m=0;m<a;m++)for(var g=0;g<f;g++)if(m+h<this.tileMap.tilesWide&&g+p<this.tileMap.tilesHigh){var y=this.tileMap.getTile(m+h,g+p);y>=0&&this.tileMap.tileSet.drawTile(v,y,m*this.tileMap.tileWidth-l,g*this.tileMap.tileHeight-c)}this.prerenders[i][s]=d}}},draw:function(){this._super();if(!this.tileMap||!this.tileMap.tilesWide)return;this.usePrerendering?this.drawPrerendered():this.drawTiled()},drawTiled:function(){var e=Math.floor(this.origin.x/this.tileMap.tileWidth);e<0&&(e=0);var t=Math.floor(this.origin.y/this.tileMap.tileHeight);t<0&&(t=0);var n=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-e+2;e+n>=this.tileMap.tilesWide-1&&(n=this.tileMap.tilesWide-1-e);var r=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-t+2;t+r>=this.tileMap.tilesHigh-1&&(r=this.tileMap.tilesHigh-1-t);for(var i=t,s=t+r;i<s+1;i++){var o=this.screenY(i*this.tileMap.tileHeight);for(var u=e,a=e+n;u<a;u++){var f=this.tileMap.tiles[i][u];f>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,f,this.screenX(u*this.tileMap.tileWidth),o),this.debugShowGrid&&(pc.device.ctx.save(),pc.device.ctx.strokeStyle="#222222",pc.device.ctx.strokeRect(this.screenX(u*this.tileMap.tileWidth),this.screenY(i*this.tileMap.tileHeight),this.tileMap.tileWidth,this.tileMap.tileHeight),pc.device.ctx.restore())}}},drawPrerendered:function(){this.prerenders||this.prerender();var e=-this.origin.x+this.scene.viewPort.x,t=-this.origin.y+this.scene.viewPort.y,n=Math.max(Math.floor(this.origin.x/this.prerenderSize),0),r=Math.max(Math.floor(this.origin.y/this.prerenderSize),0),i=n+Math.ceil((this.origin.x+this.scene.viewPort.w)/this.prerenderSize),s=r+Math.ceil((this.origin.y+this.scene.viewPort.h)/this.prerenderSize);i=Math.min(i,this.prerenders[0].length),s=Math.min(s,this.prerenders.length);for(var o=r;o<s;o++)for(var u=n;u<i;u++)pc.device.ctx.drawImage(this.prerenders[o%this.prerenders.length][u%this.prerenders[0].length],e+u*this.prerenderSize,t+o*this.prerenderSize)}}),define("playcraft/tilelayer",function(){}),pc.HexTileLayer=pc.TileLayer.extend("pc.HexTileLayer",{},{init:function(e,t,n){this._super(e),this.tileMap=pc.checked(t,new pc.TileMap(n)),this.usePrerendering=!1},drawTiled:function(){var e=Math.floor(this.origin.x/this.tileMap.tileWidth);e<0&&(e=0);var t=Math.floor(this.origin.y/this.tileMap.tileHeight);t<0&&(t=0);var n=Math.ceil((this.origin.x+this.scene.viewPort.w)/this.tileMap.tileWidth)-e;e+n>=this.tileMap.tilesWide-1&&(n=this.tileMap.tilesWide-1-e);var r=Math.ceil((this.origin.y+this.scene.viewPort.h)/this.tileMap.tileHeight)-t;t+r>=this.tileMap.tilesHigh-1&&(r=this.tileMap.tilesHigh-1-t);for(var i=t,s=r+t;i<s+1;i++){var o=i*this.tileMap.tileHeight;for(var u=e,a=n+e;u<a;u++){var f=u*this.tileMap.tileWidth;i%2&&(f+=this.tileMap.tileWidth/2);var l=this.tileMap.tiles[i][u];l>=0&&this.tileMap.tileSet.drawTile(pc.device.ctx,l,this.screenX(f),this.screenY(o))}}}}),define("playcraft/hextilelayer",function(){}),pc.Entity=pc.Pooled.extend("pc.Entity",{create:function(e){var t=this._super();if(!e)throw"Entity requires a valid layer to be placed on";if(!e.Class.isA)throw"Entity requires a valid layer to be placed on";if(!e.Class.isA("pc.EntityLayer"))throw"Entities can only be placed on pc.EntityLayer objects";return t.config(e),t}},{layer:null,tags:[],active:!0,_componentCache:null,init:function(e){this._super(),this.tags=[],this.layer=null,this.active=!0,this._componentCache=new pc.Hashmap,pc.valid(e)&&this.config(e)},config:function(e){this.layer=e,this.active=!0,e.entityManager.add(this)},release:function(){this.tags.length=0,this.active=!1,this._componentCache.clear(),this._super()},addTag:function(e){this.layer.entityManager.addTag(this,e)},hasTag:function(e){for(var t=0;t<this.tags.length;t++)if(this.tags[t].toLowerCase()===e.toLowerCase())return!0;return!1},removeTag:function(e){this.layer.entityManager.removeTag(this,e)},addComponent:function(e){return this.layer.entityManager.addComponent(this,e)},removeComponent:function(e){this.layer.entityManager.removeComponent(this,e)},removeComponentByType:function(e){this.removeComponent(this._componentCache.get(e))},getComponent:function(e){return this._componentCache.get(e)},getAllComponents:function(){return this._componentCache},getComponentTypes:function(){return this._componentCache.keys()},hasComponentOfType:function(e){return this._componentCache.hasKey(e)},remove:function(){this.layer.entityManager.remove(this)},_handleComponentRemoved:function(e){this._componentCache.remove(e.getType())},_handleComponentAdded:function(e){this._componentCache.put(e.getType(),e)}}),pc.EntityFactory=pc.Base.extend("pc.EntityFactory",{},{createEntity:function(e,t,n,r,i,s,o){}}),define("playcraft/entity",function(){}),pc.Sprite=pc.Pooled.extend("pc.Sprite",{create:function(e){var t=this._super();return t.config(e),t}},{currentFrame:0,currentAnim:null,spriteSheet:null,animSpeedOffset:0,currentAnimName:null,alpha:1,scaleX:1,scaleY:1,active:!0,hold:!1,loopCount:0,compositeOperation:null,_acDelta:0,init:function(e){this._super(),this.config(e)},config:function(e){this.spriteSheet=pc.checked(e,null),this.spriteSheet&&this.reset()},reset:function(){this.currentFrame=0,this.alpha=1,this.loopCount=0,this.scaleX=1,this.scaleY=1,this.active=!0,this.hold=!1,this.spriteSheet.animations.size()>0?(this.currentAnim=this.spriteSheet.animations.get(this.spriteSheet.animations.keys()[0]),this.currentFrame=0):this.currentAnim=null},setSpriteSheet:function(e){this.spriteSheet=e,this.reset()},setScale:function(e,t){this.scaleX=e,this.scaleY=t},setCompositeOperation:function(e){this.compositeOperation=e},draw:function(e,t,n,r){this.alpha!=1&&(this.spriteSheet.alpha=this.alpha),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation(this.compositeOperation),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.spriteSheet.draw(e,this,t,n,r),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(1,1),this.alpha!=1&&(this.spriteSheet.alpha=1),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation("source-over")},drawFrame:function(e,t,n,r,i,s){this.alpha!=1&&(this.spriteSheet.alpha=this.alpha),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(this.scaleX,this.scaleY),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation(this.compositeOperation),this.spriteSheet.drawFrame(e,t,n,r,i,s),(this.scaleX!=1||this.scaleY!=1)&&this.spriteSheet.setScale(1,1),this.alpha!=1&&(this.spriteSheet.alpha=1),this.compositeOperation!=null&&this.spriteSheet.setCompositeOperation("source-over")},update:function(e){if(this.currentAnim==null||!this.active||this.hold)return;this.spriteSheet.update(this,e)},setAnimation:function(e,t,n){var r=pc.checked(n,!0);if(!r&&this.currentAnim.name===e)return;this.currentAnim=this.spriteSheet.animations.get(e),this.currentFrame=0,this.loopCount=0,this.active=!0,this.held=!1,this.animSpeedOffset=pc.checked(t,0),this.currentAnimName=e},setAnimationSpeedOffset:function(e){this.animSpeedOffset=e},setCurrentFrame:function(e){this.currentFrame=e},getAnimation:function(){return this.currentAnimName},setAlpha:function(e){this.alpha=e},addAlpha:function(e){this.alpha+=e,this.alpha>1&&(this.alpha=1)},subAlpha:function(e){this.alpha-=e,this.alpha<0&&(this.alpha=0)}}),define("playcraft/sprite",function(){}),pc.SpriteSheet=pc.Base.extend("pc.SpriteSheet",{},{image:null,frameWidth:0,frameHeight:0,framesWide:1,framesHigh:1,scaleX:1,scaleY:1,sourceX:0,sourceY:0,alpha:1,useRotation:!1,compositeOperation:null,totalFrames:0,animations:null,frameOffsetX:0,frameOffsetY:0,_frameXPos:null,_frameYPos:null,init:function(e){this._super();if(!pc.checked(e.image))throw"No image supplied";this.image=e.image;if(!this.image.width||!this.image.height)throw"Invalid image (zero width or height)";pc.valid(e.frameWidth)?this.frameWidth=e.frameWidth:pc.valid(e.framesWide)&&e.framesWide>0?this.frameWidth=Math.floor(this.image.width/e.framesWide):this.frameWidth=this.image.width,pc.valid(e.frameHeight)?this.frameHeight=e.frameHeight:pc.valid(e.framesHigh)&&e.framesHigh>0?this.frameHeight=Math.floor(this.image.height/e.framesHigh):this.frameHeight=this.image.height,this.framesWide=Math.floor(pc.checked(e.framesWide,this.image.width/this.frameWidth)),this.framesHigh=Math.floor(pc.checked(e.framesHigh,this.image.height/this.frameHeight)),this.scaleX=pc.checked(e.scaleX,1),this.scaleY=pc.checked(e.scaleY,1),this.sourceX=pc.checked(e.sourceX,0),this.sourceY=pc.checked(e.sourceY,0),this.frameOffsetX=pc.checked(e.frameOffsetX,0),this.frameOffsetY=pc.checked(e.frameOffsetY,0),this.alpha=pc.checked(e.alpha,1),this.useRotation=pc.checked(e.useRotation,!0),this.totalFrames=this.framesWide*this.framesHigh,this.animations=new pc.Hashtable,this._frameXPos=[];for(var t=0;t<this.framesWide;t++)this._frameXPos.push(t*this.frameWidth);this._frameYPos=[];for(var n=0;n<this.framesHigh;n++)this._frameYPos.push(n*this.frameHeight)},addAnimation:function(e){if(!pc.valid(e.name))throw"Animation requires a name for reference";e.frameX=pc.checked(e.frameX,0),e.frameY=pc.checked(e.frameY,0),e.directions=pc.checked(e.directions,1),e.time=pc.checked(e.time,1e3),e.loops=pc.checked(e.loops,0),e.holdOnEnd=pc.checked(e.holdOnEnd,!1),e.dirAcross=pc.checked(e.dirAcross,!1),e.scaleX=pc.checked(e.scaleX,1),e.scaleY=pc.checked(e.scaleY,1),e.offsetX=pc.checked(e.offsetX,0),e.offsetY=pc.checked(e.offsetY,0),e.framesWide=pc.checked(e.framesWide,this.framesWide),e.framesHigh=pc.checked(e.framesHigh,this.framesHigh),e.frameCount=pc.checked(e.frameCount,this.framesWide*this.framesHigh),e.frameCount==0&&(e.frameCount=pc.checked(e.frameCount,this.framesWide*this.framesHigh));if(!pc.valid(e.frames)){var t=e.frameX+e.frameY*e.framesWide;e.frames=[];for(var n=t;n<t+e.frameCount;n++)e.frames.push([n%e.framesWide,Math.floor(n/e.framesWide)])}e.frameRate=e.time/e.frames.length,e.degreesPerDir=360/e.directions,this.animations.put(e.name,e)},setAnimation:function(e,t,n){e.currentAnim=this.animations.get(t),e.currentAnim==null&&this.warn("attempt to set unknown animation ["+t+"]"),e.currentFrame=0,e.held=!1,e.animSpeedOffset=pc.checked(n,0)},hasAnimation:function(e){return this.animations.get(e)!=null},setScale:function(e,t){this.scaleX=e,this.scaleY=t},setCompositeOperation:function(e){this.compositeOperation=e},dirTmp:0,draw:function(e,t,n,r,i){if(!this.image.loaded||t==null||!t.active)return;(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),t.alpha!=1&&(this.image.alpha=t.alpha),this.compositeOperation!=null&&this.image.setCompositeOperation(this.compositeOperation);if(t.currentAnim==null)(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),this.image.draw(e,this.sourceX,this.sourceY,Math.round(n+this.frameOffsetX),Math.round(r+this.frameOffsetY),this.frameWidth+this.frameOffsetX,this.frameHeight+this.frameOffsetY,this.useRotation?i:0);else{var s=0,o=0;(t.currentAnim.scaleX!=1||t.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(t.currentAnim.scaleX*this.scaleX,t.currentAnim.scaleY*this.scaleY),this.useRotation?(s=t.currentAnim.frames[t.currentFrame][0],o=t.currentAnim.frames[t.currentFrame][1],this.image.draw(e,this.sourceX+this._frameXPos[s],this.sourceY+this._frameYPos[o],t.currentAnim.offsetX+pc.Math.round(n)+this.frameOffsetX,t.currentAnim.offsetY+pc.Math.round(r)+this.frameOffsetY,this.frameWidth,this.frameHeight,i)):(this.dirTmp=Math.round(i/t.currentAnim.degreesPerDir),this.dirTmp>t.currentAnim.directions-1&&(this.dirTmp=0),s=t.currentAnim.frames[t.currentFrame][1]+this.dirTmp,o=t.currentAnim.frames[t.currentFrame][0],t.currentAnim.directions==1&&(o=t.currentAnim.frames[t.currentFrame][1],s=t.currentAnim.frames[t.currentFrame][0]),this.image.draw(e,this.sourceX+this._frameXPos[s],this.sourceY+this._frameYPos[o],t.currentAnim.offsetX+pc.Math.round(n)+this.frameOffsetX,t.currentAnim.offsetY+pc.Math.round(r)+this.frameOffsetY,this.frameWidth,this.frameHeight),(t.currentAnim.scaleX!=1||t.currentAnim.scaleY!=1||this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(t.currentAnim.scaleX*this.scaleX,t.currentAnim.scaleY*this.scaleY))}(this.image.scaleX!=1||this.image.scaleY!=1)&&this.image.setScale(1,1),t.alpha!=1&&(this.image.alpha=1),this.compositeOperation!=null&&this.image.setCompositeOperation("source-over")},drawFrame:function(e,t,n,r,i,s){if(!this.image.loaded)return;this.alpha<1&&(e.globalAlpha=this.alpha),(this.scaleX!=1||this.scaleY!=1)&&this.image.setScale(this.scaleX,this.scaleY),this.compositeOperation!=null&&this.image.setCompositeOperation(this.compositeOperation),this.image.draw(e,this.sourceX+this._frameXPos[t],this.sourceY+this._frameYPos[n],pc.Math.round(r)+this.frameOffsetX,pc.Math.round(i)+this.frameOffsetY,this.frameWidth,this.frameHeight,s),(this.image.scaleX!=1||this.image.scaleY!=1)&&this.image.setScale(1,1),this.alpha<1&&(e.globalAlpha=1),this.compositeOperation!=null&&this.image.setCompositeOperation("source-over")},drawAllFrames:function(e,t,n){for(var r=0;r<this.framesHigh;r++)for(var i=0;i<this.framesWide;i++)this.drawFrame(e,i,r,t+i*this.frameWidth,n+r*this.frameHeight)},update:function(e,t){if(e.currentAnim==null||!e.active||e.held)return;if(e.currentAnim.frames.length<=1)return;e._acDelta>e.currentAnim.frameRate+e.animSpeedOffset?(e.currentFrame++,e.currentFrame>=e.currentAnim.frames.length&&(e.loopCount++,e.currentAnim.loops&&e.loopCount>=e.currentAnim.loops&&(e.currentAnim.holdOnEnd?(e.held=!0,e.currentFrame&&e.currentFrame--):e.active=!1),e.held||(e.currentFrame=0)),e._acDelta-=e.currentAnim.frameRate):e._acDelta+=t},reset:function(){this.image=null,this.animations=null}}),define("playcraft/spritesheet",function(){}),pc.Math=pc.Base("pc.Math",{RADIAN_TO_DEGREE:180/Math.PI,DEGREE_TO_RADIAN:Math.PI/180,PI:Math.PI,round:Math.round,random:Math.random,floor:Math.floor,sqr:function(e){return e*e},rand:function(e,t){return pc.Math.round(pc.Math.random()*(t-e)+e)},randFloat:function(e,t){return pc.Math.random()*(t-e)+e},rotate:function(e,t){var n=e+t;while(n>359)n-=360;while(n<0)n=360+n;return n},angleDiff:function(e,t,n){if(!n){var r=e-t;return r<0&&(r+=360),r}return t<e&&(t+=360),t-e},isClockwise:function(e,t){return e>t?Math.abs(e-t)<t+(360-e):e+(360-t)<Math.abs(t-e)},isFacingRight:function(e){return e>270||e<90?!0:!1},radToDeg:function(e){return e*pc.Math.RADIAN_TO_DEGREE},degToRad:function(e){return e*pc.Math.DEGREE_TO_RADIAN},angleFromVector:function(e,t){var n=pc.Math.radToDeg(Math.atan2(t,e));return n<0&&(n+=360),n},vectorFromAngle:function(e){var t=Math.cos(pc.Math.degToRad(e)),n=Math.sin(pc.Math.degToRad(e));return pc.Point.create(t,n)},isPointInRect:function(e,t,n,r,i,s){return e>=n&&e<=n+i&&t>=r&&t<=r+s},isRectInRect:function(e,t,n,r,i,s,o,u){return pc.Math.isPointInRect(e,t,i,s,o,u)?pc.Math.isPointInRect(e+n,t,i,s,o,u)?pc.Math.isPointInRect(e,t+r,i,s,o,u)?pc.Math.isPointInRect(e+n,t+r,i,s,o,u):!1:!1:!1},isRectColliding:function(e,t,n,r,i,s,o,u){return!(t+r<s||t>s+u||e+n<i||e>i+o)},limit:function(e,t,n){return e<t?t:e>n?n:e},limitAdd:function(e,t,n,r){return e+t<n?n:e+t>r?r:e+t}},{}),pc.Rect=pc.Pooled("pc.Rect",{create:function(e,t,n,r){var i=this._super();return i.x=e,i.y=t,i.w=n,i.h=r,i}},{x:0,y:0,w:0,h:0,containsRect:function(e,t,n,r,i,s,o,u){return pc.Math.isPointInRect(e,t,i,s,o,u)?pc.Math.isPointInRect(e+n,t,i,s,o,u)?pc.Math.isPointInRect(e,t+r,i,s,o,u)?pc.Math.isPointInRect(e+n,t+r,i,s,o,u):!1:!1:!1},containsPoint:function(e){return e.x>=this.x&&e.x<=this.x+this.w&&e.y>=this.y&&e.y<=this.y+this.h},overlaps:function(e,t,n,r,i){var s=n,o=r;if(pc.valid(i)&&i!=0){var u=Math.sin(pc.Math.degToRad(i)),a=Math.cos(pc.Math.degToRad(i));u<0&&(u=-u),a<0&&(a=-a),s=r*u+n*a,o=r*a+n*u}return!(this.y+this.h<t||this.y>t+o||this.x+this.w<e||this.x>e+s)},toString:function(){return this.x+" x "+this.y+" by "+this.w+" x "+this.h}}),pc.Point=pc.Pooled("pc.Point",{create:function(e,t){var n=this._super();return n.x=e,n.y=t,n}},{x:0,y:0,match:function(e){this.x=e.x,this.y=e.y},set:function(e){this.match(e)},setXY:function(e,t){return this.x=e,this.y=t,this},add:function(e,t){return this.x+=e,this.y+=t,this},subtract:function(e,t){return this.x-=e,this.y-=t,this},dirTo:function(e){return Math.atan2(e.y-this.y,e.x-this.x)*180/Math.PI},moveInDir:function(e,t){return this.x+=t*Math.cos(pc.Math.degToRad(e)),this.y+=t*Math.sin(pc.Math.degToRad(e)),this},moveTowards:function(e,t){this.moveInDir(this.dirTo(e),t)},distance:function(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))},toString:function(){return this.x+"x"+this.y}}),pc.Poly=pc.Pooled("pc.Poly",{create:function(e,t,n){var r=this._super();return r.x=e,r.y=t,r.points=n,r}},{x:0,y:0,points:null,_boundingRect:null,init:function(e,t,n){this.x=e,this.y=t,this.points=n,this._boundingRect=pc.Rect.create(0,0,0,0)},getBoundingRect:function(){}}),pc.Dim=pc.Point,pc.Vector=pc.Point,define("playcraft/math",function(){}),pc.Image=pc.Base.extend("pc.Image",{},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(e,t,n,r){this._super(),this.name=e,this.src=pc.device.loader.makeUrl(t),this.image=new Image,this.onLoadCallback=n,this.onErrorCallback=r,this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.scaleX=1,this.scaleY=1,this.alpha=1,pc.device.loader.started&&this.load()},setAlpha:function(e){this.alpha=e},setScale:function(e,t){this.scaleX=e,this.scaleY=t},setCompositeOperation:function(e){this.compositeOperation=e},load:function(e,t){this.onLoadCallback=e,this.onErrorCallback=t,this.loaded&&e&&this.onLoadCallback(this),this.image.onload=this._onLoad.bind(this),this.image.onerror=this._onError.bind(this),this.image.src=this.src},reload:function(){this.loaded=!1,this.load()},draw:function(e,t,n,r,i,s,o,u){this.compositeOperation!=null&&(e.globalCompositeOperation=this.compositeOperation);if(arguments.length==3)e.save(),this.alpha!=1&&(e.globalAlpha=this.alpha),e.translate(t+this.width/2,n+this.height/2),e.scale(this.scaleX,this.scaleY),e.drawImage(this.image,0,0,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height),e.restore();else if(pc.valid(u)){e.save(),this.alpha!=1&&(e.globalAlpha=this.alpha);if(this.scaleX<0||this.scaleY<0){var a=this.scaleY==1?0:this.scaleY,f=this.scaleX==1?0:this.scaleX;e.translate(r+s/2*f,i+o/2*a)}else e.translate(r+s/2,i+o/2);e.rotate(u*(Math.PI/180)),e.drawImage(this.image,t,n,s,o,-s/2,-o/2,s,o),e.restore()}else{e.save(),this.alpha!=1&&(e.globalAlpha=this.alpha);if(this.scaleX<0||this.scaleY<0){var l=this.scaleY==1?0:this.scaleY,c=this.scaleX==1?0:this.scaleX;e.translate(r+ -(s/2)*c,i+ -(o/2)*l)}else e.translate(r,i);e.scale(this.scaleX,this.scaleY),e.drawImage(this.image,t,n,s,o,0,0,s,o),e.restore()}this.compositeOperation!=null&&(e.globalCompositeOperation="source-over"),pc.device.elementsDrawn++},_onLoad:function(){this.loaded=!0,this.width=this.image.width,this.height=this.image.height,this.onLoadCallback&&this.onLoadCallback(this)},_onError:function(){this.onErrorCallback&&this.onErrorCallback(this)},expand:function(e,t){this.image.width=this.width+e,this.image.height=this.height+t,this.width=this.image.width,this.height=this.image.height},resize:function(e,t){var n=this.width*e,r=this.height*t,i=document.createElement("canvas");i.width=this.width,i.height=this.height;var s=document.createElement("canvas");s.width=n,s.height=r;var o=s.getContext("2d"),u=o.getImageData(0,0,n,r),a=i.getContext("2d");a.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);var f=a.getImageData(0,0,this.width,this.height);for(var l=0;l<r;l++)for(var c=0;c<n;c++){var h=(Math.floor(l/t)*this.width+Math.floor(c/e))*4,p=(l*n+c)*4;for(var d=0;d<4;d++)u.data[p+d]=f.data[h+d]}return o.putImageData(u,0,0),this.image=s,this}}),pc.CanvasImage=pc.Base.extend("pc.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(e){this.canvas=e,this.width=e.width,this.height=e.height},draw:function(e,t,n,r,i,s,o){s==undefined||o==undefined||s==0||o==0?e.drawImage(this.canvas,t,n):e.drawImage(this.canvas,t,n,s,o,r*this.scaleX,i*this.scaleY,s*this.scaleX,o*this.scaleY)},setScale:function(e,t){this.scaleX=e,this.scaleY=t}}),pc.ImageTools=pc.Base.extend("pc.ImageTools",{rotate:function(e,t,n,r){var i=document.createElement("canvas");i.width=t*r,i.height=n;var s=i.getContext("2d"),o=t/2,u=n/2;for(var a=0;a<r;a++)s.save(),s.translate(a*t+t/2,n/2),s.rotate(360/r*a*(Math.PI/180)),s.drawImage(e,-(t/2),-(n/2)),s.restore();return new pc.CanvasImage(i)}},{}),define("playcraft/image",function(){}),pc.Scene=pc.Base.extend("pc.Scene",{},{name:null,layersByName:null,layers:null,activeLayers:null,paused:!1,active:!1,viewPort:null,viewPortCenter:null,init:function(e){this._super(),this.active=!1,this.name=e,this.layersByName=new pc.Hashtable,this.layers=new pc.LinkedList,this.activeLayers=new pc.LinkedList,this.viewPort=pc.Rect.create(0,0,0,0),this.viewPortCenter=pc.Point.create(0,0),this.setViewPort(0,0,pc.device.canvasWidth,pc.device.canvasHeight),pc.device.started&&this.onReady()},onReady:function(){var e=this.layers.first;while(e)e.obj.onReady(),e=e.next()},onActivated:function(){},onDeactivated:function(){},onResize:function(e,t){this.setViewPort(this.viewPort.x,this.viewPort.y,e,t);var n=this.layers.first;while(n)n.obj.onResize(e,t),n=n.next()},setViewPort:function(e,t,n,r){this.viewPort.x=e,this.viewPort.y=t,this.viewPort.w=n,this.viewPort.h=r,this.viewPortCenter.x=this.viewPort.w/2,this.viewPortCenter.y=this.viewPort.h/2},getScreenRect:function(){return this.viewPort},sortLayers:function(){this.activeLayers.sort(function(e,t){return e.zIndex-t.zIndex})},onAction:function(e,t,n){},isActive:function(){return this.active},get:function(e){return this.layersByName.get(e)},addLayer:function(e){if(!pc.valid(e))throw"Error: invalid layer";if(!pc.valid(e.name))throw"Error: trying to add a layer that has no name (forget to call this._super in your layer init?)";return this.layersByName.put(e.name,e),this.layers.add(e),this.activeLayers.add(e),e.active=!0,e.scene=this,e.onAddedToScene(),this.sortLayers(),e},removeLayer:function(e){this.layersByName.remove(e.name),this.layers.remove(e),this.activeLayers.remove(e),e.active=!1,e.scene=null,e.onRemovedFromScene()},setLayerActive:function(e){this.activeLayers.add(e),this.sortLayers(),e.active=!0},setLayerInactive:function(e){this.activeLayers.remove(e),e.active=!1},toggleLayerActive:function(e){e.active?this.setLayerInactive(e):this.setLayerActive(e)},getFirstActiveLayer:function(){return this.activeLayers.first},getFirstLayer:function(){return this.layers.first},startTime:0,process:function(){var e=this.activeLayers.first;while(e)e.obj.paused||(e.obj.process(),this.startTime=Date.now(),e.obj.draw(),pc.device.lastDrawMS+=Date.now()-this.startTime),e=e.next()},pause:function(){this.paused=!0;var e=this.activeLayers.first;while(e)e.obj.pause(),e=e.next()},resume:function(){this.paused=!1;var e=this.activeLayers.first;while(e)e.obj.resume(),e=e.next()},reset:function(){var e=this.layers.first;while(e)e.obj.reset(),e=e.next();this.layers.clear(),this.activeLayers.clear()},entitiesUnderXY:function(e,t){var n=[],r=this.layers.first;while(r)n.push(r.obj.entitiesUnderXY(e,t)),r=r.next()},loadFromTMX:function(e,t){var n=pc.device.parseXML(e.data),r=n.getElementsByTagName("map")[0],i=parseInt(r.getAttribute("tilewidth")),s=parseInt(r.getAttribute("tileheight")),o=n.getElementsByTagName("tileset")[0],u=o.getAttribute("name"),a=o.getAttribute("width"),f=o.getAttribute("height"),l=pc.device.loader.get(u);pc.assert(l,"Unable to locate tile image resource: "+u+". It must match the tileset name in tiled.");var c=pc.device.loader.get(u).resource,h=new pc.SpriteSheet({image:c,frameWidth:i,frameHeight:s}),p=new pc.TileSet(h),d=n.getElementsByTagName("tile");for(var v=0;v<d.length;v++){var m=d[v],g=parseInt(m.getAttribute("id")),y=m.getElementsByTagName("properties")[0],b=y.getElementsByTagName("property");for(var w=0;w<b.length;w++){var E=b[w],S=E.getAttribute("name"),x=E.getAttribute("value");p.addProperty(g,S,x)}}var T=n.getElementsByTagName("layer");for(var N=0;N<T.length;N++)switch(r.getAttribute("orientation")){case"isometric":pc.IsoTileLayer.loadFromTMX(this,T[N],i,s,p);break;default:pc.TileLayer.loadFromTMX(this,T[N],i,s,p)}var C=n.getElementsByTagName("objectgroup");for(var k=0;k<C.length;k++)pc.EntityLayer.loadFromTMX(this,C[k],t)}}),define("playcraft/scene",function(){}),pc.Game=pc.Base.extend("pc.Game",{},{scenes:null,activeScenes:null,paused:!1,init:function(e,t){this._super(),this.scenes=new pc.LinkedList,this.activeScenes=new pc.LinkedList,pc.device.devMode&&(pc.device.input.bindAction(this,"physics debug","F9"),pc.device.input.bindAction(this,"pool dump","F10"),pc.device.input.bindAction(this,"toggle sound","F11"))},process:function(){if(this.paused)return!0;var e=this.getFirstActiveScene();while(e)e.object().process(),e=e.next();return!0},stopAllSounds:function(){var e=pc.device.loader.getAllSounds();for(var t=0;t<e.length;t++)pc.device.soundEnabled&&e[t].stop()},onAction:function(e){e==="toggle sound"&&(this.stopAllSounds(),pc.device.soundEnabled=!pc.device.soundEnabled),e==="pool dump"&&console.log(pc.Pool.getStats());if(e==="physics debug"){var t=this.getFirstScene();while(t){var n=t.object().getFirstActiveLayer();while(n){var r=n.object();if(r.Class.isA("pc.EntityLayer")){var i=r.systemManager.systems.first;while(i){var s=i.object();s.Class.isA("pc.systems.Physics")&&s.setDebug(!s.debug),i=i.next()}}n=n.next()}t=t.next()}}},addScene:function(e,t){this.scenes.add(e),this.onSceneAdded(e),pc.checked(t,!0)&&this.activateScene(e)},onSceneAdded:function(e){},removeScene:function(e){this.scenes.remove(e),this.activeScenes.remove(e),this.onSceneRemoved(e)},onSceneRemoved:function(e){},activateScene:function(e){if(e.active)return;this.activeScenes.add(e),e.active=!0,this.onSceneActivated(e),e.onActivated()},onSceneActivated:function(e){},deactivateScene:function(e){if(!e.active)return;this.activeScenes.remove(e),e.active=!1,this.onSceneDeactivated(e),e.onDeactivated()},onSceneDeactivated:function(e){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){this.paused=!0;var e=this.getFirstScene();while(e)e.object().pause(),e=e.next()},isActive:function(){return!this.paused},resume:function(){this.paused=!1;var e=this.getFirstScene();while(e)e.object().resume(),e=e.next()},togglePauseResume:function(){pc.device.game.paused?pc.device.game.resume():pc.device.game.pause()},reset:function(){var e=this.getFirstScene();while(e)e.obj.reset(),e=e.next();this.scenes.clear(),this.activeScenes.clear(),this.onReady()},onReady:function(){},onResize:function(e,t){var n=this.getFirstActiveScene();while(n)n.obj.onResize(e,t),n=n.next()},getScreenRect:function(){return pc.Rect.create(0,0,pc.device.canvasWidth,pc.device.canvasHeight)}}),define("playcraft/game",function(){}),pc.Loader=pc.Base.extend("pc.Loader",{},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},resources:new pc.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",started:!1,finished:!1,_noCacheString:"",init:function(){this._super()},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(e){this.baseUrl=e},setListener:function(e,t){this.loadingListener=e,this.loadedListener=t},add:function(e){e.name=e.name.toLowerCase(),this.resources.put(e.name.toLowerCase(),{resource:e,state:this.State.QUEUED}),this.info("Adding resource "+e.src+" to the queue.")},get:function(e){var t=this.resources.get(e.toLowerCase());if(!t)throw"Attempting to get a resource that hasn't been added: "+e;if(t.state<this.State.READY)throw"Attempting to get a resource that hasn't been loaded yet (calling before onLoaded?)";return t},getAllSounds:function(){var e=[],t=this.resources.keys();for(var n=0;n<t.length;n++){var r=this.resources.get(t[n]).resource;r.Class.isA("pc.Sound")&&e.push(r)}return e},getAllImages:function(){var e=[],t=this.resources.keys();for(var n=0;n<t.length;n++){var r=this.resources.get(t[n]);r.isA("pc.Image")&&e.push(r)}return e},start:function(e,t){this.setListener(e,t),this.progress=0,this.errored=0;var n=this.resources.keys();for(var r=0;r<n.length;r++){var i=this.resources.get(n[r]);i.state==this.State.QUEUED&&(i.resource.load(this._onLoad.bind(this),this._onError.bind(this)),i.state=this.State.LOADING,this.totalBeingLoaded++)}this.info("Started loading "+this.totalBeingLoaded+" resource(s)."),this._checkAllDone()},makeUrl:function(e){return this.baseUrl+e+this._noCacheString},_onLoad:function(e){var t=this.resources.get(e.name);t==null?this.error("Unable to get resource ["+e.name+"] - Please make sure you are using all lowercase."):(t.state=this.State.READY,this.progress++,this.loadingListener!=null&&this.loadingListener(Math.round(this.progress/this.totalBeingLoaded*100)),this.info(e.name+" loaded ("+Math.round(this.progress/this.totalBeingLoaded*100)+"% done)")),this._checkAllDone()},_onError:function(e){var t=this.resources.get(e.name);t.state=this.State.FAILED,this.progress++,this.errored++,this.loadingListener!=null&&this.loadingListener(this.progress/this.totalBeingLoaded),this.warn(e.name+" ("+e.src+") failed."),this._checkAllDone()},_checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.finished=!0,this.loadedListener(this.progress,this.errored),this.progress=0,this.errored=0,this.totalBeingLoaded=0)}}),define("playcraft/loader",function(){}),pc.DataResource=pc.Base.extend("pc.DataResource",{},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(e,t,n,r){this._super(),this.src=pc.device.loader.makeUrl(t),this.name=e,this.onLoadCallback=n,this.onErrorCallback=r,this.request=new XMLHttpRequest,this.request.onreadystatechange=this.onReadyStateChange.bind(this),this.request.onload=this.onReadyStateChange.bind(this),this.request.onloadend=this.onReadyStateChange.bind(this),this.load()},load:function(e,t){this.onLoadCallback=e,this.onErrorCallback=t,this.request.open("get",this.src),this.request.send(null)},reload:function(){this.loaded=!1,this.load()},onReadyStateChange:function(){if(this.loaded)return;this.request.readyState==4&&(this.request.status==200?(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback&&this.onLoadCallback(this)):this.request.status==404&&(this.warn("resource "+this.src+" error "+this.request.status),this.onErrorCallback&&this.onErrorCallback(this)))}}),define("playcraft/dataresource",function(){}),pc.components={},pc.components.Component=pc.Pooled.extend("pc.components.Component",{create:function(){return this._super()}},{_entity:null,_type:null,active:!0,init:function(e){this._super(),this._type=e,this.active=!0},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}}),define("playcraft/components/component",function(){}),pc.components.Physics=pc.components.Component.extend("pc.components.Physics",{create:function(e){var t=this._super();return t.config(e),t}},{maxSpeed:null,bounce:.5,faceVel:!1,density:0,mass:-1,friction:0,linearDamping:0,linearVelocity:null,angularDamping:0,fixedRotation:!1,bullet:!1,collisionGroup:0,collisionCategory:0,collisionMask:0,sensorOnly:!1,immovable:!1,centerOfMass:null,centered:!0,gravity:null,shapes:null,force:0,turn:0,torque:0,_body:null,_fixtures:null,_lastSpatialPos:null,_lastSpatialDim:null,_lastSpatialDir:0,init:function(e){this._super("physics"),this.centerOfMass=pc.Point.create(0,0),this.margin={x:0,y:0},this.linearVelocity=pc.Dim.create(0,0),pc.valid(e)&&this.config(e),this._velReturn=pc.Dim.create(0,0),this.gravity={}},config:function(e){this._body=null,this._fixtures?this._fixtures.length=0:this._fixtures=[],this.collisionGroup=pc.checked(e.collisionGroup,0),this.collisionCategory=pc.checked(e.collisionCategory,0),this.collisionMask=pc.checked(e.collisionMask,0),this.sensorOnly=pc.checked(e.sensorOnly,!1),this.centered=pc.checked(e.centered,!0),!pc.valid(e.shapes)&&!Array.isArray(e.shapes)&&(e.shapes=[{}],e.shapes[0].shape=pc.CollisionShape.RECT);for(var t=0;t<e.shapes.length;t++){var n=e.shapes[t];n.offset||(n.offset={}),n.offset.x=pc.checked(n.offset.x,0),n.offset.y=pc.checked(n.offset.y,0),n.offset.w=pc.checked(n.offset.w,0),n.offset.h=pc.checked(n.offset.h,0),n.type=pc.checked(n.type,0),n.shape=pc.checked(n.shape,pc.CollisionShape.RECT),n.sensorOnly=pc.checked(n.sensorOnly,this.sensorOnly),n.collisionGroup=pc.checked(n.collisionGroup,this.collisionGroup),n.collisionCategory=pc.checked(n.collisionCategory,this.collisionCategory),n.collisionMask=pc.checked(n.collisionMask,this.collisionMask)}this.shapes=e.shapes,e.linearVelocity?(this.linearVelocity.x=pc.checked(e.linearVelocity.x,0),this.linearVelocity.y=pc.checked(e.linearVelocity.y,0)):(this.linearVelocity.x=0,this.linearVelocity.y=0),this.maxSpeed||(this.maxSpeed={}),e.maxSpeed?(this.maxSpeed.x=pc.checked(e.maxSpeed.x,0),this.maxSpeed.y=pc.checked(e.maxSpeed.y,0)):(this.maxSpeed.x=0,this.maxSpeed.y=0),e.gravity?(this.gravity.x=e.gravity.x,this.gravity.y=e.gravity.y):(this.gravity.x=undefined,this.gravity.y=undefined),this.mass=pc.checked(e.mass,-1),this.fixedRotation=pc.checked(e.fixedRotation,!1),this.thrust=pc.checked(e.thrust,0),this.bounce=pc.checked(e.bounce,.5),this.faceVel=pc.checked(e.faceVel,0),this.shape=pc.checked(e.shape,pc.CollisionShape.RECT),this.immovable=pc.checked(e.immovable,!1),this.density=pc.checked(e.density,1),this.friction=pc.checked(e.friction,.2),this.linearDamping=pc.checked(e.linearDamping,0),this.angularDamping=pc.checked(e.angularDamping,0),this.bullet=pc.checked(e.bullet,!1),this.torque=pc.checked(e.torque,0),this.impulse=pc.checked(e.impulse,0),this.turn=pc.checked(e.turn,0),this.force=pc.checked(e.force,0),pc.valid(e.centerOfMass)&&(this.centerOfMass.x=pc.checked(e.centerOfMass.x),this.centerOfMass.y=pc.checked(e.centerOfMass.y))},applyTurn:function(e){this._body?(this._body.SetAngularVelocity(pc.Math.degToRad(e)),this._body.SetAwake(!0)):this._pendingDir=e},clearGravity:function(){this.setGravity()},setGravity:function(e,t){this.gravity.x=e,this.gravity.y=t;if(this._body){if(this.gravity.x!=undefined||this._body._pc_gravityX!=undefined)this._body._pc_gravityX=this.gravity.x;if(this.gravity.y!=undefined||this._body._pc_gravityY!=undefined)this._body._pc_gravityY=this.gravity.y}},setDir:function(e){this._body?(this._body.SetAngle(pc.Math.degToRad(e)),this._body.SetAwake(!0)):this.dir=e},getDir:function(){return this._body?pc.Math.radToDeg(this._body.GetAngle()):0},applyForce:function(e,t){if(this._body){var n=this._body.GetAngle();pc.valid(t)&&(n=pc.Math.degToRad(t)),this._body.ApplyForce(Box2D.Common.Math.b2Vec2.Get(Math.cos(n)*e,Math.sin(n)*e),this._body.GetWorldCenter())}else this.force=e},applyImpulse:function(e,t){if(this._body){var n=this._body.GetAngle();pc.valid(t)&&(n=pc.Math.degToRad(t)),this._body.ApplyImpulse(Box2D.Common.Math.b2Vec2.Get(Math.cos(n)*e,Math.sin(n)*e),this._body.GetWorldCenter())}else this.impulse=e},applyTorque:function(e){this._body?this._body.ApplyTorque(pc.Math.degToRad(e)):this.torque=e},setCenterOfMass:function(e,t){if(this._body){var n=new Box2D.Collision.Shapes.b2MassData;n.center=Box2D.Common.Math.b2Vec2.Get(pc.systems.Physics.toP(e),pc.systems.Physics.toP(t)),this._body.SetMassData(n)}else this.centerOfMass.x=e,this.centerOfMass.y=t},getSpeed:function(){return this._body?this._body.GetLinearVelocity().Length()/pc.systems.Physics.SCALE:0},setLinearVelocity:function(e,t){this._body?(this._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(e*pc.systems.Physics.SCALE,t*pc.systems.Physics.SCALE)),this._body.SetAwake(!0)):(this.linearVelocity.x=e,this.linearVelocity.y=t)},_velReturn:null,getLinearVelocity:function(){if(this._body){var e=this._body.GetLinearVelocity();this._velReturn.setXY(pc.systems.Physics.fromP(e.x),pc.systems.Physics.fromP(e.y))}return this._velReturn},getVelocityAngle:function(){return pc.Math.angleFromVector(this._body.GetLinearVelocity().x,this._body.GetLinearVelocity().y)},setAngularVelocity:function(e){this._body&&(this._body.SetAngularVelocity(e),this._body.SetAwake(!0))},setLinearDamping:function(e){this._body&&(this._body.SetLinearDamping(a),this._body.SetAwake(!0))},setFriction:function(e){this._body&&(this._body.SetFriction(e),this._body.SetAwake(!0))},setCollisionCategory:function(e){if(!this._fixtures.length)return;this.collisionCategory=e;for(var t=0;t<this._fixtures.length;t++){var n=this._fixtures[t].GetFilterData();n.collisionCategory=e,this._fixtures[t].SetFilterData(n),this._fixtures[t].GetFilterData().categoryBits=e}},setCollisionGroup:function(e){if(!this._fixtures.length)return;this.collisionGroup=e;for(var t=0;t<this._fixtures.length;t++){var n=this._fixtures[t].GetFilterData();n.groupIndex=e,this._fixtures[t].SetFilterData(n)}},setCollisionMask:function(e){if(!this._fixtures.length)return;this.collisionMask=e;for(var t=0;t<this._fixtures.length;t++){var n=this._fixtures[t].GetFilterData();n.maskBits=e,this._fixtures[t].SetFilterData(n)}},setIsSensor:function(e,t){if(!this._fixtures.length)return;this._fixtures[t].isSensor=e}}),define("playcraft/components/physics",function(){}),pc.components.Alpha=pc.components.Component.extend("pc.components.Alpha",{create:function(e){var t=this._super();return t.config(e),t}},{level:1,init:function(){this._super("alpha")},config:function(e){this.level=pc.checked(e.level,1)},setAlpha:function(e){this.level=e,this._fix(this.level)},addAlpha:function(e){this.level+=e,this._fix(this.level)},subAlpha:function(e){this.level-=e,this._fix(this.level)},_fix:function(e){if(e>1)return;if(e<0)return;this.level=e}}),define("playcraft/components/alpha",function(){}),pc.JointType={WELD:0,REVOLUTE:1,DISTANCE:2},pc.components.Joint=pc.components.Component.extend("pc.components.Joint",{create:function(e){var t=this._super();return t.config(e),t}},{attachTo:null,offset:null,attachmentOffset:null,distance:0,type:0,frequency:0,dampingRatio:0,angle:0,lowerAngleLimit:0,upperAngleLimit:0,enableLimit:!1,maxMotorTorque:0,enableMotor:0,motorSpeed:0,_joint:null,init:function(e){this._super("joint"),this.offset=pc.Point.create(0,0),this.attachmentOffset=pc.Point.create(0,0),pc.valid(e)&&this.config(e)},config:function(e){this.attachTo=pc.checked(e.attachedTo,null),e.offset&&this.offset.setXY(pc.checked(e.offset.x,0),pc.checked(e.offset.y,0)),e.attachmentOffset&&this.attachmentOffset.setXY(pc.checked(e.attachmentOffset.x,0),pc.checked(e.attachmentOffset.y,0)),this.distance=pc.checked(e.distance,0),this.type=pc.checked(e.type,pc.JointType.WELD),this.dampingRatio=pc.checked(e.dampingRatio,0),this.lowerAngleLimit=pc.checked(e.lowerAngleLimit,0),this.upperAngleLimit=pc.checked(e.upperAngleLimit,359),this.enableLimit=pc.checked(e.enableLimit,!1),this.maxMotorTorque=pc.checked(e.maxMotorTorque,100),this.enableMotor=pc.checked(e.enableMotor,!1),this.motorSpeed=pc.checked(e.motorSpeed,0),this.angle=pc.checked(e.angle,0),this._joint=null},getAngle:function(){return pc.Math.radToDeg(this._joint.GetJointAngle())},getSpeed:function(){return this._joint.GetJointSpeed()},setMotorSpeed:function(e){this.motorSpeed=e,this._joint.SetMotorSpeed(e)},getMotorTorque:function(){return this._joint.GetMotorTorque()},isLimitEnabled:function(){return this.enableLimit},isMotorEnabled:function(){return this.enableMotor},setMaxMotorTorque:function(e){this.maxMotorTorque=e,this._joint.SetMaxMotorTorque(e)},getMaxMotorTorque:function(){return this.maxMotorTorque}}),define("playcraft/components/joint",function(){}),pc.components.Expiry=pc.components.Component.extend("pc.components.Expiry",{create:function(e){var t=this._super();return t.config(e),t}},{lifetime:0,init:function(){this._super("expiry")},config:function(e){this.lifetime=pc.checked(e.lifetime,1e3)},decrease:function(e){this.lifetime-=e},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/expiry",function(){}),pc.components.OriginShifter=pc.components.Component.extend("pc.components.OriginShifter",{create:function(e){var t=this._super();return t.config(e),t}},{ratio:1,_offsetX:0,_offsetY:0,init:function(e){this._super("originshifter"),pc.valid(e)&&this.config(e)},config:function(e){this.ratio=pc.checked(e.ratio,1)}}),define("playcraft/components/originshifter",function(){}),pc.components.Spatial=pc.components.Component.extend("pc.components.Spatial",{create:function(e){var t=this._super();return t.config(e),t}},{lastMove:null,pos:null,dim:null,scaleX:0,scaleY:0,dir:0,_centerPos:null,_screenRect:null,init:function(e){this._super("spatial"),this.pos=pc.Point.create(0,0),this.dim=pc.Dim.create(0,0),this._screenRect=pc.Rect.create(0,0,0,0),this._centerPos=pc.Point.create(0,0),this._unscaledPos=pc.Point.create(0,0),this._unscaledDim=pc.Point.create(0,0),this.lastMove=pc.Dim.create(0,0),this.scaleX=1,this.scaleY=1,pc.valid(e)&&this.config(e)},config:function(e){this.pos.x=pc.checked(e.x,0),this.pos.y=pc.checked(e.y,0),this.dim.x=pc.checked(e.w,0),this.dim.y=pc.checked(e.h,0),this.dir=pc.checked(e.dir,0),this.scaleX=pc.checked(e.scaleX,1),this.scaleY=pc.checked(e.scaleY,1),this._centerPos.x=0,this._centerPos.y=0,this._screenRect.x=0,this._screenRect.y=0,this._screenRect.w=0,this._screenRect.h=0,this.lastMove.x=0,this.lastMove.y=0},getPos:function(){return this.pos},getDim:function(){return this.dim},addScale:function(e,t){this.pos.x-=Math.abs((this.dim.x-this.dim.x*e)/2),this.pos.y-=Math.abs((this.dim.y-this.dim.y*t)/2),this.dim.x*=e,this.dim.y*=t,this.scaleX+=e,this.scaleY+=t},_unscaledPos:null,getUnscaledPos:function(){return this._unscaledPos.x=this.pos.x/this.scaleX,this._unscaledPos.y=this.pos.y/this.scaleY,this._unscaledPos},_unscaledDim:null,getUnscaledDim:function(){return this._unscaledDim.x=this.dim.x/this.scaleX,this._unscaledDim.y=this.dim.y/this.scaleY,this._unscaledDim},subtractScale:function(e,t){this.addScale(-e,-t)},setDir:function(e){this.dir=e},getDir:function(){return this.dir},getCenterPos:function(){return this._centerPos.x=this.pos.x+this.dim.x/2,this._centerPos.y=this.pos.y+this.dim.y/2,this._centerPos},getScreenRect:function(){return this._entity&&this._entity.layer?(this._screenRect.x=this._entity.layer.screenX(this.pos.x),this._screenRect.y=this._entity.layer.screenY(this.pos.y),this._screenRect.w=this.dim.x,this._screenRect.h=this.dim.y,this._screenRect):null},toString:function(){return"x: "+this.x+" y: "+this.y+" z: "+this.z+" dir: "+this.dir}}),define("playcraft/components/spatial",function(){}),pc.components.Overlay=pc.components.Component.extend("pc.components.Overlay",{create:function(e){var t=this._super();return t.config(e),t}},{lifetime:0,sprite:null,init:function(e){this._super("overlay"),this.sprite=pc.Sprite.create(),pc.valid(e)&&this.config(e)},config:function(e){this.lifetime=pc.checked(e.lifetime,1e3);var t=pc.checked(e.spriteSheet,null);if(t==null)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(t);var n=pc.checked(e.animationStart,null),r=pc.checked(e.animationStartDelay,0);n!=null&&this.sprite.setAnimation(n,r)},decrease:function(e){this.lifetime-=e},hasExpired:function(){return this.lifetime<=0}}),define("playcraft/components/overlay",function(){}),pc.components.Clip=pc.components.Component.extend("pc.components.Clip",{create:function(e){var t=this._super();return t.config(e),t}},{clipEntity:null,x:0,y:0,w:0,h:0,init:function(){this._super("clip")},config:function(e){this.clipEntity=pc.checked(e.clipEntity,null),this.x=pc.checked(e.x,0),this.y=pc.checked(e.y,0),this.w=pc.checked(e.w,0),this.h=pc.checked(e.h,0)}}),define("playcraft/components/clip",function(){}),pc.components.Activator=pc.components.Component.extend("pc.components.Activator",{create:function(e){var t=this._super();return t.config(e),t}},{tag:null,layer:null,range:0,stayActive:!1,_cacheLayer:null,init:function(){this._super("activator")},config:function(e){if(!e.tag)throw"Activator requires an entity to track against";this.tag=e.tag,this.layer=pc.checked(e.layer,null),this.range=pc.checked(e.range,300),this.stayActive=pc.checked(e.stayActive,!1)}}),define("playcraft/components/activator",function(){}),pc.components.Input=pc.components.Component.extend("pc.components.Input",{create:function(e){var t=this._super();return t.config(e),t}},{target:null,states:null,actions:null,_bound:!1,init:function(e){this._super("input")},config:function(e){if(!e.states&&!e.actions)throw"Input requires at least an action or state set";this.states=e.states,this.actions=e.actions,this.target=e.target}}),define("playcraft/components/input",function(){}),pc.components.Fade=pc.components.Component.extend("pc.components.Fade",{create:function(e){var t=this._super();return t.config(e),t}},{startDelay:0,fadeInTime:0,fadeOutTime:0,holdTime:0,startTime:0,timeLimit:0,state:0,loops:1,loopsSoFar:0,init:function(){this._super("fade")},config:function(e){this.startDelay=pc.checked(e.startDelay,0),this.fadeInTime=pc.checked(e.fadeInTime,0),this.fadeOutTime=pc.checked(e.fadeOutTime,0),this.holdTime=pc.checked(e.holdTime,0),this.loops=pc.checked(e.loops,1),this.timeLimit=0,this.state=0,this.loopsSoFar=0}}),define("playcraft/components/fade",function(){}),pc.components.Spin=pc.components.Component.extend("pc.components.Spin",{create:function(e){var t=this._super();return t.config(e),t}},{rate:0,max:0,clockwise:!0,spinSoFar:0,spinning:!0,init:function(e){this._super("spin"),pc.valid(e)&&this.config(e)},config:function(e){this.rate=pc.checked(e.rate,15),this.max=pc.checked(e.max,0),this.clockwise=pc.checked(e.clockwise,!0),this.spinSoFar=0,this.spinning=!0}}),define("playcraft/components/spin",function(){}),pc.components.Scale=pc.components.Component.extend("pc.components.Scale",{create:function(e){var t=this._super();return t.config(e),t}},{x:1,y:1,growX:0,growY:0,maxX:0,maxY:0,scaledXSoFar:0,scaledYSoFar:0,scaling:!0,_bound:!1,init:function(e){this._super("scale"),pc.valid(e)&&this.config(e)},config:function(e){this.x=pc.checked(e.x,1),this.y=pc.checked(e.y,1),this.growX=pc.checked(e.growX,0),this.growY=pc.checked(e.growY,0),this.maxX=pc.checked(e.maxX,0),this.maxY=pc.checked(e.maxY,0),this.scaledXSoFar=0,this.scaledYSoFar=0}}),define("playcraft/components/scale",function(){}),pc.components.Rect=pc.components.Component.extend("pc.components.Rect",{create:function(e){var t=this._super();return t.config(e),t}},{color:null,lineColor:null,lineWidth:0,cornerRadius:0,init:function(e){this._super("rect"),this.color=pc.Color.create("#ffffff"),this.lineColor=pc.Color.create("#888888"),pc.valid(e)&&this.config(e)},config:function(e){e.color?this.color.set(pc.checked(e.color,"#ffffff")):this.color.set("#ffffff"),e.lineColor?this.lineColor.set(pc.checked(e.lineColor,"#888888")):this.lineColor.set("#ffffff"),this.lineWidth=pc.checked(e.lineWidth,0),this.cornerRadius=pc.checked(e.cornerRadius,0)}}),define("playcraft/components/rect",function(){}),pc.components.Poly=pc.components.Component.extend("pc.components.Poly",{create:function(e){var t=this._super();return t.config(e),t}},{color:null,lineColor:null,lineWidth:0,points:[],init:function(e){this._super("poly"),this.color=pc.Color.create("#ffffff"),this.lineColor=null,pc.valid(e)&&this.config(e)},config:function(e){e.color?this.color.set(pc.checked(e.color,"#ffffff")):this.color.set("#ffffff"),pc.valid(e.lineColor)&&(this.lineColor==null?this.lineColor=pc.Color.create(e.lineColor):this.lineColor.set(pc.checked(e.lineColor,"#888888"))),this.lineWidth=pc.checked(e.lineWidth,0);if(e.points.length<3)throw"Invalid polygon, requires at least 3 points";this.points=e.points}}),define("playcraft/components/poly",function(){}),pc.components.Circle=pc.components.Component.extend("pc.components.Circle",{create:function(e){var t=this._super();return t.config(e),t}},{color:null,lineColor:null,lineWidth:0,init:function(){this._super("circle")},config:function(e){e.color?this.color==null?this.color=pc.Color.create(e.color):this.color.set(e.color):this.color=null,e.lineColor?this.lineColor==null?this.lineColor=pc.Color.create(e.lineColor):this.lineColor.set(e.lineColor):this.lineColor=null,this.lineWidth=pc.checked(e.lineWidth,0)}}),define("playcraft/components/circle",function(){}),pc.components.Text=pc.components.Component.extend("pc.components.Text",{create:function(e){var t=this._super();return t.config(e),t}},{color:null,strokeColor:null,font:null,fontHeight:0,text:null,lineWidth:0,offset:null,_fontCache:null,init:function(e){this._super("text"),this.color=pc.Color.create("#ffffff"),this.strokeColor=pc.Color.create("#888888"),this.text=[],this.font="Calibri",this.fontHeight=20,this.offset=pc.Dim.create(0,0),this._fontCache="",pc.valid(e)&&this.config(e)},config:function(e){this.color.set(pc.checked(e.color,"#ffffff")),this.strokeColor.set(pc.checked(e.strokeColor,"#888888")),this.lineWidth=pc.checked(e.lineWidth,0),this.text=pc.checked(e.text,[""]),this.font=pc.checked(e.font,"Arial"),this.fontHeight=pc.checked(e.fontHeight,20),pc.valid(e.offset)&&(this.offset.x=pc.checked(e.offset.x),this.offset.y=pc.checked(e.offset.y)),this._updateFont()},setHeight:function(e){this.fontHeight=e,this._updateFont()},setFont:function(e){this.font=e,this._updateFont()},_updateFont:function(){this._fontCache=""+this.fontHeight+"px "+this.font}}),define("playcraft/components/text",function(){}),pc.components.Sprite=pc.components.Component.extend("pc.components.Sprite",{create:function(e){var t=this._super();return t.config(e),t}},{sprite:null,offset:null,init:function(e){this._super("sprite"),this.sprite=pc.Sprite.create(),this.offset=pc.Point.create(0,0),pc.valid(e)&&this.config(e)},config:function(e){var t=pc.checked(e.spriteSheet,null);if(t==null)throw this.getUniqueId()+": no spritesheet specified";this.sprite.setSpriteSheet(t),pc.valid(e.offset)?(this.offset.x=pc.checked(e.offset.x,0),this.offset.y=pc.checked(e.offset.y,0)):(this.offset.x=0,this.offset.y=0);var n=pc.checked(e.animationStart,null),r=pc.checked(e.animationStartDelay,0);n!=null&&this.sprite.setAnimation(n,r),this.sprite.currentFrame=pc.checked(e.currentFrame,0)}}),define("playcraft/components/sprite",function(){}),pc.components.Layout=pc.components.Component.extend("pc.components.Layout",{create:function(e){var t=this._super();return t.config(e),t}},{vertical:null,horizontal:null,margin:null,init:function(){this._super("layout"),this.margin={}},config:function(e){pc.checked(e.margin)?(this.margin.left=pc.checked(e.margin.left,0),this.margin.right=pc.checked(e.margin.right,0),this.margin.top=pc.checked(e.margin.top,0),this.margin.bottom=pc.checked(e.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0),this.horizontal=pc.checked(e.horizontal,"left"),this.vertical=pc.checked(e.vertical,"top")}}),define("playcraft/components/layout",function(){}),pc.components.ParticleEmitter=pc.components.Component.extend("pc.components.ParticleEmitter",{create:function(e){var t=this._super();return t.config(e),t}},{active:!0,emitting:!0,growXMin:0,growXMax:0,growYMin:0,growYMax:0,scaleXMin:0,scaleXMax:0,scaleYMin:0,scaleYMax:0,fadeInTime:0,fadeOutTime:0,angleMin:0,angleMax:0,thrustMin:0,thrustMax:0,thrustTime:0,spinMin:0,spinMax:0,rangeX:1,rangeY:1,burst:1,delay:25,spriteSheet:null,lifeMin:0,lifeMax:0,rotateSprite:!1,offsetX:null,offsetY:null,compositeOperation:null,relativeAngle:!0,shots:0,alphaMin:1,alphaMax:1,alphaDelay:0,_particles:null,_lastEmitTime:0,_shotCount:0,init:function(e){this._super("emitter"),pc.valid(e)&&this.config(e)},reset:function(){this._shotCount=0,this._lastEmitTime=0},config:function(e){this._lastEmitTime=0,this._shotCount=0,this.active=pc.checked(e.active,!0),this.emitting=pc.checked(e.emitting,!0),this.growXMin=pc.checked(e.growXMin,0),this.growXMax=pc.checked(e.growXMax,this.growXMin),this.growYMin=pc.checked(e.growYMin,0),this.growYMax=pc.checked(e.growYMax,this.growYMin),this.scaleXMin=pc.checked(e.scaleXMin,1),this.scaleYMin=pc.checked(e.scaleYMin,1),this.scaleXMax=pc.checked(e.scaleXMax,1),this.scaleYMax=pc.checked(e.scaleYMax,1),this.compositeOperation=pc.checked(e.compositeOperation,null),this.alphaMin=pc.checked(e.alphaMin,1),this.alphaMax=pc.checked(e.alphaMax,this.alphaMin),this.alphaDelay=pc.checked(e.alphaDelay,50),this.shots=pc.checked(e.shots,0),this.relativeAngle=pc.checked(e.relativeAngle,!0),this.rangeX=pc.checked(e.rangeX,1),this.rangeY=pc.checked(e.rangeY,1),this.fadeInTime=pc.checked(e.fadeInTime,0),this.fadeOutTime=pc.checked(e.fadeOutTime,0),this.angleMin=pc.checked(e.angleMin,0),this.angleMax=pc.checked(e.angleMax,359),this.thrustMin=pc.checked(e.thrustMin,1),this.thrustMax=pc.checked(e.thrustMax,this.thrustMin),this.thrustTime=pc.checked(e.thrustTime,100),this.burst=pc.checked(e.burst,1),this.delay=pc.checked(e.delay,25),this.lifeMin=pc.checked(e.lifeMin,100),this.lifeMax=pc.checked(e.lifeMin,this.lifeMin),this.rotateSprite=pc.checked(e.rotateSprite,!1),this.spinMin=pc.checked(e.spinMin,0),this.spinMax=pc.checked(e.spinMax,this.spinMin),this.offsetX=pc.checked(e.offsetX,0),this.offsetY=pc.checked(e.offsetY,0),this.gravityX=pc.checked(e.gravityX,0),this.gravityY=pc.checked(e.gravityY,0),this.maxVelX=pc.checked(e.maxVelX,50),this.maxVelY=pc.checked(e.maxVelY,50);if(!pc.valid(e.spriteSheet))throw"A spritesheet is required for the emitter";this.spriteSheet=e.spriteSheet,Array.isArray(this._particles)?this._particles.clear():this._particles=new pc.LinkedList},onBeforeRemoved:function(){var e=this._particles.first;while(e)e.obj.release(),e=e.next()}}),define("playcraft/components/particleemitter",function(){}),pc.systems={},pc.systems.System=pc.Base.extend("pc.System",{},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(e,t){this._super(),this.delay=pc.checked(t,0);if(!e instanceof Array)throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system.";this.componentTypes=e},processAll:function(){},onResize:function(){},onOriginChange:function(e,t){},onAddedToLayer:function(e){},onRemovedFromLayer:function(e){}}),define("playcraft/systems/system",function(){}),pc.EntityManager=pc.Base.extend("pc.EntityManager",{},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(e){this.layer=e,this.entitiesByTag=new pc.HashList,this.entities=new pc.LinkedList,this.componentsByEntity=new pc.Hashmap,this.componentsByEntityPlusType=new pc.Hashmap,this.entitySuicides=new pc.LinkedList},cleanup:function(){var e=this.entitySuicides.first;while(e)this._doRemoveEntity(e.object()),e=e.next();this.entitySuicides.clear()},add:function(e,t){this.entities.add(e),t!=undefined&&this.entitiesByTag.add(t,e);var n=e.getAllComponents();if(n!=null){var r=n.values();for(var i=0;i<r.length;i++)this._addToComponentMap(e,r[i])}this.layer.systemManager._handleEntityAdded(e)},remove:function(e){this.entitySuicides.has(e)||(this.entitySuicides.add(e),e.active=!1)},removeComponent:function(e,t){this._removeFromComponentMap(e,t),this.layer.systemManager._handleComponentRemoved(e,t),e._handleComponentRemoved(t),t._entity=null},addTag:function(e,t){if(e.tags.indexOf(t.toLowerCase())!=-1)return;this.entitiesByTag.add(t.toLowerCase(),e),e.tags.push(t.toLowerCase())},removeTag:function(e,t){this.entitiesByTag.remove(t.toLowerCase(),e),pc.Tools.arrayRemove(e.tags,t.toLowerCase())},getTagged:function(e){return this.entitiesByTag.get(e.toLowerCase())},activate:function(e){if(e.active)return;this.layer.systemManager._handleEntityAdded(e),e.active=!0},deactivate:function(e){if(!e.active)return;this.layer.systemManager._handleEntityRemoved(e),e.active=!1},_doRemoveEntity:function(e){this.entities.remove(e);var t=e.getAllComponents();if(t!=null){var n=t.values();for(var r=0;r<n.length;r++)this._removeFromComponentMap(e,n[r])}for(var i=0;i<e.tags.length;i++)this.entitiesByTag.remove(e.tags[i],e);this.layer.systemManager._handleEntityRemoved(e),e.release()},addComponent:function(e,t){return this._addToComponentMap(e,t),e._handleComponentAdded(t),this.layer.systemManager._handleComponentAdded(e,t),t._entity=e,t},getComponent:function(e,t){return this.componentsByEntityPlusType.get(e.objectId+":"+t)},getComponents:function(e){return this.componentsByEntity.get(e.objectId)},hasComponentOfType:function(e,t){return this.componentsByEntityPlusType.containsKey(e.objectId+":"+t)},_addToComponentMap:function(e,t){if(this.componentsByEntityPlusType.get(e.objectId+":"+t.getType()))throw"adding component "+t.getType()+" to entity "+e+" when it already has one of that type";this.componentsByEntityPlusType.put(e.objectId+":"+t.getType(),t),this.componentsByEntity.put(e.objectId,t)},_removeFromComponentMap:function(e,t){t.onBeforeRemoved(),this.componentsByEntityPlusType.remove(e.objectId+":"+t.getType()),this.componentsByEntity.remove(e.objectId),t.release()}}),define("playcraft/es/entitymanager",function(){}),pc.SystemManager=pc.Base.extend("pc.SystemManager",{},{systems:null,systemsByComponentType:null,layer:null,init:function(e){this.systems=new pc.LinkedList,this.systemsByComponentType=new pc.Hashtable,this.layer=e},add:function(e){e.layer=this.layer,e.systemManager=this,this.systems.add(e);if(!pc.valid(e.componentTypes))throw"Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)";for(var t=0;t<e.componentTypes.length;t++){var n=e.componentTypes[t].toLowerCase(),r=this.systemsByComponentType.get(n);r==null&&(r=new pc.LinkedList,this.systemsByComponentType.put(n,r)),r.has(e)||r.add(e)}var i=this.layer.entityManager.entities.first;while(i)this._handleEntityAdded(i.object()),i=i.next();e.onAddedToLayer(this.layer)},remove:function(e){e.onRemovedFromLayer(e.layer),this.systems.remove(e);for(var t=0;t<e.componentTypes;t++){var n=this.systemsByComponentType.get(e.componentTypes[t].toLowerCase());assert(n!=null,"Oops, trying to remove a system and it's not in the by type list"),e.systemManager=null,n.remove(e)}},getByComponentType:function(e){return this.systemsByComponentType.get(e)},onOriginChange:function(e,t){var n=this.systems.first;while(n)n.object().onOriginChange(e,t),n=n.next()},_handleEntityAdded:function(e){var t=e.getComponentTypes();for(var n=0;n<t.length;n++){var r=this.systemsByComponentType.get(t[n].toLowerCase());if(r){var i=r.first;while(i)i.obj.add(e),i=i.next()}}},_handleEntityRemoved:function(e){var t=e.getAllComponents();if(t==null)return;var n=t.keys();for(var r=0;r<n.length;r++){var i=this.systemsByComponentType.get(n[r].toLowerCase());if(i){var s=i.first;while(s)s.obj.remove(e),s=s.next()}}},_handleComponentAdded:function(e,t){var n=this.systemsByComponentType.get(t.getType());if(n==null)return;var r=n.first;while(r)r.obj.add(e),r.obj.onComponentAdded(e,t),r=r.next()},_handleComponentRemoved:function(e,t){var n=this.systemsByComponentType.get(t.getType());if(n==null)return;var r=n.first;while(r)r.obj.removeIfNotMatched(e),r.obj.onComponentRemoved(e,t),r=r.next()},processAll:function(){var e=this.systems.first;while(e){if(e.obj.delay==0||pc.device.now-e.obj._lastRun>e.obj.delay)e.obj.processAll(),e.obj.delay!=0&&(e.obj._lastRun=pc.device.now);e=e.next()}},onResize:function(e,t){var n=this.systems.first;while(n)n.obj.onResize(e,t),n=n.next()}}),define("playcraft/es/systemmanager",function(){}),pc.systems.EntitySystem=pc.systems.System.extend("pc.systems.EntitySystem",{},{entities:null,suicides:null,init:function(e,t){this._super(e,t),this.entities=new pc.LinkedList,this.suicides=new pc.LinkedList},addIfMatched:function(e){for(var t=0;t<this.componentTypes.length;t++)if(e.hasComponentOfType(this.componentTypes[t])){this.entities.add(e),this.onEntityAdded(e);return}},add:function(e){if(this.entities.has(e))return;this.entities.add(e),this.onEntityAdded(e)},remove:function(e){this.entities.remove(e)&&this.onEntityRemoved(e)},removeIfNotMatched:function(e){for(var t=0;t<this.componentTypes.length;t++)if(e.hasComponentOfType(this.componentTypes[t]))return;this.remove(e)},processAll:function(){var e=this.entities.first;while(e)this.process(e.obj),e=e.next();e=this.suicides.first;while(e)this.remove(e.obj),e=e.next();this.suicides.clear()},process:function(e){},suicide:function(e){this.suicides.add(e)},onEntityAdded:function(e){},onEntityRemoved:function(e){},onComponentAdded:function(e,t){},onComponentRemoved:function(e,t){}}),define("playcraft/systems/entitysystem",function(){}),pc.CollisionShape={RECT:0,CIRCLE:1,POLY:2},pc.BodyType={ENTITY:0,TILE:1},pc.systems.Physics=pc.systems.EntitySystem.extend("pc.systems.Physics",{SCALE:.1,toP:function(e){return e*this.SCALE},fromP:function(e){return e/this.SCALE}},{world:null,gravity:null,debug:!1,debugDraw:null,init:function(e){this._super(["physics"]),e&&e.gravity?this.gravity=pc.Point.create(pc.checked(e.gravity.x,0),pc.checked(e.gravity.y,0)):this.gravity=pc.Point.create(0,0);var t=new Box2D.Common.Math.b2Vec2(this.gravity.x*this.Class.SCALE,this.gravity.y*this.Class.SCALE);this.world=new Box2D.Dynamics.b2World(t,!0),e&&pc.valid(e.tileCollisionMap)&&(pc.assert(pc.valid(e.tileCollisionMap.tileMap),"A tileMap is required for a tileCollisionMap"),this.addTileCollisionMap(e.tileCollisionMap.tileMap,pc.checked(e.tileCollisionMap.collisionGroup,0),pc.checked(e.tileCollisionMap.collisionCategory,0),pc.checked(e.tileCollisionMap.collisionMask,0)));var n=new Box2D.Dynamics.b2ContactListener;n.BeginContact=this._beginContactListener.bind(this),n.EndContact=this._endContactListener.bind(this),n.PostSolve=this._postSolveListener.bind(this),this.world.SetContactListener(n);var r=Box2D.Dynamics.b2DebugDraw;this.debugDraw=new r,this.debugDraw.SetSprite(pc.device.ctx),this.debugDraw.SetDrawScale(this.Class.SCALE*100),this.debugDraw.SetFillAlpha(.3),this.debugDraw.SetLineThickness(1),this.debugDraw.SetFlags(r.e_shapeBit|r.e_jointBit|r.e_centerOfMassBit),e&&e.debug==1&&(this.debug=e.debug,this.setDebug(e.debug))},_beginContactListener:function(e){this.onCollisionStart(e.GetFixtureA().GetBody()._pc_bodyType,e.GetFixtureB().GetBody()._pc_bodyType,e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData(),e.GetFixtureA()._pc_type,e.GetFixtureB()._pc_type,e)},_endContactListener:function(e){this.onCollisionEnd(e.GetFixtureA().GetBody()._pc_bodyType,e.GetFixtureB().GetBody()._pc_bodyType,e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData(),e.GetFixtureA()._pc_type,e.GetFixtureB()._pc_type,e)},_postSolveListener:function(e,t){var n=t.normalImpulses[0];this.onCollision(e.GetFixtureA().GetBody()._pc_bodyType,e.GetFixtureB().GetBody()._pc_bodyType,e.GetFixtureA().GetBody().GetUserData(),e.GetFixtureB().GetBody().GetUserData(),n,e.GetFixtureA()._pc_type,e.GetFixtureB()._pc_type,e)},process:function(e){if(!e.active)return;var t=e.getComponent("spatial"),n=e.getComponent("physics");if(!n.active)return;var r=e.getComponent("joint");if(!n._body){var i=new Box2D.Dynamics.b2BodyDef;i.type=n.immovable?Box2D.Dynamics.b2BodyDef.b2_staticBody:i.type=Box2D.Dynamics.b2BodyDef.b2_dynamicBody,n.centered?(i.position.x=this.Class.toP(t.pos.x+t.dim.x/2),i.position.y=this.Class.toP(t.pos.y+t.dim.y/2)):(i.position.x=this.Class.toP(t.pos.x),i.position.y=this.Class.toP(t.pos.y)),i.linearDamping=n.linearDamping,i.angularDamping=n.angularDamping,i.isBullet=n.bullet,i.fixedRotation=n.fixedRotation,n._body=this.world.CreateBody(i),n._body.SetAngle(pc.Math.degToRad(t.dir)),n._body.SetUserData(e),n._body._pc_bodyType=pc.BodyType.ENTITY,n.linearVelocity&&n._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(n.linearVelocity.x*pc.systems.Physics.SCALE,n.linearVelocity.y*pc.systems.Physics.SCALE)),n.gravity&&n.setGravity(n.gravity.x,n.gravity.y),pc.assert(n.shapes.length,"You must specify at least one shape for a physics entity");for(var s=0;s<n.shapes.length;s++){var o=n.shapes[s],u=(t.dim.x+o.offset.w)*this.Class.SCALE,a=(t.dim.y+o.offset.h)*this.Class.SCALE,f=u/2,l=a/2,c=o.offset.x*this.Class.SCALE/2,h=o.offset.y*this.Class.SCALE/2;pc.assert(f>0&&l>0,"Physics requires a spatial size minimum of 1");var p=new Box2D.Dynamics.b2FixtureDef;p.density=n.density,p.friction=n.friction,p.restitution=n.bounce;switch(o.shape){case pc.CollisionShape.CIRCLE:p.shape=new Box2D.Collision.Shapes.b2CircleShape(u/2),p.shape.SetLocalPosition(Box2D.Common.Math.b2Vec2.Get(o.offset.x*this.Class.SCALE,o.offset.y*this.Class.SCALE));break;case pc.CollisionShape.POLY:p.shape=new Box2D.Collision.Shapes.b2PolygonShape;var d=[];for(var v=0;v<o.points.length;v++)d.push(Box2D.Common.Math.b2Vec2.Get((o.offset.x+o.points[v][0])*this.Class.SCALE,(o.offset.y+o.points[v][1])*this.Class.SCALE));p.shape.SetAsArray(d,d.length);break;default:p.shape=new Box2D.Collision.Shapes.b2PolygonShape,d=[],d.push(Box2D.Common.Math.b2Vec2.Get(-f+c,-l+h)),d.push(Box2D.Common.Math.b2Vec2.Get(f,-l+h)),d.push(Box2D.Common.Math.b2Vec2.Get(f,l)),d.push(Box2D.Common.Math.b2Vec2.Get(-f+c,l)),p.shape.SetAsArray(d,d.length)}p.filter.groupIndex=o.collisionGroup,p.filter.categoryBits=o.collisionCategory,p.filter.maskBits=o.collisionMask,p.isSensor=o.sensorOnly;var m=n._body.CreateFixture(p);m._pc_type=o.type,n._fixtures.push(m)}if(n.centerOfMass.x!=0||n.centerOfMass.y!=0||n.mass!=-1){var g=new Box2D.Collision.Shapes.b2MassData;g.center=Box2D.Common.Math.b2Vec2.Get(n.centerOfMass.x*pc.systems.Physics.SCALE,n.centerOfMass.y*pc.systems.Physics.SCALE),n.mass!=-1&&(g.mass=n.mass),g.I=1,n._body.SetMassData(g)}else g=new Box2D.Collision.Shapes.b2MassData,g.mass=1,g.I=1,n._body.SetMassData(g);n.torque&&n.applyTorque(n.torque),n.turn&&n.applyTurn(n.turn),n.force&&n.applyForce(n.force),n.impulse&&n.applyImpulse(n.impulse),n._lastSpatialPos=pc.Point.create(t.pos.x,t.pos.y),n._lastSpatialDim=pc.Dim.create(t.dim.x,t.dim.y),n._lastSpatialDir=t.dir}if(r&&!r._joint){var y=r.attachTo.getComponent("physics");if(y._body){var b=null;switch(r.type){case pc.JointType.WELD:b=new Box2D.Dynamics.Joints.b2WeldJointDef,b.bodyA=y._body,b.bodyB=n._body,b.collideConnected=!1,b.localAnchorA.Set(r.offset.x*this.Class.SCALE,r.offset.y*this.Class.SCALE),b.localAnchorB.Set(r.attachmentOffset.x*this.Class.SCALE,r.attachmentOffset.y*this.Class.SCALE),y._body.SetAwake(!0);var w=y._body.GetPosition();n._body.SetPosition({x:w.x+r.offset.x*this.Class.SCALE,y:w.y+r.offset.y*this.Class.SCALE});break;case pc.JointType.DISTANCE:b=new Box2D.Dynamics.Joints.b2DistanceJointDef,b.bodyA=y._body,b.bodyB=n._body,b.frequency=r.frequency,b.dampingRatio=r.dampingRatio,b.collideConnected=!1,b.length=r.distance,b.localAnchorA.Set(r.offset.x*this.Class.SCALE,r.offset.y*this.Class.SCALE),b.localAnchorB.Set(r.attachmentOffset.x*this.Class.SCALE,r.attachmentOffset.y*this.Class.SCALE),y._body.SetAwake(!0),w=y._body.GetPosition(),n._body.SetPosition({x:w.x+r.offset.x*this.Class.SCALE,y:w.y+r.offset.y*this.Class.SCALE});break;case pc.JointType.REVOLUTE:b=new Box2D.Dynamics.Joints.b2RevoluteJointDef,b.bodyA=y._body,b.bodyB=n._body,b.collideConnected=!1,b.referenceAngle=r.angle,b.localAnchorA.Set(r.offset.x*this.Class.SCALE,r.offset.y*this.Class.SCALE),b.localAnchorB.Set(r.attachmentOffset.x*this.Class.SCALE,r.attachmentOffset.y*this.Class.SCALE),y._body.SetAwake(!0),r.enableLimit&&(b.enableLimit=r.enableLimit,b.lowerAngle=pc.Math.degToRad(r.lowerAngleLimit),b.upperAngle=pc.Math.degToRad(r.upperAngleLimit)),r.enableMotor&&(b.enableMotor=r.enableMotor,b.motorSpeed=pc.Math.degToRad(r.motorSpeed),b.maxMotorTorque=r.maxMotorTorque);var E=y._body.GetPosition();n._body.SetPosition({x:E.x+this.Class.toP(r.offset.x),y:E.y+this.Class.toP(r.offset.y)})}if(!b)throw"Invalid attachment config";r._joint=this.world.CreateJoint(b)}}var S=n._body.GetPosition(),x=Math.round(pc.Math.radToDeg(n._body.GetAngle()));if(n._lastSpatialPos.x!=t.pos.x||n._lastSpatialPos.y!=t.pos.y){var T=n._lastSpatialPos.x!=t.pos.x?this.Class.toP(t.pos.x+t.dim.x/2):S.x,N=n._lastSpatialPos.y!=t.pos.y?this.Class.toP(t.pos.y+t.dim.y/2):S.y;n._body.SetPosition(Box2D.Common.Math.b2Vec2.Get(T,N))}n._lastSpatialDir!=t.dir&&(n._body.SetAngle(pc.Math.degToRad(t.dir)),x=Math.round(pc.Math.radToDeg(n._body.GetAngle()))),t.pos.x=Math.round(this.Class.fromP(S.x)-t.dim.x/2),t.pos.y=Math.round(this.Class.fromP(S.y)-t.dim.y/2),t.dir=x,n._lastSpatialPos.x=t.pos.x,n._lastSpatialPos.y=t.pos.y,n._lastSpatialDir=x;if(n.maxSpeed.x>0||n.maxSpeed.y>0){var C=n._body.GetLinearVelocity();if(C.x!=0||C.y!=0){var k=this.Class.toP(n.maxSpeed.x);C.x>0&&C.x>k&&n._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(k,C.y)),C.x<0&&C.x<-k&&n._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(-k,C.y));var L=this.Class.toP(n.maxSpeed.y);C.y>0&&C.y>L&&n._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(C.x,L)),C.y<0&&C.y<-L&&n._body.SetLinearVelocity(Box2D.Common.Math.b2Vec2.Get(C.x,-L))}}},onOriginChange:function(e,t){this.debugDraw.SetOrigin(e,t)},processAll:function(){this.world.Step(.08,10,10),this.world.DrawDebugData(),this.world.ClearForces(),this._super()},onAddedToLayer:function(e){var t=new Box2D.Collision.b2AABB;t.lowerBound.Set(0,0),t.upperBound.Set(this.Class.toP(e.worldSize.x),this.Class.toP(e.worldSize.y))},setDebug:function(e){e?this.world.SetDebugDraw(this.debugDraw):this.world.SetDebugDraw(null),this.debug=e},getEntitiesInArea:function(e){var t=new Box2D.Collision.b2AABB,n=[];return t.lowerBound.Set(e.x,e.y),t.upperBound.Set(e.w,e.h),this.world.QueryAABB(function(e){return n.push(e.GetBody().GetUserData()),!0},t),n},createStaticBody:function(e,t,n,r,i,s,o){var u=this.Class.toP(n/2),a=this.Class.toP(r/2),f=new Box2D.Dynamics.b2FixtureDef,l=new Box2D.Dynamics.b2BodyDef;l.type=Box2D.Dynamics.b2BodyDef.b2_staticBody,f.shape=new Box2D.Collision.Shapes.b2PolygonShape;var c=[];c.push(Box2D.Common.Math.b2Vec2.Get(-u,-a)),c.push(Box2D.Common.Math.b2Vec2.Get(u,-a)),c.push(Box2D.Common.Math.b2Vec2.Get(u,a)),c.push(Box2D.Common.Math.b2Vec2.Get(-u,a)),f.shape.SetAsArray(c,c.length),f.filter.groupIndex=i,f.filter.categoryBits=s,f.filter.maskBits=o,l.position.x=this.Class.toP(e)+u,l.position.y=this.Class.toP(t)+a;var h=this.world.CreateBody(l);h._pc_bodyType=pc.BodyType.TILE,h.CreateFixture(f)},addTileCollisionMap:function(e,t,n,r){for(var i=0;i<e.tilesHigh;i++){var s=0,o=0;for(var u=0;u<e.tilesWide;u++)e.tiles[i][u]>=0?o+=e.tileWidth:(o>0&&(this.createStaticBody(s,i*e.tileHeight,o,e.tileHeight,t,n,r),o=0),s=(u+1)*e.tileWidth)}},onCollisionStart:function(e,t,n,r,i,s,o){},onCollision:function(e,t,n,r,i,s,o,u){},onCollisionEnd:function(e,t,n,r,i,s,o){},onEntityAdded:function(e){},onEntityRemoved:function(e){var t=e.getComponent("physics");if(t._body){this.world.DestroyBody(t._body);var n=e.getComponent("attachment");n&&this.world.DestroyJoint(n._joint)}}}),define("playcraft/systems/physics",function(){}),pc.systems.Effects=pc.systems.EntitySystem.extend("pc.systems.Effects",{FadeState:{NOT_STARTED:0,DELAYING:1,FADING_IN:2,HOLDING:3,FADING_OUT:4,DONE:5}},{init:function(){this._super(["fade","spin","scale"])},processAll:function(){var e=this.entities.first;while(e){var t=e.obj;if(t.active){var n=t.getComponent("fade");if(n&&n.active){var r=t.getComponent("alpha");r||(r=t.addComponent(pc.components.Alpha.create({}))),n.state!=this.Class.FadeState.DONE&&(this._fade(r,n)||t.removeComponent(n))}var i=t.getComponent("spin");if(i&&i.spinning&&i.active){var s=t.getComponent("spatial"),o=i.rate/pc.device.elapsed;i.max>0&&i.spinSoFar+o>=i.max&&(i.spinning=!1,o=i.max-i.spinSoFar),i.spinSoFar+=o,s.setDir(pc.Math.rotate(s.getDir(),i.clockwise?o:-o))}var u=t.getComponent("scale");if(u&&u.scaling&&u.active){s=t.getComponent("spatial"),!u._bound&&(u.x!=1||u.y!=1)&&(s.addScale(u.x,u.y),u._bound=!0,u.growX==0&&u.growY==0&&(u.scaling=!1));var a=u.growX/pc.device.elapsed,f=u.growY/pc.device.elapsed;u.maxX!=0&&u.scaledXSoFar>0&&u.scaledXSoFar+a>=u.maxX&&(a=u.maxX-u.scaledXSoFar),u.maxY!=0&&u.scaledYSoFar>0&&u.scaledYSoFar+f>=u.maxY&&(f=u.maxY-u.scaledYSoFar),a!=0&&f!=0&&(u.scaledXSoFar+=a,u.scaledYSoFar+=f,s.addScale(a,f)),u.maxX!=0&&u.scaledXSoFar>=u.maxX&&u.maxY!=0&&u.scaledYSoFar>=u.maxY&&(u.scaling=!1),u._bound=!0}}e=e.next()}},_fade:function(e,t){var n=pc.device.now-t.startTime;switch(t.state){case this.Class.FadeState.NOT_STARTED:t.startTime=pc.device.now,t.startDelay>0?(t.state=this.Class.FadeState.DELAYING,t.timeLimit=t.startDelay,e.setAlpha(0)):t.fadeInTime>0?(t.state=this.Class.FadeState.FADING_IN,t.timeLimit=t.fadeInTime,e.setAlpha(0)):t.holdTime>0?(t.state=this.Class.FadeState.HOLDING,t.timeLimit=t.holdTime):t.fadeOutTime>0&&(t.state=this.Class.FadeState.FADING_OUT,t.timeLimit=t.fadeOutTime);break;case this.Class.FadeState.DELAYING:n>t.timeLimit&&(t.timeLimit=t.fadeInTime,t.startTime=pc.device.now,t.state=this.Class.FadeState.FADING_IN);break;case this.Class.FadeState.FADING_IN:e.addAlpha(pc.device.elapsed*(100/t.timeLimit)/100),n>t.timeLimit&&(t.timeLimit=t.holdTime,t.startTime=pc.device.now,t.state=this.Class.FadeState.HOLDING);break;case this.Class.FadeState.HOLDING:n>t.timeLimit&&(t.timeLimit=t.fadeOutTime,t.startTime=pc.device.now,t.state=this.Class.FadeState.FADING_OUT);break;case this.Class.FadeState.FADING_OUT:if(n>t.timeLimit){t.loopsSoFar++;if(t.loops>1||t.loops==0)t.startTime=pc.device.now,t.timeLimit=t.fadeInTime,t.state=this.Class.FadeState.FADING_IN,t.timeLimit>0&&e.setAlpha(0);if(t.loopsSoFar>=t.loops&&t.loops)return t.state=this.Class.FadeState.DONE,t.timeLimit>0&&e.setAlpha(0),!1}else e.subAlpha(pc.device.elapsed*(100/t.timeLimit)/100)}return!0}}),define("playcraft/systems/effects",function(){}),pc.systems.Particles=pc.systems.EntitySystem.extend("pc.systems.Particles",{},{init:function(){this._super(["emitter"])},_drawStartTime:0,process:function(e){if(!e.active)return;var t=e.getComponent("emitter");if(!t.active)return;var n=e.getComponent("spatial");n||(n=e.addComponent(new pc.components.Spatial({})));if(t){if(!t.active)return;if(t.emitting&&Date.now()-t._lastEmitTime>t.delay&&(t.shots==0||t._shotCount<t.shots)){for(var r=0;r<t.burst;r++){var i=0;t.spriteSheet.animations.size()==0&&(i=pc.Math.rand(0,t.spriteSheet.framesHigh*t.spriteSheet.framesWide-1)),t._particles.add(pc._Particle.create(n.pos.x+t.offsetX+pc.Math.rand(-(t.rangeX/2),t.rangeX/2),n.pos.y+t.offsetY+pc.Math.rand(-(t.rangeY/2),t.rangeY/2),pc.Math.rotate(t.relativeAngle?n.dir:0,pc.Math.rand(t.angleMin,t.angleMax)),pc.Math.randFloat(t.thrustMin,t.thrustMax),pc.Math.randFloat(t.lifeMin,t.lifeMax),pc.Math.randFloat(t.spinMin,t.spinMax),pc.Math.randFloat(t.growXMin,t.growXMax),pc.Math.randFloat(t.growYMin,t.growYMax),pc.Math.randFloat(t.scaleXMin,t.scaleXMax),pc.Math.randFloat(t.scaleYMin,t.scaleYMax),t.fadeInTime,t.fadeOutTime,t.alphaMin,t.alphaMax,t.spriteSheet,t.compositeOperation,i))}t._lastEmitTime=Date.now(),t._shotCount++}var s=t._particles.first;while(s){var o=s.obj;pc.device.now-o.start>t.thrustTime&&(o.thrust=0);var u=o.thrust*Math.cos(pc.Math.degToRad(o.dir)),a=o.thrust*Math.sin(pc.Math.degToRad(o.dir));o.velX+=u*(pc.device.elapsed/1e3)+t.gravityX,o.velY+=a*(pc.device.elapsed/1e3)+t.gravityY,o.velX=pc.Math.limit(o.velX,-t.maxVelX,t.maxVelX),o.velY=pc.Math.limit(o.velY,-t.maxVelY,t.maxVelY),o.x+=o.velX,o.y+=o.velY,o.spin&&(o.rotation=pc.Math.rotate(o.rotation,o.spin*(pc.device.elapsed/1e3)));if(o.growXRate!=0||o.growYRate!=0)o.scaleX+=o.growXRate*(pc.device.elapsed/1e3),o.scaleY+=o.growYRate*(pc.device.elapsed/1e3);o.fadeState==0&&(o.sprite.addAlpha(pc.device.elapsed*(100/o.fadeInTime)/100),pc.device.now-o.fadeStateStart>o.fadeInTime&&(o.fadeState++,o.fadeStateStart=pc.device.now)),o.fadeState==1&&pc.device.now-o.fadeStateStart>o.holdTime&&(o.fadeState++,o.fadeStateStart=pc.device.now);if(o.fadeState==2&&o.fadeOutTime>0){var f=pc.device.elapsed*(100/o.fadeOutTime)/100;o.sprite.subAlpha(f)}(o.alphaMin!=1||o.alphaMax!=1)&&pc.device.now-o.lastAlpha>t.alphaDelay&&(o.sprite.setAlpha(pc.Math.rand(o.alphaMin,o.alphaMax)),o.lastAlpha=pc.device.now),this.drawStartTime=Date.now(),(o.scaleX!=1||o.scaleY!=1)&&t.spriteSheet.setScale(o.scaleX,o.scaleY),o.sprite.currentAnim?(o.sprite.draw(pc.device.ctx,o.x-e.layer.origin.x-e.layer.scene.viewPort.x,o.y-e.layer.origin.y-e.layer.scene.viewPort.y,o.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime,o.sprite.update(pc.device.elapsed)):(o.sprite.drawFrame(pc.device.ctx,o.frame%t.spriteSheet.framesWide,Math.floor(o.frame/t.spriteSheet.framesWide),o.x-e.layer.origin.x-e.layer.scene.viewPort.x,o.y-e.layer.origin.y-e.layer.scene.viewPort.y,t.rotateSprite?o.rotation:o.dir),pc.device.lastDrawMS+=Date.now()-this.drawStartTime),(o.scaleX!=1||o.scaleY!=1)&&t.spriteSheet.setScale(1,1),s=s.next(),pc.device.now-o.start>o.lifetime&&(o.release(),t._particles.remove(o))}t.shots!=0&&t._particles.first==null&&t._shotCount>=t.shots&&(t.active=!1)}}}),pc._Particle=pc.Pooled.extend("pc._Particle",{create:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var g=this._super();return g.x=e,g.y=t,g.dir=n,g.thrust=r,g.frame=m,g.lifetime=i,g.spin=s,g.growXRate=o,g.growYRate=u,g.scaleX=a,g.scaleY=f,g.sprite==null?g.sprite=pc.Sprite.create(d):g.sprite.setSpriteSheet(d),g.start=pc.device.now,g.fadeStart=0,g.velX=0,g.velY=0,g.rotation=0,g.alphaMin=h,g.alphaMax=p,g.lastAlpha=pc.device.now,g.fadeInTime=l,g.fadeOutTime=c,g.holdTime=g.lifetime-(g.fadeInTime+g.fadeOutTime),v?g.sprite.setCompositeOperation(v):g.sprite.setCompositeOperation("source-over"),g.fadeState=1,g.fadeStateStart=pc.device.now,g.fadeInTime>0?(g.fadeState=0,g.sprite.setAlpha(0)):g.sprite.setAlpha(1),g}},{x:0,y:0,dir:0,rotation:0,thrust:0,sprite:null,start:0,frame:0,fadeStart:0,velX:0,velY:0,spin:0,growXRate:0,growYRate:0,scaleX:1,scaleY:1,fadeInTime:0,fadeOutTime:0,fadeStateStart:0,holdTime:0,fadeState:1,alphaMin:1,alphaMax:1,lastAlpha:0}),define("playcraft/systems/particles",function(){}),pc.systems.Input=pc.systems.EntitySystem.extend("pc.systems.Input",{},{init:function(){this._super(["input"])},process:function(e){var t=e.getComponent("input");if(!t.active)return;if(!t._bound){var n=e.getComponent("spatial"),r=e;t.target&&(r=t.target);if(t.states)for(var i=0;i<t.states.length;i++){var s=t.states[i][1];for(var o=0;o<s.length;o++){var u=n;pc.valid(t.states[i][2])&&t.states[i][2]==0&&(u=null),pc.device.input.bindState(r,t.states[i][0],s[o],u)}}if(t.actions){r=this;for(i=0;i<t.actions.length;i++){s=t.actions[i][1];for(o=0;o<s.length;o++)u=n,pc.valid(t.actions[i][2])&&t.actions[i][2]==0&&(u=null),pc.device.input.bindAction(r,t.actions[i][0],s[o],u)}}t._bound=!0}},onAction:function(e,t,n,r){},isInputState:function(e,t){return e.getComponent("input")._bound?pc.device.input.isInputState(e,t):!1}}),define("playcraft/systems/input",function(){}),pc.systems.Expiration=pc.systems.EntitySystem.extend("pc.systems.Expiration",{},{init:function(){this._super(["expiry"])},process:function(e){var t=e.getComponent("expiry");if(!t.active)return;t.decrease(pc.device.elapsed),t.hasExpired()&&e.remove()}}),define("playcraft/systems/expiry",function(){}),pc.systems.Activation=pc.systems.EntitySystem.extend("pc.systems.Activation",{},{init:function(e){this._super(["activator"],e)},onEntityAdded:function(e){e.active=!1},process:function(e){var t=e.getComponent("activator");if(!t.active)return;if(e.active&&t.stayActive)return;t._cacheLayer||(t.layer?t._cacheLayer=e.layer.scene.get(t.layer):t._cacheLayer=e.layer);var n=t._cacheLayer.getEntityManager().getTagged(t.tag);if(!n)return;var r=n.first;while(r){var i=e.getComponent("spatial"),s=r.object().getComponent("spatial"),o=i.getCenterPos().distance(s.getCenterPos());e.active?o>=t.range&&(e.active=!1):o<t.range&&(e.active=!0),r=r.next()}}}),define("playcraft/systems/activation",function(){}),pc.systems.Render=pc.systems.EntitySystem.extend("pc.systems.Render",{},{init:function(){this._super(["sprite","overlay","rect","text","poly","circle"])},processAll:function(){var e=Date.now(),t=this.entities.first;while(t){var n=t.obj;if(n.active){var r=n.getComponent("spatial"),i=n.getComponent("alpha"),s=n.getComponent("clip"),o=n.layer.screenX(r.pos.x),u=n.layer.screenY(r.pos.y),a=r.getUnscaledPos(),f=r.getUnscaledDim(),l=pc.device.ctx;l.save();if(r.scaleX!=1||r.scaleY!=1)o=n.layer.screenX(a.x),u=n.layer.screenY(a.y),l.scale(r.scaleX,r.scaleY);if(n.layer.scene.viewPort.overlaps(o,u,r.dim.x,r.dim.y,0,r.dir)){if(s&&s.active){l.beginPath();if(s.clipEntity){var c=s.clipEntity.getComponent("spatial");l.rect(n.layer.screenX(c.pos.x)+s.x,n.layer.screenY(c.pos.y)+s.y,c.dim.x+s.w,c.dim.y+s.h)}else l.rect(n.layer.screenX(r.pos.x)+s.x,n.layer.screenY(r.pos.y)+s.y,s.w,s.h);l.closePath(),l.clip()}var h=n.getComponent("originshifter");if(h&&h.active){var p=r.pos.x-h._offsetX,d=r.pos.y-h._offsetY;h._offsetX=this.layer.origin.x*h.ratio,h._offsetY=this.layer.origin.y*h.ratio,r.pos.x=p+h._offsetX,r.pos.y=d+h._offsetY}var v=n.getComponent("sprite");v&&v.active&&(v.sprite.update(pc.device.elapsed),i&&i.level!=1&&i.level!=0&&(v.sprite.alpha=i.level),(r.scaleX!=1||r.scaleY!=1)&&v.sprite.setScale(r.scaleX,r.scaleY),v.sprite.draw(l,o+v.offset.x,u+v.offset.y,r.dir),(r.scaleX!=1||r.scaleY!=1)&&v.sprite.setScale(1,1));var m=n.getComponent("overlay");m&&m.active&&(m.sprite.update(pc.device.elapsed),i&&(m.sprite.alpha=i.level),m.sprite.draw(l,o,u,r.dir),m.decrease(pc.device.elapsed),m.hasExpired()&&n.removeComponent(m));var g=t.obj.getComponent("rect");if(g&&g.active){l.save(),i&&(l.globalAlpha=i.level),l.translate(o+f.x/2,u+f.y/2),l.rotate(r.dir*(Math.PI/180));if(g.cornerRadius>0){var y=-f.x/2,b=-f.y/2;l.beginPath(),l.moveTo(-f.x/2+g.cornerRadius,-f.y),l.lineTo(o+f.x-g.cornerRadius,u),l.quadraticCurveTo(o+f.x,u,o+f.x,u+g.cornerRadius),l.lineTo(o+f.x,u+f.y-g.cornerRadius),l.quadraticCurveTo(o+f.x,u+f.y,o+f.x-g.cornerRadius,u+f.y),l.lineTo(o+g.cornerRadius,u+f.y),l.quadraticCurveTo(o,u+f.y,o,u+f.y-g.cornerRadius),l.lineTo(o,u+g.cornerRadius),l.quadraticCurveTo(o,u,o+g.cornerRadius,u),l.closePath(),g.color&&(l.fillStyle=g.color.color,l.fill()),g.lineColor&&g.lineWidth&&(l.lineWidth=g.lineWidth,l.strokeStyle=g.lineColor.color,l.stroke())}else g.color&&(l.fillStyle=g.color.color,l.fillRect(-f.x/2,-f.y/2,f.x,f.y)),g.lineColor&&g.lineWidth&&(l.lineWidth=g.lineWidth,l.strokeStyle=g.lineColor.color,l.strokeRect(-f.x/2,-f.y/2,f.x,f.y));i&&(l.globalAlpha=1),l.restore(),pc.device.elementsDrawn++}var w=t.obj.getComponent("circle");w&&w.active&&(l.save(),l.lineWidth=w.lineWidth,i&&(l.globalAlpha=i.level),l.translate(o+r.dim.x/2,u+r.dim.y/2),l.rotate(r.dir*(Math.PI/180)),l.beginPath(),l.arc(0,0,r.dim.x/2,0,pc.Math.PI*2,!0),l.closePath(),w.color&&(l.fillStyle=w.color.color,l.fill()),w.lineColor&&(l.lineWidth=w.lineWidth,l.strokeStyle=w.lineColor.color,l.stroke()),i&&(l.globalAlpha=1),l.restore(),pc.device.elementsDrawn++);var E=t.obj.getComponent("poly");if(E&&E.active){l.save(),i&&(l.globalAlpha=i.level);var S=r.dim.x/2,x=r.dim.y/2;l.translate(o+S,u+x),l.rotate(r.dir*(Math.PI/180)),l.beginPath(),l.moveTo(E.points[0][0]-S,E.points[0][1]-x);for(var T=1;T<E.points.length;T++)l.lineTo(E.points[T][0]-S,E.points[T][1]-x);l.closePath(),E.color&&(l.fillStyle=E.color.color,l.fill()),E.lineColor&&(l.lineWidth=E.lineWidth,l.strokeStyle=E.lineColor.color,l.stroke()),i&&(l.globalAlpha=1),l.restore(),pc.device.elementsDrawn++}var N=n.getComponent("text");if(N&&N.active){l.save();var C=0;i&&(l.globalAlpha=i.level),S=r.dim.x/2,x=r.dim.y/2,l.font=N._fontCache,l.lineWidth=N.lineWidth,l.translate(o+S,u+x),l.rotate(r.dir*(Math.PI/180));for(var k=0;k<N.text.length;k++)N.color&&(l.fillStyle=N.color.color,l.fillText(N.text[k],N.offset.x-S,C+r.dim.y+N.offset.y-x)),N.strokeColor&&N.lineWidth&&(l.strokeStyle=N.strokeColor.color,l.strokeText(N.text[k],N.offset.x-S,C+r.dim.y+N.offset.y-x)),C+=N.fontHeight*1.1;i&&(l.globalAlpha=1),pc.device.elementsDrawn++,l.restore()}l.restore()}}t=t.next()}pc.device.lastDrawMS+=Date.now()-e}}),define("playcraft/systems/render",function(){}),pc.systems.Layout=pc.systems.EntitySystem.extend("pc.systems.Layout",{},{margin:null,init:function(e){this._super(["layout"]),this.margin={},pc.checked(e)&&pc.checked(e.margin)?(this.margin.left=pc.checked(e.margin.left,0),this.margin.right=pc.checked(e.margin.right,0),this.margin.top=pc.checked(e.margin.top,0),this.margin.bottom=pc.checked(e.margin.bottom,0)):(this.margin.left=0,this.margin.right=0,this.margin.top=0,this.margin.bottom=0)},_getAnchorLocation:function(e,t){if(e==="left"){if(t==="top")return"top-left";if(t==="middle")return"middle-left";if(t==="bottom")return"bottom-left"}if(e==="center"){if(t==="top")return"top-center";if(t==="middle")return"middle-center";if(t==="bottom")return"bottom-center"}if(e==="right"){if(t==="top")return"top-right";if(t==="middle")return"middle-right";if(t==="bottom")return"bottom-right"}return null},doLayout:function(){var e=new pc.HashList,t=this.entities.first;while(t){var n=t.obj,r=n.getComponent("spatial");r||n.addComponent(pc.components.Spatial({}));var i=n.getComponent("layout"),s=this._getAnchorLocation(i.horizontal,i.vertical);e.add(s,t.obj),t=t.next()}var o=e.hashtable.keys();for(var u=0;u<o.length;u++){var a=o[u],f=e.get(o[u]),l=this._getEntityDimensions(f),c=this.margin.left,h=this.margin.top;switch(a){case"top-left":break;case"middle-left":h+=this.layer.getScreenRect().h/2-l.y/2;break;case"bottom-left":h=this.layer.getScreenRect().h-l.y-this.margin.bottom;break;case"top-center":c+=this.layer.getScreenRect().w/2-l.x/2;break;case"middle-center":c+=this.layer.getScreenRect().w/2-l.x/2,h+=this.layer.getScreenRect().h/2-l.y/2;break;case"bottom-center":c=this.layer.getScreenRect().w/2-l.x/2-this.margin.bottom,h+=this.layer.getScreenRect().h-l.y;break;case"top-right":c+=this.layer.getScreenRect().w-l.x;break;case"middle-right":c+=this.layer.getScreenRect().w-l.x,h+=this.layer.getScreenRect().h/2-l.y/2;break;case"bottom-right":c+=this.layer.getScreenRect().w-l.x,h=this.layer.getScreenRect().h-l.y-this.margin.bottom}var p=f.first;while(p){n=p.obj,r=n.getComponent("spatial"),i=n.getComponent("layout"),h+=i.margin.top;switch(a){case"top-left":case"middle-left":case"bottom-left":c=i.margin.left+this.margin.left;break;case"top-center":case"middle-center":case"bottom-center":c=i.margin.left+this.layer.getScreenRect().w/2-r.dim.x/2;break;case"top-right":case"middle-right":case"bottom-right":c=this.layer.getScreenRect().w-r.dim.x-i.margin.right-this.margin.right}r.pos.x=c,r.pos.y=h,h+=r.dim.y+i.margin.bottom,p=p.next()}}},_entityDim:null,_getEntityDimensions:function(e){this._entityDim||(this._entityDim=new pc.Dim),this._entityDim.x=0,this._entityDim.y=0;var t=e.first;while(t){var n=t.obj.getComponent("spatial"),r=t.obj.getComponent("layout");n&&(this._entityDim.x+=r.margin.left+n.dim.x+r.margin.right,this._entityDim.y+=r.margin.top+n.dim.y+r.margin.bottom),t=t.nextLinked}return this._entityDim},onResize:function(e,t){this.doLayout()},onEntityAdded:function(e){this._super(),this.doLayout()},onEntityRemoved:function(e){this._super(),this.doLayout()},onComponentAdded:function(e,t){this._super(),this.doLayout()}}),define("playcraft/systems/layout",function(){}),window.pc||(window.pc={},pc.VERSION="0.5.6"),define("pc",["playcraft/ext/gamecore.js/src/gamecore","playcraft/ext/gamecore.js/src/class","playcraft/ext/gamecore.js/src/base","playcraft/ext/gamecore.js/src/jhashtable","playcraft/ext/gamecore.js/src/device","playcraft/ext/gamecore.js/src/perf","playcraft/ext/gamecore.js/src/linkedlist","playcraft/ext/gamecore.js/src/hashlist","playcraft/ext/gamecore.js/src/stacktrace","playcraft/ext/gamecore.js/src/pooled","playcraft/ext/box2dweb.2.1a-pc","playcraft/boot","playcraft/input","playcraft/hashmap","playcraft/tools","playcraft/color","playcraft/debug","playcraft/device","playcraft/sound","playcraft/layer","playcraft/entitylayer","playcraft/tileset","playcraft/tilemap","playcraft/tilelayer","playcraft/hextilelayer","playcraft/entity","playcraft/sprite","playcraft/spritesheet","playcraft/math","playcraft/image","playcraft/scene","playcraft/game","playcraft/loader","playcraft/dataresource","playcraft/components/component","playcraft/components/physics","playcraft/components/alpha","playcraft/components/joint","playcraft/components/expiry","playcraft/components/originshifter","playcraft/components/spatial","playcraft/components/overlay","playcraft/components/clip","playcraft/components/activator","playcraft/components/input","playcraft/components/fade","playcraft/components/spin","playcraft/components/scale","playcraft/components/rect","playcraft/components/poly","playcraft/components/circle","playcraft/components/text","playcraft/components/sprite","playcraft/components/layout","playcraft/components/particleemitter","playcraft/systems/system","playcraft/es/entitymanager","playcraft/es/systemmanager","playcraft/systems/entitysystem","playcraft/systems/physics","playcraft/systems/effects","playcraft/systems/particles","playcraft/systems/input","playcraft/systems/expiry","playcraft/systems/activation","playcraft/systems/render","playcraft/systems/layout"],function(){return window.pc}),function(e){function U(e,t,n){var r=(n||0)-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function z(e,t){var n=typeof t;e=e.cache;if(n=="boolean"||t==null)return e[t];n!="number"&&n!="string"&&(n="object");var r=n=="number"?t:o+t;return e=e[n]||(e[n]={}),n=="object"?e[r]&&U(e[r],t)>-1?0:-1:e[r]?0:-1}function W(e){var t=this.cache,n=typeof e;if(n=="boolean"||e==null)t[e]=!0;else{n!="number"&&n!="string"&&(n="object");var r=n=="number"?e:o+e,i=t[n]||(t[n]={});n=="object"?(i[r]||(i[r]=[])).push(e)==this.array.length&&(t[n]=!1):i[r]=!0}}function X(e){return e.charCodeAt(0)}function V(e,t){var n=e.index,r=t.index;e=e.criteria,t=t.criteria;if(e!==t){if(e>t||typeof e=="undefined")return 1;if(e<t||typeof t=="undefined")return-1}return n<r?-1:1}function $(e){var t=-1,n=e.length,r=Q();r["false"]=r["null"]=r["true"]=r["undefined"]=!1;var i=Q();i.array=e,i.cache=r,i.push=W;while(++t<n)i.push(e[t]);return r.object===!1?(et(i),null):i}function J(e){return"\\"+F[e]}function K(){return n.pop()||[]}function Q(){return r.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,"undefined":!1,useHas:!1,useKeys:!1,value:null}}function G(e){return typeof e.toString!="function"&&typeof (e+"")=="string"}function Y(){}function Z(e){e.length=0,n.length<a&&n.push(e)}function et(e){var t=e.cache;t&&et(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,r.length<a&&r.push(e)}function tt(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function nt(n){function Ut(e){return e&&typeof e=="object"&&!sn(e)&&Et.call(e,"__wrapped__")?e:new zt(e)}function zt(e){this.__wrapped__=e}function Kt(e,t,n,r){function a(){var r=arguments,f=s?this:t;i||(e=t[o]),n.length&&(r=r.length?(r=jt.call(r),u?r.concat(n):n.concat(r)):n);if(this instanceof a){f=Gt(e.prototype);var l=e.apply(f,r);return Ln(l)?l:f}return e.apply(f,r)}var i=kn(e),s=!n,o=t;if(s){var u=r;n=t}else if(!i){if(!r)throw new at;t=e}return a}function Qt(){var e=Q();e.shadowedProps=x,e.array=e.bottom=e.loop=e.top="",e.init="iterable",e.useHas=!0,e.useKeys=!!un;for(var t,n=0;t=arguments[n];n++)for(var r in t)e[r]=t[r];var i=e.args;e.firstArg=/^[^,]+/.exec(i)[0];var s=R("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+Xt(e)+"\n}");return et(e),s(O,lt,Et,rn,sn,Pn,un,Ut,ct,j,Rt,H,ht,Ct)}function Gt(e){return Ln(e)?Lt(e):{}}function Yt(e){return fn[e]}function Zt(e,t,n){var r=(r=Ut.indexOf)===vr?U:r;return r}function en(e){return function(n,r,i,s){return typeof r!="boolean"&&r!=null&&(s=i,i=!s||s[r]!==n?r:t,r=!1),i!=null&&(i=Ut.createCallback(i,s)),e(n,r,i,s)}}function tn(e){var n,r;return!e||Ct.call(e)!=D||(n=e.constructor,kn(n)&&!(n instanceof n))||!Wt.argsClass&&rn(e)||!Wt.nodeClass&&G(e)?!1:Wt.ownLast?(mn(e,function(e,t,n){return r=Et.call(n,t),!1}),r!==!1):(mn(e,function(e,t){r=t}),r===t||Et.call(e,r))}function nn(e){return ln[e]}function rn(e){return Ct.call(e)==N}function hn(e,n,r,i,s,o){var u=e;typeof n!="boolean"&&n!=null&&(i=r,r=n,n=!1);if(typeof r=="function"){r=typeof i=="undefined"?r:Ut.createCallback(r,i,1),u=r(u);if(typeof u!="undefined")return u;u=e}var a=Ln(u);if(a){var f=Ct.call(u);if(!B[f]||!Wt.nodeClass&&G(u))return u;var l=sn(u)}if(!a||!n)return a?l?tt(u):cn({},u):u;var c=qt[f];switch(f){case L:case A:return new c(+u);case _:case H:return new c(u);case P:return c(u.source,d.exec(u))}var h=!s;s||(s=K()),o||(o=K());var p=s.length;while(p--)if(s[p]==e)return o[p];return u=l?c(u.length):{},l&&(Et.call(e,"index")&&(u.index=e.index),Et.call(e,"input")&&(u.input=e.input)),s.push(e),o.push(u),(l?an:gn)(e,function(e,i){u[i]=hn(e,n,r,t,s,o)}),h&&(Z(s),Z(o)),u}function pn(e,t,n){return hn(e,!0,t,n)}function vn(e,t,n){var r;return t=Ut.createCallback(t,n),gn(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function yn(e){var t=[];return mn(e,function(e,n){kn(e)&&t.push(n)}),t.sort()}function bn(e,t){return e?Et.call(e,t):!1}function wn(e){var t=-1,n=un(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function En(e){return e===!0||e===!1||Ct.call(e)==L}function Sn(e){return e?typeof e=="object"&&Ct.call(e)==A:!1}function xn(e){return e?e.nodeType===1:!1}function Tn(e){var t=!0;if(!e)return t;var n=Ct.call(e),r=e.length;return n==C||n==H||(Wt.argsClass?n==N:rn(e))||n==D&&typeof r=="number"&&kn(e.splice)?!r:(gn(e,function(){return t=!1}),t)}function Nn(e,t,n,r,i,o){var u=n===s;if(typeof n=="function"&&!u){n=Ut.createCallback(n,r,2);var a=n(e,t);if(typeof a!="undefined")return!!a}if(e===t)return e!==0||1/e==1/t;var f=typeof e,l=typeof t;if(e===e&&(!e||f!="function"&&f!="object")&&(!t||l!="function"&&l!="object"))return!1;if(e==null||t==null)return e===t;var c=Ct.call(e),h=Ct.call(t);c==N&&(c=D),h==N&&(h=D);if(c!=h)return!1;switch(c){case L:case A:return+e==+t;case _:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case P:case H:return e==ut(t)}var p=c==C;if(!p){if(Et.call(e,"__wrapped__ ")||Et.call(t,"__wrapped__"))return Nn(e.__wrapped__||e,t.__wrapped__||t,n,r,i,o);if(c!=D||!Wt.nodeClass&&(G(e)||G(t)))return!1;var d=!Wt.argsObject&&rn(e)?st:e.constructor,v=!Wt.argsObject&&rn(t)?st:t.constructor;if(d!=v&&!(kn(d)&&d instanceof d&&kn(v)&&v instanceof v))return!1}var m=!i;i||(i=K()),o||(o=K());var g=i.length;while(g--)if(i[g]==e)return o[g]==t;var y=0;a=!0,i.push(e),o.push(t);if(p){g=e.length,y=t.length,a=y==e.length;if(!a&&!u)return a;while(y--){var b=g,w=t[y];if(u){while(b--)if(a=Nn(e[b],w,n,r,i,o))break}else if(!(a=Nn(e[y],w,n,r,i,o)))break}return a}return mn(t,function(t,s,u){if(Et.call(u,s))return y++,a=Et.call(e,s)&&Nn(e[s],t,n,r,i,o)}),a&&!u&&mn(e,function(e,t,n){if(Et.call(n,t))return a=--y>-1}),m&&(Z(i),Z(o)),a}function Cn(e){return Ot(e)&&!Mt(parseFloat(e))}function kn(e){return typeof e=="function"}function Ln(e){return!!e&&!!j[typeof e]}function An(e){return Mn(e)&&e!=+e}function On(e){return e===null}function Mn(e){return typeof e=="number"||Ct.call(e)==_}function Dn(e){return!!e&&!!j[typeof e]&&Ct.call(e)==P}function Pn(e){return typeof e=="string"||Ct.call(e)==H}function Hn(e){return typeof e=="undefined"}function Bn(e,t,n){var r=arguments,i=0,o=2;if(!Ln(e))return e;if(n===s)var u=r[3],a=r[4],f=r[5];else{var l=!0;a=K(),f=K(),typeof n!="number"&&(o=r.length),o>3&&typeof r[o-2]=="function"?u=Ut.createCallback(r[--o-1],r[o--],2):o>2&&typeof r[o-1]=="function"&&(u=r[--o])}while(++i<o)(sn(r[i])?Jn:gn)(r[i],function(t,n){var r,i,o=t,l=e[n];if(t&&((i=sn(t))||_n(t))){var c=a.length;while(c--)if(r=a[c]==t){l=f[c];break}if(!r){var h;if(u){o=u(l,t);if(h=typeof o!="undefined")l=o}h||(l=i?sn(l)?l:[]:_n(l)?l:{}),a.push(t),f.push(l),h||(l=Bn(l,t,s,u,a,f))}}else u&&(o=u(l,t),typeof o=="undefined"&&(o=t)),typeof o!="undefined"&&(l=o);e[n]=l});return l&&(Z(a),Z(f)),e}function jn(e,t,n){var r=Zt(),i=typeof t=="function",s={};if(i)t=Ut.createCallback(t,n);else var o=gt.apply(ft,jt.call(arguments,1));return mn(e,function(e,n,u){if(i?!t(e,n,u):r(o,n)<0)s[n]=e}),s}function Fn(e){var t=-1,n=un(e),i=n.length,s=r(i);while(++t<i){var o=n[t];s[t]=[o,e[o]]}return s}function In(e,t,n){var r={};if(typeof t!="function"){var i=-1,s=gt.apply(ft,jt.call(arguments,1)),o=Ln(e)?s.length:0;while(++i<o){var u=s[i];u in e&&(r[u]=e[u])}}else t=Ut.createCallback(t,n),mn(e,function(e,n,i){t(e,n,i)&&(r[n]=e)});return r}function qn(e,t,n,r){var i=sn(e);t=Ut.createCallback(t,r,4);if(n==null)if(i)n=[];else{var s=e&&e.constructor,o=s&&s.prototype;n=Gt(o)}return(i?an:gn)(e,function(e,r,i){return t(n,e,r,i)}),n}function Rn(e){var t=-1,n=un(e),i=n.length,s=r(i);while(++t<i)s[t]=e[n[t]];return s}function Un(e){var t=-1,n=gt.apply(ft,jt.call(arguments,1)),i=n.length,s=r(i);Wt.unindexedChars&&Pn(e)&&(e=e.split(""));while(++t<i)s[t]=e[n[t]];return s}function zn(e,t,n){var r=-1,i=Zt(),s=e?e.length:0,o=!1;return n=(n<0?Dt(0,s+n):n)||0,s&&typeof s=="number"?o=(Pn(e)?e.indexOf(t,n):i(e,t,n))>-1:an(e,function(e){if(++r>=n)return!(o=e===t)}),o}function Wn(e,t,n){var r={};return t=Ut.createCallback(t,n),Jn(e,function(e,n,i){n=ut(t(e,n,i)),Et.call(r,n)?r[n]++:r[n]=1}),r}function Xn(e,t,n){var r=!0;t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s)if(!(r=!!t(e[i],i,e)))break}else an(e,function(e,n,i){return r=!!t(e,n,i)});return r}function Vn(e,t,n){var r=[];t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}}else an(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $n(e,t,n){t=Ut.createCallback(t,n);if(!sn(e)){var o;return an(e,function(e,n,r){if(t(e,n,r))return o=e,!1}),o}var r=-1,i=e.length;while(++r<i){var s=e[r];if(t(s,r,e))return s}}function Jn(e,t,n){if(t&&typeof n=="undefined"&&sn(e)){var r=-1,i=e.length;while(++r<i)if(t(e[r],r,e)===!1)break}else an(e,t,n);return e}function Kn(e,t,n){var r={};return t=Ut.createCallback(t,n),Jn(e,function(e,n,i){n=ut(t(e,n,i)),(Et.call(r,n)?r[n]:r[n]=[]).push(e)}),r}function Qn(e,t){var n=jt.call(arguments,2),i=-1,s=typeof t=="function",o=e?e.length:0,u=r(typeof o=="number"?o:0);return Jn(e,function(e){u[++i]=(s?t:e[t]).apply(e,n)}),u}function Gn(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=Ut.createCallback(t,n);if(sn(e))while(++i<s)o[i]=t(e[i],i,e);else an(e,function(e,n,r){o[++i]=t(e,n,r)});return o}function Yn(e,t,n){var r=-Infinity,i=r;if(!t&&sn(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u>i&&(i=u)}}else t=!t&&Pn(e)?X:Ut.createCallback(t,n),an(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function Zn(e,t,n){var r=Infinity,i=r;if(!t&&sn(e)){var s=-1,o=e.length;while(++s<o){var u=e[s];u<i&&(i=u)}}else t=!t&&Pn(e)?X:Ut.createCallback(t,n),an(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function tr(e,t,n,r){var i=arguments.length<3;t=Ut.createCallback(t,r,4);if(sn(e)){var s=-1,o=e.length;i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else an(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function nr(e,t,n,r){var i=e,s=e?e.length:0,o=arguments.length<3;if(typeof s!="number"){var u=un(e);s=u.length}else Wt.unindexedChars&&Pn(e)&&(i=e.split(""));return t=Ut.createCallback(t,r,4),Jn(e,function(e,r,a){r=u?u[--s]:--s,n=o?(o=!1,i[r]):t(n,i[r],r,a)}),n}function rr(e,t,n){return t=Ut.createCallback(t,n),Vn(e,function(e,n,r){return!t(e,n,r)})}function ir(e){var t=-1,n=e?e.length:0,i=r(typeof n=="number"?n:0);return Jn(e,function(e){var n=yt(Bt()*(++t+1));i[t]=i[n],i[n]=e}),i}function sr(e){var t=e?e.length:0;return typeof t=="number"?t:un(e).length}function or(e,t,n){var r;t=Ut.createCallback(t,n);if(sn(e)){var i=-1,s=e.length;while(++i<s)if(r=t(e[i],i,e))break}else an(e,function(e,n,i){return!(r=t(e,n,i))});return!!r}function ur(e,t,n){var i=-1,s=e?e.length:0,o=r(typeof s=="number"?s:0);t=Ut.createCallback(t,n),Jn(e,function(e,n,r){var s=o[++i]=Q();s.criteria=t(e,n,r),s.index=i,s.value=e}),s=o.length,o.sort(V);while(s--){var u=o[s];o[s]=u.value,et(u)}return o}function ar(e){return e&&typeof e.length=="number"?Wt.unindexedChars&&Pn(e)?e.split(""):tt(e):Rn(e)}function lr(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function cr(e){var t=-1,n=Zt(),r=e?e.length:0,i=gt.apply(ft,jt.call(arguments,1)),s=[],o=r>=u&&n===U;if(o){var a=$(i);a?(n=z,i=a):o=!1}while(++t<r){var f=e[t];n(i,f)<0&&s.push(f)}return o&&et(i),s}function hr(e,t,n){var r=-1,i=e?e.length:0;t=Ut.createCallback(t,n);while(++r<i)if(t(e[r],r,e))return r;return-1}function pr(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=-1;t=Ut.createCallback(t,n);while(++s<i&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[0]}return tt(e,0,Pt(Dt(0,r),i))}}function vr(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?Dt(0,r+n):n||0}else if(n){var i=Sr(e,t);return e[i]===t?i:-1}return e?U(e,t,n):-1}function mr(e,t,n){if(!e)return[];var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=Ut.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return tt(e,0,Pt(Dt(0,i-r),i))}function gr(e){var t=arguments,n=t.length,r=-1,i=K(),s=-1,o=Zt(),a=e?e.length:0,f=[],l=K();while(++r<n){var c=t[r];i[r]=o===U&&(c?c.length:0)>=u&&$(r?t[r]:l)}e:while(++s<a){var h=i[0];c=e[s];if((h?z(h,c):o(l,c))<0){r=n,(h||l).push(c);while(--r){h=i[r];if((h?z(h,c):o(t[r],c))<0)continue e}f.push(c)}}while(n--)h=i[n],h&&et(h);return Z(i),Z(l),f}function yr(e,t,n){if(e){var r=0,i=e.length;if(typeof t!="number"&&t!=null){var s=i;t=Ut.createCallback(t,n);while(s--&&t(e[s],s,e))r++}else{r=t;if(r==null||n)return e[i-1]}return tt(e,Dt(0,i-r))}}function br(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?Dt(0,r+n):Pt(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function wr(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var i=-1,s=Dt(0,vt((t-e)/n)),o=r(s);while(++i<s)o[i]=e,e+=n;return o}function Er(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Ut.createCallback(t,n);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:Dt(0,t);return tt(e,r)}function Sr(e,t,n,r){var i=0,s=e?e.length:i;n=n?Ut.createCallback(n,r,1):Xr,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function xr(e){return sn(e)||(arguments[0]=e?jt.call(e):ft),Tr(gt.apply(ft,arguments))}function Nr(e){var t=-1,n=e?Yn(er(e,"length")):0,i=r(n<0?0:n);while(++t<n)i[t]=er(e,t);return i}function Cr(e){return cr(e,jt.call(arguments,1))}function kr(e){return e?Nr(arguments):[]}function Lr(e,t){var n=-1,r=e?e.length:0,i={};while(++n<r){var s=e[n];t?i[s]=t[n]:i[s[0]]=s[1]}return i}function Ar(e,t){return e<1?t():function(){if(--e<1)return t.apply(this,arguments)}}function Or(e,t){return Wt.fastBind||kt&&arguments.length>2?kt.call.apply(kt,arguments):Kt(e,t,jt.call(arguments,2))}function Mr(e){var t=arguments.length>1?gt.apply(ft,jt.call(arguments,1)):yn(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=Or(e[i],e)}return e}function _r(e,t){return Kt(e,t,jt.call(arguments,2),s)}function Dr(){var e=arguments;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Pr(e,t,n){if(e==null)return Xr;var r=typeof e;if(r!="function"){if(r!="object")return function(t){return t[e]};var i=un(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=Nn(t[i[n]],e[i[n]],s)))break;return r}}return typeof t=="undefined"||m&&!m.test(bt.call(e))?e:n===1?function(n){return e.call(t,n)}:n===2?function(n,r){return e.call(t,n,r)}:n===4?function(n,r,i,s){return e.call(t,n,r,i,s)}:function(n,r,i){return e.call(t,n,r,i)}}function Hr(e,t,n){function h(){mt(f),mt(l),o=0,f=l=null}function p(){var t=c&&(!v||o>1);h(),t&&(a!==!1&&(u=new F),i=e.apply(s,r))}function d(){h();if(c||a!==t)u=new F,i=e.apply(s,r)}var r,i,s,o=0,u=0,a=!1,f=null,l=null,c=!0;t=Dt(0,t||0);if(n===!0){var v=!0;c=!1}else Ln(n)&&(v=n.leading,a="maxWait"in n&&Dt(t,n.maxWait||0),c="trailing"in n?n.trailing:c);return function(){r=arguments,s=this,o++,mt(l);if(a===!1)v&&o<2&&(i=e.apply(s,r));else{var n=new F;!f&&!v&&(u=n);var c=a-(n-u);c<=0?(mt(f),f=null,u=n,i=e.apply(s,r)):f||(f=Nt(d,c))}return t!==a&&(l=Nt(p,t)),i}}function Br(e){var n=jt.call(arguments,1);return Nt(function(){e.apply(t,n)},1)}function jr(e,n){var r=jt.call(arguments,2);return Nt(function(){e.apply(t,r)},n)}function Fr(e,t){function n(){var r=n.cache,i=o+(t?t.apply(this,arguments):arguments[0]);return Et.call(r,i)?r[i]:r[i]=e.apply(this,arguments)}return n.cache={},n}function Ir(e){var t,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function qr(e){return Kt(e,jt.call(arguments,1))}function Rr(e){return Kt(e,jt.call(arguments,1),null,s)}function Ur(e,t,n){var r=!0,i=!0;n===!1?r=!1:Ln(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n=Q(),n.leading=r,n.maxWait=t,n.trailing=i;var s=Hr(e,t,n);return et(n),s}function zr(e,t){return function(){var n=[e];return St.apply(n,arguments),t.apply(this,n)}}function Wr(e){return e==null?"":ut(e).replace(w,Yt)}function Xr(e){return e}function Vr(e){Jn(yn(e),function(t){var n=Ut[t]=e[t];Ut.prototype[t]=function(){var e=this.__wrapped__,t=[e];St.apply(t,arguments);var r=n.apply(Ut,t);return e&&typeof e=="object"&&e===r?this:new zt(r)}})}function $r(){return n._=pt,this}function Kr(e,t){e==null&&t==null&&(t=1),e=+e||0,t==null?(t=e,e=0):t=+t||0;var n=Bt();return e%1||t%1?e+Pt(n*(t-e+parseFloat("1e-"+((n+"").length-1))),t):e+yt(n*(t-e+1))}function Qr(e,n){var r=e?e[n]:t;return kn(r)?e[n]():r}function Gr(e,n,r){var i=Ut.templateSettings;e||(e=""),r=dn({},r,i);var s=dn({},r.imports,i.imports),o=un(s),u=Rn(s),a,h=0,d=r.interpolate||b,m="__p += '",g=ot((r.escape||b).source+"|"+d.source+"|"+(d===v?p:b).source+"|"+(r.evaluate||b).source+"|$","g");e.replace(g,function(t,n,r,i,s,o){return r||(r=i),m+=e.slice(h,o).replace(E,J),n&&(m+="' +\n__e("+n+") +\n'"),s&&(a=!0,m+="';\n"+s+";\n__p += '"),r&&(m+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),h=o+t.length,t}),m+="';\n";var y=r.variable,w=y;w||(y="obj",m="with ("+y+") {\n"+m+"\n}\n"),m=(a?m.replace(f,""):m).replace(l,"$1").replace(c,"$1;"),m="function("+y+") {\n"+(w?"":y+" || ("+y+" = {});\n")+"var __t, __p = '', __e = _.escape"+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var S="\n/*\n//@ sourceURL="+(r.sourceURL||"/lodash/template/source["+T++ +"]")+"\n*/";try{var x=R(o,"return "+m+S).apply(t,u)}catch(N){throw N.source=m,N}return n?x(n):(x.source=m,x)}function Yr(e,t,n){e=(e=+e)>-1?e:0;var i=-1,s=r(e);t=Ut.createCallback(t,n,1);while(++i<e)s[i]=t(i);return s}function Zr(e){return e==null?"":ut(e).replace(h,nn)}function ei(e){var t=++i;return ut(e==null?"":e)+t}function ti(e,t){return t(e),e}function ni(){return ut(this.__wrapped__)}function ri(){return this.__wrapped__}n=n?rt.defaults(e.Object(),n,rt.pick(e,S)):e;var r=n.Array,a=n.Boolean,F=n.Date,I=n.Error,R=n.Function,W=n.Math,it=n.Number,st=n.Object,ot=n.RegExp,ut=n.String,at=n.TypeError,ft=[],lt=I.prototype,ct=st.prototype,ht=ut.prototype,pt=n._,dt=ot("^"+ut(ct.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),vt=W.ceil,mt=n.clearTimeout,gt=ft.concat,yt=W.floor,bt=R.prototype.toString,wt=dt.test(wt=st.getPrototypeOf)&&wt,Et=ct.hasOwnProperty,St=ft.push,xt=ct.propertyIsEnumerable,Tt=n.setImmediate,Nt=n.setTimeout,Ct=ct.toString,kt=dt.test(kt=Ct.bind)&&kt,Lt=dt.test(Lt=st.create)&&Lt,At=dt.test(At=r.isArray)&&At,Ot=n.isFinite,Mt=n.isNaN,_t=dt.test(_t=st.keys)&&_t,Dt=W.max,Pt=W.min,Ht=n.parseInt,Bt=W.random,jt=ft.slice,Ft=dt.test(n.attachEvent),It=kt&&!/\n|true/.test(kt+Ft),qt={};qt[C]=r,qt[L]=a,qt[A]=F,qt[M]=R,qt[D]=st,qt[_]=it,qt[P]=ot,qt[H]=ut;var Rt={};Rt[C]=Rt[A]=Rt[_]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Rt[L]=Rt[H]={constructor:!0,toString:!0,valueOf:!0},Rt[O]=Rt[M]=Rt[P]={constructor:!0,toString:!0},Rt[D]={constructor:!0},function(){var e=x.length;while(e--){var t=x[e];for(var n in Rt)Et.call(Rt,n)&&!Et.call(Rt[n],t)&&(Rt[n][t]=!1)}}(),zt.prototype=Ut.prototype;var Wt=Ut.support={};(function(){var e=function(){this.x=1},t={0:1,length:1},n=[];e.prototype={valueOf:1,y:1};for(var i in new e)n.push(i);for(i in arguments);Wt.argsObject=arguments.constructor==st&&!(arguments instanceof r),Wt.argsClass=rn(arguments),Wt.enumErrorProps=xt.call(lt,"message")||xt.call(lt,"name"),Wt.enumPrototypes=xt.call(e,"prototype"),Wt.fastBind=kt&&!It,Wt.ownLast=n[0]!="x",Wt.nonEnumArgs=i!=0,Wt.nonEnumShadows=!/valueOf/.test(n),Wt.spliceObjects=(ft.splice.call(t,0,1),!t[0]),Wt.unindexedChars="x"[0]+st("x")[0]!="xx";try{Wt.nodeClass=Ct.call(document)!=D||!!({toString:0}+"")}catch(s){Wt.nodeClass=!0}})(1),Ut.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:Ut}};var Xt=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",Wt.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):Wt.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),Wt.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  "),Wt.enumErrorProps&&(t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];Wt.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Wt.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))');if(e.useHas&&e.useKeys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }  ";else{t+="\n  for (index in iterable) {\n",e.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }    ";if(Wt.nonEnumShadows){t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ";for(k=0;k<7;k++)t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),t+=") {\n      "+e.loop+";\n    }      ";t+="\n  }    "}}if(e.array||Wt.nonEnumArgs)t+="\n}";return t+=e.bottom+";\nreturn result",t},Vt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},$t={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Jt={top:"if (!objectTypes[typeof iterable]) return result;\n"+$t.top,array:!1};if(!Lt)var Gt=function(e){if(Ln(e)){Y.prototype=e;var t=new Y;Y.prototype=null}return t||{}};Wt.argsClass||(rn=function(e){return e?Et.call(e,"callee"):!1});var sn=At||function(e){return e?typeof e=="object"&&Ct.call(e)==C:!1},on=Qt({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),un=_t?function(e){return Ln(e)?Wt.enumPrototypes&&typeof e=="function"||Wt.nonEnumArgs&&e.length&&rn(e)?on(e):_t(e):[]}:on,an=Qt($t),fn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ln=wn(fn),cn=Qt(Vt,{top:Vt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),dn=Qt(Vt),mn=Qt($t,Jt,{useHas:!1}),gn=Qt($t,Jt);kn(/x/)&&(kn=function(e){return typeof e=="function"&&Ct.call(e)==M});var _n=wt?function(e){if(!e||Ct.call(e)!=D||!Wt.argsClass&&rn(e))return!1;var t=e.valueOf,n=typeof t=="function"&&(n=wt(t))&&wt(n);return n?e==n||wt(e)==n:tn(e)}:tn,er=Gn,fr=Vn,dr=en(function ii(e,t,n){var r=-1,i=e?e.length:0,s=[];while(++r<i){var o=e[r];n&&(o=n(o,r,e)),sn(o)?St.apply(s,t?o:ii(o)):s.push(o)}return s}),Tr=en(function(e,t,n){var r=-1,i=Zt(),s=e?e.length:0,o=[],a=!t&&s>=u&&i===U,f=n||a?K():o;if(a){var l=$(f);l?(i=z,f=l):(a=!1,f=n?f:(Z(f),o))}while(++r<s){var c=e[r],h=n?n(c,r,e):c;if(t?!r||f[f.length-1]!==h:i(f,h)<0)(n||a)&&f.push(h),o.push(c)}return a?(Z(f.array),et(f)):n&&Z(f),o});It&&q&&typeof Tt=="function"&&(Br=Or(Tt,n));var Jr=Ht(g+"08")==8?Ht:function(e,t){return Ht(Pn(e)?e.replace(y,""):e,t||0)};return Ut.after=Ar,Ut.assign=cn,Ut.at=Un,Ut.bind=Or,Ut.bindAll=Mr,Ut.bindKey=_r,Ut.compact=lr,Ut.compose=Dr,Ut.countBy=Wn,Ut.createCallback=Pr,Ut.debounce=Hr,Ut.defaults=dn,Ut.defer=Br,Ut.delay=jr,Ut.difference=cr,Ut.filter=Vn,Ut.flatten=dr,Ut.forEach=Jn,Ut.forIn=mn,Ut.forOwn=gn,Ut.functions=yn,Ut.groupBy=Kn,Ut.initial=mr,Ut.intersection=gr,Ut.invert=wn,Ut.invoke=Qn,Ut.keys=un,Ut.map=Gn,Ut.max=Yn,Ut.memoize=Fr,Ut.merge=Bn,Ut.min=Zn,Ut.omit=jn,Ut.once=Ir,Ut.pairs=Fn,Ut.partial=qr,Ut.partialRight=Rr,Ut.pick=In,Ut.pluck=er,Ut.range=wr,Ut.reject=rr,Ut.rest=Er,Ut.shuffle=ir,Ut.sortBy=ur,Ut.tap=ti,Ut.throttle=Ur,Ut.times=Yr,Ut.toArray=ar,Ut.transform=qn,Ut.union=xr,Ut.uniq=Tr,Ut.unzip=Nr,Ut.values=Rn,Ut.where=fr,Ut.without=Cr,Ut.wrap=zr,Ut.zip=kr,Ut.zipObject=Lr,Ut.collect=Gn,Ut.drop=Er,Ut.each=Jn,Ut.extend=cn,Ut.methods=yn,Ut.object=Lr,Ut.select=Vn,Ut.tail=Er,Ut.unique=Tr,Vr(Ut),Ut.chain=Ut,Ut.prototype.chain=function(){return this},Ut.clone=hn,Ut.cloneDeep=pn,Ut.contains=zn,Ut.escape=Wr,Ut.every=Xn,Ut.find=$n,Ut.findIndex=hr,Ut.findKey=vn,Ut.has=bn,Ut.identity=Xr,Ut.indexOf=vr,Ut.isArguments=rn,Ut.isArray=sn,Ut.isBoolean=En,Ut.isDate=Sn,Ut.isElement=xn,Ut.isEmpty=Tn,Ut.isEqual=Nn,Ut.isFinite=Cn,Ut.isFunction=kn,Ut.isNaN=An,Ut.isNull=On,Ut.isNumber=Mn,Ut.isObject=Ln,Ut.isPlainObject=_n,Ut.isRegExp=Dn,Ut.isString=Pn,Ut.isUndefined=Hn,Ut.lastIndexOf=br,Ut.mixin=Vr,Ut.noConflict=$r,Ut.parseInt=Jr,Ut.random=Kr,Ut.reduce=tr,Ut.reduceRight=nr,Ut.result=Qr,Ut.runInContext=nt,Ut.size=sr,Ut.some=or,Ut.sortedIndex=Sr,Ut.template=Gr,Ut.unescape=Zr,Ut.uniqueId=ei,Ut.all=Xn,Ut.any=or,Ut.detect=$n,Ut.findWhere=$n,Ut.foldl=tr,Ut.foldr=nr,Ut.include=zn,Ut.inject=tr,gn(Ut,function(e,t){Ut.prototype[t]||(Ut.prototype[t]=function(){var t=[this.__wrapped__];return St.apply(t,arguments),e.apply(Ut,t)})}),Ut.first=pr,Ut.last=yr,Ut.take=pr,Ut.head=pr,gn(Ut,function(e,t){Ut.prototype[t]||(Ut.prototype[t]=function(t,n){var r=e(this.__wrapped__,t,n);return t==null||n&&typeof t!="function"?r:new zt(r)})}),Ut.VERSION="1.3.1",Ut.prototype.toString=ni,Ut.prototype.value=ri,Ut.prototype.valueOf=ri,an(["join","pop","shift"],function(e){var t=ft[e];Ut.prototype[e]=function(){return t.apply(this.__wrapped__,arguments)}}),an(["push","reverse","sort","unshift"],function(e){var t=ft[e];Ut.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),an(["concat","slice","splice"],function(e){var t=ft[e];Ut.prototype[e]=function(){return new zt(t.apply(this.__wrapped__,arguments))}}),Wt.spliceObjects||an(["pop","shift","splice"],function(e){var t=ft[e],n=e=="splice";Ut.prototype[e]=function(){var e=this.__wrapped__,r=t.apply(e,arguments);return e.length===0&&delete e[0],n?new zt(r):r}}),Ut}var t,n=[],r=[],i=0,s={},o=+(new Date)+"",u=75,a=40,f=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,c=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/&(?:amp|lt|gt|quot|#39);/g,p=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,d=/\w*$/,v=/<%=([\s\S]+?)%>/g,m=(m=/\bthis\b/)&&m.test(nt)&&m,g=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",y=RegExp("^["+g+"]*0+(?=.$)"),b=/($^)/,w=/[&<>"']/g,E=/['\n\r\t\u2028\u2029\\]/g,S=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],x=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],T=0,N="[object Arguments]",C="[object Array]",L="[object Boolean]",A="[object Date]",O="[object Error]",M="[object Function]",_="[object Number]",D="[object Object]",P="[object RegExp]",H="[object String]",B={};B[M]=!1,B[N]=B[C]=B[L]=B[A]=B[_]=B[D]=B[P]=B[H]=!0;var j={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},F={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},I=j[typeof exports]&&exports,q=j[typeof module]&&module&&module.exports==I&&module,R=j[typeof global]&&global;R&&(R.global===R||R.window===R)&&(e=R);var rt=nt();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=rt,define("lodash",[],function(){return rt})):I&&!I.nodeType?q?(q.exports=rt)._=rt:I._=rt:e._=rt}(this),define("vent",["lodash"],function(e){var t=/\s+/,n=function(e,n,r,i){if(!r)return!0;if(typeof r=="object"){for(var s in r)e[n].apply(e,[s,r[s]].concat(i));return!1}if(t.test(r)){var o=r.split(t);for(var u=0,a=o.length;u<a;u++)e[n].apply(e,[o[u]].concat(i));return!1}return!0},r=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},i={on:function(e,t,r){if(!n(this,"on",e,[t,r])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:r,ctx:r||this}),this},once:function(t,r,i){if(!n(this,"once",t,[r,i])||!r)return this;var s=this,o=e.once(function(){s.off(t,o),r.apply(this,arguments)});return o._callback=r,this.on(t,o,i)},off:function(t,r,i){var s,o,u,a,f,l,c,h;if(!this._events||!n(this,"off",t,[r,i]))return this;if(!t&&!r&&!i)return this._events={},this;a=t?[t]:e.keys(this._events);for(f=0,l=a.length;f<l;f++){t=a[f];if(u=this._events[t]){this._events[t]=s=[];if(r||i)for(c=0,h=u.length;c<h;c++)o=u[c],(r&&r!==o.callback&&r!==o.callback._callback||i&&i!==o.context)&&s.push(o);s.length||delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var i=e.toArray(arguments).slice(1);if(!n(this,"trigger",t,i))return this;var s=this._events[t],o=this._events.all;return s&&r(s,i),o&&r(o,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},s={};return e.extend(s,i)}),define("messaging/message",["lodash","messaging"],function(e){return Message=function(){},Message.from=function(t,n){var n=n||{},r=new this,i=function(r){if(r instanceof ArrayBuffer){var i=require("messaging"),s=new DataView(r),o=0,u=0,a,f,l,c;while(o<t.byteformat.length)a=t.byteformat.charAt(o),format=i.format[a],c=i.extractValue(s["get"+format](u),a),hydrator=n["hydrate"+t.format[o].charAt(0).toUpperCase()+t.format[o].substring(1)],hydrator&&(c=hydrator.call(n,c)),this[t.format[o]]=c,u+=i.getTypeByteLength(format),o++}else e.extend(this,r)};return r.toBuffer=function(){var e=require("messaging"),n=e.calcByteSize(t),r=ArrayBuffer(n),i=new DataView(r),s=0,o=0,u,a,f;while(s<t.byteformat.length)a=t.byteformat.charAt(s),u=e.format[a],f=this[t.format[s]],i["set"+u](o,f),o+=e.getTypeByteLength(u),s++;return r},r.schema=t,i.prototype=r,i.prototype.constructor=i,i.extend=arguments.calee,i.schema=t,i},Message}),define("messaging/frame",["messaging/message"],function(e){var t={id:1,format:["id","x","y","direction","state"],byteformat:"IffBB"},n=e.from(t);return n}),define("messaging/update",["messaging/message"],function(e){var t={id:2,format:["id","entityType","remove"],byteformat:"IB?"},n={entityTypeLookup:{0:"unknown",1:"collidable",2:"player",3:"arrow"},hydrateEntityType:function(e){return this.entityTypeLookup[e]}},r=e.from(t,n);return r}),define("messaging/useraction",["messaging/message"],function(e){var t={id:3,format:["action","direction"],byteformat:"BB"},n=e.from(t);return n}),define("messaging",["require","lodash","messaging/frame","messaging/update","messaging/useraction"],function(e,t,n,r,i){var s={format:{b:"Int8",B:"Uint8","?":"Uint8",h:"Int16",H:"Uint16",i:"Int32",I:"Uint32",f:"Float32",d:"Float64"},messages:{1:n,2:r,3:i},copyBytes:function(e,t,n,r,i){var s=new Uint8Array(t,r);s.set(new Uint8Array(e,n,i))},getTypeByteLength:function(e){return window[e+"Array"].BYTES_PER_ELEMENT},calcByteSize:function(e){var t=0,n=0,r;while(n<e.byteformat.length)r=this.format[e.byteformat.charAt(n)],t+=this.getTypeByteLength(r),n++;return t},extractValue:function(e,t){return t==="?"&&(e=!!e),e},fromBuffer:function(e){var t=new DataView(e),n=this.messages[t.getUint8(0)],r=this.calcByteSize(n.schema),i=1,s,o=[];while(i<e.byteLength)s=new n(e.slice(i,i+r)),o.push(s),i+=r;return o},toBuffer:function(e){var t=1,n=0,r,i,s,o,u;if(e.length){r=this.messages[e[0].constructor.schema.id],o=this.calcByteSize(e[0].constructor.schema),t+=e.length*o,i=new ArrayBuffer(t),s=new DataView(i),s.setUint8(0,e[0].constructor.schema.id),n=1;while(e.length)u=e.shift(),this.copyBytes(u.toBuffer(),i,0,n,o),n+=o;return i}return new ArrayBuffer(0)}};return s}),define("networking",["lodash","vent","messaging"],function(e,t,n){return{init:function(){var e=this;this.ws=new WebSocket("ws://localhost:9000"),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.ws.onmessage=e.onmessage}},onmessage:function(e){messages=n.fromBuffer(e.data),t.trigger("hello"),messages[0].schema.id===2&&messages.forEach(function(e){}),messages[0].schema.id===1&&messages.forEach(function(e){})}}}),define("entityfactory",["pc"],function(){var e=pc.EntityFactory.extend("pc.archers.EntityFactory",{},{createEntity:function(){}});return e}),define("scenes/game",["pc","entityfactory"],function(e,t){var n=e.Scene.extend("pc.archers.GameScene",{},{init:function(){this._super(),this.factory=new t,this.loadFromTMX(e.device.loader.get("map").resource,this.factory)}});return n}),define("archers",["pc","vent","networking","scenes/game"],function(e,t,n,r){var i=e.Game.extend("Archers",{},{onReady:function(){this._super(),e.device.loader.add(new e.DataResource("map","/resources/map.tmx")),e.device.loader.add(new e.Image("combined","/resources/tiles.png")),e.device.loader.add(new e.Image("archer","/resources/archer.png")),t.on("hello",function(){console.log("hello world")}),e.device.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this))},onLoading:function(t){var n=e.device.ctx;n.clearRect(0,0,e.device.canvasWidth,e.device.canvasHeight),n.font="normal 50px Times",n.fillStyle="#bbb",n.fillText("Archers!",40,e.device.canvasHeight/2-50),n.font="normal 14px Verdana",n.fillStyle="#777",n.fillText("Loading:  "+t+"%",40,e.device.canvasHeight/2)},onLoaded:function(){this.gameScene=new r,this.addScene(this.gameScene),this.activateScene(this.gameScene),console.warn("LOADED"),this.networking=n,this.networking.init()}});return i});